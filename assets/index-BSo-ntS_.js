(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function tz(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var VT={exports:{}},Qy={};var gF;function G7(){if(gF)return Qy;gF=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(r,a,s){var i=null;if(s!==void 0&&(i=""+s),a.key!==void 0&&(i=""+a.key),"key"in a){s={};for(var o in a)o!=="key"&&(s[o]=a[o])}else s=a;return a=s.ref,{$$typeof:e,type:r,key:i,ref:a!==void 0?a:null,props:s}}return Qy.Fragment=t,Qy.jsx=n,Qy.jsxs=n,Qy}var yF;function q7(){return yF||(yF=1,VT.exports=G7()),VT.exports}var G=q7(),UT={exports:{}},It={};var bF;function K7(){if(bF)return It;bF=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),i=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function g(H){return H===null||typeof H!="object"?null:(H=m&&H[m]||H["@@iterator"],typeof H=="function"?H:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,x={};function _(H,se,ue){this.props=H,this.context=se,this.refs=x,this.updater=ue||b}_.prototype.isReactComponent={},_.prototype.setState=function(H,se){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,se,"setState")},_.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function I(){}I.prototype=_.prototype;function k(H,se,ue){this.props=H,this.context=se,this.refs=x,this.updater=ue||b}var E=k.prototype=new I;E.constructor=k,v(E,_.prototype),E.isPureReactComponent=!0;var R=Array.isArray;function U(){}var D={H:null,A:null,T:null,S:null},C=Object.prototype.hasOwnProperty;function O(H,se,ue){var ge=ue.ref;return{$$typeof:e,type:H,key:se,ref:ge!==void 0?ge:null,props:ue}}function z(H,se){return O(H.type,se,H.props)}function M(H){return typeof H=="object"&&H!==null&&H.$$typeof===e}function N(H){var se={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(ue){return se[ue]})}var P=/\/+/g;function Q(H,se){return typeof H=="object"&&H!==null&&H.key!=null?N(""+H.key):se.toString(36)}function ee(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(U,U):(H.status="pending",H.then(function(se){H.status==="pending"&&(H.status="fulfilled",H.value=se)},function(se){H.status==="pending"&&(H.status="rejected",H.reason=se)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function q(H,se,ue,ge,Ee){var $e=typeof H;($e==="undefined"||$e==="boolean")&&(H=null);var Oe=!1;if(H===null)Oe=!0;else switch($e){case"bigint":case"string":case"number":Oe=!0;break;case"object":switch(H.$$typeof){case e:case t:Oe=!0;break;case c:return Oe=H._init,q(Oe(H._payload),se,ue,ge,Ee)}}if(Oe)return Ee=Ee(H),Oe=ge===""?"."+Q(H,0):ge,R(Ee)?(ue="",Oe!=null&&(ue=Oe.replace(P,"$&/")+"/"),q(Ee,se,ue,"",function(at){return at})):Ee!=null&&(M(Ee)&&(Ee=z(Ee,ue+(Ee.key==null||H&&H.key===Ee.key?"":(""+Ee.key).replace(P,"$&/")+"/")+Oe)),se.push(Ee)),1;Oe=0;var Fe=ge===""?".":ge+":";if(R(H))for(var We=0;We<H.length;We++)ge=H[We],$e=Fe+Q(ge,We),Oe+=q(ge,se,ue,$e,Ee);else if(We=g(H),typeof We=="function")for(H=We.call(H),We=0;!(ge=H.next()).done;)ge=ge.value,$e=Fe+Q(ge,We++),Oe+=q(ge,se,ue,$e,Ee);else if($e==="object"){if(typeof H.then=="function")return q(ee(H),se,ue,ge,Ee);throw se=String(H),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.")}return Oe}function Z(H,se,ue){if(H==null)return H;var ge=[],Ee=0;return q(H,ge,"","",function($e){return se.call(ue,$e,Ee++)}),ge}function ne(H){if(H._status===-1){var se=H._result;se=se(),se.then(function(ue){(H._status===0||H._status===-1)&&(H._status=1,H._result=ue)},function(ue){(H._status===0||H._status===-1)&&(H._status=2,H._result=ue)}),H._status===-1&&(H._status=0,H._result=se)}if(H._status===1)return H._result.default;throw H._result}var me=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var se=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(se))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)},xe={map:Z,forEach:function(H,se,ue){Z(H,function(){se.apply(this,arguments)},ue)},count:function(H){var se=0;return Z(H,function(){se++}),se},toArray:function(H){return Z(H,function(se){return se})||[]},only:function(H){if(!M(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return It.Activity=p,It.Children=xe,It.Component=_,It.Fragment=n,It.Profiler=a,It.PureComponent=k,It.StrictMode=r,It.Suspense=l,It.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,It.__COMPILER_RUNTIME={__proto__:null,c:function(H){return D.H.useMemoCache(H)}},It.cache=function(H){return function(){return H.apply(null,arguments)}},It.cacheSignal=function(){return null},It.cloneElement=function(H,se,ue){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var ge=v({},H.props),Ee=H.key;if(se!=null)for($e in se.key!==void 0&&(Ee=""+se.key),se)!C.call(se,$e)||$e==="key"||$e==="__self"||$e==="__source"||$e==="ref"&&se.ref===void 0||(ge[$e]=se[$e]);var $e=arguments.length-2;if($e===1)ge.children=ue;else if(1<$e){for(var Oe=Array($e),Fe=0;Fe<$e;Fe++)Oe[Fe]=arguments[Fe+2];ge.children=Oe}return O(H.type,Ee,ge)},It.createContext=function(H){return H={$$typeof:i,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:s,_context:H},H},It.createElement=function(H,se,ue){var ge,Ee={},$e=null;if(se!=null)for(ge in se.key!==void 0&&($e=""+se.key),se)C.call(se,ge)&&ge!=="key"&&ge!=="__self"&&ge!=="__source"&&(Ee[ge]=se[ge]);var Oe=arguments.length-2;if(Oe===1)Ee.children=ue;else if(1<Oe){for(var Fe=Array(Oe),We=0;We<Oe;We++)Fe[We]=arguments[We+2];Ee.children=Fe}if(H&&H.defaultProps)for(ge in Oe=H.defaultProps,Oe)Ee[ge]===void 0&&(Ee[ge]=Oe[ge]);return O(H,$e,Ee)},It.createRef=function(){return{current:null}},It.forwardRef=function(H){return{$$typeof:o,render:H}},It.isValidElement=M,It.lazy=function(H){return{$$typeof:c,_payload:{_status:-1,_result:H},_init:ne}},It.memo=function(H,se){return{$$typeof:h,type:H,compare:se===void 0?null:se}},It.startTransition=function(H){var se=D.T,ue={};D.T=ue;try{var ge=H(),Ee=D.S;Ee!==null&&Ee(ue,ge),typeof ge=="object"&&ge!==null&&typeof ge.then=="function"&&ge.then(U,me)}catch($e){me($e)}finally{se!==null&&ue.types!==null&&(se.types=ue.types),D.T=se}},It.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},It.use=function(H){return D.H.use(H)},It.useActionState=function(H,se,ue){return D.H.useActionState(H,se,ue)},It.useCallback=function(H,se){return D.H.useCallback(H,se)},It.useContext=function(H){return D.H.useContext(H)},It.useDebugValue=function(){},It.useDeferredValue=function(H,se){return D.H.useDeferredValue(H,se)},It.useEffect=function(H,se){return D.H.useEffect(H,se)},It.useEffectEvent=function(H){return D.H.useEffectEvent(H)},It.useId=function(){return D.H.useId()},It.useImperativeHandle=function(H,se,ue){return D.H.useImperativeHandle(H,se,ue)},It.useInsertionEffect=function(H,se){return D.H.useInsertionEffect(H,se)},It.useLayoutEffect=function(H,se){return D.H.useLayoutEffect(H,se)},It.useMemo=function(H,se){return D.H.useMemo(H,se)},It.useOptimistic=function(H,se){return D.H.useOptimistic(H,se)},It.useReducer=function(H,se,ue){return D.H.useReducer(H,se,ue)},It.useRef=function(H){return D.H.useRef(H)},It.useState=function(H){return D.H.useState(H)},It.useSyncExternalStore=function(H,se,ue){return D.H.useSyncExternalStore(H,se,ue)},It.useTransition=function(){return D.H.useTransition()},It.version="19.2.0",It}var vF;function mN(){return vF||(vF=1,UT.exports=K7()),UT.exports}var fe=mN();const X7=tz(fe);var BT={exports:{}},Zy={},WT={exports:{}},jT={};var xF;function Y7(){return xF||(xF=1,(function(e){function t(q,Z){var ne=q.length;q.push(Z);e:for(;0<ne;){var me=ne-1>>>1,xe=q[me];if(0<a(xe,Z))q[me]=Z,q[ne]=xe,ne=me;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var Z=q[0],ne=q.pop();if(ne!==Z){q[0]=ne;e:for(var me=0,xe=q.length,H=xe>>>1;me<H;){var se=2*(me+1)-1,ue=q[se],ge=se+1,Ee=q[ge];if(0>a(ue,ne))ge<xe&&0>a(Ee,ue)?(q[me]=Ee,q[ge]=ne,me=ge):(q[me]=ue,q[se]=ne,me=se);else if(ge<xe&&0>a(Ee,ne))q[me]=Ee,q[ge]=ne,me=ge;else break e}}return Z}function a(q,Z){var ne=q.sortIndex-Z.sortIndex;return ne!==0?ne:q.id-Z.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var i=Date,o=i.now();e.unstable_now=function(){return i.now()-o}}var l=[],h=[],c=1,p=null,m=3,g=!1,b=!1,v=!1,x=!1,_=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function E(q){for(var Z=n(h);Z!==null;){if(Z.callback===null)r(h);else if(Z.startTime<=q)r(h),Z.sortIndex=Z.expirationTime,t(l,Z);else break;Z=n(h)}}function R(q){if(v=!1,E(q),!b)if(n(l)!==null)b=!0,U||(U=!0,N());else{var Z=n(h);Z!==null&&ee(R,Z.startTime-q)}}var U=!1,D=-1,C=5,O=-1;function z(){return x?!0:!(e.unstable_now()-O<C)}function M(){if(x=!1,U){var q=e.unstable_now();O=q;var Z=!0;try{e:{b=!1,v&&(v=!1,I(D),D=-1),g=!0;var ne=m;try{t:{for(E(q),p=n(l);p!==null&&!(p.expirationTime>q&&z());){var me=p.callback;if(typeof me=="function"){p.callback=null,m=p.priorityLevel;var xe=me(p.expirationTime<=q);if(q=e.unstable_now(),typeof xe=="function"){p.callback=xe,E(q),Z=!0;break t}p===n(l)&&r(l),E(q)}else r(l);p=n(l)}if(p!==null)Z=!0;else{var H=n(h);H!==null&&ee(R,H.startTime-q),Z=!1}}break e}finally{p=null,m=ne,g=!1}Z=void 0}}finally{Z?N():U=!1}}}var N;if(typeof k=="function")N=function(){k(M)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,Q=P.port2;P.port1.onmessage=M,N=function(){Q.postMessage(null)}}else N=function(){_(M,0)};function ee(q,Z){D=_(function(){q(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(q){q.callback=null},e.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<q?Math.floor(1e3/q):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_next=function(q){switch(m){case 1:case 2:case 3:var Z=3;break;default:Z=m}var ne=m;m=Z;try{return q()}finally{m=ne}},e.unstable_requestPaint=function(){x=!0},e.unstable_runWithPriority=function(q,Z){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ne=m;m=q;try{return Z()}finally{m=ne}},e.unstable_scheduleCallback=function(q,Z,ne){var me=e.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?me+ne:me):ne=me,q){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=ne+xe,q={id:c++,callback:Z,priorityLevel:q,startTime:ne,expirationTime:xe,sortIndex:-1},ne>me?(q.sortIndex=ne,t(h,q),n(l)===null&&q===n(h)&&(v?(I(D),D=-1):v=!0,ee(R,ne-me))):(q.sortIndex=xe,t(l,q),b||g||(b=!0,U||(U=!0,N()))),q},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(q){var Z=m;return function(){var ne=m;m=Z;try{return q.apply(this,arguments)}finally{m=ne}}}})(jT)),jT}var wF;function Q7(){return wF||(wF=1,WT.exports=Y7()),WT.exports}var HT={exports:{}},Oa={};var _F;function Z7(){if(_F)return Oa;_F=1;var e=mN();function t(l){var h="https://react.dev/errors/"+l;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)h+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function s(l,h,c){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:p==null?null:""+p,children:l,containerInfo:h,implementation:c}}var i=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,h){if(l==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Oa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Oa.createPortal=function(l,h){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return s(l,h,null,c)},Oa.flushSync=function(l){var h=i.T,c=r.p;try{if(i.T=null,r.p=2,l)return l()}finally{i.T=h,r.p=c,r.d.f()}},Oa.preconnect=function(l,h){typeof l=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(l,h))},Oa.prefetchDNS=function(l){typeof l=="string"&&r.d.D(l)},Oa.preinit=function(l,h){if(typeof l=="string"&&h&&typeof h.as=="string"){var c=h.as,p=o(c,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,g=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;c==="style"?r.d.S(l,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:g}):c==="script"&&r.d.X(l,{crossOrigin:p,integrity:m,fetchPriority:g,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Oa.preinitModule=function(l,h){if(typeof l=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var c=o(h.as,h.crossOrigin);r.d.M(l,{crossOrigin:c,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(l)},Oa.preload=function(l,h){if(typeof l=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var c=h.as,p=o(c,h.crossOrigin);r.d.L(l,c,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Oa.preloadModule=function(l,h){if(typeof l=="string")if(h){var c=o(h.as,h.crossOrigin);r.d.m(l,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:c,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(l)},Oa.requestFormReset=function(l){r.d.r(l)},Oa.unstable_batchedUpdates=function(l,h){return l(h)},Oa.useFormState=function(l,h,c){return i.H.useFormState(l,h,c)},Oa.useFormStatus=function(){return i.H.useHostTransitionStatus()},Oa.version="19.2.0",Oa}var SF;function J7(){if(SF)return HT.exports;SF=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),HT.exports=Z7(),HT.exports}var IF;function eK(){if(IF)return Zy;IF=1;var e=Q7(),t=mN(),n=J7();function r(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function s(u){var d=u,f=u;if(u.alternate)for(;d.return;)d=d.return;else{u=d;do d=u,(d.flags&4098)!==0&&(f=d.return),u=d.return;while(u)}return d.tag===3?f:null}function i(u){if(u.tag===13){var d=u.memoizedState;if(d===null&&(u=u.alternate,u!==null&&(d=u.memoizedState)),d!==null)return d.dehydrated}return null}function o(u){if(u.tag===31){var d=u.memoizedState;if(d===null&&(u=u.alternate,u!==null&&(d=u.memoizedState)),d!==null)return d.dehydrated}return null}function l(u){if(s(u)!==u)throw Error(r(188))}function h(u){var d=u.alternate;if(!d){if(d=s(u),d===null)throw Error(r(188));return d!==u?null:u}for(var f=u,y=d;;){var S=f.return;if(S===null)break;var T=S.alternate;if(T===null){if(y=S.return,y!==null){f=y;continue}break}if(S.child===T.child){for(T=S.child;T;){if(T===f)return l(S),u;if(T===y)return l(S),d;T=T.sibling}throw Error(r(188))}if(f.return!==y.return)f=S,y=T;else{for(var L=!1,j=S.child;j;){if(j===f){L=!0,f=S,y=T;break}if(j===y){L=!0,y=S,f=T;break}j=j.sibling}if(!L){for(j=T.child;j;){if(j===f){L=!0,f=T,y=S;break}if(j===y){L=!0,y=T,f=S;break}j=j.sibling}if(!L)throw Error(r(189))}}if(f.alternate!==y)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?u:d}function c(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u;for(u=u.child;u!==null;){if(d=c(u),d!==null)return d;u=u.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),k=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),M=Symbol.iterator;function N(u){return u===null||typeof u!="object"?null:(u=M&&u[M]||u["@@iterator"],typeof u=="function"?u:null)}var P=Symbol.for("react.client.reference");function Q(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===P?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case v:return"Fragment";case _:return"Profiler";case x:return"StrictMode";case R:return"Suspense";case U:return"SuspenseList";case O:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case b:return"Portal";case k:return u.displayName||"Context";case I:return(u._context.displayName||"Context")+".Consumer";case E:var d=u.render;return u=u.displayName,u||(u=d.displayName||d.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case D:return d=u.displayName||null,d!==null?d:Q(u.type)||"Memo";case C:d=u._payload,u=u._init;try{return Q(u(d))}catch{}}return null}var ee=Array.isArray,q=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne={pending:!1,data:null,method:null,action:null},me=[],xe=-1;function H(u){return{current:u}}function se(u){0>xe||(u.current=me[xe],me[xe]=null,xe--)}function ue(u,d){xe++,me[xe]=u.current,u.current=d}var ge=H(null),Ee=H(null),$e=H(null),Oe=H(null);function Fe(u,d){switch(ue($e,d),ue(Ee,u),ue(ge,null),d.nodeType){case 9:case 11:u=(u=d.documentElement)&&(u=u.namespaceURI)?zO(u):0;break;default:if(u=d.tagName,d=d.namespaceURI)d=zO(d),u=VO(d,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}se(ge),ue(ge,u)}function We(){se(ge),se(Ee),se($e)}function at(u){u.memoizedState!==null&&ue(Oe,u);var d=ge.current,f=VO(d,u.type);d!==f&&(ue(Ee,u),ue(ge,f))}function pt(u){Ee.current===u&&(se(ge),se(Ee)),Oe.current===u&&(se(Oe),qy._currentValue=ne)}var bt,Bt;function vt(u){if(bt===void 0)try{throw Error()}catch(f){var d=f.stack.trim().match(/\n( *(at )?)/);bt=d&&d[1]||"",Bt=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bt+u+Bt}var Mt=!1;function ut(u,d){if(!u||Mt)return"";Mt=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(d){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(Ie){var we=Ie}Reflect.construct(u,[],De)}else{try{De.call()}catch(Ie){we=Ie}u.call(De.prototype)}}else{try{throw Error()}catch(Ie){we=Ie}(De=u())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(Ie){if(Ie&&we&&typeof Ie.stack=="string")return[Ie.stack,we.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=y.DetermineComponentFrameRoot(),L=T[0],j=T[1];if(L&&j){var ae=L.split(`
`),ve=j.split(`
`);for(S=y=0;y<ae.length&&!ae[y].includes("DetermineComponentFrameRoot");)y++;for(;S<ve.length&&!ve[S].includes("DetermineComponentFrameRoot");)S++;if(y===ae.length||S===ve.length)for(y=ae.length-1,S=ve.length-1;1<=y&&0<=S&&ae[y]!==ve[S];)S--;for(;1<=y&&0<=S;y--,S--)if(ae[y]!==ve[S]){if(y!==1||S!==1)do if(y--,S--,0>S||ae[y]!==ve[S]){var Ne=`
`+ae[y].replace(" at new "," at ");return u.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",u.displayName)),Ne}while(1<=y&&0<=S);break}}}finally{Mt=!1,Error.prepareStackTrace=f}return(f=u?u.displayName||u.name:"")?vt(f):""}function Lt(u,d){switch(u.tag){case 26:case 27:case 5:return vt(u.type);case 16:return vt("Lazy");case 13:return u.child!==d&&d!==null?vt("Suspense Fallback"):vt("Suspense");case 19:return vt("SuspenseList");case 0:case 15:return ut(u.type,!1);case 11:return ut(u.type.render,!1);case 1:return ut(u.type,!0);case 31:return vt("Activity");default:return""}}function nn(u){try{var d="",f=null;do d+=Lt(u,f),f=u,u=u.return;while(u);return d}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}var Xt=Object.prototype.hasOwnProperty,Et=e.unstable_scheduleCallback,Gn=e.unstable_cancelCallback,ur=e.unstable_shouldYield,Dr=e.unstable_requestPaint,kn=e.unstable_now,cr=e.unstable_getCurrentPriorityLevel,vr=e.unstable_ImmediatePriority,qn=e.unstable_UserBlockingPriority,hr=e.unstable_NormalPriority,si=e.unstable_LowPriority,lo=e.unstable_IdlePriority,ds=e.log,uo=e.unstable_setDisableYieldValue,dr=null,On=null;function ln(u){if(typeof ds=="function"&&uo(u),On&&typeof On.setStrictMode=="function")try{On.setStrictMode(dr,u)}catch{}}var Fn=Math.clz32?Math.clz32:rl,nl=Math.log,Ri=Math.LN2;function rl(u){return u>>>=0,u===0?32:31-(nl(u)/Ri|0)|0}var Mr=256,ps=262144,Ln=4194304;function oa(u){var d=u&42;if(d!==0)return d;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function la(u,d,f){var y=u.pendingLanes;if(y===0)return 0;var S=0,T=u.suspendedLanes,L=u.pingedLanes;u=u.warmLanes;var j=y&134217727;return j!==0?(y=j&~T,y!==0?S=oa(y):(L&=j,L!==0?S=oa(L):f||(f=j&~u,f!==0&&(S=oa(f))))):(j=y&~T,j!==0?S=oa(j):L!==0?S=oa(L):f||(f=y&~u,f!==0&&(S=oa(f)))),S===0?0:d!==0&&d!==S&&(d&T)===0&&(T=S&-S,f=d&-d,T>=f||T===32&&(f&4194048)!==0)?d:S}function Aa(u,d){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&d)===0}function Te(u,d){switch(u){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Le(){var u=Ln;return Ln<<=1,(Ln&62914560)===0&&(Ln=4194304),u}function Qe(u){for(var d=[],f=0;31>f;f++)d.push(u);return d}function Ve(u,d){u.pendingLanes|=d,d!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function un(u,d,f,y,S,T){var L=u.pendingLanes;u.pendingLanes=f,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=f,u.entangledLanes&=f,u.errorRecoveryDisabledLanes&=f,u.shellSuspendCounter=0;var j=u.entanglements,ae=u.expirationTimes,ve=u.hiddenUpdates;for(f=L&~f;0<f;){var Ne=31-Fn(f),De=1<<Ne;j[Ne]=0,ae[Ne]=-1;var we=ve[Ne];if(we!==null)for(ve[Ne]=null,Ne=0;Ne<we.length;Ne++){var Ie=we[Ne];Ie!==null&&(Ie.lane&=-536870913)}f&=~De}y!==0&&rn(u,y,0),T!==0&&S===0&&u.tag!==0&&(u.suspendedLanes|=T&~(L&~d))}function rn(u,d,f){u.pendingLanes|=d,u.suspendedLanes&=~d;var y=31-Fn(d);u.entangledLanes|=d,u.entanglements[y]=u.entanglements[y]|1073741824|f&261930}function xt(u,d){var f=u.entangledLanes|=d;for(u=u.entanglements;f;){var y=31-Fn(f),S=1<<y;S&d|u[y]&d&&(u[y]|=d),f&=~S}}function mt(u,d){var f=d&-d;return f=(f&42)!==0?1:bn(f),(f&(u.suspendedLanes|d))!==0?0:f}function bn(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function nr(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function fs(){var u=Z.p;return u!==0?u:(u=window.event,u===void 0?32:uF(u.type))}function Ra(u,d){var f=Z.p;try{return Z.p=u,d()}finally{Z.p=f}}var ya=Math.random().toString(36).slice(2),zn="__reactFiber$"+ya,Yt="__reactProps$"+ya,Kr="__reactContainer$"+ya,Di="__reactEvents$"+ya,hy="__reactListeners$"+ya,iu="__reactHandles$"+ya,nf="__reactResources$"+ya,ii="__reactMarker$"+ya;function ou(u){delete u[zn],delete u[Yt],delete u[Di],delete u[hy],delete u[iu]}function Da(u){var d=u[zn];if(d)return d;for(var f=u.parentNode;f;){if(d=f[Kr]||f[zn]){if(f=d.alternate,d.child!==null||f!==null&&f.child!==null)for(u=qO(u);u!==null;){if(f=u[zn])return f;u=qO(u)}return d}u=f,f=u.parentNode}return null}function ms(u){if(u=u[zn]||u[Kr]){var d=u.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return u}return null}function Qa(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u.stateNode;throw Error(r(33))}function Ls(u){var d=u[nf];return d||(d=u[nf]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function pr(u){u[ii]=!0}var al=new Set,th={};function oi(u,d){li(u,d),li(u+"Capture",d)}function li(u,d){for(th[u]=d,u=0;u<d.length;u++)al.add(d[u])}var ui=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sl={},nh={};function rf(u){return Xt.call(nh,u)?!0:Xt.call(sl,u)?!1:ui.test(u)?nh[u]=!0:(sl[u]=!0,!1)}function lu(u,d,f){if(rf(d))if(f===null)u.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":u.removeAttribute(d);return;case"boolean":var y=d.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){u.removeAttribute(d);return}}u.setAttribute(d,""+f)}}function Za(u,d,f){if(f===null)u.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(d);return}u.setAttribute(d,""+f)}}function rr(u,d,f,y){if(y===null)u.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(f);return}u.setAttributeNS(d,f,""+y)}}function xr(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function co(u){var d=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function rh(u,d,f){var y=Object.getOwnPropertyDescriptor(u.constructor.prototype,d);if(!u.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var S=y.get,T=y.set;return Object.defineProperty(u,d,{configurable:!0,get:function(){return S.call(this)},set:function(L){f=""+L,T.call(this,L)}}),Object.defineProperty(u,d,{enumerable:y.enumerable}),{getValue:function(){return f},setValue:function(L){f=""+L},stopTracking:function(){u._valueTracker=null,delete u[d]}}}}function an(u){if(!u._valueTracker){var d=co(u)?"checked":"value";u._valueTracker=rh(u,d,""+u[d])}}function ho(u){if(!u)return!1;var d=u._valueTracker;if(!d)return!0;var f=d.getValue(),y="";return u&&(y=co(u)?u.checked?"true":"false":u.value),u=y,u!==f?(d.setValue(u),!0):!1}function ci(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var il=/[\n"\\]/g;function Ma(u){return u.replace(il,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function uu(u,d,f,y,S,T,L,j){u.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?u.type=L:u.removeAttribute("type"),d!=null?L==="number"?(d===0&&u.value===""||u.value!=d)&&(u.value=""+xr(d)):u.value!==""+xr(d)&&(u.value=""+xr(d)):L!=="submit"&&L!=="reset"||u.removeAttribute("value"),d!=null?po(u,L,xr(d)):f!=null?po(u,L,xr(f)):y!=null&&u.removeAttribute("value"),S==null&&T!=null&&(u.defaultChecked=!!T),S!=null&&(u.checked=S&&typeof S!="function"&&typeof S!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?u.name=""+xr(j):u.removeAttribute("name")}function ah(u,d,f,y,S,T,L,j){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(u.type=T),d!=null||f!=null){if(!(T!=="submit"&&T!=="reset"||d!=null)){an(u);return}f=f!=null?""+xr(f):"",d=d!=null?""+xr(d):f,j||d===u.value||(u.value=d),u.defaultValue=d}y=y??S,y=typeof y!="function"&&typeof y!="symbol"&&!!y,u.checked=j?u.checked:!!y,u.defaultChecked=!!y,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(u.name=L),an(u)}function po(u,d,f){d==="number"&&ci(u.ownerDocument)===u||u.defaultValue===""+f||(u.defaultValue=""+f)}function Mi(u,d,f,y){if(u=u.options,d){d={};for(var S=0;S<f.length;S++)d["$"+f[S]]=!0;for(f=0;f<u.length;f++)S=d.hasOwnProperty("$"+u[f].value),u[f].selected!==S&&(u[f].selected=S),S&&y&&(u[f].defaultSelected=!0)}else{for(f=""+xr(f),d=null,S=0;S<u.length;S++){if(u[S].value===f){u[S].selected=!0,y&&(u[S].defaultSelected=!0);return}d!==null||u[S].disabled||(d=u[S])}d!==null&&(d.selected=!0)}}function sh(u,d,f){if(d!=null&&(d=""+xr(d),d!==u.value&&(u.value=d),f==null)){u.defaultValue!==d&&(u.defaultValue=d);return}u.defaultValue=f!=null?""+xr(f):""}function $i(u,d,f,y){if(d==null){if(y!=null){if(f!=null)throw Error(r(92));if(ee(y)){if(1<y.length)throw Error(r(93));y=y[0]}f=y}f==null&&(f=""),d=f}f=xr(d),u.defaultValue=f,y=u.textContent,y===f&&y!==""&&y!==null&&(u.value=y),an(u)}function ua(u,d){if(d){var f=u.firstChild;if(f&&f===u.lastChild&&f.nodeType===3){f.nodeValue=d;return}}u.textContent=d}var ih=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function cu(u,d,f){var y=d.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?y?u.setProperty(d,""):d==="float"?u.cssFloat="":u[d]="":y?u.setProperty(d,f):typeof f!="number"||f===0||ih.has(d)?d==="float"?u.cssFloat=f:u[d]=(""+f).trim():u[d]=f+"px"}function ol(u,d,f){if(d!=null&&typeof d!="object")throw Error(r(62));if(u=u.style,f!=null){for(var y in f)!f.hasOwnProperty(y)||d!=null&&d.hasOwnProperty(y)||(y.indexOf("--")===0?u.setProperty(y,""):y==="float"?u.cssFloat="":u[y]="");for(var S in d)y=d[S],d.hasOwnProperty(S)&&f[S]!==y&&cu(u,S,y)}else for(var T in d)d.hasOwnProperty(T)&&cu(u,T,d[T])}function Oi(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ll=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ul(u){return zs.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function $a(){}var fo=null;function gs(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Y=null,de=null;function Pe(u){var d=ms(u);if(d&&(u=d.stateNode)){var f=u[Yt]||null;e:switch(u=d.stateNode,d.type){case"input":if(uu(u,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),d=f.name,f.type==="radio"&&d!=null){for(f=u;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Ma(""+d)+'"][type="radio"]'),d=0;d<f.length;d++){var y=f[d];if(y!==u&&y.form===u.form){var S=y[Yt]||null;if(!S)throw Error(r(90));uu(y,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(d=0;d<f.length;d++)y=f[d],y.form===u.form&&ho(y)}break e;case"textarea":sh(u,f.value,f.defaultValue);break e;case"select":d=f.value,d!=null&&Mi(u,!!f.multiple,d,!1)}}}var st=!1;function ct(u,d,f){if(st)return u(d,f);st=!0;try{var y=u(d);return y}finally{if(st=!1,(Y!==null||de!==null)&&(Tw(),Y&&(d=Y,u=de,de=Y=null,Pe(d),u)))for(d=0;d<u.length;d++)Pe(u[d])}}function it(u,d){var f=u.stateNode;if(f===null)return null;var y=f[Yt]||null;if(y===null)return null;f=y[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(u=u.type,y=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!y;break e;default:u=!1}if(u)return null;if(f&&typeof f!="function")throw Error(r(231,d,typeof f));return f}var Ue=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ze=!1;if(Ue)try{var ht={};Object.defineProperty(ht,"passive",{get:function(){Ze=!0}}),window.addEventListener("test",ht,ht),window.removeEventListener("test",ht,ht)}catch{Ze=!1}var Kn=null,Ja=null,mo=null;function cl(){if(mo)return mo;var u,d=Ja,f=d.length,y,S="value"in Kn?Kn.value:Kn.textContent,T=S.length;for(u=0;u<f&&d[u]===S[u];u++);var L=f-u;for(y=1;y<=L&&d[f-y]===S[T-y];y++);return mo=S.slice(u,1<y?1-y:void 0)}function hl(u){var d=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&d===13&&(u=13)):u=d,u===10&&(u=13),32<=u||u===13?u:0}function ar(){return!0}function ca(){return!1}function $r(u){function d(f,y,S,T,L){this._reactName=f,this._targetInst=S,this.type=y,this.nativeEvent=T,this.target=L,this.currentTarget=null;for(var j in u)u.hasOwnProperty(j)&&(f=u[j],this[j]=f?f(T):T[j]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ar:ca,this.isPropagationStopped=ca,this}return p(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=ar)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=ar)},persist:function(){},isPersistent:ar}),d}var dl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},go=$r(dl),hu=p({},dl,{view:0,detail:0}),dy=$r(hu),du,af,yo,sf=p({},hu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pu,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==yo&&(yo&&u.type==="mousemove"?(du=u.screenX-yo.screenX,af=u.screenY-yo.screenY):af=du=0,yo=u),du)},movementY:function(u){return"movementY"in u?u.movementY:af}}),py=$r(sf),oh=p({},sf,{dataTransfer:0}),Mx=$r(oh),$x=p({},hu,{relatedTarget:0}),lh=$r($x),fy=p({},dl,{animationName:0,elapsedTime:0,pseudoElement:0}),Ox=$r(fy),of=p({},dl,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),Fx=$r(of),Px=p({},dl,{data:0}),bo=$r(Px),Lx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ux(u){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(u):(u=Vx[u])?!!d[u]:!1}function pu(){return Ux}var es=p({},hu,{key:function(u){if(u.key){var d=Lx[u.key]||u.key;if(d!=="Unidentified")return d}return u.type==="keypress"?(u=hl(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?zx[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pu,charCode:function(u){return u.type==="keypress"?hl(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?hl(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),Bx=$r(es),Wx=p({},sf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pl=$r(Wx),w=p({},hu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pu}),A=$r(w),V=p({},dl,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=$r(V),ye=p({},sf,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),_e=$r(ye),Be=p({},dl,{newState:0,oldState:0}),Rt=$r(Be),wr=[9,13,27,32],cn=Ue&&"CompositionEvent"in window,Xn=null;Ue&&"documentMode"in document&&(Xn=document.documentMode);var hi=Ue&&"TextEvent"in window&&!Xn,vo=Ue&&(!cn||Xn&&8<Xn&&11>=Xn),Fi=" ",Pi=!1;function uh(u,d){switch(u){case"keyup":return wr.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lf(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var uf=!1;function g9(u,d){switch(u){case"compositionend":return lf(d);case"keypress":return d.which!==32?null:(Pi=!0,Fi);case"textInput":return u=d.data,u===Fi&&Pi?null:u;default:return null}}function y9(u,d){if(uf)return u==="compositionend"||!cn&&uh(u,d)?(u=cl(),mo=Ja=Kn=null,uf=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return vo&&d.locale!=="ko"?null:d.data;default:return null}}var b9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function YD(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d==="input"?!!b9[u.type]:d==="textarea"}function QD(u,d,f,y){Y?de?de.push(y):de=[y]:Y=y,d=Dw(d,"onChange"),0<d.length&&(f=new go("onChange","change",null,f,y),u.push({event:f,listeners:d}))}var my=null,gy=null;function v9(u){MO(u,0)}function jx(u){var d=Qa(u);if(ho(d))return u}function ZD(u,d){if(u==="change")return d}var JD=!1;if(Ue){var qS;if(Ue){var KS="oninput"in document;if(!KS){var eM=document.createElement("div");eM.setAttribute("oninput","return;"),KS=typeof eM.oninput=="function"}qS=KS}else qS=!1;JD=qS&&(!document.documentMode||9<document.documentMode)}function tM(){my&&(my.detachEvent("onpropertychange",nM),gy=my=null)}function nM(u){if(u.propertyName==="value"&&jx(gy)){var d=[];QD(d,gy,u,gs(u)),ct(v9,d)}}function x9(u,d,f){u==="focusin"?(tM(),my=d,gy=f,my.attachEvent("onpropertychange",nM)):u==="focusout"&&tM()}function w9(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return jx(gy)}function _9(u,d){if(u==="click")return jx(d)}function S9(u,d){if(u==="input"||u==="change")return jx(d)}function I9(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var Vs=typeof Object.is=="function"?Object.is:I9;function yy(u,d){if(Vs(u,d))return!0;if(typeof u!="object"||u===null||typeof d!="object"||d===null)return!1;var f=Object.keys(u),y=Object.keys(d);if(f.length!==y.length)return!1;for(y=0;y<f.length;y++){var S=f[y];if(!Xt.call(d,S)||!Vs(u[S],d[S]))return!1}return!0}function rM(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function aM(u,d){var f=rM(u);u=0;for(var y;f;){if(f.nodeType===3){if(y=u+f.textContent.length,u<=d&&y>=d)return{node:f,offset:d-u};u=y}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=rM(f)}}function sM(u,d){return u&&d?u===d?!0:u&&u.nodeType===3?!1:d&&d.nodeType===3?sM(u,d.parentNode):"contains"in u?u.contains(d):u.compareDocumentPosition?!!(u.compareDocumentPosition(d)&16):!1:!1}function iM(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var d=ci(u.document);d instanceof u.HTMLIFrameElement;){try{var f=typeof d.contentWindow.location.href=="string"}catch{f=!1}if(f)u=d.contentWindow;else break;d=ci(u.document)}return d}function XS(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d&&(d==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||d==="textarea"||u.contentEditable==="true")}var T9=Ue&&"documentMode"in document&&11>=document.documentMode,cf=null,YS=null,by=null,QS=!1;function oM(u,d,f){var y=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;QS||cf==null||cf!==ci(y)||(y=cf,"selectionStart"in y&&XS(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),by&&yy(by,y)||(by=y,y=Dw(YS,"onSelect"),0<y.length&&(d=new go("onSelect","select",null,d,f),u.push({event:d,listeners:y}),d.target=cf)))}function ch(u,d){var f={};return f[u.toLowerCase()]=d.toLowerCase(),f["Webkit"+u]="webkit"+d,f["Moz"+u]="moz"+d,f}var hf={animationend:ch("Animation","AnimationEnd"),animationiteration:ch("Animation","AnimationIteration"),animationstart:ch("Animation","AnimationStart"),transitionrun:ch("Transition","TransitionRun"),transitionstart:ch("Transition","TransitionStart"),transitioncancel:ch("Transition","TransitionCancel"),transitionend:ch("Transition","TransitionEnd")},ZS={},lM={};Ue&&(lM=document.createElement("div").style,"AnimationEvent"in window||(delete hf.animationend.animation,delete hf.animationiteration.animation,delete hf.animationstart.animation),"TransitionEvent"in window||delete hf.transitionend.transition);function hh(u){if(ZS[u])return ZS[u];if(!hf[u])return u;var d=hf[u],f;for(f in d)if(d.hasOwnProperty(f)&&f in lM)return ZS[u]=d[f];return u}var uM=hh("animationend"),cM=hh("animationiteration"),hM=hh("animationstart"),k9=hh("transitionrun"),E9=hh("transitionstart"),N9=hh("transitioncancel"),dM=hh("transitionend"),pM=new Map,JS="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");JS.push("scrollEnd");function Li(u,d){pM.set(u,d),oi(d,[u])}var Hx=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},di=[],df=0,eI=0;function Gx(){for(var u=df,d=eI=df=0;d<u;){var f=di[d];di[d++]=null;var y=di[d];di[d++]=null;var S=di[d];di[d++]=null;var T=di[d];if(di[d++]=null,y!==null&&S!==null){var L=y.pending;L===null?S.next=S:(S.next=L.next,L.next=S),y.pending=S}T!==0&&fM(f,S,T)}}function qx(u,d,f,y){di[df++]=u,di[df++]=d,di[df++]=f,di[df++]=y,eI|=y,u.lanes|=y,u=u.alternate,u!==null&&(u.lanes|=y)}function tI(u,d,f,y){return qx(u,d,f,y),Kx(u)}function dh(u,d){return qx(u,null,null,d),Kx(u)}function fM(u,d,f){u.lanes|=f;var y=u.alternate;y!==null&&(y.lanes|=f);for(var S=!1,T=u.return;T!==null;)T.childLanes|=f,y=T.alternate,y!==null&&(y.childLanes|=f),T.tag===22&&(u=T.stateNode,u===null||u._visibility&1||(S=!0)),u=T,T=T.return;return u.tag===3?(T=u.stateNode,S&&d!==null&&(S=31-Fn(f),u=T.hiddenUpdates,y=u[S],y===null?u[S]=[d]:y.push(d),d.lane=f|536870912),T):null}function Kx(u){if(50<Vy)throw Vy=0,cT=null,Error(r(185));for(var d=u.return;d!==null;)u=d,d=u.return;return u.tag===3?u.stateNode:null}var pf={};function C9(u,d,f,y){this.tag=u,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(u,d,f,y){return new C9(u,d,f,y)}function nI(u){return u=u.prototype,!(!u||!u.isReactComponent)}function fl(u,d){var f=u.alternate;return f===null?(f=Us(u.tag,d,u.key,u.mode),f.elementType=u.elementType,f.type=u.type,f.stateNode=u.stateNode,f.alternate=u,u.alternate=f):(f.pendingProps=d,f.type=u.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=u.flags&65011712,f.childLanes=u.childLanes,f.lanes=u.lanes,f.child=u.child,f.memoizedProps=u.memoizedProps,f.memoizedState=u.memoizedState,f.updateQueue=u.updateQueue,d=u.dependencies,f.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},f.sibling=u.sibling,f.index=u.index,f.ref=u.ref,f.refCleanup=u.refCleanup,f}function mM(u,d){u.flags&=65011714;var f=u.alternate;return f===null?(u.childLanes=0,u.lanes=d,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,d=f.dependencies,u.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),u}function Xx(u,d,f,y,S,T){var L=0;if(y=u,typeof u=="function")nI(u)&&(L=1);else if(typeof u=="string")L=$7(u,f,ge.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case O:return u=Us(31,f,d,S),u.elementType=O,u.lanes=T,u;case v:return ph(f.children,S,T,d);case x:L=8,S|=24;break;case _:return u=Us(12,f,d,S|2),u.elementType=_,u.lanes=T,u;case R:return u=Us(13,f,d,S),u.elementType=R,u.lanes=T,u;case U:return u=Us(19,f,d,S),u.elementType=U,u.lanes=T,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case k:L=10;break e;case I:L=9;break e;case E:L=11;break e;case D:L=14;break e;case C:L=16,y=null;break e}L=29,f=Error(r(130,u===null?"null":typeof u,"")),y=null}return d=Us(L,f,d,S),d.elementType=u,d.type=y,d.lanes=T,d}function ph(u,d,f,y){return u=Us(7,u,y,d),u.lanes=f,u}function rI(u,d,f){return u=Us(6,u,null,d),u.lanes=f,u}function gM(u){var d=Us(18,null,null,0);return d.stateNode=u,d}function aI(u,d,f){return d=Us(4,u.children!==null?u.children:[],u.key,d),d.lanes=f,d.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},d}var yM=new WeakMap;function pi(u,d){if(typeof u=="object"&&u!==null){var f=yM.get(u);return f!==void 0?f:(d={value:u,source:d,stack:nn(d)},yM.set(u,d),d)}return{value:u,source:d,stack:nn(d)}}var ff=[],mf=0,Yx=null,vy=0,fi=[],mi=0,fu=null,xo=1,wo="";function ml(u,d){ff[mf++]=vy,ff[mf++]=Yx,Yx=u,vy=d}function bM(u,d,f){fi[mi++]=xo,fi[mi++]=wo,fi[mi++]=fu,fu=u;var y=xo;u=wo;var S=32-Fn(y)-1;y&=~(1<<S),f+=1;var T=32-Fn(d)+S;if(30<T){var L=S-S%5;T=(y&(1<<L)-1).toString(32),y>>=L,S-=L,xo=1<<32-Fn(d)+S|f<<S|y,wo=T+u}else xo=1<<T|f<<S|y,wo=u}function sI(u){u.return!==null&&(ml(u,1),bM(u,1,0))}function iI(u){for(;u===Yx;)Yx=ff[--mf],ff[mf]=null,vy=ff[--mf],ff[mf]=null;for(;u===fu;)fu=fi[--mi],fi[mi]=null,wo=fi[--mi],fi[mi]=null,xo=fi[--mi],fi[mi]=null}function vM(u,d){fi[mi++]=xo,fi[mi++]=wo,fi[mi++]=fu,xo=d.id,wo=d.overflow,fu=u}var ba=null,Vn=null,Qt=!1,mu=null,gi=!1,oI=Error(r(519));function gu(u){var d=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw xy(pi(d,u)),oI}function xM(u){var d=u.stateNode,f=u.type,y=u.memoizedProps;switch(d[zn]=u,d[Yt]=y,f){case"dialog":Vt("cancel",d),Vt("close",d);break;case"iframe":case"object":case"embed":Vt("load",d);break;case"video":case"audio":for(f=0;f<By.length;f++)Vt(By[f],d);break;case"source":Vt("error",d);break;case"img":case"image":case"link":Vt("error",d),Vt("load",d);break;case"details":Vt("toggle",d);break;case"input":Vt("invalid",d),ah(d,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0);break;case"select":Vt("invalid",d);break;case"textarea":Vt("invalid",d),$i(d,y.value,y.defaultValue,y.children)}f=y.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||d.textContent===""+f||y.suppressHydrationWarning===!0||PO(d.textContent,f)?(y.popover!=null&&(Vt("beforetoggle",d),Vt("toggle",d)),y.onScroll!=null&&Vt("scroll",d),y.onScrollEnd!=null&&Vt("scrollend",d),y.onClick!=null&&(d.onclick=$a),d=!0):d=!1,d||gu(u,!0)}function wM(u){for(ba=u.return;ba;)switch(ba.tag){case 5:case 31:case 13:gi=!1;return;case 27:case 3:gi=!0;return;default:ba=ba.return}}function gf(u){if(u!==ba)return!1;if(!Qt)return wM(u),Qt=!0,!1;var d=u.tag,f;if((f=d!==3&&d!==27)&&((f=d===5)&&(f=u.type,f=!(f!=="form"&&f!=="button")||TT(u.type,u.memoizedProps)),f=!f),f&&Vn&&gu(u),wM(u),d===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Vn=GO(u)}else if(d===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Vn=GO(u)}else d===27?(d=Vn,Au(u.type)?(u=AT,AT=null,Vn=u):Vn=d):Vn=ba?bi(u.stateNode.nextSibling):null;return!0}function fh(){Vn=ba=null,Qt=!1}function lI(){var u=mu;return u!==null&&(xs===null?xs=u:xs.push.apply(xs,u),mu=null),u}function xy(u){mu===null?mu=[u]:mu.push(u)}var uI=H(null),mh=null,gl=null;function yu(u,d,f){ue(uI,d._currentValue),d._currentValue=f}function yl(u){u._currentValue=uI.current,se(uI)}function cI(u,d,f){for(;u!==null;){var y=u.alternate;if((u.childLanes&d)!==d?(u.childLanes|=d,y!==null&&(y.childLanes|=d)):y!==null&&(y.childLanes&d)!==d&&(y.childLanes|=d),u===f)break;u=u.return}}function hI(u,d,f,y){var S=u.child;for(S!==null&&(S.return=u);S!==null;){var T=S.dependencies;if(T!==null){var L=S.child;T=T.firstContext;e:for(;T!==null;){var j=T;T=S;for(var ae=0;ae<d.length;ae++)if(j.context===d[ae]){T.lanes|=f,j=T.alternate,j!==null&&(j.lanes|=f),cI(T.return,f,u),y||(L=null);break e}T=j.next}}else if(S.tag===18){if(L=S.return,L===null)throw Error(r(341));L.lanes|=f,T=L.alternate,T!==null&&(T.lanes|=f),cI(L,f,u),L=null}else L=S.child;if(L!==null)L.return=S;else for(L=S;L!==null;){if(L===u){L=null;break}if(S=L.sibling,S!==null){S.return=L.return,L=S;break}L=L.return}S=L}}function yf(u,d,f,y){u=null;for(var S=d,T=!1;S!==null;){if(!T){if((S.flags&524288)!==0)T=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var L=S.alternate;if(L===null)throw Error(r(387));if(L=L.memoizedProps,L!==null){var j=S.type;Vs(S.pendingProps.value,L.value)||(u!==null?u.push(j):u=[j])}}else if(S===Oe.current){if(L=S.alternate,L===null)throw Error(r(387));L.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(u!==null?u.push(qy):u=[qy])}S=S.return}u!==null&&hI(d,u,f,y),d.flags|=262144}function Qx(u){for(u=u.firstContext;u!==null;){if(!Vs(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function gh(u){mh=u,gl=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function va(u){return _M(mh,u)}function Zx(u,d){return mh===null&&gh(u),_M(u,d)}function _M(u,d){var f=d._currentValue;if(d={context:d,memoizedValue:f,next:null},gl===null){if(u===null)throw Error(r(308));gl=d,u.dependencies={lanes:0,firstContext:d},u.flags|=524288}else gl=gl.next=d;return f}var A9=typeof AbortController<"u"?AbortController:function(){var u=[],d=this.signal={aborted:!1,addEventListener:function(f,y){u.push(y)}};this.abort=function(){d.aborted=!0,u.forEach(function(f){return f()})}},R9=e.unstable_scheduleCallback,D9=e.unstable_NormalPriority,Or={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dI(){return{controller:new A9,data:new Map,refCount:0}}function wy(u){u.refCount--,u.refCount===0&&R9(D9,function(){u.controller.abort()})}var _y=null,pI=0,bf=0,vf=null;function M9(u,d){if(_y===null){var f=_y=[];pI=0,bf=gT(),vf={status:"pending",value:void 0,then:function(y){f.push(y)}}}return pI++,d.then(SM,SM),d}function SM(){if(--pI===0&&_y!==null){vf!==null&&(vf.status="fulfilled");var u=_y;_y=null,bf=0,vf=null;for(var d=0;d<u.length;d++)(0,u[d])()}}function $9(u,d){var f=[],y={status:"pending",value:null,reason:null,then:function(S){f.push(S)}};return u.then(function(){y.status="fulfilled",y.value=d;for(var S=0;S<f.length;S++)(0,f[S])(d)},function(S){for(y.status="rejected",y.reason=S,S=0;S<f.length;S++)(0,f[S])(void 0)}),y}var IM=q.S;q.S=function(u,d){oO=kn(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&M9(u,d),IM!==null&&IM(u,d)};var yh=H(null);function fI(){var u=yh.current;return u!==null?u:Rn.pooledCache}function Jx(u,d){d===null?ue(yh,yh.current):ue(yh,d.pool)}function TM(){var u=fI();return u===null?null:{parent:Or._currentValue,pool:u}}var xf=Error(r(460)),mI=Error(r(474)),ew=Error(r(542)),tw={then:function(){}};function kM(u){return u=u.status,u==="fulfilled"||u==="rejected"}function EM(u,d,f){switch(f=u[f],f===void 0?u.push(d):f!==d&&(d.then($a,$a),d=f),d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,CM(u),u;default:if(typeof d.status=="string")d.then($a,$a);else{if(u=Rn,u!==null&&100<u.shellSuspendCounter)throw Error(r(482));u=d,u.status="pending",u.then(function(y){if(d.status==="pending"){var S=d;S.status="fulfilled",S.value=y}},function(y){if(d.status==="pending"){var S=d;S.status="rejected",S.reason=y}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,CM(u),u}throw vh=d,xf}}function bh(u){try{var d=u._init;return d(u._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(vh=f,xf):f}}var vh=null;function NM(){if(vh===null)throw Error(r(459));var u=vh;return vh=null,u}function CM(u){if(u===xf||u===ew)throw Error(r(483))}var wf=null,Sy=0;function nw(u){var d=Sy;return Sy+=1,wf===null&&(wf=[]),EM(wf,u,d)}function Iy(u,d){d=d.props.ref,u.ref=d!==void 0?d:null}function rw(u,d){throw d.$$typeof===m?Error(r(525)):(u=Object.prototype.toString.call(d),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":u)))}function AM(u){function d(pe,ce){if(u){var be=pe.deletions;be===null?(pe.deletions=[ce],pe.flags|=16):be.push(ce)}}function f(pe,ce){if(!u)return null;for(;ce!==null;)d(pe,ce),ce=ce.sibling;return null}function y(pe){for(var ce=new Map;pe!==null;)pe.key!==null?ce.set(pe.key,pe):ce.set(pe.index,pe),pe=pe.sibling;return ce}function S(pe,ce){return pe=fl(pe,ce),pe.index=0,pe.sibling=null,pe}function T(pe,ce,be){return pe.index=be,u?(be=pe.alternate,be!==null?(be=be.index,be<ce?(pe.flags|=67108866,ce):be):(pe.flags|=67108866,ce)):(pe.flags|=1048576,ce)}function L(pe){return u&&pe.alternate===null&&(pe.flags|=67108866),pe}function j(pe,ce,be,Ce){return ce===null||ce.tag!==6?(ce=rI(be,pe.mode,Ce),ce.return=pe,ce):(ce=S(ce,be),ce.return=pe,ce)}function ae(pe,ce,be,Ce){var ot=be.type;return ot===v?Ne(pe,ce,be.props.children,Ce,be.key):ce!==null&&(ce.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===C&&bh(ot)===ce.type)?(ce=S(ce,be.props),Iy(ce,be),ce.return=pe,ce):(ce=Xx(be.type,be.key,be.props,null,pe.mode,Ce),Iy(ce,be),ce.return=pe,ce)}function ve(pe,ce,be,Ce){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==be.containerInfo||ce.stateNode.implementation!==be.implementation?(ce=aI(be,pe.mode,Ce),ce.return=pe,ce):(ce=S(ce,be.children||[]),ce.return=pe,ce)}function Ne(pe,ce,be,Ce,ot){return ce===null||ce.tag!==7?(ce=ph(be,pe.mode,Ce,ot),ce.return=pe,ce):(ce=S(ce,be),ce.return=pe,ce)}function De(pe,ce,be){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=rI(""+ce,pe.mode,be),ce.return=pe,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case g:return be=Xx(ce.type,ce.key,ce.props,null,pe.mode,be),Iy(be,ce),be.return=pe,be;case b:return ce=aI(ce,pe.mode,be),ce.return=pe,ce;case C:return ce=bh(ce),De(pe,ce,be)}if(ee(ce)||N(ce))return ce=ph(ce,pe.mode,be,null),ce.return=pe,ce;if(typeof ce.then=="function")return De(pe,nw(ce),be);if(ce.$$typeof===k)return De(pe,Zx(pe,ce),be);rw(pe,ce)}return null}function we(pe,ce,be,Ce){var ot=ce!==null?ce.key:null;if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return ot!==null?null:j(pe,ce,""+be,Ce);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case g:return be.key===ot?ae(pe,ce,be,Ce):null;case b:return be.key===ot?ve(pe,ce,be,Ce):null;case C:return be=bh(be),we(pe,ce,be,Ce)}if(ee(be)||N(be))return ot!==null?null:Ne(pe,ce,be,Ce,null);if(typeof be.then=="function")return we(pe,ce,nw(be),Ce);if(be.$$typeof===k)return we(pe,ce,Zx(pe,be),Ce);rw(pe,be)}return null}function Ie(pe,ce,be,Ce,ot){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return pe=pe.get(be)||null,j(ce,pe,""+Ce,ot);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case g:return pe=pe.get(Ce.key===null?be:Ce.key)||null,ae(ce,pe,Ce,ot);case b:return pe=pe.get(Ce.key===null?be:Ce.key)||null,ve(ce,pe,Ce,ot);case C:return Ce=bh(Ce),Ie(pe,ce,be,Ce,ot)}if(ee(Ce)||N(Ce))return pe=pe.get(be)||null,Ne(ce,pe,Ce,ot,null);if(typeof Ce.then=="function")return Ie(pe,ce,be,nw(Ce),ot);if(Ce.$$typeof===k)return Ie(pe,ce,be,Zx(ce,Ce),ot);rw(ce,Ce)}return null}function Je(pe,ce,be,Ce){for(var ot=null,sn=null,nt=ce,$t=ce=0,jt=null;nt!==null&&$t<be.length;$t++){nt.index>$t?(jt=nt,nt=null):jt=nt.sibling;var on=we(pe,nt,be[$t],Ce);if(on===null){nt===null&&(nt=jt);break}u&&nt&&on.alternate===null&&d(pe,nt),ce=T(on,ce,$t),sn===null?ot=on:sn.sibling=on,sn=on,nt=jt}if($t===be.length)return f(pe,nt),Qt&&ml(pe,$t),ot;if(nt===null){for(;$t<be.length;$t++)nt=De(pe,be[$t],Ce),nt!==null&&(ce=T(nt,ce,$t),sn===null?ot=nt:sn.sibling=nt,sn=nt);return Qt&&ml(pe,$t),ot}for(nt=y(nt);$t<be.length;$t++)jt=Ie(nt,pe,$t,be[$t],Ce),jt!==null&&(u&&jt.alternate!==null&&nt.delete(jt.key===null?$t:jt.key),ce=T(jt,ce,$t),sn===null?ot=jt:sn.sibling=jt,sn=jt);return u&&nt.forEach(function(Ou){return d(pe,Ou)}),Qt&&ml(pe,$t),ot}function dt(pe,ce,be,Ce){if(be==null)throw Error(r(151));for(var ot=null,sn=null,nt=ce,$t=ce=0,jt=null,on=be.next();nt!==null&&!on.done;$t++,on=be.next()){nt.index>$t?(jt=nt,nt=null):jt=nt.sibling;var Ou=we(pe,nt,on.value,Ce);if(Ou===null){nt===null&&(nt=jt);break}u&&nt&&Ou.alternate===null&&d(pe,nt),ce=T(Ou,ce,$t),sn===null?ot=Ou:sn.sibling=Ou,sn=Ou,nt=jt}if(on.done)return f(pe,nt),Qt&&ml(pe,$t),ot;if(nt===null){for(;!on.done;$t++,on=be.next())on=De(pe,on.value,Ce),on!==null&&(ce=T(on,ce,$t),sn===null?ot=on:sn.sibling=on,sn=on);return Qt&&ml(pe,$t),ot}for(nt=y(nt);!on.done;$t++,on=be.next())on=Ie(nt,pe,$t,on.value,Ce),on!==null&&(u&&on.alternate!==null&&nt.delete(on.key===null?$t:on.key),ce=T(on,ce,$t),sn===null?ot=on:sn.sibling=on,sn=on);return u&&nt.forEach(function(H7){return d(pe,H7)}),Qt&&ml(pe,$t),ot}function Cn(pe,ce,be,Ce){if(typeof be=="object"&&be!==null&&be.type===v&&be.key===null&&(be=be.props.children),typeof be=="object"&&be!==null){switch(be.$$typeof){case g:e:{for(var ot=be.key;ce!==null;){if(ce.key===ot){if(ot=be.type,ot===v){if(ce.tag===7){f(pe,ce.sibling),Ce=S(ce,be.props.children),Ce.return=pe,pe=Ce;break e}}else if(ce.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===C&&bh(ot)===ce.type){f(pe,ce.sibling),Ce=S(ce,be.props),Iy(Ce,be),Ce.return=pe,pe=Ce;break e}f(pe,ce);break}else d(pe,ce);ce=ce.sibling}be.type===v?(Ce=ph(be.props.children,pe.mode,Ce,be.key),Ce.return=pe,pe=Ce):(Ce=Xx(be.type,be.key,be.props,null,pe.mode,Ce),Iy(Ce,be),Ce.return=pe,pe=Ce)}return L(pe);case b:e:{for(ot=be.key;ce!==null;){if(ce.key===ot)if(ce.tag===4&&ce.stateNode.containerInfo===be.containerInfo&&ce.stateNode.implementation===be.implementation){f(pe,ce.sibling),Ce=S(ce,be.children||[]),Ce.return=pe,pe=Ce;break e}else{f(pe,ce);break}else d(pe,ce);ce=ce.sibling}Ce=aI(be,pe.mode,Ce),Ce.return=pe,pe=Ce}return L(pe);case C:return be=bh(be),Cn(pe,ce,be,Ce)}if(ee(be))return Je(pe,ce,be,Ce);if(N(be)){if(ot=N(be),typeof ot!="function")throw Error(r(150));return be=ot.call(be),dt(pe,ce,be,Ce)}if(typeof be.then=="function")return Cn(pe,ce,nw(be),Ce);if(be.$$typeof===k)return Cn(pe,ce,Zx(pe,be),Ce);rw(pe,be)}return typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint"?(be=""+be,ce!==null&&ce.tag===6?(f(pe,ce.sibling),Ce=S(ce,be),Ce.return=pe,pe=Ce):(f(pe,ce),Ce=rI(be,pe.mode,Ce),Ce.return=pe,pe=Ce),L(pe)):f(pe,ce)}return function(pe,ce,be,Ce){try{Sy=0;var ot=Cn(pe,ce,be,Ce);return wf=null,ot}catch(nt){if(nt===xf||nt===ew)throw nt;var sn=Us(29,nt,null,pe.mode);return sn.lanes=Ce,sn.return=pe,sn}finally{}}}var xh=AM(!0),RM=AM(!1),bu=!1;function gI(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function yI(u,d){u=u.updateQueue,d.updateQueue===u&&(d.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function vu(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function xu(u,d,f){var y=u.updateQueue;if(y===null)return null;if(y=y.shared,(hn&2)!==0){var S=y.pending;return S===null?d.next=d:(d.next=S.next,S.next=d),y.pending=d,d=Kx(u),fM(u,null,f),d}return qx(u,y,d,f),Kx(u)}function Ty(u,d,f){if(d=d.updateQueue,d!==null&&(d=d.shared,(f&4194048)!==0)){var y=d.lanes;y&=u.pendingLanes,f|=y,d.lanes=f,xt(u,f)}}function bI(u,d){var f=u.updateQueue,y=u.alternate;if(y!==null&&(y=y.updateQueue,f===y)){var S=null,T=null;if(f=f.firstBaseUpdate,f!==null){do{var L={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};T===null?S=T=L:T=T.next=L,f=f.next}while(f!==null);T===null?S=T=d:T=T.next=d}else S=T=d;f={baseState:y.baseState,firstBaseUpdate:S,lastBaseUpdate:T,shared:y.shared,callbacks:y.callbacks},u.updateQueue=f;return}u=f.lastBaseUpdate,u===null?f.firstBaseUpdate=d:u.next=d,f.lastBaseUpdate=d}var vI=!1;function ky(){if(vI){var u=vf;if(u!==null)throw u}}function Ey(u,d,f,y){vI=!1;var S=u.updateQueue;bu=!1;var T=S.firstBaseUpdate,L=S.lastBaseUpdate,j=S.shared.pending;if(j!==null){S.shared.pending=null;var ae=j,ve=ae.next;ae.next=null,L===null?T=ve:L.next=ve,L=ae;var Ne=u.alternate;Ne!==null&&(Ne=Ne.updateQueue,j=Ne.lastBaseUpdate,j!==L&&(j===null?Ne.firstBaseUpdate=ve:j.next=ve,Ne.lastBaseUpdate=ae))}if(T!==null){var De=S.baseState;L=0,Ne=ve=ae=null,j=T;do{var we=j.lane&-536870913,Ie=we!==j.lane;if(Ie?(Wt&we)===we:(y&we)===we){we!==0&&we===bf&&(vI=!0),Ne!==null&&(Ne=Ne.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});e:{var Je=u,dt=j;we=d;var Cn=f;switch(dt.tag){case 1:if(Je=dt.payload,typeof Je=="function"){De=Je.call(Cn,De,we);break e}De=Je;break e;case 3:Je.flags=Je.flags&-65537|128;case 0:if(Je=dt.payload,we=typeof Je=="function"?Je.call(Cn,De,we):Je,we==null)break e;De=p({},De,we);break e;case 2:bu=!0}}we=j.callback,we!==null&&(u.flags|=64,Ie&&(u.flags|=8192),Ie=S.callbacks,Ie===null?S.callbacks=[we]:Ie.push(we))}else Ie={lane:we,tag:j.tag,payload:j.payload,callback:j.callback,next:null},Ne===null?(ve=Ne=Ie,ae=De):Ne=Ne.next=Ie,L|=we;if(j=j.next,j===null){if(j=S.shared.pending,j===null)break;Ie=j,j=Ie.next,Ie.next=null,S.lastBaseUpdate=Ie,S.shared.pending=null}}while(!0);Ne===null&&(ae=De),S.baseState=ae,S.firstBaseUpdate=ve,S.lastBaseUpdate=Ne,T===null&&(S.shared.lanes=0),Tu|=L,u.lanes=L,u.memoizedState=De}}function DM(u,d){if(typeof u!="function")throw Error(r(191,u));u.call(d)}function MM(u,d){var f=u.callbacks;if(f!==null)for(u.callbacks=null,u=0;u<f.length;u++)DM(f[u],d)}var _f=H(null),aw=H(0);function $M(u,d){u=kl,ue(aw,u),ue(_f,d),kl=u|d.baseLanes}function xI(){ue(aw,kl),ue(_f,_f.current)}function wI(){kl=aw.current,se(_f),se(aw)}var Bs=H(null),yi=null;function wu(u){var d=u.alternate;ue(_r,_r.current&1),ue(Bs,u),yi===null&&(d===null||_f.current!==null||d.memoizedState!==null)&&(yi=u)}function _I(u){ue(_r,_r.current),ue(Bs,u),yi===null&&(yi=u)}function OM(u){u.tag===22?(ue(_r,_r.current),ue(Bs,u),yi===null&&(yi=u)):_u()}function _u(){ue(_r,_r.current),ue(Bs,Bs.current)}function Ws(u){se(Bs),yi===u&&(yi=null),se(_r)}var _r=H(0);function sw(u){for(var d=u;d!==null;){if(d.tag===13){var f=d.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||NT(f)||CT(f)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var bl=0,Dt=null,En=null,Fr=null,iw=!1,Sf=!1,wh=!1,ow=0,Ny=0,If=null,O9=0;function fr(){throw Error(r(321))}function SI(u,d){if(d===null)return!1;for(var f=0;f<d.length&&f<u.length;f++)if(!Vs(u[f],d[f]))return!1;return!0}function II(u,d,f,y,S,T){return bl=T,Dt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,q.H=u===null||u.memoizedState===null?b$:zI,wh=!1,T=f(y,S),wh=!1,Sf&&(T=PM(d,f,y,S)),FM(u),T}function FM(u){q.H=Ry;var d=En!==null&&En.next!==null;if(bl=0,Fr=En=Dt=null,iw=!1,Ny=0,If=null,d)throw Error(r(300));u===null||Pr||(u=u.dependencies,u!==null&&Qx(u)&&(Pr=!0))}function PM(u,d,f,y){Dt=u;var S=0;do{if(Sf&&(If=null),Ny=0,Sf=!1,25<=S)throw Error(r(301));if(S+=1,Fr=En=null,u.updateQueue!=null){var T=u.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}q.H=v$,T=d(f,y)}while(Sf);return T}function F9(){var u=q.H,d=u.useState()[0];return d=typeof d.then=="function"?Cy(d):d,u=u.useState()[0],(En!==null?En.memoizedState:null)!==u&&(Dt.flags|=1024),d}function TI(){var u=ow!==0;return ow=0,u}function kI(u,d,f){d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~f}function EI(u){if(iw){for(u=u.memoizedState;u!==null;){var d=u.queue;d!==null&&(d.pending=null),u=u.next}iw=!1}bl=0,Fr=En=Dt=null,Sf=!1,Ny=ow=0,If=null}function ts(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fr===null?Dt.memoizedState=Fr=u:Fr=Fr.next=u,Fr}function Sr(){if(En===null){var u=Dt.alternate;u=u!==null?u.memoizedState:null}else u=En.next;var d=Fr===null?Dt.memoizedState:Fr.next;if(d!==null)Fr=d,En=u;else{if(u===null)throw Dt.alternate===null?Error(r(467)):Error(r(310));En=u,u={memoizedState:En.memoizedState,baseState:En.baseState,baseQueue:En.baseQueue,queue:En.queue,next:null},Fr===null?Dt.memoizedState=Fr=u:Fr=Fr.next=u}return Fr}function lw(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cy(u){var d=Ny;return Ny+=1,If===null&&(If=[]),u=EM(If,u,d),d=Dt,(Fr===null?d.memoizedState:Fr.next)===null&&(d=d.alternate,q.H=d===null||d.memoizedState===null?b$:zI),u}function uw(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Cy(u);if(u.$$typeof===k)return va(u)}throw Error(r(438,String(u)))}function NI(u){var d=null,f=Dt.updateQueue;if(f!==null&&(d=f.memoCache),d==null){var y=Dt.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(d={data:y.data.map(function(S){return S.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),f===null&&(f=lw(),Dt.updateQueue=f),f.memoCache=d,f=d.data[d.index],f===void 0)for(f=d.data[d.index]=Array(u),y=0;y<u;y++)f[y]=z;return d.index++,f}function vl(u,d){return typeof d=="function"?d(u):d}function cw(u){var d=Sr();return CI(d,En,u)}function CI(u,d,f){var y=u.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=f;var S=u.baseQueue,T=y.pending;if(T!==null){if(S!==null){var L=S.next;S.next=T.next,T.next=L}d.baseQueue=S=T,y.pending=null}if(T=u.baseState,S===null)u.memoizedState=T;else{d=S.next;var j=L=null,ae=null,ve=d,Ne=!1;do{var De=ve.lane&-536870913;if(De!==ve.lane?(Wt&De)===De:(bl&De)===De){var we=ve.revertLane;if(we===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,gesture:null,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),De===bf&&(Ne=!0);else if((bl&we)===we){ve=ve.next,we===bf&&(Ne=!0);continue}else De={lane:0,revertLane:ve.revertLane,gesture:null,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},ae===null?(j=ae=De,L=T):ae=ae.next=De,Dt.lanes|=we,Tu|=we;De=ve.action,wh&&f(T,De),T=ve.hasEagerState?ve.eagerState:f(T,De)}else we={lane:De,revertLane:ve.revertLane,gesture:ve.gesture,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},ae===null?(j=ae=we,L=T):ae=ae.next=we,Dt.lanes|=De,Tu|=De;ve=ve.next}while(ve!==null&&ve!==d);if(ae===null?L=T:ae.next=j,!Vs(T,u.memoizedState)&&(Pr=!0,Ne&&(f=vf,f!==null)))throw f;u.memoizedState=T,u.baseState=L,u.baseQueue=ae,y.lastRenderedState=T}return S===null&&(y.lanes=0),[u.memoizedState,y.dispatch]}function AI(u){var d=Sr(),f=d.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=u;var y=f.dispatch,S=f.pending,T=d.memoizedState;if(S!==null){f.pending=null;var L=S=S.next;do T=u(T,L.action),L=L.next;while(L!==S);Vs(T,d.memoizedState)||(Pr=!0),d.memoizedState=T,d.baseQueue===null&&(d.baseState=T),f.lastRenderedState=T}return[T,y]}function LM(u,d,f){var y=Dt,S=Sr(),T=Qt;if(T){if(f===void 0)throw Error(r(407));f=f()}else f=d();var L=!Vs((En||S).memoizedState,f);if(L&&(S.memoizedState=f,Pr=!0),S=S.queue,MI(UM.bind(null,y,S,u),[u]),S.getSnapshot!==d||L||Fr!==null&&Fr.memoizedState.tag&1){if(y.flags|=2048,Tf(9,{destroy:void 0},VM.bind(null,y,S,f,d),null),Rn===null)throw Error(r(349));T||(bl&127)!==0||zM(y,d,f)}return f}function zM(u,d,f){u.flags|=16384,u={getSnapshot:d,value:f},d=Dt.updateQueue,d===null?(d=lw(),Dt.updateQueue=d,d.stores=[u]):(f=d.stores,f===null?d.stores=[u]:f.push(u))}function VM(u,d,f,y){d.value=f,d.getSnapshot=y,BM(d)&&WM(u)}function UM(u,d,f){return f(function(){BM(d)&&WM(u)})}function BM(u){var d=u.getSnapshot;u=u.value;try{var f=d();return!Vs(u,f)}catch{return!0}}function WM(u){var d=dh(u,2);d!==null&&ws(d,u,2)}function RI(u){var d=ts();if(typeof u=="function"){var f=u;if(u=f(),wh){ln(!0);try{f()}finally{ln(!1)}}}return d.memoizedState=d.baseState=u,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vl,lastRenderedState:u},d}function jM(u,d,f,y){return u.baseState=f,CI(u,En,typeof y=="function"?y:vl)}function P9(u,d,f,y,S){if(pw(u))throw Error(r(485));if(u=d.action,u!==null){var T={payload:S,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){T.listeners.push(L)}};q.T!==null?f(!0):T.isTransition=!1,y(T),f=d.pending,f===null?(T.next=d.pending=T,HM(d,T)):(T.next=f.next,d.pending=f.next=T)}}function HM(u,d){var f=d.action,y=d.payload,S=u.state;if(d.isTransition){var T=q.T,L={};q.T=L;try{var j=f(S,y),ae=q.S;ae!==null&&ae(L,j),GM(u,d,j)}catch(ve){DI(u,d,ve)}finally{T!==null&&L.types!==null&&(T.types=L.types),q.T=T}}else try{T=f(S,y),GM(u,d,T)}catch(ve){DI(u,d,ve)}}function GM(u,d,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(y){qM(u,d,y)},function(y){return DI(u,d,y)}):qM(u,d,f)}function qM(u,d,f){d.status="fulfilled",d.value=f,KM(d),u.state=f,d=u.pending,d!==null&&(f=d.next,f===d?u.pending=null:(f=f.next,d.next=f,HM(u,f)))}function DI(u,d,f){var y=u.pending;if(u.pending=null,y!==null){y=y.next;do d.status="rejected",d.reason=f,KM(d),d=d.next;while(d!==y)}u.action=null}function KM(u){u=u.listeners;for(var d=0;d<u.length;d++)(0,u[d])()}function XM(u,d){return d}function YM(u,d){if(Qt){var f=Rn.formState;if(f!==null){e:{var y=Dt;if(Qt){if(Vn){t:{for(var S=Vn,T=gi;S.nodeType!==8;){if(!T){S=null;break t}if(S=bi(S.nextSibling),S===null){S=null;break t}}T=S.data,S=T==="F!"||T==="F"?S:null}if(S){Vn=bi(S.nextSibling),y=S.data==="F!";break e}}gu(y)}y=!1}y&&(d=f[0])}}return f=ts(),f.memoizedState=f.baseState=d,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:XM,lastRenderedState:d},f.queue=y,f=m$.bind(null,Dt,y),y.dispatch=f,y=RI(!1),T=LI.bind(null,Dt,!1,y.queue),y=ts(),S={state:d,dispatch:null,action:u,pending:null},y.queue=S,f=P9.bind(null,Dt,S,T,f),S.dispatch=f,y.memoizedState=u,[d,f,!1]}function QM(u){var d=Sr();return ZM(d,En,u)}function ZM(u,d,f){if(d=CI(u,d,XM)[0],u=cw(vl)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var y=Cy(d)}catch(L){throw L===xf?ew:L}else y=d;d=Sr();var S=d.queue,T=S.dispatch;return f!==d.memoizedState&&(Dt.flags|=2048,Tf(9,{destroy:void 0},L9.bind(null,S,f),null)),[y,T,u]}function L9(u,d){u.action=d}function JM(u){var d=Sr(),f=En;if(f!==null)return ZM(d,f,u);Sr(),d=d.memoizedState,f=Sr();var y=f.queue.dispatch;return f.memoizedState=u,[d,y,!1]}function Tf(u,d,f,y){return u={tag:u,create:f,deps:y,inst:d,next:null},d=Dt.updateQueue,d===null&&(d=lw(),Dt.updateQueue=d),f=d.lastEffect,f===null?d.lastEffect=u.next=u:(y=f.next,f.next=u,u.next=y,d.lastEffect=u),u}function e$(){return Sr().memoizedState}function hw(u,d,f,y){var S=ts();Dt.flags|=u,S.memoizedState=Tf(1|d,{destroy:void 0},f,y===void 0?null:y)}function dw(u,d,f,y){var S=Sr();y=y===void 0?null:y;var T=S.memoizedState.inst;En!==null&&y!==null&&SI(y,En.memoizedState.deps)?S.memoizedState=Tf(d,T,f,y):(Dt.flags|=u,S.memoizedState=Tf(1|d,T,f,y))}function t$(u,d){hw(8390656,8,u,d)}function MI(u,d){dw(2048,8,u,d)}function z9(u){Dt.flags|=4;var d=Dt.updateQueue;if(d===null)d=lw(),Dt.updateQueue=d,d.events=[u];else{var f=d.events;f===null?d.events=[u]:f.push(u)}}function n$(u){var d=Sr().memoizedState;return z9({ref:d,nextImpl:u}),function(){if((hn&2)!==0)throw Error(r(440));return d.impl.apply(void 0,arguments)}}function r$(u,d){return dw(4,2,u,d)}function a$(u,d){return dw(4,4,u,d)}function s$(u,d){if(typeof d=="function"){u=u();var f=d(u);return function(){typeof f=="function"?f():d(null)}}if(d!=null)return u=u(),d.current=u,function(){d.current=null}}function i$(u,d,f){f=f!=null?f.concat([u]):null,dw(4,4,s$.bind(null,d,u),f)}function $I(){}function o$(u,d){var f=Sr();d=d===void 0?null:d;var y=f.memoizedState;return d!==null&&SI(d,y[1])?y[0]:(f.memoizedState=[u,d],u)}function l$(u,d){var f=Sr();d=d===void 0?null:d;var y=f.memoizedState;if(d!==null&&SI(d,y[1]))return y[0];if(y=u(),wh){ln(!0);try{u()}finally{ln(!1)}}return f.memoizedState=[y,d],y}function OI(u,d,f){return f===void 0||(bl&1073741824)!==0&&(Wt&261930)===0?u.memoizedState=d:(u.memoizedState=f,u=uO(),Dt.lanes|=u,Tu|=u,f)}function u$(u,d,f,y){return Vs(f,d)?f:_f.current!==null?(u=OI(u,f,y),Vs(u,d)||(Pr=!0),u):(bl&42)===0||(bl&1073741824)!==0&&(Wt&261930)===0?(Pr=!0,u.memoizedState=f):(u=uO(),Dt.lanes|=u,Tu|=u,d)}function c$(u,d,f,y,S){var T=Z.p;Z.p=T!==0&&8>T?T:8;var L=q.T,j={};q.T=j,LI(u,!1,d,f);try{var ae=S(),ve=q.S;if(ve!==null&&ve(j,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var Ne=$9(ae,y);Ay(u,d,Ne,Gs(u))}else Ay(u,d,y,Gs(u))}catch(De){Ay(u,d,{then:function(){},status:"rejected",reason:De},Gs())}finally{Z.p=T,L!==null&&j.types!==null&&(L.types=j.types),q.T=L}}function V9(){}function FI(u,d,f,y){if(u.tag!==5)throw Error(r(476));var S=h$(u).queue;c$(u,S,d,ne,f===null?V9:function(){return d$(u),f(y)})}function h$(u){var d=u.memoizedState;if(d!==null)return d;d={memoizedState:ne,baseState:ne,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vl,lastRenderedState:ne},next:null};var f={};return d.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vl,lastRenderedState:f},next:null},u.memoizedState=d,u=u.alternate,u!==null&&(u.memoizedState=d),d}function d$(u){var d=h$(u);d.next===null&&(d=u.alternate.memoizedState),Ay(u,d.next.queue,{},Gs())}function PI(){return va(qy)}function p$(){return Sr().memoizedState}function f$(){return Sr().memoizedState}function U9(u){for(var d=u.return;d!==null;){switch(d.tag){case 24:case 3:var f=Gs();u=vu(f);var y=xu(d,u,f);y!==null&&(ws(y,d,f),Ty(y,d,f)),d={cache:dI()},u.payload=d;return}d=d.return}}function B9(u,d,f){var y=Gs();f={lane:y,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},pw(u)?g$(d,f):(f=tI(u,d,f,y),f!==null&&(ws(f,u,y),y$(f,d,y)))}function m$(u,d,f){var y=Gs();Ay(u,d,f,y)}function Ay(u,d,f,y){var S={lane:y,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(pw(u))g$(d,S);else{var T=u.alternate;if(u.lanes===0&&(T===null||T.lanes===0)&&(T=d.lastRenderedReducer,T!==null))try{var L=d.lastRenderedState,j=T(L,f);if(S.hasEagerState=!0,S.eagerState=j,Vs(j,L))return qx(u,d,S,0),Rn===null&&Gx(),!1}catch{}finally{}if(f=tI(u,d,S,y),f!==null)return ws(f,u,y),y$(f,d,y),!0}return!1}function LI(u,d,f,y){if(y={lane:2,revertLane:gT(),gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},pw(u)){if(d)throw Error(r(479))}else d=tI(u,f,y,2),d!==null&&ws(d,u,2)}function pw(u){var d=u.alternate;return u===Dt||d!==null&&d===Dt}function g$(u,d){Sf=iw=!0;var f=u.pending;f===null?d.next=d:(d.next=f.next,f.next=d),u.pending=d}function y$(u,d,f){if((f&4194048)!==0){var y=d.lanes;y&=u.pendingLanes,f|=y,d.lanes=f,xt(u,f)}}var Ry={readContext:va,use:uw,useCallback:fr,useContext:fr,useEffect:fr,useImperativeHandle:fr,useLayoutEffect:fr,useInsertionEffect:fr,useMemo:fr,useReducer:fr,useRef:fr,useState:fr,useDebugValue:fr,useDeferredValue:fr,useTransition:fr,useSyncExternalStore:fr,useId:fr,useHostTransitionStatus:fr,useFormState:fr,useActionState:fr,useOptimistic:fr,useMemoCache:fr,useCacheRefresh:fr};Ry.useEffectEvent=fr;var b$={readContext:va,use:uw,useCallback:function(u,d){return ts().memoizedState=[u,d===void 0?null:d],u},useContext:va,useEffect:t$,useImperativeHandle:function(u,d,f){f=f!=null?f.concat([u]):null,hw(4194308,4,s$.bind(null,d,u),f)},useLayoutEffect:function(u,d){return hw(4194308,4,u,d)},useInsertionEffect:function(u,d){hw(4,2,u,d)},useMemo:function(u,d){var f=ts();d=d===void 0?null:d;var y=u();if(wh){ln(!0);try{u()}finally{ln(!1)}}return f.memoizedState=[y,d],y},useReducer:function(u,d,f){var y=ts();if(f!==void 0){var S=f(d);if(wh){ln(!0);try{f(d)}finally{ln(!1)}}}else S=d;return y.memoizedState=y.baseState=S,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:S},y.queue=u,u=u.dispatch=B9.bind(null,Dt,u),[y.memoizedState,u]},useRef:function(u){var d=ts();return u={current:u},d.memoizedState=u},useState:function(u){u=RI(u);var d=u.queue,f=m$.bind(null,Dt,d);return d.dispatch=f,[u.memoizedState,f]},useDebugValue:$I,useDeferredValue:function(u,d){var f=ts();return OI(f,u,d)},useTransition:function(){var u=RI(!1);return u=c$.bind(null,Dt,u.queue,!0,!1),ts().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,d,f){var y=Dt,S=ts();if(Qt){if(f===void 0)throw Error(r(407));f=f()}else{if(f=d(),Rn===null)throw Error(r(349));(Wt&127)!==0||zM(y,d,f)}S.memoizedState=f;var T={value:f,getSnapshot:d};return S.queue=T,t$(UM.bind(null,y,T,u),[u]),y.flags|=2048,Tf(9,{destroy:void 0},VM.bind(null,y,T,f,d),null),f},useId:function(){var u=ts(),d=Rn.identifierPrefix;if(Qt){var f=wo,y=xo;f=(y&~(1<<32-Fn(y)-1)).toString(32)+f,d="_"+d+"R_"+f,f=ow++,0<f&&(d+="H"+f.toString(32)),d+="_"}else f=O9++,d="_"+d+"r_"+f.toString(32)+"_";return u.memoizedState=d},useHostTransitionStatus:PI,useFormState:YM,useActionState:YM,useOptimistic:function(u){var d=ts();d.memoizedState=d.baseState=u;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=f,d=LI.bind(null,Dt,!0,f),f.dispatch=d,[u,d]},useMemoCache:NI,useCacheRefresh:function(){return ts().memoizedState=U9.bind(null,Dt)},useEffectEvent:function(u){var d=ts(),f={impl:u};return d.memoizedState=f,function(){if((hn&2)!==0)throw Error(r(440));return f.impl.apply(void 0,arguments)}}},zI={readContext:va,use:uw,useCallback:o$,useContext:va,useEffect:MI,useImperativeHandle:i$,useInsertionEffect:r$,useLayoutEffect:a$,useMemo:l$,useReducer:cw,useRef:e$,useState:function(){return cw(vl)},useDebugValue:$I,useDeferredValue:function(u,d){var f=Sr();return u$(f,En.memoizedState,u,d)},useTransition:function(){var u=cw(vl)[0],d=Sr().memoizedState;return[typeof u=="boolean"?u:Cy(u),d]},useSyncExternalStore:LM,useId:p$,useHostTransitionStatus:PI,useFormState:QM,useActionState:QM,useOptimistic:function(u,d){var f=Sr();return jM(f,En,u,d)},useMemoCache:NI,useCacheRefresh:f$};zI.useEffectEvent=n$;var v$={readContext:va,use:uw,useCallback:o$,useContext:va,useEffect:MI,useImperativeHandle:i$,useInsertionEffect:r$,useLayoutEffect:a$,useMemo:l$,useReducer:AI,useRef:e$,useState:function(){return AI(vl)},useDebugValue:$I,useDeferredValue:function(u,d){var f=Sr();return En===null?OI(f,u,d):u$(f,En.memoizedState,u,d)},useTransition:function(){var u=AI(vl)[0],d=Sr().memoizedState;return[typeof u=="boolean"?u:Cy(u),d]},useSyncExternalStore:LM,useId:p$,useHostTransitionStatus:PI,useFormState:JM,useActionState:JM,useOptimistic:function(u,d){var f=Sr();return En!==null?jM(f,En,u,d):(f.baseState=u,[u,f.queue.dispatch])},useMemoCache:NI,useCacheRefresh:f$};v$.useEffectEvent=n$;function VI(u,d,f,y){d=u.memoizedState,f=f(y,d),f=f==null?d:p({},d,f),u.memoizedState=f,u.lanes===0&&(u.updateQueue.baseState=f)}var UI={enqueueSetState:function(u,d,f){u=u._reactInternals;var y=Gs(),S=vu(y);S.payload=d,f!=null&&(S.callback=f),d=xu(u,S,y),d!==null&&(ws(d,u,y),Ty(d,u,y))},enqueueReplaceState:function(u,d,f){u=u._reactInternals;var y=Gs(),S=vu(y);S.tag=1,S.payload=d,f!=null&&(S.callback=f),d=xu(u,S,y),d!==null&&(ws(d,u,y),Ty(d,u,y))},enqueueForceUpdate:function(u,d){u=u._reactInternals;var f=Gs(),y=vu(f);y.tag=2,d!=null&&(y.callback=d),d=xu(u,y,f),d!==null&&(ws(d,u,f),Ty(d,u,f))}};function x$(u,d,f,y,S,T,L){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(y,T,L):d.prototype&&d.prototype.isPureReactComponent?!yy(f,y)||!yy(S,T):!0}function w$(u,d,f,y){u=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(f,y),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(f,y),d.state!==u&&UI.enqueueReplaceState(d,d.state,null)}function _h(u,d){var f=d;if("ref"in d){f={};for(var y in d)y!=="ref"&&(f[y]=d[y])}if(u=u.defaultProps){f===d&&(f=p({},f));for(var S in u)f[S]===void 0&&(f[S]=u[S])}return f}function _$(u){Hx(u)}function S$(u){console.error(u)}function I$(u){Hx(u)}function fw(u,d){try{var f=u.onUncaughtError;f(d.value,{componentStack:d.stack})}catch(y){setTimeout(function(){throw y})}}function T$(u,d,f){try{var y=u.onCaughtError;y(f.value,{componentStack:f.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function BI(u,d,f){return f=vu(f),f.tag=3,f.payload={element:null},f.callback=function(){fw(u,d)},f}function k$(u){return u=vu(u),u.tag=3,u}function E$(u,d,f,y){var S=f.type.getDerivedStateFromError;if(typeof S=="function"){var T=y.value;u.payload=function(){return S(T)},u.callback=function(){T$(d,f,y)}}var L=f.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(u.callback=function(){T$(d,f,y),typeof S!="function"&&(ku===null?ku=new Set([this]):ku.add(this));var j=y.stack;this.componentDidCatch(y.value,{componentStack:j!==null?j:""})})}function W9(u,d,f,y,S){if(f.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(d=f.alternate,d!==null&&yf(d,f,S,!0),f=Bs.current,f!==null){switch(f.tag){case 31:case 13:return yi===null?kw():f.alternate===null&&mr===0&&(mr=3),f.flags&=-257,f.flags|=65536,f.lanes=S,y===tw?f.flags|=16384:(d=f.updateQueue,d===null?f.updateQueue=new Set([y]):d.add(y),pT(u,y,S)),!1;case 22:return f.flags|=65536,y===tw?f.flags|=16384:(d=f.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([y])},f.updateQueue=d):(f=d.retryQueue,f===null?d.retryQueue=new Set([y]):f.add(y)),pT(u,y,S)),!1}throw Error(r(435,f.tag))}return pT(u,y,S),kw(),!1}if(Qt)return d=Bs.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=S,y!==oI&&(u=Error(r(422),{cause:y}),xy(pi(u,f)))):(y!==oI&&(d=Error(r(423),{cause:y}),xy(pi(d,f))),u=u.current.alternate,u.flags|=65536,S&=-S,u.lanes|=S,y=pi(y,f),S=BI(u.stateNode,y,S),bI(u,S),mr!==4&&(mr=2)),!1;var T=Error(r(520),{cause:y});if(T=pi(T,f),zy===null?zy=[T]:zy.push(T),mr!==4&&(mr=2),d===null)return!0;y=pi(y,f),f=d;do{switch(f.tag){case 3:return f.flags|=65536,u=S&-S,f.lanes|=u,u=BI(f.stateNode,y,u),bI(f,u),!1;case 1:if(d=f.type,T=f.stateNode,(f.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(ku===null||!ku.has(T))))return f.flags|=65536,S&=-S,f.lanes|=S,S=k$(S),E$(S,u,f,y),bI(f,S),!1}f=f.return}while(f!==null);return!1}var WI=Error(r(461)),Pr=!1;function xa(u,d,f,y){d.child=u===null?RM(d,null,f,y):xh(d,u.child,f,y)}function N$(u,d,f,y,S){f=f.render;var T=d.ref;if("ref"in y){var L={};for(var j in y)j!=="ref"&&(L[j]=y[j])}else L=y;return gh(d),y=II(u,d,f,L,T,S),j=TI(),u!==null&&!Pr?(kI(u,d,S),xl(u,d,S)):(Qt&&j&&sI(d),d.flags|=1,xa(u,d,y,S),d.child)}function C$(u,d,f,y,S){if(u===null){var T=f.type;return typeof T=="function"&&!nI(T)&&T.defaultProps===void 0&&f.compare===null?(d.tag=15,d.type=T,A$(u,d,T,y,S)):(u=Xx(f.type,null,y,d,d.mode,S),u.ref=d.ref,u.return=d,d.child=u)}if(T=u.child,!QI(u,S)){var L=T.memoizedProps;if(f=f.compare,f=f!==null?f:yy,f(L,y)&&u.ref===d.ref)return xl(u,d,S)}return d.flags|=1,u=fl(T,y),u.ref=d.ref,u.return=d,d.child=u}function A$(u,d,f,y,S){if(u!==null){var T=u.memoizedProps;if(yy(T,y)&&u.ref===d.ref)if(Pr=!1,d.pendingProps=y=T,QI(u,S))(u.flags&131072)!==0&&(Pr=!0);else return d.lanes=u.lanes,xl(u,d,S)}return jI(u,d,f,y,S)}function R$(u,d,f,y){var S=y.children,T=u!==null?u.memoizedState:null;if(u===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.mode==="hidden"){if((d.flags&128)!==0){if(T=T!==null?T.baseLanes|f:f,u!==null){for(y=d.child=u.child,S=0;y!==null;)S=S|y.lanes|y.childLanes,y=y.sibling;y=S&~T}else y=0,d.child=null;return D$(u,d,T,f,y)}if((f&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},u!==null&&Jx(d,T!==null?T.cachePool:null),T!==null?$M(d,T):xI(),OM(d);else return y=d.lanes=536870912,D$(u,d,T!==null?T.baseLanes|f:f,f,y)}else T!==null?(Jx(d,T.cachePool),$M(d,T),_u(),d.memoizedState=null):(u!==null&&Jx(d,null),xI(),_u());return xa(u,d,S,f),d.child}function Dy(u,d){return u!==null&&u.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function D$(u,d,f,y,S){var T=fI();return T=T===null?null:{parent:Or._currentValue,pool:T},d.memoizedState={baseLanes:f,cachePool:T},u!==null&&Jx(d,null),xI(),OM(d),u!==null&&yf(u,d,y,!0),d.childLanes=S,null}function mw(u,d){return d=yw({mode:d.mode,children:d.children},u.mode),d.ref=u.ref,u.child=d,d.return=u,d}function M$(u,d,f){return xh(d,u.child,null,f),u=mw(d,d.pendingProps),u.flags|=2,Ws(d),d.memoizedState=null,u}function j9(u,d,f){var y=d.pendingProps,S=(d.flags&128)!==0;if(d.flags&=-129,u===null){if(Qt){if(y.mode==="hidden")return u=mw(d,y),d.lanes=536870912,Dy(null,u);if(_I(d),(u=Vn)?(u=HO(u,gi),u=u!==null&&u.data==="&"?u:null,u!==null&&(d.memoizedState={dehydrated:u,treeContext:fu!==null?{id:xo,overflow:wo}:null,retryLane:536870912,hydrationErrors:null},f=gM(u),f.return=d,d.child=f,ba=d,Vn=null)):u=null,u===null)throw gu(d);return d.lanes=536870912,null}return mw(d,y)}var T=u.memoizedState;if(T!==null){var L=T.dehydrated;if(_I(d),S)if(d.flags&256)d.flags&=-257,d=M$(u,d,f);else if(d.memoizedState!==null)d.child=u.child,d.flags|=128,d=null;else throw Error(r(558));else if(Pr||yf(u,d,f,!1),S=(f&u.childLanes)!==0,Pr||S){if(y=Rn,y!==null&&(L=mt(y,f),L!==0&&L!==T.retryLane))throw T.retryLane=L,dh(u,L),ws(y,u,L),WI;kw(),d=M$(u,d,f)}else u=T.treeContext,Vn=bi(L.nextSibling),ba=d,Qt=!0,mu=null,gi=!1,u!==null&&vM(d,u),d=mw(d,y),d.flags|=4096;return d}return u=fl(u.child,{mode:y.mode,children:y.children}),u.ref=d.ref,d.child=u,u.return=d,u}function gw(u,d){var f=d.ref;if(f===null)u!==null&&u.ref!==null&&(d.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(u===null||u.ref!==f)&&(d.flags|=4194816)}}function jI(u,d,f,y,S){return gh(d),f=II(u,d,f,y,void 0,S),y=TI(),u!==null&&!Pr?(kI(u,d,S),xl(u,d,S)):(Qt&&y&&sI(d),d.flags|=1,xa(u,d,f,S),d.child)}function $$(u,d,f,y,S,T){return gh(d),d.updateQueue=null,f=PM(d,y,f,S),FM(u),y=TI(),u!==null&&!Pr?(kI(u,d,T),xl(u,d,T)):(Qt&&y&&sI(d),d.flags|=1,xa(u,d,f,T),d.child)}function O$(u,d,f,y,S){if(gh(d),d.stateNode===null){var T=pf,L=f.contextType;typeof L=="object"&&L!==null&&(T=va(L)),T=new f(y,T),d.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=UI,d.stateNode=T,T._reactInternals=d,T=d.stateNode,T.props=y,T.state=d.memoizedState,T.refs={},gI(d),L=f.contextType,T.context=typeof L=="object"&&L!==null?va(L):pf,T.state=d.memoizedState,L=f.getDerivedStateFromProps,typeof L=="function"&&(VI(d,f,L,y),T.state=d.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(L=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),L!==T.state&&UI.enqueueReplaceState(T,T.state,null),Ey(d,y,T,S),ky(),T.state=d.memoizedState),typeof T.componentDidMount=="function"&&(d.flags|=4194308),y=!0}else if(u===null){T=d.stateNode;var j=d.memoizedProps,ae=_h(f,j);T.props=ae;var ve=T.context,Ne=f.contextType;L=pf,typeof Ne=="object"&&Ne!==null&&(L=va(Ne));var De=f.getDerivedStateFromProps;Ne=typeof De=="function"||typeof T.getSnapshotBeforeUpdate=="function",j=d.pendingProps!==j,Ne||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(j||ve!==L)&&w$(d,T,y,L),bu=!1;var we=d.memoizedState;T.state=we,Ey(d,y,T,S),ky(),ve=d.memoizedState,j||we!==ve||bu?(typeof De=="function"&&(VI(d,f,De,y),ve=d.memoizedState),(ae=bu||x$(d,f,ae,y,we,ve,L))?(Ne||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(d.flags|=4194308)):(typeof T.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=y,d.memoizedState=ve),T.props=y,T.state=ve,T.context=L,y=ae):(typeof T.componentDidMount=="function"&&(d.flags|=4194308),y=!1)}else{T=d.stateNode,yI(u,d),L=d.memoizedProps,Ne=_h(f,L),T.props=Ne,De=d.pendingProps,we=T.context,ve=f.contextType,ae=pf,typeof ve=="object"&&ve!==null&&(ae=va(ve)),j=f.getDerivedStateFromProps,(ve=typeof j=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(L!==De||we!==ae)&&w$(d,T,y,ae),bu=!1,we=d.memoizedState,T.state=we,Ey(d,y,T,S),ky();var Ie=d.memoizedState;L!==De||we!==Ie||bu||u!==null&&u.dependencies!==null&&Qx(u.dependencies)?(typeof j=="function"&&(VI(d,f,j,y),Ie=d.memoizedState),(Ne=bu||x$(d,f,Ne,y,we,Ie,ae)||u!==null&&u.dependencies!==null&&Qx(u.dependencies))?(ve||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(y,Ie,ae),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(y,Ie,ae)),typeof T.componentDidUpdate=="function"&&(d.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof T.componentDidUpdate!="function"||L===u.memoizedProps&&we===u.memoizedState||(d.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||L===u.memoizedProps&&we===u.memoizedState||(d.flags|=1024),d.memoizedProps=y,d.memoizedState=Ie),T.props=y,T.state=Ie,T.context=ae,y=Ne):(typeof T.componentDidUpdate!="function"||L===u.memoizedProps&&we===u.memoizedState||(d.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||L===u.memoizedProps&&we===u.memoizedState||(d.flags|=1024),y=!1)}return T=y,gw(u,d),y=(d.flags&128)!==0,T||y?(T=d.stateNode,f=y&&typeof f.getDerivedStateFromError!="function"?null:T.render(),d.flags|=1,u!==null&&y?(d.child=xh(d,u.child,null,S),d.child=xh(d,null,f,S)):xa(u,d,f,S),d.memoizedState=T.state,u=d.child):u=xl(u,d,S),u}function F$(u,d,f,y){return fh(),d.flags|=256,xa(u,d,f,y),d.child}var HI={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function GI(u){return{baseLanes:u,cachePool:TM()}}function qI(u,d,f){return u=u!==null?u.childLanes&~f:0,d&&(u|=Hs),u}function P$(u,d,f){var y=d.pendingProps,S=!1,T=(d.flags&128)!==0,L;if((L=T)||(L=u!==null&&u.memoizedState===null?!1:(_r.current&2)!==0),L&&(S=!0,d.flags&=-129),L=(d.flags&32)!==0,d.flags&=-33,u===null){if(Qt){if(S?wu(d):_u(),(u=Vn)?(u=HO(u,gi),u=u!==null&&u.data!=="&"?u:null,u!==null&&(d.memoizedState={dehydrated:u,treeContext:fu!==null?{id:xo,overflow:wo}:null,retryLane:536870912,hydrationErrors:null},f=gM(u),f.return=d,d.child=f,ba=d,Vn=null)):u=null,u===null)throw gu(d);return CT(u)?d.lanes=32:d.lanes=536870912,null}var j=y.children;return y=y.fallback,S?(_u(),S=d.mode,j=yw({mode:"hidden",children:j},S),y=ph(y,S,f,null),j.return=d,y.return=d,j.sibling=y,d.child=j,y=d.child,y.memoizedState=GI(f),y.childLanes=qI(u,L,f),d.memoizedState=HI,Dy(null,y)):(wu(d),KI(d,j))}var ae=u.memoizedState;if(ae!==null&&(j=ae.dehydrated,j!==null)){if(T)d.flags&256?(wu(d),d.flags&=-257,d=XI(u,d,f)):d.memoizedState!==null?(_u(),d.child=u.child,d.flags|=128,d=null):(_u(),j=y.fallback,S=d.mode,y=yw({mode:"visible",children:y.children},S),j=ph(j,S,f,null),j.flags|=2,y.return=d,j.return=d,y.sibling=j,d.child=y,xh(d,u.child,null,f),y=d.child,y.memoizedState=GI(f),y.childLanes=qI(u,L,f),d.memoizedState=HI,d=Dy(null,y));else if(wu(d),CT(j)){if(L=j.nextSibling&&j.nextSibling.dataset,L)var ve=L.dgst;L=ve,y=Error(r(419)),y.stack="",y.digest=L,xy({value:y,source:null,stack:null}),d=XI(u,d,f)}else if(Pr||yf(u,d,f,!1),L=(f&u.childLanes)!==0,Pr||L){if(L=Rn,L!==null&&(y=mt(L,f),y!==0&&y!==ae.retryLane))throw ae.retryLane=y,dh(u,y),ws(L,u,y),WI;NT(j)||kw(),d=XI(u,d,f)}else NT(j)?(d.flags|=192,d.child=u.child,d=null):(u=ae.treeContext,Vn=bi(j.nextSibling),ba=d,Qt=!0,mu=null,gi=!1,u!==null&&vM(d,u),d=KI(d,y.children),d.flags|=4096);return d}return S?(_u(),j=y.fallback,S=d.mode,ae=u.child,ve=ae.sibling,y=fl(ae,{mode:"hidden",children:y.children}),y.subtreeFlags=ae.subtreeFlags&65011712,ve!==null?j=fl(ve,j):(j=ph(j,S,f,null),j.flags|=2),j.return=d,y.return=d,y.sibling=j,d.child=y,Dy(null,y),y=d.child,j=u.child.memoizedState,j===null?j=GI(f):(S=j.cachePool,S!==null?(ae=Or._currentValue,S=S.parent!==ae?{parent:ae,pool:ae}:S):S=TM(),j={baseLanes:j.baseLanes|f,cachePool:S}),y.memoizedState=j,y.childLanes=qI(u,L,f),d.memoizedState=HI,Dy(u.child,y)):(wu(d),f=u.child,u=f.sibling,f=fl(f,{mode:"visible",children:y.children}),f.return=d,f.sibling=null,u!==null&&(L=d.deletions,L===null?(d.deletions=[u],d.flags|=16):L.push(u)),d.child=f,d.memoizedState=null,f)}function KI(u,d){return d=yw({mode:"visible",children:d},u.mode),d.return=u,u.child=d}function yw(u,d){return u=Us(22,u,null,d),u.lanes=0,u}function XI(u,d,f){return xh(d,u.child,null,f),u=KI(d,d.pendingProps.children),u.flags|=2,d.memoizedState=null,u}function L$(u,d,f){u.lanes|=d;var y=u.alternate;y!==null&&(y.lanes|=d),cI(u.return,d,f)}function YI(u,d,f,y,S,T){var L=u.memoizedState;L===null?u.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:y,tail:f,tailMode:S,treeForkCount:T}:(L.isBackwards=d,L.rendering=null,L.renderingStartTime=0,L.last=y,L.tail=f,L.tailMode=S,L.treeForkCount=T)}function z$(u,d,f){var y=d.pendingProps,S=y.revealOrder,T=y.tail;y=y.children;var L=_r.current,j=(L&2)!==0;if(j?(L=L&1|2,d.flags|=128):L&=1,ue(_r,L),xa(u,d,y,f),y=Qt?vy:0,!j&&u!==null&&(u.flags&128)!==0)e:for(u=d.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&L$(u,f,d);else if(u.tag===19)L$(u,f,d);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===d)break e;for(;u.sibling===null;){if(u.return===null||u.return===d)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(S){case"forwards":for(f=d.child,S=null;f!==null;)u=f.alternate,u!==null&&sw(u)===null&&(S=f),f=f.sibling;f=S,f===null?(S=d.child,d.child=null):(S=f.sibling,f.sibling=null),YI(d,!1,S,f,T,y);break;case"backwards":case"unstable_legacy-backwards":for(f=null,S=d.child,d.child=null;S!==null;){if(u=S.alternate,u!==null&&sw(u)===null){d.child=S;break}u=S.sibling,S.sibling=f,f=S,S=u}YI(d,!0,f,null,T,y);break;case"together":YI(d,!1,null,null,void 0,y);break;default:d.memoizedState=null}return d.child}function xl(u,d,f){if(u!==null&&(d.dependencies=u.dependencies),Tu|=d.lanes,(f&d.childLanes)===0)if(u!==null){if(yf(u,d,f,!1),(f&d.childLanes)===0)return null}else return null;if(u!==null&&d.child!==u.child)throw Error(r(153));if(d.child!==null){for(u=d.child,f=fl(u,u.pendingProps),d.child=f,f.return=d;u.sibling!==null;)u=u.sibling,f=f.sibling=fl(u,u.pendingProps),f.return=d;f.sibling=null}return d.child}function QI(u,d){return(u.lanes&d)!==0?!0:(u=u.dependencies,!!(u!==null&&Qx(u)))}function H9(u,d,f){switch(d.tag){case 3:Fe(d,d.stateNode.containerInfo),yu(d,Or,u.memoizedState.cache),fh();break;case 27:case 5:at(d);break;case 4:Fe(d,d.stateNode.containerInfo);break;case 10:yu(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,_I(d),null;break;case 13:var y=d.memoizedState;if(y!==null)return y.dehydrated!==null?(wu(d),d.flags|=128,null):(f&d.child.childLanes)!==0?P$(u,d,f):(wu(d),u=xl(u,d,f),u!==null?u.sibling:null);wu(d);break;case 19:var S=(u.flags&128)!==0;if(y=(f&d.childLanes)!==0,y||(yf(u,d,f,!1),y=(f&d.childLanes)!==0),S){if(y)return z$(u,d,f);d.flags|=128}if(S=d.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),ue(_r,_r.current),y)break;return null;case 22:return d.lanes=0,R$(u,d,f,d.pendingProps);case 24:yu(d,Or,u.memoizedState.cache)}return xl(u,d,f)}function V$(u,d,f){if(u!==null)if(u.memoizedProps!==d.pendingProps)Pr=!0;else{if(!QI(u,f)&&(d.flags&128)===0)return Pr=!1,H9(u,d,f);Pr=(u.flags&131072)!==0}else Pr=!1,Qt&&(d.flags&1048576)!==0&&bM(d,vy,d.index);switch(d.lanes=0,d.tag){case 16:e:{var y=d.pendingProps;if(u=bh(d.elementType),d.type=u,typeof u=="function")nI(u)?(y=_h(u,y),d.tag=1,d=O$(null,d,u,y,f)):(d.tag=0,d=jI(null,d,u,y,f));else{if(u!=null){var S=u.$$typeof;if(S===E){d.tag=11,d=N$(null,d,u,y,f);break e}else if(S===D){d.tag=14,d=C$(null,d,u,y,f);break e}}throw d=Q(u)||u,Error(r(306,d,""))}}return d;case 0:return jI(u,d,d.type,d.pendingProps,f);case 1:return y=d.type,S=_h(y,d.pendingProps),O$(u,d,y,S,f);case 3:e:{if(Fe(d,d.stateNode.containerInfo),u===null)throw Error(r(387));y=d.pendingProps;var T=d.memoizedState;S=T.element,yI(u,d),Ey(d,y,null,f);var L=d.memoizedState;if(y=L.cache,yu(d,Or,y),y!==T.cache&&hI(d,[Or],f,!0),ky(),y=L.element,T.isDehydrated)if(T={element:y,isDehydrated:!1,cache:L.cache},d.updateQueue.baseState=T,d.memoizedState=T,d.flags&256){d=F$(u,d,y,f);break e}else if(y!==S){S=pi(Error(r(424)),d),xy(S),d=F$(u,d,y,f);break e}else{switch(u=d.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(Vn=bi(u.firstChild),ba=d,Qt=!0,mu=null,gi=!0,f=RM(d,null,y,f),d.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(fh(),y===S){d=xl(u,d,f);break e}xa(u,d,y,f)}d=d.child}return d;case 26:return gw(u,d),u===null?(f=QO(d.type,null,d.pendingProps,null))?d.memoizedState=f:Qt||(f=d.type,u=d.pendingProps,y=Mw($e.current).createElement(f),y[zn]=d,y[Yt]=u,wa(y,f,u),pr(y),d.stateNode=y):d.memoizedState=QO(d.type,u.memoizedProps,d.pendingProps,u.memoizedState),null;case 27:return at(d),u===null&&Qt&&(y=d.stateNode=KO(d.type,d.pendingProps,$e.current),ba=d,gi=!0,S=Vn,Au(d.type)?(AT=S,Vn=bi(y.firstChild)):Vn=S),xa(u,d,d.pendingProps.children,f),gw(u,d),u===null&&(d.flags|=4194304),d.child;case 5:return u===null&&Qt&&((S=y=Vn)&&(y=w7(y,d.type,d.pendingProps,gi),y!==null?(d.stateNode=y,ba=d,Vn=bi(y.firstChild),gi=!1,S=!0):S=!1),S||gu(d)),at(d),S=d.type,T=d.pendingProps,L=u!==null?u.memoizedProps:null,y=T.children,TT(S,T)?y=null:L!==null&&TT(S,L)&&(d.flags|=32),d.memoizedState!==null&&(S=II(u,d,F9,null,null,f),qy._currentValue=S),gw(u,d),xa(u,d,y,f),d.child;case 6:return u===null&&Qt&&((u=f=Vn)&&(f=_7(f,d.pendingProps,gi),f!==null?(d.stateNode=f,ba=d,Vn=null,u=!0):u=!1),u||gu(d)),null;case 13:return P$(u,d,f);case 4:return Fe(d,d.stateNode.containerInfo),y=d.pendingProps,u===null?d.child=xh(d,null,y,f):xa(u,d,y,f),d.child;case 11:return N$(u,d,d.type,d.pendingProps,f);case 7:return xa(u,d,d.pendingProps,f),d.child;case 8:return xa(u,d,d.pendingProps.children,f),d.child;case 12:return xa(u,d,d.pendingProps.children,f),d.child;case 10:return y=d.pendingProps,yu(d,d.type,y.value),xa(u,d,y.children,f),d.child;case 9:return S=d.type._context,y=d.pendingProps.children,gh(d),S=va(S),y=y(S),d.flags|=1,xa(u,d,y,f),d.child;case 14:return C$(u,d,d.type,d.pendingProps,f);case 15:return A$(u,d,d.type,d.pendingProps,f);case 19:return z$(u,d,f);case 31:return j9(u,d,f);case 22:return R$(u,d,f,d.pendingProps);case 24:return gh(d),y=va(Or),u===null?(S=fI(),S===null&&(S=Rn,T=dI(),S.pooledCache=T,T.refCount++,T!==null&&(S.pooledCacheLanes|=f),S=T),d.memoizedState={parent:y,cache:S},gI(d),yu(d,Or,S)):((u.lanes&f)!==0&&(yI(u,d),Ey(d,null,null,f),ky()),S=u.memoizedState,T=d.memoizedState,S.parent!==y?(S={parent:y,cache:y},d.memoizedState=S,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=S),yu(d,Or,y)):(y=T.cache,yu(d,Or,y),y!==S.cache&&hI(d,[Or],f,!0))),xa(u,d,d.pendingProps.children,f),d.child;case 29:throw d.pendingProps}throw Error(r(156,d.tag))}function wl(u){u.flags|=4}function ZI(u,d,f,y,S){if((d=(u.mode&32)!==0)&&(d=!1),d){if(u.flags|=16777216,(S&335544128)===S)if(u.stateNode.complete)u.flags|=8192;else if(pO())u.flags|=8192;else throw vh=tw,mI}else u.flags&=-16777217}function U$(u,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!nF(d))if(pO())u.flags|=8192;else throw vh=tw,mI}function bw(u,d){d!==null&&(u.flags|=4),u.flags&16384&&(d=u.tag!==22?Le():536870912,u.lanes|=d,Cf|=d)}function My(u,d){if(!Qt)switch(u.tailMode){case"hidden":d=u.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?u.tail=null:f.sibling=null;break;case"collapsed":f=u.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?d||u.tail===null?u.tail=null:u.tail.sibling=null:y.sibling=null}}function Un(u){var d=u.alternate!==null&&u.alternate.child===u.child,f=0,y=0;if(d)for(var S=u.child;S!==null;)f|=S.lanes|S.childLanes,y|=S.subtreeFlags&65011712,y|=S.flags&65011712,S.return=u,S=S.sibling;else for(S=u.child;S!==null;)f|=S.lanes|S.childLanes,y|=S.subtreeFlags,y|=S.flags,S.return=u,S=S.sibling;return u.subtreeFlags|=y,u.childLanes=f,d}function G9(u,d,f){var y=d.pendingProps;switch(iI(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Un(d),null;case 1:return Un(d),null;case 3:return f=d.stateNode,y=null,u!==null&&(y=u.memoizedState.cache),d.memoizedState.cache!==y&&(d.flags|=2048),yl(Or),We(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(u===null||u.child===null)&&(gf(d)?wl(d):u===null||u.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,lI())),Un(d),null;case 26:var S=d.type,T=d.memoizedState;return u===null?(wl(d),T!==null?(Un(d),U$(d,T)):(Un(d),ZI(d,S,null,y,f))):T?T!==u.memoizedState?(wl(d),Un(d),U$(d,T)):(Un(d),d.flags&=-16777217):(u=u.memoizedProps,u!==y&&wl(d),Un(d),ZI(d,S,u,y,f)),null;case 27:if(pt(d),f=$e.current,S=d.type,u!==null&&d.stateNode!=null)u.memoizedProps!==y&&wl(d);else{if(!y){if(d.stateNode===null)throw Error(r(166));return Un(d),null}u=ge.current,gf(d)?xM(d):(u=KO(S,y,f),d.stateNode=u,wl(d))}return Un(d),null;case 5:if(pt(d),S=d.type,u!==null&&d.stateNode!=null)u.memoizedProps!==y&&wl(d);else{if(!y){if(d.stateNode===null)throw Error(r(166));return Un(d),null}if(T=ge.current,gf(d))xM(d);else{var L=Mw($e.current);switch(T){case 1:T=L.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:T=L.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":T=L.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":T=L.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":T=L.createElement("div"),T.innerHTML="<script><\/script>",T=T.removeChild(T.firstChild);break;case"select":T=typeof y.is=="string"?L.createElement("select",{is:y.is}):L.createElement("select"),y.multiple?T.multiple=!0:y.size&&(T.size=y.size);break;default:T=typeof y.is=="string"?L.createElement(S,{is:y.is}):L.createElement(S)}}T[zn]=d,T[Yt]=y;e:for(L=d.child;L!==null;){if(L.tag===5||L.tag===6)T.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===d)break e;for(;L.sibling===null;){if(L.return===null||L.return===d)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}d.stateNode=T;e:switch(wa(T,S,y),S){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&wl(d)}}return Un(d),ZI(d,d.type,u===null?null:u.memoizedProps,d.pendingProps,f),null;case 6:if(u&&d.stateNode!=null)u.memoizedProps!==y&&wl(d);else{if(typeof y!="string"&&d.stateNode===null)throw Error(r(166));if(u=$e.current,gf(d)){if(u=d.stateNode,f=d.memoizedProps,y=null,S=ba,S!==null)switch(S.tag){case 27:case 5:y=S.memoizedProps}u[zn]=d,u=!!(u.nodeValue===f||y!==null&&y.suppressHydrationWarning===!0||PO(u.nodeValue,f)),u||gu(d,!0)}else u=Mw(u).createTextNode(y),u[zn]=d,d.stateNode=u}return Un(d),null;case 31:if(f=d.memoizedState,u===null||u.memoizedState!==null){if(y=gf(d),f!==null){if(u===null){if(!y)throw Error(r(318));if(u=d.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(557));u[zn]=d}else fh(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Un(d),u=!1}else f=lI(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=f),u=!0;if(!u)return d.flags&256?(Ws(d),d):(Ws(d),null);if((d.flags&128)!==0)throw Error(r(558))}return Un(d),null;case 13:if(y=d.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(S=gf(d),y!==null&&y.dehydrated!==null){if(u===null){if(!S)throw Error(r(318));if(S=d.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(r(317));S[zn]=d}else fh(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Un(d),S=!1}else S=lI(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=S),S=!0;if(!S)return d.flags&256?(Ws(d),d):(Ws(d),null)}return Ws(d),(d.flags&128)!==0?(d.lanes=f,d):(f=y!==null,u=u!==null&&u.memoizedState!==null,f&&(y=d.child,S=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(S=y.alternate.memoizedState.cachePool.pool),T=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(T=y.memoizedState.cachePool.pool),T!==S&&(y.flags|=2048)),f!==u&&f&&(d.child.flags|=8192),bw(d,d.updateQueue),Un(d),null);case 4:return We(),u===null&&xT(d.stateNode.containerInfo),Un(d),null;case 10:return yl(d.type),Un(d),null;case 19:if(se(_r),y=d.memoizedState,y===null)return Un(d),null;if(S=(d.flags&128)!==0,T=y.rendering,T===null)if(S)My(y,!1);else{if(mr!==0||u!==null&&(u.flags&128)!==0)for(u=d.child;u!==null;){if(T=sw(u),T!==null){for(d.flags|=128,My(y,!1),u=T.updateQueue,d.updateQueue=u,bw(d,u),d.subtreeFlags=0,u=f,f=d.child;f!==null;)mM(f,u),f=f.sibling;return ue(_r,_r.current&1|2),Qt&&ml(d,y.treeForkCount),d.child}u=u.sibling}y.tail!==null&&kn()>Sw&&(d.flags|=128,S=!0,My(y,!1),d.lanes=4194304)}else{if(!S)if(u=sw(T),u!==null){if(d.flags|=128,S=!0,u=u.updateQueue,d.updateQueue=u,bw(d,u),My(y,!0),y.tail===null&&y.tailMode==="hidden"&&!T.alternate&&!Qt)return Un(d),null}else 2*kn()-y.renderingStartTime>Sw&&f!==536870912&&(d.flags|=128,S=!0,My(y,!1),d.lanes=4194304);y.isBackwards?(T.sibling=d.child,d.child=T):(u=y.last,u!==null?u.sibling=T:d.child=T,y.last=T)}return y.tail!==null?(u=y.tail,y.rendering=u,y.tail=u.sibling,y.renderingStartTime=kn(),u.sibling=null,f=_r.current,ue(_r,S?f&1|2:f&1),Qt&&ml(d,y.treeForkCount),u):(Un(d),null);case 22:case 23:return Ws(d),wI(),y=d.memoizedState!==null,u!==null?u.memoizedState!==null!==y&&(d.flags|=8192):y&&(d.flags|=8192),y?(f&536870912)!==0&&(d.flags&128)===0&&(Un(d),d.subtreeFlags&6&&(d.flags|=8192)):Un(d),f=d.updateQueue,f!==null&&bw(d,f.retryQueue),f=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(f=u.memoizedState.cachePool.pool),y=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==f&&(d.flags|=2048),u!==null&&se(yh),null;case 24:return f=null,u!==null&&(f=u.memoizedState.cache),d.memoizedState.cache!==f&&(d.flags|=2048),yl(Or),Un(d),null;case 25:return null;case 30:return null}throw Error(r(156,d.tag))}function q9(u,d){switch(iI(d),d.tag){case 1:return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 3:return yl(Or),We(),u=d.flags,(u&65536)!==0&&(u&128)===0?(d.flags=u&-65537|128,d):null;case 26:case 27:case 5:return pt(d),null;case 31:if(d.memoizedState!==null){if(Ws(d),d.alternate===null)throw Error(r(340));fh()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 13:if(Ws(d),u=d.memoizedState,u!==null&&u.dehydrated!==null){if(d.alternate===null)throw Error(r(340));fh()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 19:return se(_r),null;case 4:return We(),null;case 10:return yl(d.type),null;case 22:case 23:return Ws(d),wI(),u!==null&&se(yh),u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 24:return yl(Or),null;case 25:return null;default:return null}}function B$(u,d){switch(iI(d),d.tag){case 3:yl(Or),We();break;case 26:case 27:case 5:pt(d);break;case 4:We();break;case 31:d.memoizedState!==null&&Ws(d);break;case 13:Ws(d);break;case 19:se(_r);break;case 10:yl(d.type);break;case 22:case 23:Ws(d),wI(),u!==null&&se(yh);break;case 24:yl(Or)}}function $y(u,d){try{var f=d.updateQueue,y=f!==null?f.lastEffect:null;if(y!==null){var S=y.next;f=S;do{if((f.tag&u)===u){y=void 0;var T=f.create,L=f.inst;y=T(),L.destroy=y}f=f.next}while(f!==S)}}catch(j){xn(d,d.return,j)}}function Su(u,d,f){try{var y=d.updateQueue,S=y!==null?y.lastEffect:null;if(S!==null){var T=S.next;y=T;do{if((y.tag&u)===u){var L=y.inst,j=L.destroy;if(j!==void 0){L.destroy=void 0,S=d;var ae=f,ve=j;try{ve()}catch(Ne){xn(S,ae,Ne)}}}y=y.next}while(y!==T)}}catch(Ne){xn(d,d.return,Ne)}}function W$(u){var d=u.updateQueue;if(d!==null){var f=u.stateNode;try{MM(d,f)}catch(y){xn(u,u.return,y)}}}function j$(u,d,f){f.props=_h(u.type,u.memoizedProps),f.state=u.memoizedState;try{f.componentWillUnmount()}catch(y){xn(u,d,y)}}function Oy(u,d){try{var f=u.ref;if(f!==null){switch(u.tag){case 26:case 27:case 5:var y=u.stateNode;break;case 30:y=u.stateNode;break;default:y=u.stateNode}typeof f=="function"?u.refCleanup=f(y):f.current=y}}catch(S){xn(u,d,S)}}function _o(u,d){var f=u.ref,y=u.refCleanup;if(f!==null)if(typeof y=="function")try{y()}catch(S){xn(u,d,S)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(S){xn(u,d,S)}else f.current=null}function H$(u){var d=u.type,f=u.memoizedProps,y=u.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":f.autoFocus&&y.focus();break e;case"img":f.src?y.src=f.src:f.srcSet&&(y.srcset=f.srcSet)}}catch(S){xn(u,u.return,S)}}function JI(u,d,f){try{var y=u.stateNode;m7(y,u.type,f,d),y[Yt]=d}catch(S){xn(u,u.return,S)}}function G$(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Au(u.type)||u.tag===4}function eT(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||G$(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Au(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function tT(u,d,f){var y=u.tag;if(y===5||y===6)u=u.stateNode,d?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(u,d):(d=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,d.appendChild(u),f=f._reactRootContainer,f!=null||d.onclick!==null||(d.onclick=$a));else if(y!==4&&(y===27&&Au(u.type)&&(f=u.stateNode,d=null),u=u.child,u!==null))for(tT(u,d,f),u=u.sibling;u!==null;)tT(u,d,f),u=u.sibling}function vw(u,d,f){var y=u.tag;if(y===5||y===6)u=u.stateNode,d?f.insertBefore(u,d):f.appendChild(u);else if(y!==4&&(y===27&&Au(u.type)&&(f=u.stateNode),u=u.child,u!==null))for(vw(u,d,f),u=u.sibling;u!==null;)vw(u,d,f),u=u.sibling}function q$(u){var d=u.stateNode,f=u.memoizedProps;try{for(var y=u.type,S=d.attributes;S.length;)d.removeAttributeNode(S[0]);wa(d,y,f),d[zn]=u,d[Yt]=f}catch(T){xn(u,u.return,T)}}var _l=!1,Lr=!1,nT=!1,K$=typeof WeakSet=="function"?WeakSet:Set,ha=null;function K9(u,d){if(u=u.containerInfo,ST=Vw,u=iM(u),XS(u)){if("selectionStart"in u)var f={start:u.selectionStart,end:u.selectionEnd};else e:{f=(f=u.ownerDocument)&&f.defaultView||window;var y=f.getSelection&&f.getSelection();if(y&&y.rangeCount!==0){f=y.anchorNode;var S=y.anchorOffset,T=y.focusNode;y=y.focusOffset;try{f.nodeType,T.nodeType}catch{f=null;break e}var L=0,j=-1,ae=-1,ve=0,Ne=0,De=u,we=null;t:for(;;){for(var Ie;De!==f||S!==0&&De.nodeType!==3||(j=L+S),De!==T||y!==0&&De.nodeType!==3||(ae=L+y),De.nodeType===3&&(L+=De.nodeValue.length),(Ie=De.firstChild)!==null;)we=De,De=Ie;for(;;){if(De===u)break t;if(we===f&&++ve===S&&(j=L),we===T&&++Ne===y&&(ae=L),(Ie=De.nextSibling)!==null)break;De=we,we=De.parentNode}De=Ie}f=j===-1||ae===-1?null:{start:j,end:ae}}else f=null}f=f||{start:0,end:0}}else f=null;for(IT={focusedElem:u,selectionRange:f},Vw=!1,ha=d;ha!==null;)if(d=ha,u=d.child,(d.subtreeFlags&1028)!==0&&u!==null)u.return=d,ha=u;else for(;ha!==null;){switch(d=ha,T=d.alternate,u=d.flags,d.tag){case 0:if((u&4)!==0&&(u=d.updateQueue,u=u!==null?u.events:null,u!==null))for(f=0;f<u.length;f++)S=u[f],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&T!==null){u=void 0,f=d,S=T.memoizedProps,T=T.memoizedState,y=f.stateNode;try{var Je=_h(f.type,S);u=y.getSnapshotBeforeUpdate(Je,T),y.__reactInternalSnapshotBeforeUpdate=u}catch(dt){xn(f,f.return,dt)}}break;case 3:if((u&1024)!==0){if(u=d.stateNode.containerInfo,f=u.nodeType,f===9)ET(u);else if(f===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":ET(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(r(163))}if(u=d.sibling,u!==null){u.return=d.return,ha=u;break}ha=d.return}}function X$(u,d,f){var y=f.flags;switch(f.tag){case 0:case 11:case 15:Il(u,f),y&4&&$y(5,f);break;case 1:if(Il(u,f),y&4)if(u=f.stateNode,d===null)try{u.componentDidMount()}catch(L){xn(f,f.return,L)}else{var S=_h(f.type,d.memoizedProps);d=d.memoizedState;try{u.componentDidUpdate(S,d,u.__reactInternalSnapshotBeforeUpdate)}catch(L){xn(f,f.return,L)}}y&64&&W$(f),y&512&&Oy(f,f.return);break;case 3:if(Il(u,f),y&64&&(u=f.updateQueue,u!==null)){if(d=null,f.child!==null)switch(f.child.tag){case 27:case 5:d=f.child.stateNode;break;case 1:d=f.child.stateNode}try{MM(u,d)}catch(L){xn(f,f.return,L)}}break;case 27:d===null&&y&4&&q$(f);case 26:case 5:Il(u,f),d===null&&y&4&&H$(f),y&512&&Oy(f,f.return);break;case 12:Il(u,f);break;case 31:Il(u,f),y&4&&Z$(u,f);break;case 13:Il(u,f),y&4&&J$(u,f),y&64&&(u=f.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(f=r7.bind(null,f),S7(u,f))));break;case 22:if(y=f.memoizedState!==null||_l,!y){d=d!==null&&d.memoizedState!==null||Lr,S=_l;var T=Lr;_l=y,(Lr=d)&&!T?Tl(u,f,(f.subtreeFlags&8772)!==0):Il(u,f),_l=S,Lr=T}break;case 30:break;default:Il(u,f)}}function Y$(u){var d=u.alternate;d!==null&&(u.alternate=null,Y$(d)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(d=u.stateNode,d!==null&&ou(d)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Yn=null,ys=!1;function Sl(u,d,f){for(f=f.child;f!==null;)Q$(u,d,f),f=f.sibling}function Q$(u,d,f){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(dr,f)}catch{}switch(f.tag){case 26:Lr||_o(f,d),Sl(u,d,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Lr||_o(f,d);var y=Yn,S=ys;Au(f.type)&&(Yn=f.stateNode,ys=!1),Sl(u,d,f),jy(f.stateNode),Yn=y,ys=S;break;case 5:Lr||_o(f,d);case 6:if(y=Yn,S=ys,Yn=null,Sl(u,d,f),Yn=y,ys=S,Yn!==null)if(ys)try{(Yn.nodeType===9?Yn.body:Yn.nodeName==="HTML"?Yn.ownerDocument.body:Yn).removeChild(f.stateNode)}catch(T){xn(f,d,T)}else try{Yn.removeChild(f.stateNode)}catch(T){xn(f,d,T)}break;case 18:Yn!==null&&(ys?(u=Yn,WO(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,f.stateNode),Pf(u)):WO(Yn,f.stateNode));break;case 4:y=Yn,S=ys,Yn=f.stateNode.containerInfo,ys=!0,Sl(u,d,f),Yn=y,ys=S;break;case 0:case 11:case 14:case 15:Su(2,f,d),Lr||Su(4,f,d),Sl(u,d,f);break;case 1:Lr||(_o(f,d),y=f.stateNode,typeof y.componentWillUnmount=="function"&&j$(f,d,y)),Sl(u,d,f);break;case 21:Sl(u,d,f);break;case 22:Lr=(y=Lr)||f.memoizedState!==null,Sl(u,d,f),Lr=y;break;default:Sl(u,d,f)}}function Z$(u,d){if(d.memoizedState===null&&(u=d.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{Pf(u)}catch(f){xn(d,d.return,f)}}}function J$(u,d){if(d.memoizedState===null&&(u=d.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{Pf(u)}catch(f){xn(d,d.return,f)}}function X9(u){switch(u.tag){case 31:case 13:case 19:var d=u.stateNode;return d===null&&(d=u.stateNode=new K$),d;case 22:return u=u.stateNode,d=u._retryCache,d===null&&(d=u._retryCache=new K$),d;default:throw Error(r(435,u.tag))}}function xw(u,d){var f=X9(u);d.forEach(function(y){if(!f.has(y)){f.add(y);var S=a7.bind(null,u,y);y.then(S,S)}})}function bs(u,d){var f=d.deletions;if(f!==null)for(var y=0;y<f.length;y++){var S=f[y],T=u,L=d,j=L;e:for(;j!==null;){switch(j.tag){case 27:if(Au(j.type)){Yn=j.stateNode,ys=!1;break e}break;case 5:Yn=j.stateNode,ys=!1;break e;case 3:case 4:Yn=j.stateNode.containerInfo,ys=!0;break e}j=j.return}if(Yn===null)throw Error(r(160));Q$(T,L,S),Yn=null,ys=!1,T=S.alternate,T!==null&&(T.return=null),S.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)eO(d,u),d=d.sibling}var zi=null;function eO(u,d){var f=u.alternate,y=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:bs(d,u),vs(u),y&4&&(Su(3,u,u.return),$y(3,u),Su(5,u,u.return));break;case 1:bs(d,u),vs(u),y&512&&(Lr||f===null||_o(f,f.return)),y&64&&_l&&(u=u.updateQueue,u!==null&&(y=u.callbacks,y!==null&&(f=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=f===null?y:f.concat(y))));break;case 26:var S=zi;if(bs(d,u),vs(u),y&512&&(Lr||f===null||_o(f,f.return)),y&4){var T=f!==null?f.memoizedState:null;if(y=u.memoizedState,f===null)if(y===null)if(u.stateNode===null){e:{y=u.type,f=u.memoizedProps,S=S.ownerDocument||S;t:switch(y){case"title":T=S.getElementsByTagName("title")[0],(!T||T[ii]||T[zn]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=S.createElement(y),S.head.insertBefore(T,S.querySelector("head > title"))),wa(T,y,f),T[zn]=u,pr(T),y=T;break e;case"link":var L=eF("link","href",S).get(y+(f.href||""));if(L){for(var j=0;j<L.length;j++)if(T=L[j],T.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&T.getAttribute("rel")===(f.rel==null?null:f.rel)&&T.getAttribute("title")===(f.title==null?null:f.title)&&T.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){L.splice(j,1);break t}}T=S.createElement(y),wa(T,y,f),S.head.appendChild(T);break;case"meta":if(L=eF("meta","content",S).get(y+(f.content||""))){for(j=0;j<L.length;j++)if(T=L[j],T.getAttribute("content")===(f.content==null?null:""+f.content)&&T.getAttribute("name")===(f.name==null?null:f.name)&&T.getAttribute("property")===(f.property==null?null:f.property)&&T.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&T.getAttribute("charset")===(f.charSet==null?null:f.charSet)){L.splice(j,1);break t}}T=S.createElement(y),wa(T,y,f),S.head.appendChild(T);break;default:throw Error(r(468,y))}T[zn]=u,pr(T),y=T}u.stateNode=y}else tF(S,u.type,u.stateNode);else u.stateNode=JO(S,y,u.memoizedProps);else T!==y?(T===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):T.count--,y===null?tF(S,u.type,u.stateNode):JO(S,y,u.memoizedProps)):y===null&&u.stateNode!==null&&JI(u,u.memoizedProps,f.memoizedProps)}break;case 27:bs(d,u),vs(u),y&512&&(Lr||f===null||_o(f,f.return)),f!==null&&y&4&&JI(u,u.memoizedProps,f.memoizedProps);break;case 5:if(bs(d,u),vs(u),y&512&&(Lr||f===null||_o(f,f.return)),u.flags&32){S=u.stateNode;try{ua(S,"")}catch(Je){xn(u,u.return,Je)}}y&4&&u.stateNode!=null&&(S=u.memoizedProps,JI(u,S,f!==null?f.memoizedProps:S)),y&1024&&(nT=!0);break;case 6:if(bs(d,u),vs(u),y&4){if(u.stateNode===null)throw Error(r(162));y=u.memoizedProps,f=u.stateNode;try{f.nodeValue=y}catch(Je){xn(u,u.return,Je)}}break;case 3:if(Fw=null,S=zi,zi=$w(d.containerInfo),bs(d,u),zi=S,vs(u),y&4&&f!==null&&f.memoizedState.isDehydrated)try{Pf(d.containerInfo)}catch(Je){xn(u,u.return,Je)}nT&&(nT=!1,tO(u));break;case 4:y=zi,zi=$w(u.stateNode.containerInfo),bs(d,u),vs(u),zi=y;break;case 12:bs(d,u),vs(u);break;case 31:bs(d,u),vs(u),y&4&&(y=u.updateQueue,y!==null&&(u.updateQueue=null,xw(u,y)));break;case 13:bs(d,u),vs(u),u.child.flags&8192&&u.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(_w=kn()),y&4&&(y=u.updateQueue,y!==null&&(u.updateQueue=null,xw(u,y)));break;case 22:S=u.memoizedState!==null;var ae=f!==null&&f.memoizedState!==null,ve=_l,Ne=Lr;if(_l=ve||S,Lr=Ne||ae,bs(d,u),Lr=Ne,_l=ve,vs(u),y&8192)e:for(d=u.stateNode,d._visibility=S?d._visibility&-2:d._visibility|1,S&&(f===null||ae||_l||Lr||Sh(u)),f=null,d=u;;){if(d.tag===5||d.tag===26){if(f===null){ae=f=d;try{if(T=ae.stateNode,S)L=T.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{j=ae.stateNode;var De=ae.memoizedProps.style,we=De!=null&&De.hasOwnProperty("display")?De.display:null;j.style.display=we==null||typeof we=="boolean"?"":(""+we).trim()}}catch(Je){xn(ae,ae.return,Je)}}}else if(d.tag===6){if(f===null){ae=d;try{ae.stateNode.nodeValue=S?"":ae.memoizedProps}catch(Je){xn(ae,ae.return,Je)}}}else if(d.tag===18){if(f===null){ae=d;try{var Ie=ae.stateNode;S?jO(Ie,!0):jO(ae.stateNode,!1)}catch(Je){xn(ae,ae.return,Je)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===u)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break e;for(;d.sibling===null;){if(d.return===null||d.return===u)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}y&4&&(y=u.updateQueue,y!==null&&(f=y.retryQueue,f!==null&&(y.retryQueue=null,xw(u,f))));break;case 19:bs(d,u),vs(u),y&4&&(y=u.updateQueue,y!==null&&(u.updateQueue=null,xw(u,y)));break;case 30:break;case 21:break;default:bs(d,u),vs(u)}}function vs(u){var d=u.flags;if(d&2){try{for(var f,y=u.return;y!==null;){if(G$(y)){f=y;break}y=y.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var S=f.stateNode,T=eT(u);vw(u,T,S);break;case 5:var L=f.stateNode;f.flags&32&&(ua(L,""),f.flags&=-33);var j=eT(u);vw(u,j,L);break;case 3:case 4:var ae=f.stateNode.containerInfo,ve=eT(u);tT(u,ve,ae);break;default:throw Error(r(161))}}catch(Ne){xn(u,u.return,Ne)}u.flags&=-3}d&4096&&(u.flags&=-4097)}function tO(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var d=u;tO(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),u=u.sibling}}function Il(u,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)X$(u,d.alternate,d),d=d.sibling}function Sh(u){for(u=u.child;u!==null;){var d=u;switch(d.tag){case 0:case 11:case 14:case 15:Su(4,d,d.return),Sh(d);break;case 1:_o(d,d.return);var f=d.stateNode;typeof f.componentWillUnmount=="function"&&j$(d,d.return,f),Sh(d);break;case 27:jy(d.stateNode);case 26:case 5:_o(d,d.return),Sh(d);break;case 22:d.memoizedState===null&&Sh(d);break;case 30:Sh(d);break;default:Sh(d)}u=u.sibling}}function Tl(u,d,f){for(f=f&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var y=d.alternate,S=u,T=d,L=T.flags;switch(T.tag){case 0:case 11:case 15:Tl(S,T,f),$y(4,T);break;case 1:if(Tl(S,T,f),y=T,S=y.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(ve){xn(y,y.return,ve)}if(y=T,S=y.updateQueue,S!==null){var j=y.stateNode;try{var ae=S.shared.hiddenCallbacks;if(ae!==null)for(S.shared.hiddenCallbacks=null,S=0;S<ae.length;S++)DM(ae[S],j)}catch(ve){xn(y,y.return,ve)}}f&&L&64&&W$(T),Oy(T,T.return);break;case 27:q$(T);case 26:case 5:Tl(S,T,f),f&&y===null&&L&4&&H$(T),Oy(T,T.return);break;case 12:Tl(S,T,f);break;case 31:Tl(S,T,f),f&&L&4&&Z$(S,T);break;case 13:Tl(S,T,f),f&&L&4&&J$(S,T);break;case 22:T.memoizedState===null&&Tl(S,T,f),Oy(T,T.return);break;case 30:break;default:Tl(S,T,f)}d=d.sibling}}function rT(u,d){var f=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(f=u.memoizedState.cachePool.pool),u=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(u=d.memoizedState.cachePool.pool),u!==f&&(u!=null&&u.refCount++,f!=null&&wy(f))}function aT(u,d){u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&wy(u))}function Vi(u,d,f,y){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)nO(u,d,f,y),d=d.sibling}function nO(u,d,f,y){var S=d.flags;switch(d.tag){case 0:case 11:case 15:Vi(u,d,f,y),S&2048&&$y(9,d);break;case 1:Vi(u,d,f,y);break;case 3:Vi(u,d,f,y),S&2048&&(u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&wy(u)));break;case 12:if(S&2048){Vi(u,d,f,y),u=d.stateNode;try{var T=d.memoizedProps,L=T.id,j=T.onPostCommit;typeof j=="function"&&j(L,d.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(ae){xn(d,d.return,ae)}}else Vi(u,d,f,y);break;case 31:Vi(u,d,f,y);break;case 13:Vi(u,d,f,y);break;case 23:break;case 22:T=d.stateNode,L=d.alternate,d.memoizedState!==null?T._visibility&2?Vi(u,d,f,y):Fy(u,d):T._visibility&2?Vi(u,d,f,y):(T._visibility|=2,kf(u,d,f,y,(d.subtreeFlags&10256)!==0||!1)),S&2048&&rT(L,d);break;case 24:Vi(u,d,f,y),S&2048&&aT(d.alternate,d);break;default:Vi(u,d,f,y)}}function kf(u,d,f,y,S){for(S=S&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var T=u,L=d,j=f,ae=y,ve=L.flags;switch(L.tag){case 0:case 11:case 15:kf(T,L,j,ae,S),$y(8,L);break;case 23:break;case 22:var Ne=L.stateNode;L.memoizedState!==null?Ne._visibility&2?kf(T,L,j,ae,S):Fy(T,L):(Ne._visibility|=2,kf(T,L,j,ae,S)),S&&ve&2048&&rT(L.alternate,L);break;case 24:kf(T,L,j,ae,S),S&&ve&2048&&aT(L.alternate,L);break;default:kf(T,L,j,ae,S)}d=d.sibling}}function Fy(u,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var f=u,y=d,S=y.flags;switch(y.tag){case 22:Fy(f,y),S&2048&&rT(y.alternate,y);break;case 24:Fy(f,y),S&2048&&aT(y.alternate,y);break;default:Fy(f,y)}d=d.sibling}}var Py=8192;function Ef(u,d,f){if(u.subtreeFlags&Py)for(u=u.child;u!==null;)rO(u,d,f),u=u.sibling}function rO(u,d,f){switch(u.tag){case 26:Ef(u,d,f),u.flags&Py&&u.memoizedState!==null&&O7(f,zi,u.memoizedState,u.memoizedProps);break;case 5:Ef(u,d,f);break;case 3:case 4:var y=zi;zi=$w(u.stateNode.containerInfo),Ef(u,d,f),zi=y;break;case 22:u.memoizedState===null&&(y=u.alternate,y!==null&&y.memoizedState!==null?(y=Py,Py=16777216,Ef(u,d,f),Py=y):Ef(u,d,f));break;default:Ef(u,d,f)}}function aO(u){var d=u.alternate;if(d!==null&&(u=d.child,u!==null)){d.child=null;do d=u.sibling,u.sibling=null,u=d;while(u!==null)}}function Ly(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var f=0;f<d.length;f++){var y=d[f];ha=y,iO(y,u)}aO(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)sO(u),u=u.sibling}function sO(u){switch(u.tag){case 0:case 11:case 15:Ly(u),u.flags&2048&&Su(9,u,u.return);break;case 3:Ly(u);break;case 12:Ly(u);break;case 22:var d=u.stateNode;u.memoizedState!==null&&d._visibility&2&&(u.return===null||u.return.tag!==13)?(d._visibility&=-3,ww(u)):Ly(u);break;default:Ly(u)}}function ww(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var f=0;f<d.length;f++){var y=d[f];ha=y,iO(y,u)}aO(u)}for(u=u.child;u!==null;){switch(d=u,d.tag){case 0:case 11:case 15:Su(8,d,d.return),ww(d);break;case 22:f=d.stateNode,f._visibility&2&&(f._visibility&=-3,ww(d));break;default:ww(d)}u=u.sibling}}function iO(u,d){for(;ha!==null;){var f=ha;switch(f.tag){case 0:case 11:case 15:Su(8,f,d);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var y=f.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:wy(f.memoizedState.cache)}if(y=f.child,y!==null)y.return=f,ha=y;else e:for(f=u;ha!==null;){y=ha;var S=y.sibling,T=y.return;if(Y$(y),y===f){ha=null;break e}if(S!==null){S.return=T,ha=S;break e}ha=T}}}var Y9={getCacheForType:function(u){var d=va(Or),f=d.data.get(u);return f===void 0&&(f=u(),d.data.set(u,f)),f},cacheSignal:function(){return va(Or).controller.signal}},Q9=typeof WeakMap=="function"?WeakMap:Map,hn=0,Rn=null,zt=null,Wt=0,vn=0,js=null,Iu=!1,Nf=!1,sT=!1,kl=0,mr=0,Tu=0,Ih=0,iT=0,Hs=0,Cf=0,zy=null,xs=null,oT=!1,_w=0,oO=0,Sw=1/0,Iw=null,ku=null,Xr=0,Eu=null,Af=null,El=0,lT=0,uT=null,lO=null,Vy=0,cT=null;function Gs(){return(hn&2)!==0&&Wt!==0?Wt&-Wt:q.T!==null?gT():fs()}function uO(){if(Hs===0)if((Wt&536870912)===0||Qt){var u=ps;ps<<=1,(ps&3932160)===0&&(ps=262144),Hs=u}else Hs=536870912;return u=Bs.current,u!==null&&(u.flags|=32),Hs}function ws(u,d,f){(u===Rn&&(vn===2||vn===9)||u.cancelPendingCommit!==null)&&(Rf(u,0),Nu(u,Wt,Hs,!1)),Ve(u,f),((hn&2)===0||u!==Rn)&&(u===Rn&&((hn&2)===0&&(Ih|=f),mr===4&&Nu(u,Wt,Hs,!1)),So(u))}function cO(u,d,f){if((hn&6)!==0)throw Error(r(327));var y=!f&&(d&127)===0&&(d&u.expiredLanes)===0||Aa(u,d),S=y?e7(u,d):dT(u,d,!0),T=y;do{if(S===0){Nf&&!y&&Nu(u,d,0,!1);break}else{if(f=u.current.alternate,T&&!Z9(f)){S=dT(u,d,!1),T=!1;continue}if(S===2){if(T=d,u.errorRecoveryDisabledLanes&T)var L=0;else L=u.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){d=L;e:{var j=u;S=zy;var ae=j.current.memoizedState.isDehydrated;if(ae&&(Rf(j,L).flags|=256),L=dT(j,L,!1),L!==2){if(sT&&!ae){j.errorRecoveryDisabledLanes|=T,Ih|=T,S=4;break e}T=xs,xs=S,T!==null&&(xs===null?xs=T:xs.push.apply(xs,T))}S=L}if(T=!1,S!==2)continue}}if(S===1){Rf(u,0),Nu(u,d,0,!0);break}e:{switch(y=u,T=S,T){case 0:case 1:throw Error(r(345));case 4:if((d&4194048)!==d)break;case 6:Nu(y,d,Hs,!Iu);break e;case 2:xs=null;break;case 3:case 5:break;default:throw Error(r(329))}if((d&62914560)===d&&(S=_w+300-kn(),10<S)){if(Nu(y,d,Hs,!Iu),la(y,0,!0)!==0)break e;El=d,y.timeoutHandle=UO(hO.bind(null,y,f,xs,Iw,oT,d,Hs,Ih,Cf,Iu,T,"Throttled",-0,0),S);break e}hO(y,f,xs,Iw,oT,d,Hs,Ih,Cf,Iu,T,null,-0,0)}}break}while(!0);So(u)}function hO(u,d,f,y,S,T,L,j,ae,ve,Ne,De,we,Ie){if(u.timeoutHandle=-1,De=d.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:$a},rO(d,T,De);var Je=(T&62914560)===T?_w-kn():(T&4194048)===T?oO-kn():0;if(Je=F7(De,Je),Je!==null){El=T,u.cancelPendingCommit=Je(vO.bind(null,u,d,T,f,y,S,L,j,ae,Ne,De,null,we,Ie)),Nu(u,T,L,!ve);return}}vO(u,d,T,f,y,S,L,j,ae)}function Z9(u){for(var d=u;;){var f=d.tag;if((f===0||f===11||f===15)&&d.flags&16384&&(f=d.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var y=0;y<f.length;y++){var S=f[y],T=S.getSnapshot;S=S.value;try{if(!Vs(T(),S))return!1}catch{return!1}}if(f=d.child,d.subtreeFlags&16384&&f!==null)f.return=d,d=f;else{if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Nu(u,d,f,y){d&=~iT,d&=~Ih,u.suspendedLanes|=d,u.pingedLanes&=~d,y&&(u.warmLanes|=d),y=u.expirationTimes;for(var S=d;0<S;){var T=31-Fn(S),L=1<<T;y[T]=-1,S&=~L}f!==0&&rn(u,f,d)}function Tw(){return(hn&6)===0?(Uy(0),!1):!0}function hT(){if(zt!==null){if(vn===0)var u=zt.return;else u=zt,gl=mh=null,EI(u),wf=null,Sy=0,u=zt;for(;u!==null;)B$(u.alternate,u),u=u.return;zt=null}}function Rf(u,d){var f=u.timeoutHandle;f!==-1&&(u.timeoutHandle=-1,b7(f)),f=u.cancelPendingCommit,f!==null&&(u.cancelPendingCommit=null,f()),El=0,hT(),Rn=u,zt=f=fl(u.current,null),Wt=d,vn=0,js=null,Iu=!1,Nf=Aa(u,d),sT=!1,Cf=Hs=iT=Ih=Tu=mr=0,xs=zy=null,oT=!1,(d&8)!==0&&(d|=d&32);var y=u.entangledLanes;if(y!==0)for(u=u.entanglements,y&=d;0<y;){var S=31-Fn(y),T=1<<S;d|=u[S],y&=~T}return kl=d,Gx(),f}function dO(u,d){Dt=null,q.H=Ry,d===xf||d===ew?(d=NM(),vn=3):d===mI?(d=NM(),vn=4):vn=d===WI?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,js=d,zt===null&&(mr=1,fw(u,pi(d,u.current)))}function pO(){var u=Bs.current;return u===null?!0:(Wt&4194048)===Wt?yi===null:(Wt&62914560)===Wt||(Wt&536870912)!==0?u===yi:!1}function fO(){var u=q.H;return q.H=Ry,u===null?Ry:u}function mO(){var u=q.A;return q.A=Y9,u}function kw(){mr=4,Iu||(Wt&4194048)!==Wt&&Bs.current!==null||(Nf=!0),(Tu&134217727)===0&&(Ih&134217727)===0||Rn===null||Nu(Rn,Wt,Hs,!1)}function dT(u,d,f){var y=hn;hn|=2;var S=fO(),T=mO();(Rn!==u||Wt!==d)&&(Iw=null,Rf(u,d)),d=!1;var L=mr;e:do try{if(vn!==0&&zt!==null){var j=zt,ae=js;switch(vn){case 8:hT(),L=6;break e;case 3:case 2:case 9:case 6:Bs.current===null&&(d=!0);var ve=vn;if(vn=0,js=null,Df(u,j,ae,ve),f&&Nf){L=0;break e}break;default:ve=vn,vn=0,js=null,Df(u,j,ae,ve)}}J9(),L=mr;break}catch(Ne){dO(u,Ne)}while(!0);return d&&u.shellSuspendCounter++,gl=mh=null,hn=y,q.H=S,q.A=T,zt===null&&(Rn=null,Wt=0,Gx()),L}function J9(){for(;zt!==null;)gO(zt)}function e7(u,d){var f=hn;hn|=2;var y=fO(),S=mO();Rn!==u||Wt!==d?(Iw=null,Sw=kn()+500,Rf(u,d)):Nf=Aa(u,d);e:do try{if(vn!==0&&zt!==null){d=zt;var T=js;t:switch(vn){case 1:vn=0,js=null,Df(u,d,T,1);break;case 2:case 9:if(kM(T)){vn=0,js=null,yO(d);break}d=function(){vn!==2&&vn!==9||Rn!==u||(vn=7),So(u)},T.then(d,d);break e;case 3:vn=7;break e;case 4:vn=5;break e;case 7:kM(T)?(vn=0,js=null,yO(d)):(vn=0,js=null,Df(u,d,T,7));break;case 5:var L=null;switch(zt.tag){case 26:L=zt.memoizedState;case 5:case 27:var j=zt;if(L?nF(L):j.stateNode.complete){vn=0,js=null;var ae=j.sibling;if(ae!==null)zt=ae;else{var ve=j.return;ve!==null?(zt=ve,Ew(ve)):zt=null}break t}}vn=0,js=null,Df(u,d,T,5);break;case 6:vn=0,js=null,Df(u,d,T,6);break;case 8:hT(),mr=6;break e;default:throw Error(r(462))}}t7();break}catch(Ne){dO(u,Ne)}while(!0);return gl=mh=null,q.H=y,q.A=S,hn=f,zt!==null?0:(Rn=null,Wt=0,Gx(),mr)}function t7(){for(;zt!==null&&!ur();)gO(zt)}function gO(u){var d=V$(u.alternate,u,kl);u.memoizedProps=u.pendingProps,d===null?Ew(u):zt=d}function yO(u){var d=u,f=d.alternate;switch(d.tag){case 15:case 0:d=$$(f,d,d.pendingProps,d.type,void 0,Wt);break;case 11:d=$$(f,d,d.pendingProps,d.type.render,d.ref,Wt);break;case 5:EI(d);default:B$(f,d),d=zt=mM(d,kl),d=V$(f,d,kl)}u.memoizedProps=u.pendingProps,d===null?Ew(u):zt=d}function Df(u,d,f,y){gl=mh=null,EI(d),wf=null,Sy=0;var S=d.return;try{if(W9(u,S,d,f,Wt)){mr=1,fw(u,pi(f,u.current)),zt=null;return}}catch(T){if(S!==null)throw zt=S,T;mr=1,fw(u,pi(f,u.current)),zt=null;return}d.flags&32768?(Qt||y===1?u=!0:Nf||(Wt&536870912)!==0?u=!1:(Iu=u=!0,(y===2||y===9||y===3||y===6)&&(y=Bs.current,y!==null&&y.tag===13&&(y.flags|=16384))),bO(d,u)):Ew(d)}function Ew(u){var d=u;do{if((d.flags&32768)!==0){bO(d,Iu);return}u=d.return;var f=G9(d.alternate,d,kl);if(f!==null){zt=f;return}if(d=d.sibling,d!==null){zt=d;return}zt=d=u}while(d!==null);mr===0&&(mr=5)}function bO(u,d){do{var f=q9(u.alternate,u);if(f!==null){f.flags&=32767,zt=f;return}if(f=u.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!d&&(u=u.sibling,u!==null)){zt=u;return}zt=u=f}while(u!==null);mr=6,zt=null}function vO(u,d,f,y,S,T,L,j,ae){u.cancelPendingCommit=null;do Nw();while(Xr!==0);if((hn&6)!==0)throw Error(r(327));if(d!==null){if(d===u.current)throw Error(r(177));if(T=d.lanes|d.childLanes,T|=eI,un(u,f,T,L,j,ae),u===Rn&&(zt=Rn=null,Wt=0),Af=d,Eu=u,El=f,lT=T,uT=S,lO=y,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,s7(hr,function(){return IO(),null})):(u.callbackNode=null,u.callbackPriority=0),y=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||y){y=q.T,q.T=null,S=Z.p,Z.p=2,L=hn,hn|=4;try{K9(u,d,f)}finally{hn=L,Z.p=S,q.T=y}}Xr=1,xO(),wO(),_O()}}function xO(){if(Xr===1){Xr=0;var u=Eu,d=Af,f=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||f){f=q.T,q.T=null;var y=Z.p;Z.p=2;var S=hn;hn|=4;try{eO(d,u);var T=IT,L=iM(u.containerInfo),j=T.focusedElem,ae=T.selectionRange;if(L!==j&&j&&j.ownerDocument&&sM(j.ownerDocument.documentElement,j)){if(ae!==null&&XS(j)){var ve=ae.start,Ne=ae.end;if(Ne===void 0&&(Ne=ve),"selectionStart"in j)j.selectionStart=ve,j.selectionEnd=Math.min(Ne,j.value.length);else{var De=j.ownerDocument||document,we=De&&De.defaultView||window;if(we.getSelection){var Ie=we.getSelection(),Je=j.textContent.length,dt=Math.min(ae.start,Je),Cn=ae.end===void 0?dt:Math.min(ae.end,Je);!Ie.extend&&dt>Cn&&(L=Cn,Cn=dt,dt=L);var pe=aM(j,dt),ce=aM(j,Cn);if(pe&&ce&&(Ie.rangeCount!==1||Ie.anchorNode!==pe.node||Ie.anchorOffset!==pe.offset||Ie.focusNode!==ce.node||Ie.focusOffset!==ce.offset)){var be=De.createRange();be.setStart(pe.node,pe.offset),Ie.removeAllRanges(),dt>Cn?(Ie.addRange(be),Ie.extend(ce.node,ce.offset)):(be.setEnd(ce.node,ce.offset),Ie.addRange(be))}}}}for(De=[],Ie=j;Ie=Ie.parentNode;)Ie.nodeType===1&&De.push({element:Ie,left:Ie.scrollLeft,top:Ie.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<De.length;j++){var Ce=De[j];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}Vw=!!ST,IT=ST=null}finally{hn=S,Z.p=y,q.T=f}}u.current=d,Xr=2}}function wO(){if(Xr===2){Xr=0;var u=Eu,d=Af,f=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||f){f=q.T,q.T=null;var y=Z.p;Z.p=2;var S=hn;hn|=4;try{X$(u,d.alternate,d)}finally{hn=S,Z.p=y,q.T=f}}Xr=3}}function _O(){if(Xr===4||Xr===3){Xr=0,Dr();var u=Eu,d=Af,f=El,y=lO;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Xr=5:(Xr=0,Af=Eu=null,SO(u,u.pendingLanes));var S=u.pendingLanes;if(S===0&&(ku=null),nr(f),d=d.stateNode,On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(dr,d,void 0,(d.current.flags&128)===128)}catch{}if(y!==null){d=q.T,S=Z.p,Z.p=2,q.T=null;try{for(var T=u.onRecoverableError,L=0;L<y.length;L++){var j=y[L];T(j.value,{componentStack:j.stack})}}finally{q.T=d,Z.p=S}}(El&3)!==0&&Nw(),So(u),S=u.pendingLanes,(f&261930)!==0&&(S&42)!==0?u===cT?Vy++:(Vy=0,cT=u):Vy=0,Uy(0)}}function SO(u,d){(u.pooledCacheLanes&=d)===0&&(d=u.pooledCache,d!=null&&(u.pooledCache=null,wy(d)))}function Nw(){return xO(),wO(),_O(),IO()}function IO(){if(Xr!==5)return!1;var u=Eu,d=lT;lT=0;var f=nr(El),y=q.T,S=Z.p;try{Z.p=32>f?32:f,q.T=null,f=uT,uT=null;var T=Eu,L=El;if(Xr=0,Af=Eu=null,El=0,(hn&6)!==0)throw Error(r(331));var j=hn;if(hn|=4,sO(T.current),nO(T,T.current,L,f),hn=j,Uy(0,!1),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(dr,T)}catch{}return!0}finally{Z.p=S,q.T=y,SO(u,d)}}function TO(u,d,f){d=pi(f,d),d=BI(u.stateNode,d,2),u=xu(u,d,2),u!==null&&(Ve(u,2),So(u))}function xn(u,d,f){if(u.tag===3)TO(u,u,f);else for(;d!==null;){if(d.tag===3){TO(d,u,f);break}else if(d.tag===1){var y=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(ku===null||!ku.has(y))){u=pi(f,u),f=k$(2),y=xu(d,f,2),y!==null&&(E$(f,y,d,u),Ve(y,2),So(y));break}}d=d.return}}function pT(u,d,f){var y=u.pingCache;if(y===null){y=u.pingCache=new Q9;var S=new Set;y.set(d,S)}else S=y.get(d),S===void 0&&(S=new Set,y.set(d,S));S.has(f)||(sT=!0,S.add(f),u=n7.bind(null,u,d,f),d.then(u,u))}function n7(u,d,f){var y=u.pingCache;y!==null&&y.delete(d),u.pingedLanes|=u.suspendedLanes&f,u.warmLanes&=~f,Rn===u&&(Wt&f)===f&&(mr===4||mr===3&&(Wt&62914560)===Wt&&300>kn()-_w?(hn&2)===0&&Rf(u,0):iT|=f,Cf===Wt&&(Cf=0)),So(u)}function kO(u,d){d===0&&(d=Le()),u=dh(u,d),u!==null&&(Ve(u,d),So(u))}function r7(u){var d=u.memoizedState,f=0;d!==null&&(f=d.retryLane),kO(u,f)}function a7(u,d){var f=0;switch(u.tag){case 31:case 13:var y=u.stateNode,S=u.memoizedState;S!==null&&(f=S.retryLane);break;case 19:y=u.stateNode;break;case 22:y=u.stateNode._retryCache;break;default:throw Error(r(314))}y!==null&&y.delete(d),kO(u,f)}function s7(u,d){return Et(u,d)}var Cw=null,Mf=null,fT=!1,Aw=!1,mT=!1,Cu=0;function So(u){u!==Mf&&u.next===null&&(Mf===null?Cw=Mf=u:Mf=Mf.next=u),Aw=!0,fT||(fT=!0,o7())}function Uy(u,d){if(!mT&&Aw){mT=!0;do for(var f=!1,y=Cw;y!==null;){if(u!==0){var S=y.pendingLanes;if(S===0)var T=0;else{var L=y.suspendedLanes,j=y.pingedLanes;T=(1<<31-Fn(42|u)+1)-1,T&=S&~(L&~j),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(f=!0,AO(y,T))}else T=Wt,T=la(y,y===Rn?T:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),(T&3)===0||Aa(y,T)||(f=!0,AO(y,T));y=y.next}while(f);mT=!1}}function i7(){EO()}function EO(){Aw=fT=!1;var u=0;Cu!==0&&y7()&&(u=Cu);for(var d=kn(),f=null,y=Cw;y!==null;){var S=y.next,T=NO(y,d);T===0?(y.next=null,f===null?Cw=S:f.next=S,S===null&&(Mf=f)):(f=y,(u!==0||(T&3)!==0)&&(Aw=!0)),y=S}Xr!==0&&Xr!==5||Uy(u),Cu!==0&&(Cu=0)}function NO(u,d){for(var f=u.suspendedLanes,y=u.pingedLanes,S=u.expirationTimes,T=u.pendingLanes&-62914561;0<T;){var L=31-Fn(T),j=1<<L,ae=S[L];ae===-1?((j&f)===0||(j&y)!==0)&&(S[L]=Te(j,d)):ae<=d&&(u.expiredLanes|=j),T&=~j}if(d=Rn,f=Wt,f=la(u,u===d?f:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),y=u.callbackNode,f===0||u===d&&(vn===2||vn===9)||u.cancelPendingCommit!==null)return y!==null&&y!==null&&Gn(y),u.callbackNode=null,u.callbackPriority=0;if((f&3)===0||Aa(u,f)){if(d=f&-f,d===u.callbackPriority)return d;switch(y!==null&&Gn(y),nr(f)){case 2:case 8:f=qn;break;case 32:f=hr;break;case 268435456:f=lo;break;default:f=hr}return y=CO.bind(null,u),f=Et(f,y),u.callbackPriority=d,u.callbackNode=f,d}return y!==null&&y!==null&&Gn(y),u.callbackPriority=2,u.callbackNode=null,2}function CO(u,d){if(Xr!==0&&Xr!==5)return u.callbackNode=null,u.callbackPriority=0,null;var f=u.callbackNode;if(Nw()&&u.callbackNode!==f)return null;var y=Wt;return y=la(u,u===Rn?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),y===0?null:(cO(u,y,d),NO(u,kn()),u.callbackNode!=null&&u.callbackNode===f?CO.bind(null,u):null)}function AO(u,d){if(Nw())return null;cO(u,d,!0)}function o7(){v7(function(){(hn&6)!==0?Et(vr,i7):EO()})}function gT(){if(Cu===0){var u=bf;u===0&&(u=Mr,Mr<<=1,(Mr&261888)===0&&(Mr=256)),Cu=u}return Cu}function RO(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:ul(""+u)}function DO(u,d){var f=d.ownerDocument.createElement("input");return f.name=d.name,f.value=d.value,u.id&&f.setAttribute("form",u.id),d.parentNode.insertBefore(f,d),u=new FormData(u),f.parentNode.removeChild(f),u}function l7(u,d,f,y,S){if(d==="submit"&&f&&f.stateNode===S){var T=RO((S[Yt]||null).action),L=y.submitter;L&&(d=(d=L[Yt]||null)?RO(d.formAction):L.getAttribute("formAction"),d!==null&&(T=d,L=null));var j=new go("action","action",null,y,S);u.push({event:j,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(Cu!==0){var ae=L?DO(S,L):new FormData(S);FI(f,{pending:!0,data:ae,method:S.method,action:T},null,ae)}}else typeof T=="function"&&(j.preventDefault(),ae=L?DO(S,L):new FormData(S),FI(f,{pending:!0,data:ae,method:S.method,action:T},T,ae))},currentTarget:S}]})}}for(var yT=0;yT<JS.length;yT++){var bT=JS[yT],u7=bT.toLowerCase(),c7=bT[0].toUpperCase()+bT.slice(1);Li(u7,"on"+c7)}Li(uM,"onAnimationEnd"),Li(cM,"onAnimationIteration"),Li(hM,"onAnimationStart"),Li("dblclick","onDoubleClick"),Li("focusin","onFocus"),Li("focusout","onBlur"),Li(k9,"onTransitionRun"),Li(E9,"onTransitionStart"),Li(N9,"onTransitionCancel"),Li(dM,"onTransitionEnd"),li("onMouseEnter",["mouseout","mouseover"]),li("onMouseLeave",["mouseout","mouseover"]),li("onPointerEnter",["pointerout","pointerover"]),li("onPointerLeave",["pointerout","pointerover"]),oi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),oi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),oi("onBeforeInput",["compositionend","keypress","textInput","paste"]),oi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),oi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),oi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var By="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h7=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(By));function MO(u,d){d=(d&4)!==0;for(var f=0;f<u.length;f++){var y=u[f],S=y.event;y=y.listeners;e:{var T=void 0;if(d)for(var L=y.length-1;0<=L;L--){var j=y[L],ae=j.instance,ve=j.currentTarget;if(j=j.listener,ae!==T&&S.isPropagationStopped())break e;T=j,S.currentTarget=ve;try{T(S)}catch(Ne){Hx(Ne)}S.currentTarget=null,T=ae}else for(L=0;L<y.length;L++){if(j=y[L],ae=j.instance,ve=j.currentTarget,j=j.listener,ae!==T&&S.isPropagationStopped())break e;T=j,S.currentTarget=ve;try{T(S)}catch(Ne){Hx(Ne)}S.currentTarget=null,T=ae}}}}function Vt(u,d){var f=d[Di];f===void 0&&(f=d[Di]=new Set);var y=u+"__bubble";f.has(y)||($O(d,u,2,!1),f.add(y))}function vT(u,d,f){var y=0;d&&(y|=4),$O(f,u,y,d)}var Rw="_reactListening"+Math.random().toString(36).slice(2);function xT(u){if(!u[Rw]){u[Rw]=!0,al.forEach(function(f){f!=="selectionchange"&&(h7.has(f)||vT(f,!1,u),vT(f,!0,u))});var d=u.nodeType===9?u:u.ownerDocument;d===null||d[Rw]||(d[Rw]=!0,vT("selectionchange",!1,d))}}function $O(u,d,f,y){switch(uF(d)){case 2:var S=z7;break;case 8:S=V7;break;default:S=OT}f=S.bind(null,d,f,u),S=void 0,!Ze||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(S=!0),y?S!==void 0?u.addEventListener(d,f,{capture:!0,passive:S}):u.addEventListener(d,f,!0):S!==void 0?u.addEventListener(d,f,{passive:S}):u.addEventListener(d,f,!1)}function wT(u,d,f,y,S){var T=y;if((d&1)===0&&(d&2)===0&&y!==null)e:for(;;){if(y===null)return;var L=y.tag;if(L===3||L===4){var j=y.stateNode.containerInfo;if(j===S)break;if(L===4)for(L=y.return;L!==null;){var ae=L.tag;if((ae===3||ae===4)&&L.stateNode.containerInfo===S)return;L=L.return}for(;j!==null;){if(L=Da(j),L===null)return;if(ae=L.tag,ae===5||ae===6||ae===26||ae===27){y=T=L;continue e}j=j.parentNode}}y=y.return}ct(function(){var ve=T,Ne=gs(f),De=[];e:{var we=pM.get(u);if(we!==void 0){var Ie=go,Je=u;switch(u){case"keypress":if(hl(f)===0)break e;case"keydown":case"keyup":Ie=Bx;break;case"focusin":Je="focus",Ie=lh;break;case"focusout":Je="blur",Ie=lh;break;case"beforeblur":case"afterblur":Ie=lh;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=py;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=Mx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=A;break;case uM:case cM:case hM:Ie=Ox;break;case dM:Ie=K;break;case"scroll":case"scrollend":Ie=dy;break;case"wheel":Ie=_e;break;case"copy":case"cut":case"paste":Ie=Fx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=pl;break;case"toggle":case"beforetoggle":Ie=Rt}var dt=(d&4)!==0,Cn=!dt&&(u==="scroll"||u==="scrollend"),pe=dt?we!==null?we+"Capture":null:we;dt=[];for(var ce=ve,be;ce!==null;){var Ce=ce;if(be=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||be===null||pe===null||(Ce=it(ce,pe),Ce!=null&&dt.push(Wy(ce,Ce,be))),Cn)break;ce=ce.return}0<dt.length&&(we=new Ie(we,Je,null,f,Ne),De.push({event:we,listeners:dt}))}}if((d&7)===0){e:{if(we=u==="mouseover"||u==="pointerover",Ie=u==="mouseout"||u==="pointerout",we&&f!==fo&&(Je=f.relatedTarget||f.fromElement)&&(Da(Je)||Je[Kr]))break e;if((Ie||we)&&(we=Ne.window===Ne?Ne:(we=Ne.ownerDocument)?we.defaultView||we.parentWindow:window,Ie?(Je=f.relatedTarget||f.toElement,Ie=ve,Je=Je?Da(Je):null,Je!==null&&(Cn=s(Je),dt=Je.tag,Je!==Cn||dt!==5&&dt!==27&&dt!==6)&&(Je=null)):(Ie=null,Je=ve),Ie!==Je)){if(dt=py,Ce="onMouseLeave",pe="onMouseEnter",ce="mouse",(u==="pointerout"||u==="pointerover")&&(dt=pl,Ce="onPointerLeave",pe="onPointerEnter",ce="pointer"),Cn=Ie==null?we:Qa(Ie),be=Je==null?we:Qa(Je),we=new dt(Ce,ce+"leave",Ie,f,Ne),we.target=Cn,we.relatedTarget=be,Ce=null,Da(Ne)===ve&&(dt=new dt(pe,ce+"enter",Je,f,Ne),dt.target=be,dt.relatedTarget=Cn,Ce=dt),Cn=Ce,Ie&&Je)t:{for(dt=d7,pe=Ie,ce=Je,be=0,Ce=pe;Ce;Ce=dt(Ce))be++;Ce=0;for(var ot=ce;ot;ot=dt(ot))Ce++;for(;0<be-Ce;)pe=dt(pe),be--;for(;0<Ce-be;)ce=dt(ce),Ce--;for(;be--;){if(pe===ce||ce!==null&&pe===ce.alternate){dt=pe;break t}pe=dt(pe),ce=dt(ce)}dt=null}else dt=null;Ie!==null&&OO(De,we,Ie,dt,!1),Je!==null&&Cn!==null&&OO(De,Cn,Je,dt,!0)}}e:{if(we=ve?Qa(ve):window,Ie=we.nodeName&&we.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&we.type==="file")var sn=ZD;else if(YD(we))if(JD)sn=S9;else{sn=w9;var nt=x9}else Ie=we.nodeName,!Ie||Ie.toLowerCase()!=="input"||we.type!=="checkbox"&&we.type!=="radio"?ve&&Oi(ve.elementType)&&(sn=ZD):sn=_9;if(sn&&(sn=sn(u,ve))){QD(De,sn,f,Ne);break e}nt&&nt(u,we,ve),u==="focusout"&&ve&&we.type==="number"&&ve.memoizedProps.value!=null&&po(we,"number",we.value)}switch(nt=ve?Qa(ve):window,u){case"focusin":(YD(nt)||nt.contentEditable==="true")&&(cf=nt,YS=ve,by=null);break;case"focusout":by=YS=cf=null;break;case"mousedown":QS=!0;break;case"contextmenu":case"mouseup":case"dragend":QS=!1,oM(De,f,Ne);break;case"selectionchange":if(T9)break;case"keydown":case"keyup":oM(De,f,Ne)}var $t;if(cn)e:{switch(u){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else uf?uh(u,f)&&(jt="onCompositionEnd"):u==="keydown"&&f.keyCode===229&&(jt="onCompositionStart");jt&&(vo&&f.locale!=="ko"&&(uf||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&uf&&($t=cl()):(Kn=Ne,Ja="value"in Kn?Kn.value:Kn.textContent,uf=!0)),nt=Dw(ve,jt),0<nt.length&&(jt=new bo(jt,u,null,f,Ne),De.push({event:jt,listeners:nt}),$t?jt.data=$t:($t=lf(f),$t!==null&&(jt.data=$t)))),($t=hi?g9(u,f):y9(u,f))&&(jt=Dw(ve,"onBeforeInput"),0<jt.length&&(nt=new bo("onBeforeInput","beforeinput",null,f,Ne),De.push({event:nt,listeners:jt}),nt.data=$t)),l7(De,u,ve,f,Ne)}MO(De,d)})}function Wy(u,d,f){return{instance:u,listener:d,currentTarget:f}}function Dw(u,d){for(var f=d+"Capture",y=[];u!==null;){var S=u,T=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||T===null||(S=it(u,f),S!=null&&y.unshift(Wy(u,S,T)),S=it(u,d),S!=null&&y.push(Wy(u,S,T))),u.tag===3)return y;u=u.return}return[]}function d7(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function OO(u,d,f,y,S){for(var T=d._reactName,L=[];f!==null&&f!==y;){var j=f,ae=j.alternate,ve=j.stateNode;if(j=j.tag,ae!==null&&ae===y)break;j!==5&&j!==26&&j!==27||ve===null||(ae=ve,S?(ve=it(f,T),ve!=null&&L.unshift(Wy(f,ve,ae))):S||(ve=it(f,T),ve!=null&&L.push(Wy(f,ve,ae)))),f=f.return}L.length!==0&&u.push({event:d,listeners:L})}var p7=/\r\n?/g,f7=/\u0000|\uFFFD/g;function FO(u){return(typeof u=="string"?u:""+u).replace(p7,`
`).replace(f7,"")}function PO(u,d){return d=FO(d),FO(u)===d}function Nn(u,d,f,y,S,T){switch(f){case"children":typeof y=="string"?d==="body"||d==="textarea"&&y===""||ua(u,y):(typeof y=="number"||typeof y=="bigint")&&d!=="body"&&ua(u,""+y);break;case"className":Za(u,"class",y);break;case"tabIndex":Za(u,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":Za(u,f,y);break;case"style":ol(u,y,T);break;case"data":if(d!=="object"){Za(u,"data",y);break}case"src":case"href":if(y===""&&(d!=="a"||f!=="href")){u.removeAttribute(f);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){u.removeAttribute(f);break}y=ul(""+y),u.setAttribute(f,y);break;case"action":case"formAction":if(typeof y=="function"){u.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(f==="formAction"?(d!=="input"&&Nn(u,d,"name",S.name,S,null),Nn(u,d,"formEncType",S.formEncType,S,null),Nn(u,d,"formMethod",S.formMethod,S,null),Nn(u,d,"formTarget",S.formTarget,S,null)):(Nn(u,d,"encType",S.encType,S,null),Nn(u,d,"method",S.method,S,null),Nn(u,d,"target",S.target,S,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){u.removeAttribute(f);break}y=ul(""+y),u.setAttribute(f,y);break;case"onClick":y!=null&&(u.onclick=$a);break;case"onScroll":y!=null&&Vt("scroll",u);break;case"onScrollEnd":y!=null&&Vt("scrollend",u);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(f=y.__html,f!=null){if(S.children!=null)throw Error(r(60));u.innerHTML=f}}break;case"multiple":u.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":u.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){u.removeAttribute("xlink:href");break}f=ul(""+y),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?u.setAttribute(f,""+y):u.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?u.setAttribute(f,""):u.removeAttribute(f);break;case"capture":case"download":y===!0?u.setAttribute(f,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?u.setAttribute(f,y):u.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?u.setAttribute(f,y):u.removeAttribute(f);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?u.removeAttribute(f):u.setAttribute(f,y);break;case"popover":Vt("beforetoggle",u),Vt("toggle",u),lu(u,"popover",y);break;case"xlinkActuate":rr(u,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":rr(u,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":rr(u,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":rr(u,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":rr(u,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":rr(u,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":rr(u,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":rr(u,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":rr(u,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":lu(u,"is",y);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=ll.get(f)||f,lu(u,f,y))}}function _T(u,d,f,y,S,T){switch(f){case"style":ol(u,y,T);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(f=y.__html,f!=null){if(S.children!=null)throw Error(r(60));u.innerHTML=f}}break;case"children":typeof y=="string"?ua(u,y):(typeof y=="number"||typeof y=="bigint")&&ua(u,""+y);break;case"onScroll":y!=null&&Vt("scroll",u);break;case"onScrollEnd":y!=null&&Vt("scrollend",u);break;case"onClick":y!=null&&(u.onclick=$a);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!th.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(S=f.endsWith("Capture"),d=f.slice(2,S?f.length-7:void 0),T=u[Yt]||null,T=T!=null?T[f]:null,typeof T=="function"&&u.removeEventListener(d,T,S),typeof y=="function")){typeof T!="function"&&T!==null&&(f in u?u[f]=null:u.hasAttribute(f)&&u.removeAttribute(f)),u.addEventListener(d,y,S);break e}f in u?u[f]=y:y===!0?u.setAttribute(f,""):lu(u,f,y)}}}function wa(u,d,f){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Vt("error",u),Vt("load",u);var y=!1,S=!1,T;for(T in f)if(f.hasOwnProperty(T)){var L=f[T];if(L!=null)switch(T){case"src":y=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,d));default:Nn(u,d,T,L,f,null)}}S&&Nn(u,d,"srcSet",f.srcSet,f,null),y&&Nn(u,d,"src",f.src,f,null);return;case"input":Vt("invalid",u);var j=T=L=S=null,ae=null,ve=null;for(y in f)if(f.hasOwnProperty(y)){var Ne=f[y];if(Ne!=null)switch(y){case"name":S=Ne;break;case"type":L=Ne;break;case"checked":ae=Ne;break;case"defaultChecked":ve=Ne;break;case"value":T=Ne;break;case"defaultValue":j=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(r(137,d));break;default:Nn(u,d,y,Ne,f,null)}}ah(u,T,j,ae,ve,L,S,!1);return;case"select":Vt("invalid",u),y=L=T=null;for(S in f)if(f.hasOwnProperty(S)&&(j=f[S],j!=null))switch(S){case"value":T=j;break;case"defaultValue":L=j;break;case"multiple":y=j;default:Nn(u,d,S,j,f,null)}d=T,f=L,u.multiple=!!y,d!=null?Mi(u,!!y,d,!1):f!=null&&Mi(u,!!y,f,!0);return;case"textarea":Vt("invalid",u),T=S=y=null;for(L in f)if(f.hasOwnProperty(L)&&(j=f[L],j!=null))switch(L){case"value":y=j;break;case"defaultValue":S=j;break;case"children":T=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(r(91));break;default:Nn(u,d,L,j,f,null)}$i(u,y,S,T);return;case"option":for(ae in f)if(f.hasOwnProperty(ae)&&(y=f[ae],y!=null))switch(ae){case"selected":u.selected=y&&typeof y!="function"&&typeof y!="symbol";break;default:Nn(u,d,ae,y,f,null)}return;case"dialog":Vt("beforetoggle",u),Vt("toggle",u),Vt("cancel",u),Vt("close",u);break;case"iframe":case"object":Vt("load",u);break;case"video":case"audio":for(y=0;y<By.length;y++)Vt(By[y],u);break;case"image":Vt("error",u),Vt("load",u);break;case"details":Vt("toggle",u);break;case"embed":case"source":case"link":Vt("error",u),Vt("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ve in f)if(f.hasOwnProperty(ve)&&(y=f[ve],y!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,d));default:Nn(u,d,ve,y,f,null)}return;default:if(Oi(d)){for(Ne in f)f.hasOwnProperty(Ne)&&(y=f[Ne],y!==void 0&&_T(u,d,Ne,y,f,void 0));return}}for(j in f)f.hasOwnProperty(j)&&(y=f[j],y!=null&&Nn(u,d,j,y,f,null))}function m7(u,d,f,y){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,T=null,L=null,j=null,ae=null,ve=null,Ne=null;for(Ie in f){var De=f[Ie];if(f.hasOwnProperty(Ie)&&De!=null)switch(Ie){case"checked":break;case"value":break;case"defaultValue":ae=De;default:y.hasOwnProperty(Ie)||Nn(u,d,Ie,null,y,De)}}for(var we in y){var Ie=y[we];if(De=f[we],y.hasOwnProperty(we)&&(Ie!=null||De!=null))switch(we){case"type":T=Ie;break;case"name":S=Ie;break;case"checked":ve=Ie;break;case"defaultChecked":Ne=Ie;break;case"value":L=Ie;break;case"defaultValue":j=Ie;break;case"children":case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(r(137,d));break;default:Ie!==De&&Nn(u,d,we,Ie,y,De)}}uu(u,L,j,ae,ve,Ne,T,S);return;case"select":Ie=L=j=we=null;for(T in f)if(ae=f[T],f.hasOwnProperty(T)&&ae!=null)switch(T){case"value":break;case"multiple":Ie=ae;default:y.hasOwnProperty(T)||Nn(u,d,T,null,y,ae)}for(S in y)if(T=y[S],ae=f[S],y.hasOwnProperty(S)&&(T!=null||ae!=null))switch(S){case"value":we=T;break;case"defaultValue":j=T;break;case"multiple":L=T;default:T!==ae&&Nn(u,d,S,T,y,ae)}d=j,f=L,y=Ie,we!=null?Mi(u,!!f,we,!1):!!y!=!!f&&(d!=null?Mi(u,!!f,d,!0):Mi(u,!!f,f?[]:"",!1));return;case"textarea":Ie=we=null;for(j in f)if(S=f[j],f.hasOwnProperty(j)&&S!=null&&!y.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Nn(u,d,j,null,y,S)}for(L in y)if(S=y[L],T=f[L],y.hasOwnProperty(L)&&(S!=null||T!=null))switch(L){case"value":we=S;break;case"defaultValue":Ie=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:S!==T&&Nn(u,d,L,S,y,T)}sh(u,we,Ie);return;case"option":for(var Je in f)if(we=f[Je],f.hasOwnProperty(Je)&&we!=null&&!y.hasOwnProperty(Je))switch(Je){case"selected":u.selected=!1;break;default:Nn(u,d,Je,null,y,we)}for(ae in y)if(we=y[ae],Ie=f[ae],y.hasOwnProperty(ae)&&we!==Ie&&(we!=null||Ie!=null))switch(ae){case"selected":u.selected=we&&typeof we!="function"&&typeof we!="symbol";break;default:Nn(u,d,ae,we,y,Ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var dt in f)we=f[dt],f.hasOwnProperty(dt)&&we!=null&&!y.hasOwnProperty(dt)&&Nn(u,d,dt,null,y,we);for(ve in y)if(we=y[ve],Ie=f[ve],y.hasOwnProperty(ve)&&we!==Ie&&(we!=null||Ie!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,d));break;default:Nn(u,d,ve,we,y,Ie)}return;default:if(Oi(d)){for(var Cn in f)we=f[Cn],f.hasOwnProperty(Cn)&&we!==void 0&&!y.hasOwnProperty(Cn)&&_T(u,d,Cn,void 0,y,we);for(Ne in y)we=y[Ne],Ie=f[Ne],!y.hasOwnProperty(Ne)||we===Ie||we===void 0&&Ie===void 0||_T(u,d,Ne,we,y,Ie);return}}for(var pe in f)we=f[pe],f.hasOwnProperty(pe)&&we!=null&&!y.hasOwnProperty(pe)&&Nn(u,d,pe,null,y,we);for(De in y)we=y[De],Ie=f[De],!y.hasOwnProperty(De)||we===Ie||we==null&&Ie==null||Nn(u,d,De,we,y,Ie)}function LO(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function g7(){if(typeof performance.getEntriesByType=="function"){for(var u=0,d=0,f=performance.getEntriesByType("resource"),y=0;y<f.length;y++){var S=f[y],T=S.transferSize,L=S.initiatorType,j=S.duration;if(T&&j&&LO(L)){for(L=0,j=S.responseEnd,y+=1;y<f.length;y++){var ae=f[y],ve=ae.startTime;if(ve>j)break;var Ne=ae.transferSize,De=ae.initiatorType;Ne&&LO(De)&&(ae=ae.responseEnd,L+=Ne*(ae<j?1:(j-ve)/(ae-ve)))}if(--y,d+=8*(T+L)/(S.duration/1e3),u++,10<u)break}}if(0<u)return d/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var ST=null,IT=null;function Mw(u){return u.nodeType===9?u:u.ownerDocument}function zO(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function VO(u,d){if(u===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&d==="foreignObject"?0:u}function TT(u,d){return u==="textarea"||u==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var kT=null;function y7(){var u=window.event;return u&&u.type==="popstate"?u===kT?!1:(kT=u,!0):(kT=null,!1)}var UO=typeof setTimeout=="function"?setTimeout:void 0,b7=typeof clearTimeout=="function"?clearTimeout:void 0,BO=typeof Promise=="function"?Promise:void 0,v7=typeof queueMicrotask=="function"?queueMicrotask:typeof BO<"u"?function(u){return BO.resolve(null).then(u).catch(x7)}:UO;function x7(u){setTimeout(function(){throw u})}function Au(u){return u==="head"}function WO(u,d){var f=d,y=0;do{var S=f.nextSibling;if(u.removeChild(f),S&&S.nodeType===8)if(f=S.data,f==="/$"||f==="/&"){if(y===0){u.removeChild(S),Pf(d);return}y--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")y++;else if(f==="html")jy(u.ownerDocument.documentElement);else if(f==="head"){f=u.ownerDocument.head,jy(f);for(var T=f.firstChild;T;){var L=T.nextSibling,j=T.nodeName;T[ii]||j==="SCRIPT"||j==="STYLE"||j==="LINK"&&T.rel.toLowerCase()==="stylesheet"||f.removeChild(T),T=L}}else f==="body"&&jy(u.ownerDocument.body);f=S}while(f);Pf(d)}function jO(u,d){var f=u;u=0;do{var y=f.nextSibling;if(f.nodeType===1?d?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(d?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),y&&y.nodeType===8)if(f=y.data,f==="/$"){if(u===0)break;u--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||u++;f=y}while(f)}function ET(u){var d=u.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var f=d;switch(d=d.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":ET(f),ou(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}u.removeChild(f)}}function w7(u,d,f,y){for(;u.nodeType===1;){var S=f;if(u.nodeName.toLowerCase()!==d.toLowerCase()){if(!y&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(y){if(!u[ii])switch(d){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(T=u.getAttribute("rel"),T==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(T!==S.rel||u.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||u.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||u.getAttribute("title")!==(S.title==null?null:S.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(T=u.getAttribute("src"),(T!==(S.src==null?null:S.src)||u.getAttribute("type")!==(S.type==null?null:S.type)||u.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&T&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(d==="input"&&u.type==="hidden"){var T=S.name==null?null:""+S.name;if(S.type==="hidden"&&u.getAttribute("name")===T)return u}else return u;if(u=bi(u.nextSibling),u===null)break}return null}function _7(u,d,f){if(d==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!f||(u=bi(u.nextSibling),u===null))return null;return u}function HO(u,d){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!d||(u=bi(u.nextSibling),u===null))return null;return u}function NT(u){return u.data==="$?"||u.data==="$~"}function CT(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function S7(u,d){var f=u.ownerDocument;if(u.data==="$~")u._reactRetry=d;else if(u.data!=="$?"||f.readyState!=="loading")d();else{var y=function(){d(),f.removeEventListener("DOMContentLoaded",y)};f.addEventListener("DOMContentLoaded",y),u._reactRetry=y}}function bi(u){for(;u!=null;u=u.nextSibling){var d=u.nodeType;if(d===1||d===3)break;if(d===8){if(d=u.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return u}var AT=null;function GO(u){u=u.nextSibling;for(var d=0;u;){if(u.nodeType===8){var f=u.data;if(f==="/$"||f==="/&"){if(d===0)return bi(u.nextSibling);d--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||d++}u=u.nextSibling}return null}function qO(u){u=u.previousSibling;for(var d=0;u;){if(u.nodeType===8){var f=u.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(d===0)return u;d--}else f!=="/$"&&f!=="/&"||d++}u=u.previousSibling}return null}function KO(u,d,f){switch(d=Mw(f),u){case"html":if(u=d.documentElement,!u)throw Error(r(452));return u;case"head":if(u=d.head,!u)throw Error(r(453));return u;case"body":if(u=d.body,!u)throw Error(r(454));return u;default:throw Error(r(451))}}function jy(u){for(var d=u.attributes;d.length;)u.removeAttributeNode(d[0]);ou(u)}var vi=new Map,XO=new Set;function $w(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var Nl=Z.d;Z.d={f:I7,r:T7,D:k7,C:E7,L:N7,m:C7,X:R7,S:A7,M:D7};function I7(){var u=Nl.f(),d=Tw();return u||d}function T7(u){var d=ms(u);d!==null&&d.tag===5&&d.type==="form"?d$(d):Nl.r(u)}var $f=typeof document>"u"?null:document;function YO(u,d,f){var y=$f;if(y&&typeof d=="string"&&d){var S=Ma(d);S='link[rel="'+u+'"][href="'+S+'"]',typeof f=="string"&&(S+='[crossorigin="'+f+'"]'),XO.has(S)||(XO.add(S),u={rel:u,crossOrigin:f,href:d},y.querySelector(S)===null&&(d=y.createElement("link"),wa(d,"link",u),pr(d),y.head.appendChild(d)))}}function k7(u){Nl.D(u),YO("dns-prefetch",u,null)}function E7(u,d){Nl.C(u,d),YO("preconnect",u,d)}function N7(u,d,f){Nl.L(u,d,f);var y=$f;if(y&&u&&d){var S='link[rel="preload"][as="'+Ma(d)+'"]';d==="image"&&f&&f.imageSrcSet?(S+='[imagesrcset="'+Ma(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(S+='[imagesizes="'+Ma(f.imageSizes)+'"]')):S+='[href="'+Ma(u)+'"]';var T=S;switch(d){case"style":T=Of(u);break;case"script":T=Ff(u)}vi.has(T)||(u=p({rel:"preload",href:d==="image"&&f&&f.imageSrcSet?void 0:u,as:d},f),vi.set(T,u),y.querySelector(S)!==null||d==="style"&&y.querySelector(Hy(T))||d==="script"&&y.querySelector(Gy(T))||(d=y.createElement("link"),wa(d,"link",u),pr(d),y.head.appendChild(d)))}}function C7(u,d){Nl.m(u,d);var f=$f;if(f&&u){var y=d&&typeof d.as=="string"?d.as:"script",S='link[rel="modulepreload"][as="'+Ma(y)+'"][href="'+Ma(u)+'"]',T=S;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=Ff(u)}if(!vi.has(T)&&(u=p({rel:"modulepreload",href:u},d),vi.set(T,u),f.querySelector(S)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Gy(T)))return}y=f.createElement("link"),wa(y,"link",u),pr(y),f.head.appendChild(y)}}}function A7(u,d,f){Nl.S(u,d,f);var y=$f;if(y&&u){var S=Ls(y).hoistableStyles,T=Of(u);d=d||"default";var L=S.get(T);if(!L){var j={loading:0,preload:null};if(L=y.querySelector(Hy(T)))j.loading=5;else{u=p({rel:"stylesheet",href:u,"data-precedence":d},f),(f=vi.get(T))&&RT(u,f);var ae=L=y.createElement("link");pr(ae),wa(ae,"link",u),ae._p=new Promise(function(ve,Ne){ae.onload=ve,ae.onerror=Ne}),ae.addEventListener("load",function(){j.loading|=1}),ae.addEventListener("error",function(){j.loading|=2}),j.loading|=4,Ow(L,d,y)}L={type:"stylesheet",instance:L,count:1,state:j},S.set(T,L)}}}function R7(u,d){Nl.X(u,d);var f=$f;if(f&&u){var y=Ls(f).hoistableScripts,S=Ff(u),T=y.get(S);T||(T=f.querySelector(Gy(S)),T||(u=p({src:u,async:!0},d),(d=vi.get(S))&&DT(u,d),T=f.createElement("script"),pr(T),wa(T,"link",u),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},y.set(S,T))}}function D7(u,d){Nl.M(u,d);var f=$f;if(f&&u){var y=Ls(f).hoistableScripts,S=Ff(u),T=y.get(S);T||(T=f.querySelector(Gy(S)),T||(u=p({src:u,async:!0,type:"module"},d),(d=vi.get(S))&&DT(u,d),T=f.createElement("script"),pr(T),wa(T,"link",u),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},y.set(S,T))}}function QO(u,d,f,y){var S=(S=$e.current)?$w(S):null;if(!S)throw Error(r(446));switch(u){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(d=Of(f.href),f=Ls(S).hoistableStyles,y=f.get(d),y||(y={type:"style",instance:null,count:0,state:null},f.set(d,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){u=Of(f.href);var T=Ls(S).hoistableStyles,L=T.get(u);if(L||(S=S.ownerDocument||S,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(u,L),(T=S.querySelector(Hy(u)))&&!T._p&&(L.instance=T,L.state.loading=5),vi.has(u)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},vi.set(u,f),T||M7(S,u,f,L.state))),d&&y===null)throw Error(r(528,""));return L}if(d&&y!==null)throw Error(r(529,""));return null;case"script":return d=f.async,f=f.src,typeof f=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Ff(f),f=Ls(S).hoistableScripts,y=f.get(d),y||(y={type:"script",instance:null,count:0,state:null},f.set(d,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,u))}}function Of(u){return'href="'+Ma(u)+'"'}function Hy(u){return'link[rel="stylesheet"]['+u+"]"}function ZO(u){return p({},u,{"data-precedence":u.precedence,precedence:null})}function M7(u,d,f,y){u.querySelector('link[rel="preload"][as="style"]['+d+"]")?y.loading=1:(d=u.createElement("link"),y.preload=d,d.addEventListener("load",function(){return y.loading|=1}),d.addEventListener("error",function(){return y.loading|=2}),wa(d,"link",f),pr(d),u.head.appendChild(d))}function Ff(u){return'[src="'+Ma(u)+'"]'}function Gy(u){return"script[async]"+u}function JO(u,d,f){if(d.count++,d.instance===null)switch(d.type){case"style":var y=u.querySelector('style[data-href~="'+Ma(f.href)+'"]');if(y)return d.instance=y,pr(y),y;var S=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return y=(u.ownerDocument||u).createElement("style"),pr(y),wa(y,"style",S),Ow(y,f.precedence,u),d.instance=y;case"stylesheet":S=Of(f.href);var T=u.querySelector(Hy(S));if(T)return d.state.loading|=4,d.instance=T,pr(T),T;y=ZO(f),(S=vi.get(S))&&RT(y,S),T=(u.ownerDocument||u).createElement("link"),pr(T);var L=T;return L._p=new Promise(function(j,ae){L.onload=j,L.onerror=ae}),wa(T,"link",y),d.state.loading|=4,Ow(T,f.precedence,u),d.instance=T;case"script":return T=Ff(f.src),(S=u.querySelector(Gy(T)))?(d.instance=S,pr(S),S):(y=f,(S=vi.get(T))&&(y=p({},f),DT(y,S)),u=u.ownerDocument||u,S=u.createElement("script"),pr(S),wa(S,"link",y),u.head.appendChild(S),d.instance=S);case"void":return null;default:throw Error(r(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(y=d.instance,d.state.loading|=4,Ow(y,f.precedence,u));return d.instance}function Ow(u,d,f){for(var y=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=y.length?y[y.length-1]:null,T=S,L=0;L<y.length;L++){var j=y[L];if(j.dataset.precedence===d)T=j;else if(T!==S)break}T?T.parentNode.insertBefore(u,T.nextSibling):(d=f.nodeType===9?f.head:f,d.insertBefore(u,d.firstChild))}function RT(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.title==null&&(u.title=d.title)}function DT(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.integrity==null&&(u.integrity=d.integrity)}var Fw=null;function eF(u,d,f){if(Fw===null){var y=new Map,S=Fw=new Map;S.set(f,y)}else S=Fw,y=S.get(f),y||(y=new Map,S.set(f,y));if(y.has(u))return y;for(y.set(u,null),f=f.getElementsByTagName(u),S=0;S<f.length;S++){var T=f[S];if(!(T[ii]||T[zn]||u==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var L=T.getAttribute(d)||"";L=u+L;var j=y.get(L);j?j.push(T):y.set(L,[T])}}return y}function tF(u,d,f){u=u.ownerDocument||u,u.head.insertBefore(f,d==="title"?u.querySelector("head > title"):null)}function $7(u,d,f){if(f===1||d.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return u=d.disabled,typeof d.precedence=="string"&&u==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function nF(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function O7(u,d,f,y){if(f.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var S=Of(y.href),T=d.querySelector(Hy(S));if(T){d=T._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(u.count++,u=Pw.bind(u),d.then(u,u)),f.state.loading|=4,f.instance=T,pr(T);return}T=d.ownerDocument||d,y=ZO(y),(S=vi.get(S))&&RT(y,S),T=T.createElement("link"),pr(T);var L=T;L._p=new Promise(function(j,ae){L.onload=j,L.onerror=ae}),wa(T,"link",y),f.instance=T}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(f,d),(d=f.state.preload)&&(f.state.loading&3)===0&&(u.count++,f=Pw.bind(u),d.addEventListener("load",f),d.addEventListener("error",f))}}var MT=0;function F7(u,d){return u.stylesheets&&u.count===0&&zw(u,u.stylesheets),0<u.count||0<u.imgCount?function(f){var y=setTimeout(function(){if(u.stylesheets&&zw(u,u.stylesheets),u.unsuspend){var T=u.unsuspend;u.unsuspend=null,T()}},6e4+d);0<u.imgBytes&&MT===0&&(MT=62500*g7());var S=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&zw(u,u.stylesheets),u.unsuspend)){var T=u.unsuspend;u.unsuspend=null,T()}},(u.imgBytes>MT?50:800)+d);return u.unsuspend=f,function(){u.unsuspend=null,clearTimeout(y),clearTimeout(S)}}:null}function Pw(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)zw(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var Lw=null;function zw(u,d){u.stylesheets=null,u.unsuspend!==null&&(u.count++,Lw=new Map,d.forEach(P7,u),Lw=null,Pw.call(u))}function P7(u,d){if(!(d.state.loading&4)){var f=Lw.get(u);if(f)var y=f.get(null);else{f=new Map,Lw.set(u,f);for(var S=u.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<S.length;T++){var L=S[T];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(f.set(L.dataset.precedence,L),y=L)}y&&f.set(null,y)}S=d.instance,L=S.getAttribute("data-precedence"),T=f.get(L)||y,T===y&&f.set(null,S),f.set(L,S),this.count++,y=Pw.bind(this),S.addEventListener("load",y),S.addEventListener("error",y),T?T.parentNode.insertBefore(S,T.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(S,u.firstChild)),d.state.loading|=4}}var qy={$$typeof:k,Provider:null,Consumer:null,_currentValue:ne,_currentValue2:ne,_threadCount:0};function L7(u,d,f,y,S,T,L,j,ae){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qe(0),this.hiddenUpdates=Qe(null),this.identifierPrefix=y,this.onUncaughtError=S,this.onCaughtError=T,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function rF(u,d,f,y,S,T,L,j,ae,ve,Ne,De){return u=new L7(u,d,f,L,ae,ve,Ne,De,j),d=1,T===!0&&(d|=24),T=Us(3,null,null,d),u.current=T,T.stateNode=u,d=dI(),d.refCount++,u.pooledCache=d,d.refCount++,T.memoizedState={element:y,isDehydrated:f,cache:d},gI(T),u}function aF(u){return u?(u=pf,u):pf}function sF(u,d,f,y,S,T){S=aF(S),y.context===null?y.context=S:y.pendingContext=S,y=vu(d),y.payload={element:f},T=T===void 0?null:T,T!==null&&(y.callback=T),f=xu(u,y,d),f!==null&&(ws(f,u,d),Ty(f,u,d))}function iF(u,d){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var f=u.retryLane;u.retryLane=f!==0&&f<d?f:d}}function $T(u,d){iF(u,d),(u=u.alternate)&&iF(u,d)}function oF(u){if(u.tag===13||u.tag===31){var d=dh(u,67108864);d!==null&&ws(d,u,67108864),$T(u,67108864)}}function lF(u){if(u.tag===13||u.tag===31){var d=Gs();d=bn(d);var f=dh(u,d);f!==null&&ws(f,u,d),$T(u,d)}}var Vw=!0;function z7(u,d,f,y){var S=q.T;q.T=null;var T=Z.p;try{Z.p=2,OT(u,d,f,y)}finally{Z.p=T,q.T=S}}function V7(u,d,f,y){var S=q.T;q.T=null;var T=Z.p;try{Z.p=8,OT(u,d,f,y)}finally{Z.p=T,q.T=S}}function OT(u,d,f,y){if(Vw){var S=FT(y);if(S===null)wT(u,d,y,Uw,f),cF(u,y);else if(B7(S,u,d,f,y))y.stopPropagation();else if(cF(u,y),d&4&&-1<U7.indexOf(u)){for(;S!==null;){var T=ms(S);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var L=oa(T.pendingLanes);if(L!==0){var j=T;for(j.pendingLanes|=2,j.entangledLanes|=2;L;){var ae=1<<31-Fn(L);j.entanglements[1]|=ae,L&=~ae}So(T),(hn&6)===0&&(Sw=kn()+500,Uy(0))}}break;case 31:case 13:j=dh(T,2),j!==null&&ws(j,T,2),Tw(),$T(T,2)}if(T=FT(y),T===null&&wT(u,d,y,Uw,f),T===S)break;S=T}S!==null&&y.stopPropagation()}else wT(u,d,y,null,f)}}function FT(u){return u=gs(u),PT(u)}var Uw=null;function PT(u){if(Uw=null,u=Da(u),u!==null){var d=s(u);if(d===null)u=null;else{var f=d.tag;if(f===13){if(u=i(d),u!==null)return u;u=null}else if(f===31){if(u=o(d),u!==null)return u;u=null}else if(f===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;u=null}else d!==u&&(u=null)}}return Uw=u,null}function uF(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cr()){case vr:return 2;case qn:return 8;case hr:case si:return 32;case lo:return 268435456;default:return 32}default:return 32}}var LT=!1,Ru=null,Du=null,Mu=null,Ky=new Map,Xy=new Map,$u=[],U7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cF(u,d){switch(u){case"focusin":case"focusout":Ru=null;break;case"dragenter":case"dragleave":Du=null;break;case"mouseover":case"mouseout":Mu=null;break;case"pointerover":case"pointerout":Ky.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xy.delete(d.pointerId)}}function Yy(u,d,f,y,S,T){return u===null||u.nativeEvent!==T?(u={blockedOn:d,domEventName:f,eventSystemFlags:y,nativeEvent:T,targetContainers:[S]},d!==null&&(d=ms(d),d!==null&&oF(d)),u):(u.eventSystemFlags|=y,d=u.targetContainers,S!==null&&d.indexOf(S)===-1&&d.push(S),u)}function B7(u,d,f,y,S){switch(d){case"focusin":return Ru=Yy(Ru,u,d,f,y,S),!0;case"dragenter":return Du=Yy(Du,u,d,f,y,S),!0;case"mouseover":return Mu=Yy(Mu,u,d,f,y,S),!0;case"pointerover":var T=S.pointerId;return Ky.set(T,Yy(Ky.get(T)||null,u,d,f,y,S)),!0;case"gotpointercapture":return T=S.pointerId,Xy.set(T,Yy(Xy.get(T)||null,u,d,f,y,S)),!0}return!1}function hF(u){var d=Da(u.target);if(d!==null){var f=s(d);if(f!==null){if(d=f.tag,d===13){if(d=i(f),d!==null){u.blockedOn=d,Ra(u.priority,function(){lF(f)});return}}else if(d===31){if(d=o(f),d!==null){u.blockedOn=d,Ra(u.priority,function(){lF(f)});return}}else if(d===3&&f.stateNode.current.memoizedState.isDehydrated){u.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Bw(u){if(u.blockedOn!==null)return!1;for(var d=u.targetContainers;0<d.length;){var f=FT(u.nativeEvent);if(f===null){f=u.nativeEvent;var y=new f.constructor(f.type,f);fo=y,f.target.dispatchEvent(y),fo=null}else return d=ms(f),d!==null&&oF(d),u.blockedOn=f,!1;d.shift()}return!0}function dF(u,d,f){Bw(u)&&f.delete(d)}function W7(){LT=!1,Ru!==null&&Bw(Ru)&&(Ru=null),Du!==null&&Bw(Du)&&(Du=null),Mu!==null&&Bw(Mu)&&(Mu=null),Ky.forEach(dF),Xy.forEach(dF)}function Ww(u,d){u.blockedOn===d&&(u.blockedOn=null,LT||(LT=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,W7)))}var jw=null;function pF(u){jw!==u&&(jw=u,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){jw===u&&(jw=null);for(var d=0;d<u.length;d+=3){var f=u[d],y=u[d+1],S=u[d+2];if(typeof y!="function"){if(PT(y||f)===null)continue;break}var T=ms(f);T!==null&&(u.splice(d,3),d-=3,FI(T,{pending:!0,data:S,method:f.method,action:y},y,S))}}))}function Pf(u){function d(ae){return Ww(ae,u)}Ru!==null&&Ww(Ru,u),Du!==null&&Ww(Du,u),Mu!==null&&Ww(Mu,u),Ky.forEach(d),Xy.forEach(d);for(var f=0;f<$u.length;f++){var y=$u[f];y.blockedOn===u&&(y.blockedOn=null)}for(;0<$u.length&&(f=$u[0],f.blockedOn===null);)hF(f),f.blockedOn===null&&$u.shift();if(f=(u.ownerDocument||u).$$reactFormReplay,f!=null)for(y=0;y<f.length;y+=3){var S=f[y],T=f[y+1],L=S[Yt]||null;if(typeof T=="function")L||pF(f);else if(L){var j=null;if(T&&T.hasAttribute("formAction")){if(S=T,L=T[Yt]||null)j=L.formAction;else if(PT(S)!==null)continue}else j=L.action;typeof j=="function"?f[y+1]=j:(f.splice(y,3),y-=3),pF(f)}}}function fF(){function u(T){T.canIntercept&&T.info==="react-transition"&&T.intercept({handler:function(){return new Promise(function(L){return S=L})},focusReset:"manual",scroll:"manual"})}function d(){S!==null&&(S(),S=null),y||setTimeout(f,20)}function f(){if(!y&&!navigation.transition){var T=navigation.currentEntry;T&&T.url!=null&&navigation.navigate(T.url,{state:T.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var y=!1,S=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(f,100),function(){y=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),S!==null&&(S(),S=null)}}}function zT(u){this._internalRoot=u}Hw.prototype.render=zT.prototype.render=function(u){var d=this._internalRoot;if(d===null)throw Error(r(409));var f=d.current,y=Gs();sF(f,y,u,d,null,null)},Hw.prototype.unmount=zT.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var d=u.containerInfo;sF(u.current,2,null,u,null,null),Tw(),d[Kr]=null}};function Hw(u){this._internalRoot=u}Hw.prototype.unstable_scheduleHydration=function(u){if(u){var d=fs();u={blockedOn:null,target:u,priority:d};for(var f=0;f<$u.length&&d!==0&&d<$u[f].priority;f++);$u.splice(f,0,u),f===0&&hF(u)}};var mF=t.version;if(mF!=="19.2.0")throw Error(r(527,mF,"19.2.0"));Z.findDOMNode=function(u){var d=u._reactInternals;if(d===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=h(d),u=u!==null?c(u):null,u=u===null?null:u.stateNode,u};var j7={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gw.isDisabled&&Gw.supportsFiber)try{dr=Gw.inject(j7),On=Gw}catch{}}return Zy.createRoot=function(u,d){if(!a(u))throw Error(r(299));var f=!1,y="",S=_$,T=S$,L=I$;return d!=null&&(d.unstable_strictMode===!0&&(f=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onUncaughtError!==void 0&&(S=d.onUncaughtError),d.onCaughtError!==void 0&&(T=d.onCaughtError),d.onRecoverableError!==void 0&&(L=d.onRecoverableError)),d=rF(u,1,!1,null,null,f,y,null,S,T,L,fF),u[Kr]=d.current,xT(u),new zT(d)},Zy.hydrateRoot=function(u,d,f){if(!a(u))throw Error(r(299));var y=!1,S="",T=_$,L=S$,j=I$,ae=null;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(S=f.identifierPrefix),f.onUncaughtError!==void 0&&(T=f.onUncaughtError),f.onCaughtError!==void 0&&(L=f.onCaughtError),f.onRecoverableError!==void 0&&(j=f.onRecoverableError),f.formState!==void 0&&(ae=f.formState)),d=rF(u,1,!0,d,f??null,y,S,ae,T,L,j,fF),d.context=aF(null),f=d.current,y=Gs(),y=bn(y),S=vu(y),S.callback=null,xu(f,S,y),f=y,d.current.lanes=f,Ve(d,f),So(d),u[Kr]=d.current,xT(u),new Hw(d)},Zy.version="19.2.0",Zy}var TF;function tK(){if(TF)return BT.exports;TF=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),BT.exports=eK(),BT.exports}var nK=tK();const rK=tz(nK);var kF="popstate";function aK(e={}){function t(r,a){let{pathname:s,search:i,hash:o}=r.location;return Ak("",{pathname:s,search:i,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Ob(a)}return iK(t,n,null,e)}function er(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Zi(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function sK(){return Math.random().toString(36).substring(2,10)}function EF(e,t){return{usr:e.state,key:e.key,idx:t}}function Ak(e,t,n=null,r){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Rm(t):t,state:n,key:t&&t.key||r||sK()}}function Ob({pathname:e="/",search:t="",hash:n=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Rm(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function iK(e,t,n,r={}){let{window:a=document.defaultView,v5Compat:s=!1}=r,i=a.history,o="POP",l=null,h=c();h==null&&(h=0,i.replaceState({...i.state,idx:h},""));function c(){return(i.state||{idx:null}).idx}function p(){o="POP";let x=c(),_=x==null?null:x-h;h=x,l&&l({action:o,location:v.location,delta:_})}function m(x,_){o="PUSH";let I=Ak(v.location,x,_);h=c()+1;let k=EF(I,h),E=v.createHref(I);try{i.pushState(k,"",E)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;a.location.assign(E)}s&&l&&l({action:o,location:v.location,delta:1})}function g(x,_){o="REPLACE";let I=Ak(v.location,x,_);h=c();let k=EF(I,h),E=v.createHref(I);i.replaceState(k,"",E),s&&l&&l({action:o,location:v.location,delta:0})}function b(x){return oK(x)}let v={get action(){return o},get location(){return e(a,i)},listen(x){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(kF,p),l=x,()=>{a.removeEventListener(kF,p),l=null}},createHref(x){return t(a,x)},createURL:b,encodeLocation(x){let _=b(x);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:m,replace:g,go(x){return i.go(x)}};return v}function oK(e,t=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),er(n,"No window.location.(origin|href) available to create URL");let r=typeof e=="string"?e:Ob(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function nz(e,t,n="/"){return lK(e,t,n,!1)}function lK(e,t,n,r){let a=typeof t=="string"?Rm(t):t,s=Wl(a.pathname||"/",n);if(s==null)return null;let i=rz(e);uK(i);let o=null;for(let l=0;o==null&&l<i.length;++l){let h=xK(s);o=bK(i[l],h,r)}return o}function rz(e,t=[],n=[],r="",a=!1){let s=(i,o,l=a,h)=>{let c={relativePath:h===void 0?i.path||"":h,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(r)&&l)return;er(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let p=Fl([r,c.relativePath]),m=n.concat(c);i.children&&i.children.length>0&&(er(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),rz(i.children,t,m,p,l)),!(i.path==null&&!i.index)&&t.push({path:p,score:gK(p,i.index),routesMeta:m})};return e.forEach((i,o)=>{if(i.path===""||!i.path?.includes("?"))s(i,o);else for(let l of az(i.path))s(i,o,!0,l)}),t}function az(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return a?[s,""]:[s];let i=az(r.join("/")),o=[];return o.push(...i.map(l=>l===""?s:[s,l].join("/"))),a&&o.push(...i),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function uK(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:yK(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var cK=/^:[\w-]+$/,hK=3,dK=2,pK=1,fK=10,mK=-2,NF=e=>e==="*";function gK(e,t){let n=e.split("/"),r=n.length;return n.some(NF)&&(r+=mK),t&&(r+=dK),n.filter(a=>!NF(a)).reduce((a,s)=>a+(cK.test(s)?hK:s===""?pK:fK),r)}function yK(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function bK(e,t,n=!1){let{routesMeta:r}=e,a={},s="/",i=[];for(let o=0;o<r.length;++o){let l=r[o],h=o===r.length-1,c=s==="/"?t:t.slice(s.length)||"/",p=V0({path:l.relativePath,caseSensitive:l.caseSensitive,end:h},c),m=l.route;if(!p&&h&&n&&!r[r.length-1].route.index&&(p=V0({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!p)return null;Object.assign(a,p.params),i.push({params:a,pathname:Fl([s,p.pathname]),pathnameBase:IK(Fl([s,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(s=Fl([s,p.pathnameBase]))}return i}function V0(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=vK(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let s=a[0],i=s.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:r.reduce((h,{paramName:c,isOptional:p},m)=>{if(c==="*"){let b=o[m]||"";i=s.slice(0,s.length-b.length).replace(/(.)\/+$/,"$1")}const g=o[m];return p&&!g?h[c]=void 0:h[c]=(g||"").replace(/%2F/g,"/"),h},{}),pathname:s,pathnameBase:i,pattern:e}}function vK(e,t=!1,n=!0){Zi(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function xK(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Zi(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Wl(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function wK(e,t="/"){let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?Rm(e):e;return{pathname:n?n.startsWith("/")?n:_K(n,t):t,search:TK(r),hash:kK(a)}}function _K(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function GT(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function SK(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function gN(e){let t=SK(e);return t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase)}function yN(e,t,n,r=!1){let a;typeof e=="string"?a=Rm(e):(a={...e},er(!a.pathname||!a.pathname.includes("?"),GT("?","pathname","search",a)),er(!a.pathname||!a.pathname.includes("#"),GT("#","pathname","hash",a)),er(!a.search||!a.search.includes("#"),GT("#","search","hash",a)));let s=e===""||a.pathname==="",i=s?"/":a.pathname,o;if(i==null)o=n;else{let p=t.length-1;if(!r&&i.startsWith("..")){let m=i.split("/");for(;m[0]==="..";)m.shift(),p-=1;a.pathname=m.join("/")}o=p>=0?t[p]:"/"}let l=wK(a,o),h=i&&i!=="/"&&i.endsWith("/"),c=(s||i===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(h||c)&&(l.pathname+="/"),l}var Fl=e=>e.join("/").replace(/\/\/+/g,"/"),IK=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),TK=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,kK=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function EK(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var sz=["POST","PUT","PATCH","DELETE"];new Set(sz);var NK=["GET",...sz];new Set(NK);var Dm=fe.createContext(null);Dm.displayName="DataRouter";var U_=fe.createContext(null);U_.displayName="DataRouterState";fe.createContext(!1);var iz=fe.createContext({isTransitioning:!1});iz.displayName="ViewTransition";var CK=fe.createContext(new Map);CK.displayName="Fetchers";var AK=fe.createContext(null);AK.displayName="Await";var so=fe.createContext(null);so.displayName="Navigation";var dv=fe.createContext(null);dv.displayName="Location";var Yo=fe.createContext({outlet:null,matches:[],isDataRoute:!1});Yo.displayName="Route";var bN=fe.createContext(null);bN.displayName="RouteError";function RK(e,{relative:t}={}){er(Mm(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=fe.useContext(so),{hash:a,pathname:s,search:i}=pv(e,{relative:t}),o=s;return n!=="/"&&(o=s==="/"?n:Fl([n,s])),r.createHref({pathname:o,search:i,hash:a})}function Mm(){return fe.useContext(dv)!=null}function Yl(){return er(Mm(),"useLocation() may be used only in the context of a <Router> component."),fe.useContext(dv).location}var oz="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function lz(e){fe.useContext(so).static||fe.useLayoutEffect(e)}function B_(){let{isDataRoute:e}=fe.useContext(Yo);return e?jK():DK()}function DK(){er(Mm(),"useNavigate() may be used only in the context of a <Router> component.");let e=fe.useContext(Dm),{basename:t,navigator:n}=fe.useContext(so),{matches:r}=fe.useContext(Yo),{pathname:a}=Yl(),s=JSON.stringify(gN(r)),i=fe.useRef(!1);return lz(()=>{i.current=!0}),fe.useCallback((l,h={})=>{if(Zi(i.current,oz),!i.current)return;if(typeof l=="number"){n.go(l);return}let c=yN(l,JSON.parse(s),a,h.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:Fl([t,c.pathname])),(h.replace?n.replace:n.push)(c,h.state,h)},[t,n,s,a,e])}fe.createContext(null);function pv(e,{relative:t}={}){let{matches:n}=fe.useContext(Yo),{pathname:r}=Yl(),a=JSON.stringify(gN(n));return fe.useMemo(()=>yN(e,JSON.parse(a),r,t==="path"),[e,a,r,t])}function MK(e,t){return uz(e,t)}function uz(e,t,n,r,a){er(Mm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=fe.useContext(so),{matches:i}=fe.useContext(Yo),o=i[i.length-1],l=o?o.params:{},h=o?o.pathname:"/",c=o?o.pathnameBase:"/",p=o&&o.route;{let I=p&&p.path||"";cz(h,!p||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let m=Yl(),g;if(t){let I=typeof t=="string"?Rm(t):t;er(c==="/"||I.pathname?.startsWith(c),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${I.pathname}" was given in the \`location\` prop.`),g=I}else g=m;let b=g.pathname||"/",v=b;if(c!=="/"){let I=c.replace(/^\//,"").split("/");v="/"+b.replace(/^\//,"").split("/").slice(I.length).join("/")}let x=nz(e,{pathname:v});Zi(p||x!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),Zi(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=LK(x&&x.map(I=>Object.assign({},I,{params:Object.assign({},l,I.params),pathname:Fl([c,s.encodeLocation?s.encodeLocation(I.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?c:Fl([c,s.encodeLocation?s.encodeLocation(I.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathnameBase])})),i,n,r,a);return t&&_?fe.createElement(dv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},_):_}function $K(){let e=WK(),t=EK(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},i=null;return console.error("Error handled by React Router default ErrorBoundary:",e),i=fe.createElement(fe.Fragment,null,fe.createElement("p",null," Hey developer "),fe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",fe.createElement("code",{style:s},"ErrorBoundary")," or"," ",fe.createElement("code",{style:s},"errorElement")," prop on your route.")),fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},t),n?fe.createElement("pre",{style:a},n):null,i)}var OK=fe.createElement($K,null),FK=class extends fe.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?fe.createElement(Yo.Provider,{value:this.props.routeContext},fe.createElement(bN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function PK({routeContext:e,match:t,children:n}){let r=fe.useContext(Dm);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),fe.createElement(Yo.Provider,{value:e},n)}function LK(e,t=[],n=null,r=null,a=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let s=e,i=n?.errors;if(i!=null){let h=s.findIndex(c=>c.route.id&&i?.[c.route.id]!==void 0);er(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let o=!1,l=-1;if(n)for(let h=0;h<s.length;h++){let c=s[h];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(l=h),c.route.id){let{loaderData:p,errors:m}=n,g=c.route.loader&&!p.hasOwnProperty(c.route.id)&&(!m||m[c.route.id]===void 0);if(c.route.lazy||g){o=!0,l>=0?s=s.slice(0,l+1):s=[s[0]];break}}}return s.reduceRight((h,c,p)=>{let m,g=!1,b=null,v=null;n&&(m=i&&c.route.id?i[c.route.id]:void 0,b=c.route.errorElement||OK,o&&(l<0&&p===0?(cz("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,v=null):l===p&&(g=!0,v=c.route.hydrateFallbackElement||null)));let x=t.concat(s.slice(0,p+1)),_=()=>{let I;return m?I=b:g?I=v:c.route.Component?I=fe.createElement(c.route.Component,null):c.route.element?I=c.route.element:I=h,fe.createElement(PK,{match:c,routeContext:{outlet:h,matches:x,isDataRoute:n!=null},children:I})};return n&&(c.route.ErrorBoundary||c.route.errorElement||p===0)?fe.createElement(FK,{location:n.location,revalidation:n.revalidation,component:b,error:m,children:_(),routeContext:{outlet:null,matches:x,isDataRoute:!0},unstable_onError:r}):_()},null)}function vN(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zK(e){let t=fe.useContext(Dm);return er(t,vN(e)),t}function VK(e){let t=fe.useContext(U_);return er(t,vN(e)),t}function UK(e){let t=fe.useContext(Yo);return er(t,vN(e)),t}function xN(e){let t=UK(e),n=t.matches[t.matches.length-1];return er(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function BK(){return xN("useRouteId")}function WK(){let e=fe.useContext(bN),t=VK("useRouteError"),n=xN("useRouteError");return e!==void 0?e:t.errors?.[n]}function jK(){let{router:e}=zK("useNavigate"),t=xN("useNavigate"),n=fe.useRef(!1);return lz(()=>{n.current=!0}),fe.useCallback(async(a,s={})=>{Zi(n.current,oz),n.current&&(typeof a=="number"?e.navigate(a):await e.navigate(a,{fromRouteId:t,...s}))},[e,t])}var CF={};function cz(e,t,n){!t&&!CF[e]&&(CF[e]=!0,Zi(!1,n))}fe.memo(HK);function HK({routes:e,future:t,state:n,unstable_onError:r}){return uz(e,void 0,n,r,t)}function GK({to:e,replace:t,state:n,relative:r}){er(Mm(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=fe.useContext(so);Zi(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=fe.useContext(Yo),{pathname:i}=Yl(),o=B_(),l=yN(e,gN(s),i,r==="path"),h=JSON.stringify(l);return fe.useEffect(()=>{o(JSON.parse(h),{replace:t,state:n,relative:r})},[o,h,r,t,n]),null}function Bf(e){er(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function qK({basename:e="/",children:t=null,location:n,navigationType:r="POP",navigator:a,static:s=!1}){er(!Mm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=e.replace(/^\/*/,"/"),o=fe.useMemo(()=>({basename:i,navigator:a,static:s,future:{}}),[i,a,s]);typeof n=="string"&&(n=Rm(n));let{pathname:l="/",search:h="",hash:c="",state:p=null,key:m="default"}=n,g=fe.useMemo(()=>{let b=Wl(l,i);return b==null?null:{location:{pathname:b,search:h,hash:c,state:p,key:m},navigationType:r}},[i,l,h,c,p,m,r]);return Zi(g!=null,`<Router basename="${i}"> is not able to match the URL "${l}${h}${c}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:fe.createElement(so.Provider,{value:o},fe.createElement(dv.Provider,{children:t,value:g}))}function KK({children:e,location:t}){return MK(Rk(e),t)}function Rk(e,t=[]){let n=[];return fe.Children.forEach(e,(r,a)=>{if(!fe.isValidElement(r))return;let s=[...t,a];if(r.type===fe.Fragment){n.push.apply(n,Rk(r.props.children,s));return}er(r.type===Bf,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),er(!r.props.index||!r.props.children,"An index route cannot have child routes.");let i={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=Rk(r.props.children,s)),n.push(i)}),n}var v0="get",x0="application/x-www-form-urlencoded";function W_(e){return e!=null&&typeof e.tagName=="string"}function XK(e){return W_(e)&&e.tagName.toLowerCase()==="button"}function YK(e){return W_(e)&&e.tagName.toLowerCase()==="form"}function QK(e){return W_(e)&&e.tagName.toLowerCase()==="input"}function ZK(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function JK(e,t){return e.button===0&&(!t||t==="_self")&&!ZK(e)}var qw=null;function eX(){if(qw===null)try{new FormData(document.createElement("form"),0),qw=!1}catch{qw=!0}return qw}var tX=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qT(e){return e!=null&&!tX.has(e)?(Zi(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${x0}"`),null):e}function nX(e,t){let n,r,a,s,i;if(YK(e)){let o=e.getAttribute("action");r=o?Wl(o,t):null,n=e.getAttribute("method")||v0,a=qT(e.getAttribute("enctype"))||x0,s=new FormData(e)}else if(XK(e)||QK(e)&&(e.type==="submit"||e.type==="image")){let o=e.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=e.getAttribute("formaction")||o.getAttribute("action");if(r=l?Wl(l,t):null,n=e.getAttribute("formmethod")||o.getAttribute("method")||v0,a=qT(e.getAttribute("formenctype"))||qT(o.getAttribute("enctype"))||x0,s=new FormData(o,e),!eX()){let{name:h,type:c,value:p}=e;if(c==="image"){let m=h?`${h}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else h&&s.append(h,p)}}else{if(W_(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=v0,r=null,a=x0,i=e}return s&&a==="text/plain"&&(i=s,s=void 0),{action:r,method:n.toLowerCase(),encType:a,formData:s,body:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function wN(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function rX(e,t,n){let r=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return r.pathname==="/"?r.pathname=`_root.${n}`:t&&Wl(r.pathname,t)==="/"?r.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function aX(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function sX(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function iX(e,t,n){let r=await Promise.all(e.map(async a=>{let s=t.routes[a.route.id];if(s){let i=await aX(s,n);return i.links?i.links():[]}return[]}));return cX(r.flat(1).filter(sX).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function AF(e,t,n,r,a,s){let i=(l,h)=>n[h]?l.route.id!==n[h].route.id:!0,o=(l,h)=>n[h].pathname!==l.pathname||n[h].route.path?.endsWith("*")&&n[h].params["*"]!==l.params["*"];return s==="assets"?t.filter((l,h)=>i(l,h)||o(l,h)):s==="data"?t.filter((l,h)=>{let c=r.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(i(l,h)||o(l,h))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function oX(e,t,{includeHydrateFallback:n}={}){return lX(e.map(r=>{let a=t.routes[r.route.id];if(!a)return[];let s=[a.module];return a.clientActionModule&&(s=s.concat(a.clientActionModule)),a.clientLoaderModule&&(s=s.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(s=s.concat(a.hydrateFallbackModule)),a.imports&&(s=s.concat(a.imports)),s}).flat(1))}function lX(e){return[...new Set(e)]}function uX(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function cX(e,t){let n=new Set;return new Set(t),e.reduce((r,a)=>{let s=JSON.stringify(uX(a));return n.has(s)||(n.add(s),r.push({key:s,link:a})),r},[])}function hz(){let e=fe.useContext(Dm);return wN(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function hX(){let e=fe.useContext(U_);return wN(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var _N=fe.createContext(void 0);_N.displayName="FrameworkContext";function dz(){let e=fe.useContext(_N);return wN(e,"You must render this element inside a <HydratedRouter> element"),e}function dX(e,t){let n=fe.useContext(_N),[r,a]=fe.useState(!1),[s,i]=fe.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:h,onMouseLeave:c,onTouchStart:p}=t,m=fe.useRef(null);fe.useEffect(()=>{if(e==="render"&&i(!0),e==="viewport"){let v=_=>{_.forEach(I=>{i(I.isIntersecting)})},x=new IntersectionObserver(v,{threshold:.5});return m.current&&x.observe(m.current),()=>{x.disconnect()}}},[e]),fe.useEffect(()=>{if(r){let v=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(v)}}},[r]);let g=()=>{a(!0)},b=()=>{a(!1),i(!1)};return n?e!=="intent"?[s,m,{}]:[s,m,{onFocus:Jy(o,g),onBlur:Jy(l,b),onMouseEnter:Jy(h,g),onMouseLeave:Jy(c,b),onTouchStart:Jy(p,g)}]:[!1,m,{}]}function Jy(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function pX({page:e,...t}){let{router:n}=hz(),r=fe.useMemo(()=>nz(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?fe.createElement(mX,{page:e,matches:r,...t}):null}function fX(e){let{manifest:t,routeModules:n}=dz(),[r,a]=fe.useState([]);return fe.useEffect(()=>{let s=!1;return iX(e,t,n).then(i=>{s||a(i)}),()=>{s=!0}},[e,t,n]),r}function mX({page:e,matches:t,...n}){let r=Yl(),{manifest:a,routeModules:s}=dz(),{basename:i}=hz(),{loaderData:o,matches:l}=hX(),h=fe.useMemo(()=>AF(e,t,l,a,r,"data"),[e,t,l,a,r]),c=fe.useMemo(()=>AF(e,t,l,a,r,"assets"),[e,t,l,a,r]),p=fe.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let b=new Set,v=!1;if(t.forEach(_=>{let I=a.routes[_.route.id];!I||!I.hasLoader||(!h.some(k=>k.route.id===_.route.id)&&_.route.id in o&&s[_.route.id]?.shouldRevalidate||I.hasClientLoader?v=!0:b.add(_.route.id))}),b.size===0)return[];let x=rX(e,i,"data");return v&&b.size>0&&x.searchParams.set("_routes",t.filter(_=>b.has(_.route.id)).map(_=>_.route.id).join(",")),[x.pathname+x.search]},[i,o,r,a,h,t,e,s]),m=fe.useMemo(()=>oX(c,a),[c,a]),g=fX(c);return fe.createElement(fe.Fragment,null,p.map(b=>fe.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...n})),m.map(b=>fe.createElement("link",{key:b,rel:"modulepreload",href:b,...n})),g.map(({key:b,link:v})=>fe.createElement("link",{key:b,nonce:n.nonce,...v})))}function gX(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var pz=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{pz&&(window.__reactRouterVersion="7.9.5")}catch{}function yX({basename:e,children:t,window:n}){let r=fe.useRef();r.current==null&&(r.current=aK({window:n,v5Compat:!0}));let a=r.current,[s,i]=fe.useState({action:a.action,location:a.location}),o=fe.useCallback(l=>{fe.startTransition(()=>i(l))},[i]);return fe.useLayoutEffect(()=>a.listen(o),[a,o]),fe.createElement(qK,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:a})}var fz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ji=fe.forwardRef(function({onClick:t,discover:n="render",prefetch:r="none",relative:a,reloadDocument:s,replace:i,state:o,target:l,to:h,preventScrollReset:c,viewTransition:p,...m},g){let{basename:b}=fe.useContext(so),v=typeof h=="string"&&fz.test(h),x,_=!1;if(typeof h=="string"&&v&&(x=h,pz))try{let O=new URL(window.location.href),z=h.startsWith("//")?new URL(O.protocol+h):new URL(h),M=Wl(z.pathname,b);z.origin===O.origin&&M!=null?h=M+z.search+z.hash:_=!0}catch{Zi(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let I=RK(h,{relative:a}),[k,E,R]=dX(r,m),U=wX(h,{replace:i,state:o,target:l,preventScrollReset:c,relative:a,viewTransition:p});function D(O){t&&t(O),O.defaultPrevented||U(O)}let C=fe.createElement("a",{...m,...R,href:x||I,onClick:_||s?t:D,ref:gX(g,E),target:l,"data-discover":!v&&n==="render"?"true":void 0});return k&&!v?fe.createElement(fe.Fragment,null,C,fe.createElement(pX,{page:I})):C});ji.displayName="Link";var bX=fe.forwardRef(function({"aria-current":t="page",caseSensitive:n=!1,className:r="",end:a=!1,style:s,to:i,viewTransition:o,children:l,...h},c){let p=pv(i,{relative:h.relative}),m=Yl(),g=fe.useContext(U_),{navigator:b,basename:v}=fe.useContext(so),x=g!=null&&kX(p)&&o===!0,_=b.encodeLocation?b.encodeLocation(p).pathname:p.pathname,I=m.pathname,k=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(I=I.toLowerCase(),k=k?k.toLowerCase():null,_=_.toLowerCase()),k&&v&&(k=Wl(k,v)||k);const E=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let R=I===_||!a&&I.startsWith(_)&&I.charAt(E)==="/",U=k!=null&&(k===_||!a&&k.startsWith(_)&&k.charAt(_.length)==="/"),D={isActive:R,isPending:U,isTransitioning:x},C=R?t:void 0,O;typeof r=="function"?O=r(D):O=[r,R?"active":null,U?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let z=typeof s=="function"?s(D):s;return fe.createElement(ji,{...h,"aria-current":C,className:O,ref:c,style:z,to:i,viewTransition:o},typeof l=="function"?l(D):l)});bX.displayName="NavLink";var vX=fe.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:a,state:s,method:i=v0,action:o,onSubmit:l,relative:h,preventScrollReset:c,viewTransition:p,...m},g)=>{let b=IX(),v=TX(o,{relative:h}),x=i.toLowerCase()==="get"?"get":"post",_=typeof o=="string"&&fz.test(o),I=k=>{if(l&&l(k),k.defaultPrevented)return;k.preventDefault();let E=k.nativeEvent.submitter,R=E?.getAttribute("formmethod")||i;b(E||k.currentTarget,{fetcherKey:t,method:R,navigate:n,replace:a,state:s,relative:h,preventScrollReset:c,viewTransition:p})};return fe.createElement("form",{ref:g,method:x,action:v,onSubmit:r?l:I,...m,"data-discover":!_&&e==="render"?"true":void 0})});vX.displayName="Form";function xX(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function mz(e){let t=fe.useContext(Dm);return er(t,xX(e)),t}function wX(e,{target:t,replace:n,state:r,preventScrollReset:a,relative:s,viewTransition:i}={}){let o=B_(),l=Yl(),h=pv(e,{relative:s});return fe.useCallback(c=>{if(JK(c,t)){c.preventDefault();let p=n!==void 0?n:Ob(l)===Ob(h);o(e,{replace:p,state:r,preventScrollReset:a,relative:s,viewTransition:i})}},[l,o,h,n,r,t,e,a,s,i])}var _X=0,SX=()=>`__${String(++_X)}__`;function IX(){let{router:e}=mz("useSubmit"),{basename:t}=fe.useContext(so),n=BK();return fe.useCallback(async(r,a={})=>{let{action:s,method:i,encType:o,formData:l,body:h}=nX(r,t);if(a.navigate===!1){let c=a.fetcherKey||SX();await e.fetch(c,n,a.action||s,{preventScrollReset:a.preventScrollReset,formData:l,body:h,formMethod:a.method||i,formEncType:a.encType||o,flushSync:a.flushSync})}else await e.navigate(a.action||s,{preventScrollReset:a.preventScrollReset,formData:l,body:h,formMethod:a.method||i,formEncType:a.encType||o,replace:a.replace,state:a.state,fromRouteId:n,flushSync:a.flushSync,viewTransition:a.viewTransition})},[e,t,n])}function TX(e,{relative:t}={}){let{basename:n}=fe.useContext(so),r=fe.useContext(Yo);er(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),s={...pv(e||".",{relative:t})},i=Yl();if(e==null){s.search=i.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(c=>c==="")){o.delete("index"),l.filter(p=>p).forEach(p=>o.append("index",p));let c=o.toString();s.search=c?`?${c}`:""}}return(!e||e===".")&&a.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:Fl([n,s.pathname])),Ob(s)}function kX(e,{relative:t}={}){let n=fe.useContext(iz);er(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=mz("useViewTransitionState"),a=pv(e,{relative:t});if(!n.isTransitioning)return!1;let s=Wl(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=Wl(n.nextLocation.pathname,r)||n.nextLocation.pathname;return V0(a.pathname,i)!=null||V0(a.pathname,s)!=null}const EX=()=>{};var RF={};const gz=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let a=e.charCodeAt(r);a<128?t[n++]=a:a<2048?(t[n++]=a>>6|192,t[n++]=a&63|128):(a&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=a>>18|240,t[n++]=a>>12&63|128,t[n++]=a>>6&63|128,t[n++]=a&63|128):(t[n++]=a>>12|224,t[n++]=a>>6&63|128,t[n++]=a&63|128)}return t},NX=function(e){const t=[];let n=0,r=0;for(;n<e.length;){const a=e[n++];if(a<128)t[r++]=String.fromCharCode(a);else if(a>191&&a<224){const s=e[n++];t[r++]=String.fromCharCode((a&31)<<6|s&63)}else if(a>239&&a<365){const s=e[n++],i=e[n++],o=e[n++],l=((a&7)<<18|(s&63)<<12|(i&63)<<6|o&63)-65536;t[r++]=String.fromCharCode(55296+(l>>10)),t[r++]=String.fromCharCode(56320+(l&1023))}else{const s=e[n++],i=e[n++];t[r++]=String.fromCharCode((a&15)<<12|(s&63)<<6|i&63)}}return t.join("")},yz={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<e.length;a+=3){const s=e[a],i=a+1<e.length,o=i?e[a+1]:0,l=a+2<e.length,h=l?e[a+2]:0,c=s>>2,p=(s&3)<<4|o>>4;let m=(o&15)<<2|h>>6,g=h&63;l||(g=64,i||(m=64)),r.push(n[c],n[p],n[m],n[g])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(gz(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):NX(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<e.length;){const s=n[e.charAt(a++)],o=a<e.length?n[e.charAt(a)]:0;++a;const h=a<e.length?n[e.charAt(a)]:64;++a;const p=a<e.length?n[e.charAt(a)]:64;if(++a,s==null||o==null||h==null||p==null)throw new CX;const m=s<<2|o>>4;if(r.push(m),h!==64){const g=o<<4&240|h>>2;if(r.push(g),p!==64){const b=h<<6&192|p;r.push(b)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class CX extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const AX=function(e){const t=gz(e);return yz.encodeByteArray(t,!0)},U0=function(e){return AX(e).replace(/\./g,"")},bz=function(e){try{return yz.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function RX(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const DX=()=>RX().__FIREBASE_DEFAULTS__,MX=()=>{if(typeof process>"u"||typeof RF>"u")return;const e=RF.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},$X=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&bz(e[1]);return t&&JSON.parse(t)},j_=()=>{try{return EX()||DX()||MX()||$X()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},vz=e=>j_()?.emulatorHosts?.[e],xz=e=>{const t=vz(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return t[0]==="["?[t.substring(1,n-1),r]:[t.substring(0,n),r]},wz=()=>j_()?.config,_z=e=>j_()?.[`_${e}`];class OX{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}wrapCallback(t){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(n):t(n,r))}}}function Rc(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function SN(e){return(await fetch(e,{credentials:"include"})).ok}function Sz(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=t||"demo-project",a=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[U0(JSON.stringify(n)),U0(JSON.stringify(i)),""].join(".")}const Sb={};function FX(){const e={prod:[],emulator:[]};for(const t of Object.keys(Sb))Sb[t]?e.emulator.push(t):e.prod.push(t);return e}function PX(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}let DF=!1;function IN(e,t){if(typeof window>"u"||typeof document>"u"||!Rc(window.location.host)||Sb[e]===t||Sb[e]||DF)return;Sb[e]=t;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",s=FX().prod.length>0;function i(){const m=document.getElementById(r);m&&m.remove()}function o(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,g){m.setAttribute("width","24"),m.setAttribute("id",g),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{DF=!0,i()},m}function c(m,g){m.setAttribute("id",g),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=PX(r),g=n("text"),b=document.getElementById(g)||document.createElement("span"),v=n("learnmore"),x=document.getElementById(v)||document.createElement("a"),_=n("preprendIcon"),I=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const k=m.element;o(k),c(x,v);const E=h();l(I,_),k.append(I,b,x,E),document.body.appendChild(k)}s?(b.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Wa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function LX(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wa())}function zX(){const e=j_()?.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function VX(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function UX(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function BX(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function WX(){const e=Wa();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function jX(){return!zX()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function HX(){try{return typeof indexedDB=="object"}catch{return!1}}function GX(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{t(a.error?.message||"")}}catch(n){t(n)}})}const qX="FirebaseError";class Qo extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=qX,Object.setPrototypeOf(this,Qo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fv.prototype.create)}}class fv{constructor(t,n,r){this.service=t,this.serviceName=n,this.errors=r}create(t,...n){const r=n[0]||{},a=`${this.service}/${t}`,s=this.errors[t],i=s?KX(s,r):"Error",o=`${this.serviceName}: ${i} (${a}).`;return new Qo(a,o,r)}}function KX(e,t){return e.replace(XX,(n,r)=>{const a=t[r];return a!=null?String(a):`<${r}?>`})}const XX=/\{\$([^}]+)}/g;function YX(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function qh(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return!1;const s=e[a],i=t[a];if(MF(s)&&MF(i)){if(!qh(s,i))return!1}else if(s!==i)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function MF(e){return e!==null&&typeof e=="object"}function mv(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(a=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ob(e){const t={};return e.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[a,s]=r.split("=");t[decodeURIComponent(a)]=decodeURIComponent(s)}}),t}function lb(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function QX(e,t){const n=new ZX(e,t);return n.subscribe.bind(n)}class ZX{constructor(t,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(n=>{n.next(t)})}error(t){this.forEachObserver(n=>{n.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,n,r){let a;if(t===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");JX(t,["next","error","complete"])?a=t:a={next:t,error:n,complete:r},a.next===void 0&&(a.next=KT),a.error===void 0&&(a.error=KT),a.complete===void 0&&(a.complete=KT);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),s}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,t)}sendOne(t,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{n(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function JX(e,t){if(typeof e!="object"||e===null)return!1;for(const n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}function KT(){}function sr(e){return e&&e._delegate?e._delegate:e}class oc{constructor(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Eh="[DEFAULT]";class eY{constructor(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){const r=new OX;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(t){const n=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(nY(t))try{this.getOrInitializeService({instanceIdentifier:Eh})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:a});r.resolve(s)}catch{}}}}clearInstance(t=Eh){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Eh){return this.instances.has(t)}getOptions(t=Eh){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:n={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,i]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);r===o&&i.resolve(a)}return a}onInit(t,n){const r=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(r)??new Set;a.add(t),this.onInitCallbacks.set(r,a);const s=this.instances.get(r);return s&&t(s,r),()=>{a.delete(t)}}invokeOnInitCallbacks(t,n){const r=this.onInitCallbacks.get(n);if(r)for(const a of r)try{a(t,n)}catch{}}getOrInitializeService({instanceIdentifier:t,options:n={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:tY(t),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Eh){return this.component?this.component.multipleInstances?t:Eh:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tY(e){return e===Eh?void 0:e}function nY(e){return e.instantiationMode==="EAGER"}class rY{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const n=this.getProvider(t.name);if(n.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);n.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const n=new eY(t,this);return this.providers.set(t,n),n}getProviders(){return Array.from(this.providers.values())}}var Ht;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Ht||(Ht={}));const aY={debug:Ht.DEBUG,verbose:Ht.VERBOSE,info:Ht.INFO,warn:Ht.WARN,error:Ht.ERROR,silent:Ht.SILENT},sY=Ht.INFO,iY={[Ht.DEBUG]:"log",[Ht.VERBOSE]:"log",[Ht.INFO]:"info",[Ht.WARN]:"warn",[Ht.ERROR]:"error"},oY=(e,t,...n)=>{if(t<e.logLevel)return;const r=new Date().toISOString(),a=iY[t];if(a)console[a](`[${r}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class TN{constructor(t){this.name=t,this._logLevel=sY,this._logHandler=oY,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Ht))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?aY[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Ht.DEBUG,...t),this._logHandler(this,Ht.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Ht.VERBOSE,...t),this._logHandler(this,Ht.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Ht.INFO,...t),this._logHandler(this,Ht.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Ht.WARN,...t),this._logHandler(this,Ht.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Ht.ERROR,...t),this._logHandler(this,Ht.ERROR,...t)}}const lY=(e,t)=>t.some(n=>e instanceof n);let $F,OF;function uY(){return $F||($F=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cY(){return OF||(OF=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Iz=new WeakMap,Dk=new WeakMap,Tz=new WeakMap,XT=new WeakMap,kN=new WeakMap;function hY(e){const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(ec(e.result)),a()},i=()=>{r(e.error),a()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(n=>{n instanceof IDBCursor&&Iz.set(n,e)}).catch(()=>{}),kN.set(t,e),t}function dY(e){if(Dk.has(e))return;const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),a()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});Dk.set(e,t)}let Mk={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Dk.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Tz.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ec(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function pY(e){Mk=e(Mk)}function fY(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(YT(this),t,...n);return Tz.set(r,t.sort?t.sort():[t]),ec(r)}:cY().includes(e)?function(...t){return e.apply(YT(this),t),ec(Iz.get(this))}:function(...t){return ec(e.apply(YT(this),t))}}function mY(e){return typeof e=="function"?fY(e):(e instanceof IDBTransaction&&dY(e),lY(e,uY())?new Proxy(e,Mk):e)}function ec(e){if(e instanceof IDBRequest)return hY(e);if(XT.has(e))return XT.get(e);const t=mY(e);return t!==e&&(XT.set(e,t),kN.set(t,e)),t}const YT=e=>kN.get(e);function gY(e,t,{blocked:n,upgrade:r,blocking:a,terminated:s}={}){const i=indexedDB.open(e,t),o=ec(i);return r&&i.addEventListener("upgradeneeded",l=>{r(ec(i.result),l.oldVersion,l.newVersion,ec(i.transaction),l)}),n&&i.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),a&&l.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),o}const yY=["get","getKey","getAll","getAllKeys","count"],bY=["put","add","delete","clear"],QT=new Map;function FF(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(QT.get(t))return QT.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,a=bY.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||yY.includes(n)))return;const s=async function(i,...o){const l=this.transaction(i,a?"readwrite":"readonly");let h=l.store;return r&&(h=h.index(o.shift())),(await Promise.all([h[n](...o),a&&l.done]))[0]};return QT.set(t,s),s}pY(e=>({...e,get:(t,n,r)=>FF(t,n)||e.get(t,n,r),has:(t,n)=>!!FF(t,n)||e.has(t,n)}));class vY{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(xY(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function xY(e){return e.getComponent()?.type==="VERSION"}const $k="@firebase/app",PF="0.14.5";const jl=new TN("@firebase/app"),wY="@firebase/app-compat",_Y="@firebase/analytics-compat",SY="@firebase/analytics",IY="@firebase/app-check-compat",TY="@firebase/app-check",kY="@firebase/auth",EY="@firebase/auth-compat",NY="@firebase/database",CY="@firebase/data-connect",AY="@firebase/database-compat",RY="@firebase/functions",DY="@firebase/functions-compat",MY="@firebase/installations",$Y="@firebase/installations-compat",OY="@firebase/messaging",FY="@firebase/messaging-compat",PY="@firebase/performance",LY="@firebase/performance-compat",zY="@firebase/remote-config",VY="@firebase/remote-config-compat",UY="@firebase/storage",BY="@firebase/storage-compat",WY="@firebase/firestore",jY="@firebase/ai",HY="@firebase/firestore-compat",GY="firebase",qY="12.5.0";const Ok="[DEFAULT]",KY={[$k]:"fire-core",[wY]:"fire-core-compat",[SY]:"fire-analytics",[_Y]:"fire-analytics-compat",[TY]:"fire-app-check",[IY]:"fire-app-check-compat",[kY]:"fire-auth",[EY]:"fire-auth-compat",[NY]:"fire-rtdb",[CY]:"fire-data-connect",[AY]:"fire-rtdb-compat",[RY]:"fire-fn",[DY]:"fire-fn-compat",[MY]:"fire-iid",[$Y]:"fire-iid-compat",[OY]:"fire-fcm",[FY]:"fire-fcm-compat",[PY]:"fire-perf",[LY]:"fire-perf-compat",[zY]:"fire-rc",[VY]:"fire-rc-compat",[UY]:"fire-gcs",[BY]:"fire-gcs-compat",[WY]:"fire-fst",[HY]:"fire-fst-compat",[jY]:"fire-vertex","fire-js":"fire-js",[GY]:"fire-js-all"};const B0=new Map,XY=new Map,Fk=new Map;function LF(e,t){try{e.container.addComponent(t)}catch(n){jl.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Kh(e){const t=e.name;if(Fk.has(t))return jl.debug(`There were multiple attempts to register component ${t}.`),!1;Fk.set(t,e);for(const n of B0.values())LF(n,e);for(const n of XY.values())LF(n,e);return!0}function H_(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ns(e){return e==null?!1:e.settings!==void 0}const YY={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},tc=new fv("app","Firebase",YY);class QY{constructor(t,n,r){this._isDeleted=!1,this._options={...t},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new oc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw tc.create("app-deleted",{appName:this._name})}}const wd=qY;function kz(e,t={}){let n=e;typeof t!="object"&&(t={name:t});const r={name:Ok,automaticDataCollectionEnabled:!0,...t},a=r.name;if(typeof a!="string"||!a)throw tc.create("bad-app-name",{appName:String(a)});if(n||(n=wz()),!n)throw tc.create("no-options");const s=B0.get(a);if(s){if(qh(n,s.options)&&qh(r,s.config))return s;throw tc.create("duplicate-app",{appName:a})}const i=new rY(a);for(const l of Fk.values())i.addComponent(l);const o=new QY(n,r,i);return B0.set(a,o),o}function EN(e=Ok){const t=B0.get(e);if(!t&&e===Ok&&wz())return kz();if(!t)throw tc.create("no-app",{appName:e});return t}function Oo(e,t,n){let r=KY[e]??e;n&&(r+=`-${n}`);const a=r.match(/\s|\//),s=t.match(/\s|\//);if(a||s){const i=[`Unable to register library "${r}" with version "${t}":`];a&&i.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&s&&i.push("and"),s&&i.push(`version name "${t}" contains illegal characters (whitespace or "/")`),jl.warn(i.join(" "));return}Kh(new oc(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const ZY="firebase-heartbeat-database",JY=1,Fb="firebase-heartbeat-store";let ZT=null;function Ez(){return ZT||(ZT=gY(ZY,JY,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Fb)}catch(n){console.warn(n)}}}}).catch(e=>{throw tc.create("idb-open",{originalErrorMessage:e.message})})),ZT}async function eQ(e){try{const n=(await Ez()).transaction(Fb),r=await n.objectStore(Fb).get(Nz(e));return await n.done,r}catch(t){if(t instanceof Qo)jl.warn(t.message);else{const n=tc.create("idb-get",{originalErrorMessage:t?.message});jl.warn(n.message)}}}async function zF(e,t){try{const r=(await Ez()).transaction(Fb,"readwrite");await r.objectStore(Fb).put(t,Nz(e)),await r.done}catch(n){if(n instanceof Qo)jl.warn(n.message);else{const r=tc.create("idb-set",{originalErrorMessage:n?.message});jl.warn(r.message)}}}function Nz(e){return`${e.name}!${e.options.appId}`}const tQ=1024,nQ=30;class rQ{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new sQ(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=VF();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>nQ){const a=iQ(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){jl.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=VF(),{heartbeatsToSend:n,unsentEntries:r}=aQ(this._heartbeatsCache.heartbeats),a=U0(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return jl.warn(t),""}}}function VF(){return new Date().toISOString().substring(0,10)}function aQ(e,t=tQ){const n=[];let r=e.slice();for(const a of e){const s=n.find(i=>i.agent===a.agent);if(s){if(s.dates.push(a.date),UF(n)>t){s.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),UF(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class sQ{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return HX()?GX().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await eQ(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return zF(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return zF(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function UF(e){return U0(JSON.stringify({version:2,heartbeats:e})).length}function iQ(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}function oQ(e){Kh(new oc("platform-logger",t=>new vY(t),"PRIVATE")),Kh(new oc("heartbeat",t=>new rQ(t),"PRIVATE")),Oo($k,PF,e),Oo($k,PF,"esm2020"),Oo("fire-js","")}oQ("");function Cz(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const lQ=Cz,Az=new fv("auth","Firebase",Cz());const W0=new TN("@firebase/auth");function uQ(e,...t){W0.logLevel<=Ht.WARN&&W0.warn(`Auth (${wd}): ${e}`,...t)}function w0(e,...t){W0.logLevel<=Ht.ERROR&&W0.error(`Auth (${wd}): ${e}`,...t)}function ki(e,...t){throw CN(e,...t)}function qi(e,...t){return CN(e,...t)}function NN(e,t,n){const r={...lQ(),[t]:n};return new fv("auth","Firebase",r).create(t,{appName:e.name})}function Pl(e){return NN(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cQ(e,t,n){const r=n;if(!(t instanceof r))throw r.name!==t.constructor.name&&ki(e,"argument-error"),NN(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function CN(e,...t){if(typeof e!="string"){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Az.create(e,...t)}function gt(e,t,...n){if(!e)throw CN(t,...n)}function $l(e){const t="INTERNAL ASSERTION FAILED: "+e;throw w0(t),new Error(t)}function Hl(e,t){e||$l(t)}function Pk(){return typeof self<"u"&&self.location?.href||""}function hQ(){return BF()==="http:"||BF()==="https:"}function BF(){return typeof self<"u"&&self.location?.protocol||null}function dQ(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hQ()||UX()||"connection"in navigator)?navigator.onLine:!0}function pQ(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}class gv{constructor(t,n){this.shortDelay=t,this.longDelay=n,Hl(n>t,"Short delay should be less than long delay!"),this.isMobile=LX()||BX()}get(){return dQ()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function AN(e,t){Hl(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Rz{static initialize(t,n,r){this.fetchImpl=t,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$l("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$l("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$l("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const fQ={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const mQ=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],gQ=new gv(3e4,6e4);function Dc(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function Mc(e,t,n,r,a={}){return Dz(e,a,async()=>{let s={},i={};r&&(t==="GET"?i=r:s={body:JSON.stringify(r)});const o=mv({key:e.config.apiKey,...i}).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const h={method:t,headers:l,...s};return VX()||(h.referrerPolicy="no-referrer"),e.emulatorConfig&&Rc(e.emulatorConfig.host)&&(h.credentials="include"),Rz.fetch()(await Mz(e,e.config.apiHost,n,o),h)})}async function Dz(e,t,n){e._canInitEmulator=!1;const r={...fQ,...t};try{const a=new bQ(e),s=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Kw(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const o=s.ok?i.errorMessage:i.error.message,[l,h]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Kw(e,"credential-already-in-use",i);if(l==="EMAIL_EXISTS")throw Kw(e,"email-already-in-use",i);if(l==="USER_DISABLED")throw Kw(e,"user-disabled",i);const c=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw NN(e,c,h);ki(e,c)}}catch(a){if(a instanceof Qo)throw a;ki(e,"network-request-failed",{message:String(a)})}}async function yv(e,t,n,r,a={}){const s=await Mc(e,t,n,r,a);return"mfaPendingCredential"in s&&ki(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function Mz(e,t,n,r){const a=`${t}${n}?${r}`,s=e,i=s.config.emulator?AN(e.config,a):`${e.config.apiScheme}://${a}`;return mQ.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(i).toString():i}function yQ(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bQ{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(qi(this.auth,"network-request-failed")),gQ.get())})}}function Kw(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=qi(e,t,r);return a.customData._tokenResponse=n,a}function WF(e){return e!==void 0&&e.enterprise!==void 0}class vQ{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===t)return yQ(n.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function xQ(e,t){return Mc(e,"GET","/v2/recaptchaConfig",Dc(e,t))}async function wQ(e,t){return Mc(e,"POST","/v1/accounts:delete",t)}async function j0(e,t){return Mc(e,"POST","/v1/accounts:lookup",t)}function Ib(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function _Q(e,t=!1){const n=sr(e),r=await n.getIdToken(t),a=RN(r);gt(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const s=typeof a.firebase=="object"?a.firebase:void 0,i=s?.sign_in_provider;return{claims:a,token:r,authTime:Ib(JT(a.auth_time)),issuedAtTime:Ib(JT(a.iat)),expirationTime:Ib(JT(a.exp)),signInProvider:i||null,signInSecondFactor:s?.sign_in_second_factor||null}}function JT(e){return Number(e)*1e3}function RN(e){const[t,n,r]=e.split(".");if(t===void 0||n===void 0||r===void 0)return w0("JWT malformed, contained fewer than 3 sections"),null;try{const a=bz(n);return a?JSON.parse(a):(w0("Failed to decode base64 JWT payload"),null)}catch(a){return w0("Caught error parsing JWT payload as JSON",a?.toString()),null}}function jF(e){const t=RN(e);return gt(t,"internal-error"),gt(typeof t.exp<"u","internal-error"),gt(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}async function Pb(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof Qo&&SQ(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}function SQ({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}class IQ{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(t=!1){if(!this.isRunning)return;const n=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Lk{constructor(t,n){this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ib(this.lastLoginAt),this.creationTime=Ib(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function H0(e){const t=e.auth,n=await e.getIdToken(),r=await Pb(e,j0(t,{idToken:n}));gt(r?.users.length,t,"internal-error");const a=r.users[0];e._notifyReloadListener(a);const s=a.providerUserInfo?.length?$z(a.providerUserInfo):[],i=kQ(e.providerData,s),o=e.isAnonymous,l=!(e.email&&a.passwordHash)&&!i?.length,h=o?l:!1,c={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new Lk(a.createdAt,a.lastLoginAt),isAnonymous:h};Object.assign(e,c)}async function TQ(e){const t=sr(e);await H0(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function kQ(e,t){return[...e.filter(r=>!t.some(a=>a.providerId===r.providerId)),...t]}function $z(e){return e.map(({providerId:t,...n})=>({providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function EQ(e,t){const n=await Dz(e,{},async()=>{const r=mv({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:a,apiKey:s}=e.config,i=await Mz(e,a,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:r};return e.emulatorConfig&&Rc(e.emulatorConfig.host)&&(l.credentials="include"),Rz.fetch()(i,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function NQ(e,t){return Mc(e,"POST","/v2/accounts:revokeToken",Dc(e,t))}class Zf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){gt(t.idToken,"internal-error"),gt(typeof t.idToken<"u","internal-error"),gt(typeof t.refreshToken<"u","internal-error");const n="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):jF(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,n)}updateFromIdToken(t){gt(t.length!==0,"internal-error");const n=jF(t);this.updateTokensAndExpiration(t,null,n)}async getToken(t,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(gt(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,n){const{accessToken:r,refreshToken:a,expiresIn:s}=await EQ(t,n);this.updateTokensAndExpiration(r,a,Number(s))}updateTokensAndExpiration(t,n,r){this.refreshToken=n||null,this.accessToken=t||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(t,n){const{refreshToken:r,accessToken:a,expirationTime:s}=n,i=new Zf;return r&&(gt(typeof r=="string","internal-error",{appName:t}),i.refreshToken=r),a&&(gt(typeof a=="string","internal-error",{appName:t}),i.accessToken=a),s&&(gt(typeof s=="number","internal-error",{appName:t}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Zf,this.toJSON())}_performRefresh(){return $l("not implemented")}}function Fu(e,t){gt(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Gi{constructor({uid:t,auth:n,stsTokenManager:r,...a}){this.providerId="firebase",this.proactiveRefresh=new IQ(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Lk(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(t){const n=await Pb(this,this.stsTokenManager.getToken(this.auth,t));return gt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(t){return _Q(this,t)}reload(){return TQ(this)}_assign(t){this!==t&&(gt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(n=>({...n})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const n=new Gi({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(t){gt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,n=!1){let r=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),n&&await H0(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ns(this.auth.app))return Promise.reject(Pl(this.auth));const t=await this.getIdToken();return await Pb(this,wQ(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,n){const r=n.displayName??void 0,a=n.email??void 0,s=n.phoneNumber??void 0,i=n.photoURL??void 0,o=n.tenantId??void 0,l=n._redirectEventId??void 0,h=n.createdAt??void 0,c=n.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:g,providerData:b,stsTokenManager:v}=n;gt(p&&v,t,"internal-error");const x=Zf.fromJSON(this.name,v);gt(typeof p=="string",t,"internal-error"),Fu(r,t.name),Fu(a,t.name),gt(typeof m=="boolean",t,"internal-error"),gt(typeof g=="boolean",t,"internal-error"),Fu(s,t.name),Fu(i,t.name),Fu(o,t.name),Fu(l,t.name),Fu(h,t.name),Fu(c,t.name);const _=new Gi({uid:p,auth:t,email:a,emailVerified:m,displayName:r,isAnonymous:g,photoURL:i,phoneNumber:s,tenantId:o,stsTokenManager:x,createdAt:h,lastLoginAt:c});return b&&Array.isArray(b)&&(_.providerData=b.map(I=>({...I}))),l&&(_._redirectEventId=l),_}static async _fromIdTokenResponse(t,n,r=!1){const a=new Zf;a.updateFromServerResponse(n);const s=new Gi({uid:n.localId,auth:t,stsTokenManager:a,isAnonymous:r});return await H0(s),s}static async _fromGetAccountInfoResponse(t,n,r){const a=n.users[0];gt(a.localId!==void 0,"internal-error");const s=a.providerUserInfo!==void 0?$z(a.providerUserInfo):[],i=!(a.email&&a.passwordHash)&&!s?.length,o=new Zf;o.updateFromIdToken(r);const l=new Gi({uid:a.localId,auth:t,stsTokenManager:o,isAnonymous:i}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:s,metadata:new Lk(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!s?.length};return Object.assign(l,h),l}}const HF=new Map;function Ol(e){Hl(e instanceof Function,"Expected a class definition");let t=HF.get(e);return t?(Hl(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,HF.set(e,t),t)}class Oz{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,n){this.storage[t]=n}async _get(t){const n=this.storage[t];return n===void 0?null:n}async _remove(t){delete this.storage[t]}_addListener(t,n){}_removeListener(t,n){}}Oz.type="NONE";const GF=Oz;function _0(e,t,n){return`firebase:${e}:${t}:${n}`}class Jf{constructor(t,n,r){this.persistence=t,this.auth=n,this.userKey=r;const{config:a,name:s}=this.auth;this.fullUserKey=_0(this.userKey,a.apiKey,s),this.fullPersistenceKey=_0("persistence",a.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const n=await j0(this.auth,{idToken:t}).catch(()=>{});return n?Gi._fromGetAccountInfoResponse(this.auth,n,t):null}return Gi._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,r="authUser"){if(!n.length)return new Jf(Ol(GF),t,r);const a=(await Promise.all(n.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=a[0]||Ol(GF);const i=_0(r,t.config.apiKey,t.name);let o=null;for(const h of n)try{const c=await h._get(i);if(c){let p;if(typeof c=="string"){const m=await j0(t,{idToken:c}).catch(()=>{});if(!m)break;p=await Gi._fromGetAccountInfoResponse(t,m,c)}else p=Gi._fromJSON(t,c);h!==s&&(o=p),s=h;break}}catch{}const l=a.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new Jf(s,t,r):(s=l[0],o&&await s._set(i,o.toJSON()),await Promise.all(n.map(async h=>{if(h!==s)try{await h._remove(i)}catch{}})),new Jf(s,t,r))}}function qF(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(zz(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Fz(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Uz(t))return"Blackberry";if(Bz(t))return"Webos";if(Pz(t))return"Safari";if((t.includes("chrome/")||Lz(t))&&!t.includes("edge/"))return"Chrome";if(Vz(t))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(n);if(r?.length===2)return r[1]}return"Other"}function Fz(e=Wa()){return/firefox\//i.test(e)}function Pz(e=Wa()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Lz(e=Wa()){return/crios\//i.test(e)}function zz(e=Wa()){return/iemobile/i.test(e)}function Vz(e=Wa()){return/android/i.test(e)}function Uz(e=Wa()){return/blackberry/i.test(e)}function Bz(e=Wa()){return/webos/i.test(e)}function DN(e=Wa()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function CQ(e=Wa()){return DN(e)&&!!window.navigator?.standalone}function AQ(){return WX()&&document.documentMode===10}function Wz(e=Wa()){return DN(e)||Vz(e)||Bz(e)||Uz(e)||/windows phone/i.test(e)||zz(e)}function jz(e,t=[]){let n;switch(e){case"Browser":n=qF(Wa());break;case"Worker":n=`${qF(Wa())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${wd}/${r}`}class RQ{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,n){const r=s=>new Promise((i,o)=>{try{const l=t(s);i(l)}catch(l){o(l)}});r.onAbort=n,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const n=[];try{for(const r of this.queue)await r(t),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function DQ(e,t={}){return Mc(e,"GET","/v2/passwordPolicy",Dc(e,t))}const MQ=6;class $Q{constructor(t){const n=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??MQ,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,n),this.validatePasswordCharacterOptions(t,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(t,n){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=t.length>=r),a&&(n.meetsMaxPasswordLength=t.length<=a)}validatePasswordCharacterOptions(t,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let a=0;a<t.length;a++)r=t.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(t,n,r,a,s){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s))}}class OQ{constructor(t,n,r,a){this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KF(this),this.idTokenSubscription=new KF(this),this.beforeStateQueue=new RQ(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Az,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ol(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Jf.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const n=await j0(this,{idToken:t}),r=await Gi._fromGetAccountInfoResponse(this,n,t);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(Ns(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(i=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(i,i))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,i=r?._redirectEventId,o=await this.tryRedirectSignIn(t);(!s||s===i)&&o?.user&&(r=o.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return gt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(t){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(t){try{await H0(t)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=pQ()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ns(this.app))return Promise.reject(Pl(this));const n=t?sr(t):null;return n&&gt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(t,n=!1){if(!this._deleted)return t&&gt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ns(this.app)?Promise.reject(Pl(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ns(this.app)?Promise.reject(Pl(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ol(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await DQ(this),n=new $Q(t);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new fv("auth","Firebase",t())}onAuthStateChanged(t,n,r){return this.registerStateListener(this.authStateSubscription,t,n,r)}beforeAuthStateChanged(t,n){return this.beforeStateQueue.pushCallback(t,n)}onIdTokenChanged(t,n,r){return this.registerStateListener(this.idTokenSubscription,t,n,r)}authStateReady(){return new Promise((t,n)=>{if(this.currentUser)t();else{const r=this.onAuthStateChanged(()=>{r(),t()},n)}})}async revokeAccessToken(t){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await NQ(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,n){const r=await this.getOrInitRedirectPersistenceManager(n);return t===null?r.removeCurrentUser():r.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const n=t&&Ol(t)||this._popupRedirectResolver;gt(n,this,"argument-error"),this.redirectPersistenceManager=await Jf.create(this,[Ol(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,n,r,a){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(gt(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),typeof n=="function"){const l=t.addObserver(n,r,a);return()=>{i=!0,l()}}else{const l=t.addObserver(n);return()=>{i=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return gt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=jz(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){if(Ns(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&uQ(`Error while retrieving App Check token: ${t.error}`),t?.token}}function $c(e){return sr(e)}class KF{constructor(t){this.auth=t,this.observer=null,this.addObserver=QX(n=>this.observer=n)}get next(){return gt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let G_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function FQ(e){G_=e}function Hz(e){return G_.loadJS(e)}function PQ(){return G_.recaptchaEnterpriseScript}function LQ(){return G_.gapiScript}function zQ(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class VQ{constructor(){this.enterprise=new UQ}ready(t){t()}execute(t,n){return Promise.resolve("token")}render(t,n){return""}}class UQ{ready(t){t()}execute(t,n){return Promise.resolve("token")}render(t,n){return""}}const BQ="recaptcha-enterprise",Gz="NO_RECAPTCHA";class WQ{constructor(t){this.type=BQ,this.auth=$c(t)}async verify(t="verify",n=!1){async function r(s){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(i,o)=>{xQ(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const h=new vQ(l);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,i(h.siteKey)}}).catch(l=>{o(l)})})}function a(s,i,o){const l=window.grecaptcha;WF(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:t}).then(h=>{i(h)}).catch(()=>{i(Gz)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new VQ().execute("siteKey",{action:"verify"}):new Promise((s,i)=>{r(this.auth).then(o=>{if(!n&&WF(window.grecaptcha))a(o,s,i);else{if(typeof window>"u"){i(new Error("RecaptchaVerifier is only supported in browser"));return}let l=PQ();l.length!==0&&(l+=o),Hz(l).then(()=>{a(o,s,i)}).catch(h=>{i(h)})}}).catch(o=>{i(o)})})}}async function XF(e,t,n,r=!1,a=!1){const s=new WQ(e);let i;if(a)i=Gz;else try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const o={...t};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,h=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:h,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function zk(e,t,n,r,a){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await XF(e,t,n,n==="getOobCode");return r(e,s)}else return r(e,t).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await XF(e,t,n,n==="getOobCode");return r(e,i)}else return Promise.reject(s)})}function jQ(e,t){const n=H_(e,"auth");if(n.isInitialized()){const a=n.getImmediate(),s=n.getOptions();if(qh(s,t??{}))return a;ki(a,"already-initialized")}return n.initialize({options:t})}function HQ(e,t){const n=t?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Ol);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t?.popupRedirectResolver)}function GQ(e,t,n){const r=$c(e);gt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const a=!1,s=qz(t),{host:i,port:o}=qQ(t),l=o===null?"":`:${o}`,h={url:`${s}//${i}${l}/`},c=Object.freeze({host:i,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){gt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),gt(qh(h,r.config.emulator)&&qh(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Rc(i)?(SN(`${s}//${i}${l}`),IN("Auth",!0)):KQ()}function qz(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function qQ(e){const t=qz(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const s=a[1];return{host:s,port:YF(r.substr(s.length+1))}}else{const[s,i]=r.split(":");return{host:s,port:YF(i)}}}function YF(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function KQ(){function e(){const t=document.createElement("p"),n=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}class MN{constructor(t,n){this.providerId=t,this.signInMethod=n}toJSON(){return $l("not implemented")}_getIdTokenResponse(t){return $l("not implemented")}_linkToIdToken(t,n){return $l("not implemented")}_getReauthenticationResolver(t){return $l("not implemented")}}async function XQ(e,t){return Mc(e,"POST","/v1/accounts:signUp",t)}async function YQ(e,t){return yv(e,"POST","/v1/accounts:signInWithPassword",Dc(e,t))}async function QQ(e,t){return yv(e,"POST","/v1/accounts:signInWithEmailLink",Dc(e,t))}async function ZQ(e,t){return yv(e,"POST","/v1/accounts:signInWithEmailLink",Dc(e,t))}class Lb extends MN{constructor(t,n,r,a=null){super("password",r),this._email=t,this._password=n,this._tenantId=a}static _fromEmailAndPassword(t,n){return new Lb(t,n,"password")}static _fromEmailAndCode(t,n,r=null){return new Lb(t,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const n=typeof t=="string"?JSON.parse(t):t;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zk(t,n,"signInWithPassword",YQ);case"emailLink":return QQ(t,{email:this._email,oobCode:this._password});default:ki(t,"internal-error")}}async _linkToIdToken(t,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zk(t,r,"signUpPassword",XQ);case"emailLink":return ZQ(t,{idToken:n,email:this._email,oobCode:this._password});default:ki(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function em(e,t){return yv(e,"POST","/v1/accounts:signInWithIdp",Dc(e,t))}const JQ="http://localhost";class Xh extends MN{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const n=new Xh(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(n.idToken=t.idToken),t.accessToken&&(n.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(n.nonce=t.nonce),t.pendingToken&&(n.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(n.accessToken=t.oauthToken,n.secret=t.oauthTokenSecret):ki("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const n=typeof t=="string"?JSON.parse(t):t,{providerId:r,signInMethod:a,...s}=n;if(!r||!a)return null;const i=new Xh(r,a);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(t){const n=this.buildRequest();return em(t,n)}_linkToIdToken(t,n){const r=this.buildRequest();return r.idToken=n,em(t,r)}_getReauthenticationResolver(t){const n=this.buildRequest();return n.autoCreate=!1,em(t,n)}buildRequest(){const t={requestUri:JQ,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),t.postBody=mv(n)}return t}}function eZ(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tZ(e){const t=ob(lb(e)).link,n=t?ob(lb(t)).deep_link_id:null,r=ob(lb(e)).deep_link_id;return(r?ob(lb(r)).link:null)||r||n||t||e}class $N{constructor(t){const n=ob(lb(t)),r=n.apiKey??null,a=n.oobCode??null,s=eZ(n.mode??null);gt(r&&a&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(t){const n=tZ(t);try{return new $N(n)}catch{return null}}}class $m{constructor(){this.providerId=$m.PROVIDER_ID}static credential(t,n){return Lb._fromEmailAndPassword(t,n)}static credentialWithLink(t,n){const r=$N.parseLink(n);return gt(r,"argument-error"),Lb._fromEmailAndCode(t,r.code,r.tenantId)}}$m.PROVIDER_ID="password";$m.EMAIL_PASSWORD_SIGN_IN_METHOD="password";$m.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ON{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class bv extends ON{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class ju extends bv{constructor(){super("facebook.com")}static credential(t){return Xh._fromParams({providerId:ju.PROVIDER_ID,signInMethod:ju.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ju.credentialFromTaggedObject(t)}static credentialFromError(t){return ju.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ju.credential(t.oauthAccessToken)}catch{return null}}}ju.FACEBOOK_SIGN_IN_METHOD="facebook.com";ju.PROVIDER_ID="facebook.com";class Dl extends bv{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Xh._fromParams({providerId:Dl.PROVIDER_ID,signInMethod:Dl.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return Dl.credentialFromTaggedObject(t)}static credentialFromError(t){return Dl.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return Dl.credential(n,r)}catch{return null}}}Dl.GOOGLE_SIGN_IN_METHOD="google.com";Dl.PROVIDER_ID="google.com";class Hu extends bv{constructor(){super("github.com")}static credential(t){return Xh._fromParams({providerId:Hu.PROVIDER_ID,signInMethod:Hu.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Hu.credentialFromTaggedObject(t)}static credentialFromError(t){return Hu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Hu.credential(t.oauthAccessToken)}catch{return null}}}Hu.GITHUB_SIGN_IN_METHOD="github.com";Hu.PROVIDER_ID="github.com";class Gu extends bv{constructor(){super("twitter.com")}static credential(t,n){return Xh._fromParams({providerId:Gu.PROVIDER_ID,signInMethod:Gu.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return Gu.credentialFromTaggedObject(t)}static credentialFromError(t){return Gu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return Gu.credential(n,r)}catch{return null}}}Gu.TWITTER_SIGN_IN_METHOD="twitter.com";Gu.PROVIDER_ID="twitter.com";async function nZ(e,t){return yv(e,"POST","/v1/accounts:signUp",Dc(e,t))}class Yh{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,n,r,a=!1){const s=await Gi._fromIdTokenResponse(t,r,a),i=QF(r);return new Yh({user:s,providerId:i,_tokenResponse:r,operationType:n})}static async _forOperation(t,n,r){await t._updateTokensIfNecessary(r,!0);const a=QF(r);return new Yh({user:t,providerId:a,_tokenResponse:r,operationType:n})}}function QF(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class G0 extends Qo{constructor(t,n,r,a){super(n.code,n.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,G0.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,n,r,a){return new G0(t,n,r,a)}}function Kz(e,t,n,r){return(t==="reauthenticate"?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?G0._fromErrorAndOperation(e,s,t,r):s})}async function rZ(e,t,n=!1){const r=await Pb(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Yh._forOperation(e,"link",r)}async function aZ(e,t,n=!1){const{auth:r}=e;if(Ns(r.app))return Promise.reject(Pl(r));const a="reauthenticate";try{const s=await Pb(e,Kz(r,a,t,e),n);gt(s.idToken,r,"internal-error");const i=RN(s.idToken);gt(i,r,"internal-error");const{sub:o}=i;return gt(e.uid===o,r,"user-mismatch"),Yh._forOperation(e,a,s)}catch(s){throw s?.code==="auth/user-not-found"&&ki(r,"user-mismatch"),s}}async function Xz(e,t,n=!1){if(Ns(e.app))return Promise.reject(Pl(e));const r="signIn",a=await Kz(e,r,t),s=await Yh._fromIdTokenResponse(e,r,a);return n||await e._updateCurrentUser(s.user),s}async function sZ(e,t){return Xz($c(e),t)}async function Yz(e){const t=$c(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function iZ(e,t,n){if(Ns(e.app))return Promise.reject(Pl(e));const r=$c(e),i=await zk(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nZ).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Yz(e),l}),o=await Yh._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(o.user),o}function oZ(e,t,n){return Ns(e.app)?Promise.reject(Pl(e)):sZ(sr(e),$m.credential(t,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Yz(e),r})}function lZ(e,t,n,r){return sr(e).onIdTokenChanged(t,n,r)}function uZ(e,t,n){return sr(e).beforeAuthStateChanged(t,n)}function cZ(e,t,n,r){return sr(e).onAuthStateChanged(t,n,r)}function hZ(e){return sr(e).signOut()}const q0="__sak";class Qz{constructor(t,n){this.storageRetriever=t,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(q0,"1"),this.storage.removeItem(q0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,n){return this.storage.setItem(t,JSON.stringify(n)),Promise.resolve()}_get(t){const n=this.storage.getItem(t);return Promise.resolve(n?JSON.parse(n):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}const dZ=1e3,pZ=10;class Zz extends Qz{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,n)=>this.onStorageEvent(t,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Wz(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),a=this.localCache[n];r!==a&&t(n,a,r)}}onStorageEvent(t,n=!1){if(!t.key){this.forAllChangedKeys((i,o,l)=>{this.notifyListeners(i,l)});return}const r=t.key;n?this.detachListener():this.stopPolling();const a=()=>{const i=this.storage.getItem(r);!n&&this.localCache[r]===i||this.notifyListeners(r,i)},s=this.storage.getItem(r);AQ()&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(a,pZ):a()}notifyListeners(t,n){this.localCache[t]=n;const r=this.listeners[t];if(r)for(const a of Array.from(r))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:r}),!0)})},dZ)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,n){await super._set(t,n),this.localCache[t]=JSON.stringify(n)}async _get(t){const n=await super._get(t);return this.localCache[t]=JSON.stringify(n),n}async _remove(t){await super._remove(t),delete this.localCache[t]}}Zz.type="LOCAL";const fZ=Zz;class Jz extends Qz{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,n){}_removeListener(t,n){}}Jz.type="SESSION";const e4=Jz;function mZ(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(n){return{fulfilled:!1,reason:n}}}))}class q_{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(a=>a.isListeningto(t));if(n)return n;const r=new q_(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const n=t,{eventId:r,eventType:a,data:s}=n.data,i=this.handlersMap[a];if(!i?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const o=Array.from(i).map(async h=>h(n.origin,s)),l=await mZ(o);n.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:l})}_subscribe(t,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(n)}_unsubscribe(t,n){this.handlersMap[t]&&n&&this.handlersMap[t].delete(n),(!n||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}q_.receivers=[];function FN(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(Math.random()*10);return e+n}class gZ{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,n,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let s,i;return new Promise((o,l)=>{const h=FN("",20);a.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},r);i={messageChannel:a,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(m.data.response);break;default:clearTimeout(c),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(i),a.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:t,eventId:h,data:n},[a.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Fo(){return window}function yZ(e){Fo().location.href=e}function t4(){return typeof Fo().WorkerGlobalScope<"u"&&typeof Fo().importScripts=="function"}async function bZ(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function vZ(){return navigator?.serviceWorker?.controller||null}function xZ(){return t4()?self:null}const n4="firebaseLocalStorageDb",wZ=1,K0="firebaseLocalStorage",r4="fbase_key";class vv{constructor(t){this.request=t}toPromise(){return new Promise((t,n)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function K_(e,t){return e.transaction([K0],t?"readwrite":"readonly").objectStore(K0)}function _Z(){const e=indexedDB.deleteDatabase(n4);return new vv(e).toPromise()}function Vk(){const e=indexedDB.open(n4,wZ);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const r=e.result;try{r.createObjectStore(K0,{keyPath:r4})}catch(a){n(a)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(K0)?t(r):(r.close(),await _Z(),t(await Vk()))})})}async function ZF(e,t,n){const r=K_(e,!0).put({[r4]:t,value:n});return new vv(r).toPromise()}async function SZ(e,t){const n=K_(e,!1).get(t),r=await new vv(n).toPromise();return r===void 0?null:r.value}function JF(e,t){const n=K_(e,!0).delete(t);return new vv(n).toPromise()}const IZ=800,TZ=3;class a4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Vk(),this.db)}async _withRetries(t){let n=0;for(;;)try{const r=await this._openDb();return await t(r)}catch(r){if(n++>TZ)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return t4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=q_._getInstance(xZ()),this.receiver._subscribe("keyChanged",async(t,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(t,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await bZ(),!this.activeServiceWorker)return;this.sender=new gZ(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||vZ()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Vk();return await ZF(t,q0,"1"),await JF(t,q0),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ZF(r,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){const n=await this._withRetries(r=>SZ(r,t));return this.localCache[t]=n,n}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(n=>JF(n,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(a=>{const s=K_(a,!1).getAll();return new vv(s).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(t.length!==0)for(const{fbase_key:a,value:s}of t)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(s)&&(this.notifyListeners(a,s),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(t,n){this.localCache[t]=n;const r=this.listeners[t];if(r)for(const a of Array.from(r))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),IZ)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}a4.type="LOCAL";const kZ=a4;new gv(3e4,6e4);function s4(e,t){return t?Ol(t):(gt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}class PN extends MN{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return em(t,this._buildIdpRequest())}_linkToIdToken(t,n){return em(t,this._buildIdpRequest(n))}_getReauthenticationResolver(t){return em(t,this._buildIdpRequest())}_buildIdpRequest(t){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(n.idToken=t),n}}function EZ(e){return Xz(e.auth,new PN(e),e.bypassAuthState)}function NZ(e){const{auth:t,user:n}=e;return gt(n,t,"internal-error"),aZ(n,new PN(e),e.bypassAuthState)}async function CZ(e){const{auth:t,user:n}=e;return gt(n,t,"internal-error"),rZ(n,new PN(e),e.bypassAuthState)}class i4{constructor(t,n,r,a,s=!1){this.auth=t,this.resolver=r,this.user=a,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(t,n)=>{this.pendingPromise={resolve:t,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(t){const{urlResponse:n,sessionId:r,postBody:a,tenantId:s,error:i,type:o}=t;if(i){this.reject(i);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(h){this.reject(h)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return EZ;case"linkViaPopup":case"linkViaRedirect":return CZ;case"reauthViaPopup":case"reauthViaRedirect":return NZ;default:ki(this.auth,"internal-error")}}resolve(t){Hl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Hl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const AZ=new gv(2e3,1e4);async function RZ(e,t,n){if(Ns(e.app))return Promise.reject(qi(e,"operation-not-supported-in-this-environment"));const r=$c(e);cQ(e,t,ON);const a=s4(r,n);return new Fh(r,"signInViaPopup",t,a).executeNotNull()}class Fh extends i4{constructor(t,n,r,a,s){super(t,n,a,s),this.provider=r,this.authWindow=null,this.pollId=null,Fh.currentPopupAction&&Fh.currentPopupAction.cancel(),Fh.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return gt(t,this.auth,"internal-error"),t}async onExecution(){Hl(this.filter.length===1,"Popup operations only handle one event");const t=FN();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(qi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(qi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fh.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,AZ.get())};t()}}Fh.currentPopupAction=null;const DZ="pendingRedirect",S0=new Map;class MZ extends i4{constructor(t,n,r=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let t=S0.get(this.auth._key());if(!t){try{const r=await $Z(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(r)}catch(n){t=()=>Promise.reject(n)}S0.set(this.auth._key(),t)}return this.bypassAuthState||S0.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const n=await this.auth._redirectUserForId(t.eventId);if(n)return this.user=n,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $Z(e,t){const n=PZ(t),r=FZ(e);if(!await r._isAvailable())return!1;const a=await r._get(n)==="true";return await r._remove(n),a}function OZ(e,t){S0.set(e._key(),t)}function FZ(e){return Ol(e._redirectPersistence)}function PZ(e){return _0(DZ,e.config.apiKey,e.name)}async function LZ(e,t,n=!1){if(Ns(e.app))return Promise.reject(Pl(e));const r=$c(e),a=s4(r,t),i=await new MZ(r,a,n).execute();return i&&!n&&(delete i.user._redirectEventId,await r._persistUserIfCurrent(i.user),await r._setRedirectUser(null,t)),i}const zZ=600*1e3;class VZ{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(t,r)&&(n=!0,this.sendToConsumer(t,r),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!UZ(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(t,n){if(t.error&&!o4(t)){const r=t.error.code?.split("auth/")[1]||"internal-error";n.onError(qi(this.auth,r))}else n.onAuthEvent(t)}isEventForConsumer(t,n){const r=n.eventId===null||!!t.eventId&&t.eventId===n.eventId;return n.filter.includes(t.type)&&r}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=zZ&&this.cachedEventUids.clear(),this.cachedEventUids.has(e3(t))}saveEventToCache(t){this.cachedEventUids.add(e3(t)),this.lastProcessedEventTime=Date.now()}}function e3(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function o4({type:e,error:t}){return e==="unknown"&&t?.code==="auth/no-auth-event"}function UZ(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return o4(e);default:return!1}}async function BZ(e,t={}){return Mc(e,"GET","/v1/projects",t)}const WZ=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jZ=/^https?/;async function HZ(e){if(e.config.emulator)return;const{authorizedDomains:t}=await BZ(e);for(const n of t)try{if(GZ(n))return}catch{}ki(e,"unauthorized-domain")}function GZ(e){const t=Pk(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return i.hostname===""&&r===""?n==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):n==="chrome-extension:"&&i.hostname===r}if(!jZ.test(n))return!1;if(WZ.test(e))return r===e;const a=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const qZ=new gv(3e4,6e4);function t3(){const e=Fo().___jsl;if(e?.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}}function KZ(e){return new Promise((t,n)=>{function r(){t3(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{t3(),n(qi(e,"network-request-failed"))},timeout:qZ.get()})}if(Fo().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(Fo().gapi?.load)r();else{const a=zQ("iframefcb");return Fo()[a]=()=>{gapi.load?r():n(qi(e,"network-request-failed"))},Hz(`${LQ()}?onload=${a}`).catch(s=>n(s))}}).catch(t=>{throw I0=null,t})}let I0=null;function XZ(e){return I0=I0||KZ(e),I0}const YZ=new gv(5e3,15e3),QZ="__/auth/iframe",ZZ="emulator/auth/iframe",JZ={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},eJ=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tJ(e){const t=e.config;gt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?AN(t,ZZ):`https://${e.config.authDomain}/${QZ}`,r={apiKey:t.apiKey,appName:e.name,v:wd},a=eJ.get(e.config.apiHost);a&&(r.eid=a);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${mv(r).slice(1)}`}async function nJ(e){const t=await XZ(e),n=Fo().gapi;return gt(n,e,"internal-error"),t.open({where:document.body,url:tJ(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:JZ,dontclear:!0},r=>new Promise(async(a,s)=>{await r.restyle({setHideOnLeave:!1});const i=qi(e,"network-request-failed"),o=Fo().setTimeout(()=>{s(i)},YZ.get());function l(){Fo().clearTimeout(o),a(r)}r.ping(l).then(l,()=>{s(i)})}))}const rJ={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},aJ=500,sJ=600,iJ="_blank",oJ="http://localhost";class n3{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function lJ(e,t,n,r=aJ,a=sJ){const s=Math.max((window.screen.availHeight-a)/2,0).toString(),i=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l={...rJ,width:r.toString(),height:a.toString(),top:s,left:i},h=Wa().toLowerCase();n&&(o=Lz(h)?iJ:n),Fz(h)&&(t=t||oJ,l.scrollbars="yes");const c=Object.entries(l).reduce((m,[g,b])=>`${m}${g}=${b},`,"");if(CQ(h)&&o!=="_self")return uJ(t||"",o),new n3(null);const p=window.open(t||"",o,c);gt(p,e,"popup-blocked");try{p.focus()}catch{}return new n3(p)}function uJ(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const cJ="__/auth/handler",hJ="emulator/auth/handler",dJ=encodeURIComponent("fac");async function r3(e,t,n,r,a,s){gt(e.config.authDomain,e,"auth-domain-config-required"),gt(e.config.apiKey,e,"invalid-api-key");const i={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:wd,eventId:a};if(t instanceof ON){t.setDefaultLanguage(e.languageCode),i.providerId=t.providerId||"",YX(t.getCustomParameters())||(i.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,p]of Object.entries({}))i[c]=p}if(t instanceof bv){const c=t.getScopes().filter(p=>p!=="");c.length>0&&(i.scopes=c.join(","))}e.tenantId&&(i.tid=e.tenantId);const o=i;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];const l=await e._getAppCheckToken(),h=l?`#${dJ}=${encodeURIComponent(l)}`:"";return`${pJ(e)}?${mv(o).slice(1)}${h}`}function pJ({config:e}){return e.emulator?AN(e,hJ):`https://${e.authDomain}/${cJ}`}const ek="webStorageSupport";class fJ{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=e4,this._completeRedirectFn=LZ,this._overrideRedirectResult=OZ}async _openPopup(t,n,r,a){Hl(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const s=await r3(t,n,r,Pk(),a);return lJ(t,s,FN())}async _openRedirect(t,n,r,a){await this._originValidation(t);const s=await r3(t,n,r,Pk(),a);return yZ(s),new Promise(()=>{})}_initialize(t){const n=t._key();if(this.eventManagers[n]){const{manager:a,promise:s}=this.eventManagers[n];return a?Promise.resolve(a):(Hl(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(t);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(t){const n=await nJ(t),r=new VZ(t);return n.register("authEvent",a=>(gt(a?.authEvent,t,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=n,r}_isIframeWebStorageSupported(t,n){this.iframes[t._key()].send(ek,{type:ek},a=>{const s=a?.[0]?.[ek];s!==void 0&&n(!!s),ki(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const n=t._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=HZ(t)),this.originValidationPromises[n]}get _shouldInitProactively(){return Wz()||Pz()||DN()}}const mJ=fJ;var a3="@firebase/auth",s3="1.11.1";class gJ{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const n=this.auth.onIdTokenChanged(r=>{t(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,n),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const n=this.internalListeners.get(t);n&&(this.internalListeners.delete(t),n(),this.updateProactiveRefresh())}assertAuthConfigured(){gt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function yJ(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function bJ(e){Kh(new oc("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),a=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=r.options;gt(i&&!i.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:i,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jz(e)},h=new OQ(r,a,s,l);return HQ(h,n),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,n,r)=>{t.getProvider("auth-internal").initialize()})),Kh(new oc("auth-internal",t=>{const n=$c(t.getProvider("auth").getImmediate());return(r=>new gJ(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Oo(a3,s3,yJ(e)),Oo(a3,s3,"esm2020")}const vJ=300,xJ=_z("authIdTokenMaxAge")||vJ;let i3=null;const wJ=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>xJ)return;const a=n?.token;i3!==a&&(i3=a,await fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function _J(e=EN()){const t=H_(e,"auth");if(t.isInitialized())return t.getImmediate();const n=jQ(e,{popupRedirectResolver:mJ,persistence:[kZ,fZ,e4]}),r=_z("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const i=wJ(s.toString());uZ(n,i,()=>i(n.currentUser)),lZ(n,o=>i(o))}}const a=vz("auth");return a&&GQ(n,`http://${a}`),n}function SJ(){return document.getElementsByTagName("head")?.[0]??document}FQ({loadJS(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=a=>{const s=qi("internal-error");s.customData=a,n(s)},r.type="text/javascript",r.charset="UTF-8",SJ().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});bJ("Browser");var o3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var nc,l4;(function(){var e;function t(D,C){function O(){}O.prototype=C.prototype,D.F=C.prototype,D.prototype=new O,D.prototype.constructor=D,D.D=function(z,M,N){for(var P=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)P[Q-2]=arguments[Q];return C.prototype[M].apply(z,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(D,C,O){O||(O=0);const z=Array(16);if(typeof C=="string")for(var M=0;M<16;++M)z[M]=C.charCodeAt(O++)|C.charCodeAt(O++)<<8|C.charCodeAt(O++)<<16|C.charCodeAt(O++)<<24;else for(M=0;M<16;++M)z[M]=C[O++]|C[O++]<<8|C[O++]<<16|C[O++]<<24;C=D.g[0],O=D.g[1],M=D.g[2];let N=D.g[3],P;P=C+(N^O&(M^N))+z[0]+3614090360&4294967295,C=O+(P<<7&4294967295|P>>>25),P=N+(M^C&(O^M))+z[1]+3905402710&4294967295,N=C+(P<<12&4294967295|P>>>20),P=M+(O^N&(C^O))+z[2]+606105819&4294967295,M=N+(P<<17&4294967295|P>>>15),P=O+(C^M&(N^C))+z[3]+3250441966&4294967295,O=M+(P<<22&4294967295|P>>>10),P=C+(N^O&(M^N))+z[4]+4118548399&4294967295,C=O+(P<<7&4294967295|P>>>25),P=N+(M^C&(O^M))+z[5]+1200080426&4294967295,N=C+(P<<12&4294967295|P>>>20),P=M+(O^N&(C^O))+z[6]+2821735955&4294967295,M=N+(P<<17&4294967295|P>>>15),P=O+(C^M&(N^C))+z[7]+4249261313&4294967295,O=M+(P<<22&4294967295|P>>>10),P=C+(N^O&(M^N))+z[8]+1770035416&4294967295,C=O+(P<<7&4294967295|P>>>25),P=N+(M^C&(O^M))+z[9]+2336552879&4294967295,N=C+(P<<12&4294967295|P>>>20),P=M+(O^N&(C^O))+z[10]+4294925233&4294967295,M=N+(P<<17&4294967295|P>>>15),P=O+(C^M&(N^C))+z[11]+2304563134&4294967295,O=M+(P<<22&4294967295|P>>>10),P=C+(N^O&(M^N))+z[12]+1804603682&4294967295,C=O+(P<<7&4294967295|P>>>25),P=N+(M^C&(O^M))+z[13]+4254626195&4294967295,N=C+(P<<12&4294967295|P>>>20),P=M+(O^N&(C^O))+z[14]+2792965006&4294967295,M=N+(P<<17&4294967295|P>>>15),P=O+(C^M&(N^C))+z[15]+1236535329&4294967295,O=M+(P<<22&4294967295|P>>>10),P=C+(M^N&(O^M))+z[1]+4129170786&4294967295,C=O+(P<<5&4294967295|P>>>27),P=N+(O^M&(C^O))+z[6]+3225465664&4294967295,N=C+(P<<9&4294967295|P>>>23),P=M+(C^O&(N^C))+z[11]+643717713&4294967295,M=N+(P<<14&4294967295|P>>>18),P=O+(N^C&(M^N))+z[0]+3921069994&4294967295,O=M+(P<<20&4294967295|P>>>12),P=C+(M^N&(O^M))+z[5]+3593408605&4294967295,C=O+(P<<5&4294967295|P>>>27),P=N+(O^M&(C^O))+z[10]+38016083&4294967295,N=C+(P<<9&4294967295|P>>>23),P=M+(C^O&(N^C))+z[15]+3634488961&4294967295,M=N+(P<<14&4294967295|P>>>18),P=O+(N^C&(M^N))+z[4]+3889429448&4294967295,O=M+(P<<20&4294967295|P>>>12),P=C+(M^N&(O^M))+z[9]+568446438&4294967295,C=O+(P<<5&4294967295|P>>>27),P=N+(O^M&(C^O))+z[14]+3275163606&4294967295,N=C+(P<<9&4294967295|P>>>23),P=M+(C^O&(N^C))+z[3]+4107603335&4294967295,M=N+(P<<14&4294967295|P>>>18),P=O+(N^C&(M^N))+z[8]+1163531501&4294967295,O=M+(P<<20&4294967295|P>>>12),P=C+(M^N&(O^M))+z[13]+2850285829&4294967295,C=O+(P<<5&4294967295|P>>>27),P=N+(O^M&(C^O))+z[2]+4243563512&4294967295,N=C+(P<<9&4294967295|P>>>23),P=M+(C^O&(N^C))+z[7]+1735328473&4294967295,M=N+(P<<14&4294967295|P>>>18),P=O+(N^C&(M^N))+z[12]+2368359562&4294967295,O=M+(P<<20&4294967295|P>>>12),P=C+(O^M^N)+z[5]+4294588738&4294967295,C=O+(P<<4&4294967295|P>>>28),P=N+(C^O^M)+z[8]+2272392833&4294967295,N=C+(P<<11&4294967295|P>>>21),P=M+(N^C^O)+z[11]+1839030562&4294967295,M=N+(P<<16&4294967295|P>>>16),P=O+(M^N^C)+z[14]+4259657740&4294967295,O=M+(P<<23&4294967295|P>>>9),P=C+(O^M^N)+z[1]+2763975236&4294967295,C=O+(P<<4&4294967295|P>>>28),P=N+(C^O^M)+z[4]+1272893353&4294967295,N=C+(P<<11&4294967295|P>>>21),P=M+(N^C^O)+z[7]+4139469664&4294967295,M=N+(P<<16&4294967295|P>>>16),P=O+(M^N^C)+z[10]+3200236656&4294967295,O=M+(P<<23&4294967295|P>>>9),P=C+(O^M^N)+z[13]+681279174&4294967295,C=O+(P<<4&4294967295|P>>>28),P=N+(C^O^M)+z[0]+3936430074&4294967295,N=C+(P<<11&4294967295|P>>>21),P=M+(N^C^O)+z[3]+3572445317&4294967295,M=N+(P<<16&4294967295|P>>>16),P=O+(M^N^C)+z[6]+76029189&4294967295,O=M+(P<<23&4294967295|P>>>9),P=C+(O^M^N)+z[9]+3654602809&4294967295,C=O+(P<<4&4294967295|P>>>28),P=N+(C^O^M)+z[12]+3873151461&4294967295,N=C+(P<<11&4294967295|P>>>21),P=M+(N^C^O)+z[15]+530742520&4294967295,M=N+(P<<16&4294967295|P>>>16),P=O+(M^N^C)+z[2]+3299628645&4294967295,O=M+(P<<23&4294967295|P>>>9),P=C+(M^(O|~N))+z[0]+4096336452&4294967295,C=O+(P<<6&4294967295|P>>>26),P=N+(O^(C|~M))+z[7]+1126891415&4294967295,N=C+(P<<10&4294967295|P>>>22),P=M+(C^(N|~O))+z[14]+2878612391&4294967295,M=N+(P<<15&4294967295|P>>>17),P=O+(N^(M|~C))+z[5]+4237533241&4294967295,O=M+(P<<21&4294967295|P>>>11),P=C+(M^(O|~N))+z[12]+1700485571&4294967295,C=O+(P<<6&4294967295|P>>>26),P=N+(O^(C|~M))+z[3]+2399980690&4294967295,N=C+(P<<10&4294967295|P>>>22),P=M+(C^(N|~O))+z[10]+4293915773&4294967295,M=N+(P<<15&4294967295|P>>>17),P=O+(N^(M|~C))+z[1]+2240044497&4294967295,O=M+(P<<21&4294967295|P>>>11),P=C+(M^(O|~N))+z[8]+1873313359&4294967295,C=O+(P<<6&4294967295|P>>>26),P=N+(O^(C|~M))+z[15]+4264355552&4294967295,N=C+(P<<10&4294967295|P>>>22),P=M+(C^(N|~O))+z[6]+2734768916&4294967295,M=N+(P<<15&4294967295|P>>>17),P=O+(N^(M|~C))+z[13]+1309151649&4294967295,O=M+(P<<21&4294967295|P>>>11),P=C+(M^(O|~N))+z[4]+4149444226&4294967295,C=O+(P<<6&4294967295|P>>>26),P=N+(O^(C|~M))+z[11]+3174756917&4294967295,N=C+(P<<10&4294967295|P>>>22),P=M+(C^(N|~O))+z[2]+718787259&4294967295,M=N+(P<<15&4294967295|P>>>17),P=O+(N^(M|~C))+z[9]+3951481745&4294967295,D.g[0]=D.g[0]+C&4294967295,D.g[1]=D.g[1]+(M+(P<<21&4294967295|P>>>11))&4294967295,D.g[2]=D.g[2]+M&4294967295,D.g[3]=D.g[3]+N&4294967295}r.prototype.v=function(D,C){C===void 0&&(C=D.length);const O=C-this.blockSize,z=this.C;let M=this.h,N=0;for(;N<C;){if(M==0)for(;N<=O;)a(this,D,N),N+=this.blockSize;if(typeof D=="string"){for(;N<C;)if(z[M++]=D.charCodeAt(N++),M==this.blockSize){a(this,z),M=0;break}}else for(;N<C;)if(z[M++]=D[N++],M==this.blockSize){a(this,z),M=0;break}}this.h=M,this.o+=C},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var C=1;C<D.length-8;++C)D[C]=0;C=this.o*8;for(var O=D.length-8;O<D.length;++O)D[O]=C&255,C/=256;for(this.v(D),D=Array(16),C=0,O=0;O<4;++O)for(let z=0;z<32;z+=8)D[C++]=this.g[O]>>>z&255;return D};function s(D,C){var O=o;return Object.prototype.hasOwnProperty.call(O,D)?O[D]:O[D]=C(D)}function i(D,C){this.h=C;const O=[];let z=!0;for(let M=D.length-1;M>=0;M--){const N=D[M]|0;z&&N==C||(O[M]=N,z=!1)}this.g=O}var o={};function l(D){return-128<=D&&D<128?s(D,function(C){return new i([C|0],C<0?-1:0)}):new i([D|0],D<0?-1:0)}function h(D){if(isNaN(D)||!isFinite(D))return p;if(D<0)return x(h(-D));const C=[];let O=1;for(let z=0;D>=O;z++)C[z]=D/O|0,O*=4294967296;return new i(C,0)}function c(D,C){if(D.length==0)throw Error("number format error: empty string");if(C=C||10,C<2||36<C)throw Error("radix out of range: "+C);if(D.charAt(0)=="-")return x(c(D.substring(1),C));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const O=h(Math.pow(C,8));let z=p;for(let N=0;N<D.length;N+=8){var M=Math.min(8,D.length-N);const P=parseInt(D.substring(N,N+M),C);M<8?(M=h(Math.pow(C,M)),z=z.j(M).add(h(P))):(z=z.j(O),z=z.add(h(P)))}return z}var p=l(0),m=l(1),g=l(16777216);e=i.prototype,e.m=function(){if(v(this))return-x(this).m();let D=0,C=1;for(let O=0;O<this.g.length;O++){const z=this.i(O);D+=(z>=0?z:4294967296+z)*C,C*=4294967296}return D},e.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(b(this))return"0";if(v(this))return"-"+x(this).toString(D);const C=h(Math.pow(D,6));var O=this;let z="";for(;;){const M=E(O,C).g;O=_(O,M.j(C));let N=((O.g.length>0?O.g[0]:O.h)>>>0).toString(D);if(O=M,b(O))return N+z;for(;N.length<6;)N="0"+N;z=N+z}},e.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function b(D){if(D.h!=0)return!1;for(let C=0;C<D.g.length;C++)if(D.g[C]!=0)return!1;return!0}function v(D){return D.h==-1}e.l=function(D){return D=_(this,D),v(D)?-1:b(D)?0:1};function x(D){const C=D.g.length,O=[];for(let z=0;z<C;z++)O[z]=~D.g[z];return new i(O,~D.h).add(m)}e.abs=function(){return v(this)?x(this):this},e.add=function(D){const C=Math.max(this.g.length,D.g.length),O=[];let z=0;for(let M=0;M<=C;M++){let N=z+(this.i(M)&65535)+(D.i(M)&65535),P=(N>>>16)+(this.i(M)>>>16)+(D.i(M)>>>16);z=P>>>16,N&=65535,P&=65535,O[M]=P<<16|N}return new i(O,O[O.length-1]&-2147483648?-1:0)};function _(D,C){return D.add(x(C))}e.j=function(D){if(b(this)||b(D))return p;if(v(this))return v(D)?x(this).j(x(D)):x(x(this).j(D));if(v(D))return x(this.j(x(D)));if(this.l(g)<0&&D.l(g)<0)return h(this.m()*D.m());const C=this.g.length+D.g.length,O=[];for(var z=0;z<2*C;z++)O[z]=0;for(z=0;z<this.g.length;z++)for(let M=0;M<D.g.length;M++){const N=this.i(z)>>>16,P=this.i(z)&65535,Q=D.i(M)>>>16,ee=D.i(M)&65535;O[2*z+2*M]+=P*ee,I(O,2*z+2*M),O[2*z+2*M+1]+=N*ee,I(O,2*z+2*M+1),O[2*z+2*M+1]+=P*Q,I(O,2*z+2*M+1),O[2*z+2*M+2]+=N*Q,I(O,2*z+2*M+2)}for(D=0;D<C;D++)O[D]=O[2*D+1]<<16|O[2*D];for(D=C;D<2*C;D++)O[D]=0;return new i(O,0)};function I(D,C){for(;(D[C]&65535)!=D[C];)D[C+1]+=D[C]>>>16,D[C]&=65535,C++}function k(D,C){this.g=D,this.h=C}function E(D,C){if(b(C))throw Error("division by zero");if(b(D))return new k(p,p);if(v(D))return C=E(x(D),C),new k(x(C.g),x(C.h));if(v(C))return C=E(D,x(C)),new k(x(C.g),C.h);if(D.g.length>30){if(v(D)||v(C))throw Error("slowDivide_ only works with positive integers.");for(var O=m,z=C;z.l(D)<=0;)O=R(O),z=R(z);var M=U(O,1),N=U(z,1);for(z=U(z,2),O=U(O,2);!b(z);){var P=N.add(z);P.l(D)<=0&&(M=M.add(O),N=P),z=U(z,1),O=U(O,1)}return C=_(D,M.j(C)),new k(M,C)}for(M=p;D.l(C)>=0;){for(O=Math.max(1,Math.floor(D.m()/C.m())),z=Math.ceil(Math.log(O)/Math.LN2),z=z<=48?1:Math.pow(2,z-48),N=h(O),P=N.j(C);v(P)||P.l(D)>0;)O-=z,N=h(O),P=N.j(C);b(N)&&(N=m),M=M.add(N),D=_(D,P)}return new k(M,D)}e.B=function(D){return E(this,D).h},e.and=function(D){const C=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<C;z++)O[z]=this.i(z)&D.i(z);return new i(O,this.h&D.h)},e.or=function(D){const C=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<C;z++)O[z]=this.i(z)|D.i(z);return new i(O,this.h|D.h)},e.xor=function(D){const C=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<C;z++)O[z]=this.i(z)^D.i(z);return new i(O,this.h^D.h)};function R(D){const C=D.g.length+1,O=[];for(let z=0;z<C;z++)O[z]=D.i(z)<<1|D.i(z-1)>>>31;return new i(O,D.h)}function U(D,C){const O=C>>5;C%=32;const z=D.g.length-O,M=[];for(let N=0;N<z;N++)M[N]=C>0?D.i(N+O)>>>C|D.i(N+O+1)<<32-C:D.i(N+O);return new i(M,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,l4=r,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=c,nc=i}).apply(typeof o3<"u"?o3:typeof self<"u"?self:typeof window<"u"?window:{});var Xw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var u4,ub,c4,T0,Uk,h4,d4,p4;(function(){var e,t=Object.defineProperty;function n(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof Xw=="object"&&Xw];for(var A=0;A<w.length;++A){var V=w[A];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function a(w,A){if(A)e:{var V=r;w=w.split(".");for(var K=0;K<w.length-1;K++){var ye=w[K];if(!(ye in V))break e;V=V[ye]}w=w[w.length-1],K=V[w],A=A(K),A!=K&&A!=null&&t(V,w,{configurable:!0,writable:!0,value:A})}}a("Symbol.dispose",function(w){return w||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(w){return w||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(w){return w||function(A){var V=[],K;for(K in A)Object.prototype.hasOwnProperty.call(A,K)&&V.push([K,A[K]]);return V}});var s=s||{},i=this||self;function o(w){var A=typeof w;return A=="object"&&w!=null||A=="function"}function l(w,A,V){return w.call.apply(w.bind,arguments)}function h(w,A,V){return h=l,h.apply(null,arguments)}function c(w,A){var V=Array.prototype.slice.call(arguments,1);return function(){var K=V.slice();return K.push.apply(K,arguments),w.apply(this,K)}}function p(w,A){function V(){}V.prototype=A.prototype,w.Z=A.prototype,w.prototype=new V,w.prototype.constructor=w,w.Ob=function(K,ye,_e){for(var Be=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)Be[Rt-2]=arguments[Rt];return A.prototype[ye].apply(K,Be)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?w=>w&&AsyncContext.Snapshot.wrap(w):w=>w;function g(w){const A=w.length;if(A>0){const V=Array(A);for(let K=0;K<A;K++)V[K]=w[K];return V}return[]}function b(w,A){for(let K=1;K<arguments.length;K++){const ye=arguments[K];var V=typeof ye;if(V=V!="object"?V:ye?Array.isArray(ye)?"array":V:"null",V=="array"||V=="object"&&typeof ye.length=="number"){V=w.length||0;const _e=ye.length||0;w.length=V+_e;for(let Be=0;Be<_e;Be++)w[V+Be]=ye[Be]}else w.push(ye)}}class v{constructor(A,V){this.i=A,this.j=V,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function x(w){i.setTimeout(()=>{throw w},0)}function _(){var w=D;let A=null;return w.g&&(A=w.g,w.g=w.g.next,w.g||(w.h=null),A.next=null),A}class I{constructor(){this.h=this.g=null}add(A,V){const K=k.get();K.set(A,V),this.h?this.h.next=K:this.g=K,this.h=K}}var k=new v(()=>new E,w=>w.reset());class E{constructor(){this.next=this.g=this.h=null}set(A,V){this.h=A,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let R,U=!1,D=new I,C=()=>{const w=Promise.resolve(void 0);R=()=>{w.then(O)}};function O(){for(var w;w=_();){try{w.h.call(w.g)}catch(V){x(V)}var A=k;A.j(w),A.h<100&&(A.h++,w.next=A.g,A.g=w)}U=!1}function z(){this.u=this.u,this.C=this.C}z.prototype.u=!1,z.prototype.dispose=function(){this.u||(this.u=!0,this.N())},z.prototype[Symbol.dispose]=function(){this.dispose()},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function M(w,A){this.type=w,this.g=this.target=A,this.defaultPrevented=!1}M.prototype.h=function(){this.defaultPrevented=!0};var N=(function(){if(!i.addEventListener||!Object.defineProperty)return!1;var w=!1,A=Object.defineProperty({},"passive",{get:function(){w=!0}});try{const V=()=>{};i.addEventListener("test",V,A),i.removeEventListener("test",V,A)}catch{}return w})();function P(w){return/^[\s\xa0]*$/.test(w)}function Q(w,A){M.call(this,w?w.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,w&&this.init(w,A)}p(Q,M),Q.prototype.init=function(w,A){const V=this.type=w.type,K=w.changedTouches&&w.changedTouches.length?w.changedTouches[0]:null;this.target=w.target||w.srcElement,this.g=A,A=w.relatedTarget,A||(V=="mouseover"?A=w.fromElement:V=="mouseout"&&(A=w.toElement)),this.relatedTarget=A,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0),this.button=w.button,this.key=w.key||"",this.ctrlKey=w.ctrlKey,this.altKey=w.altKey,this.shiftKey=w.shiftKey,this.metaKey=w.metaKey,this.pointerId=w.pointerId||0,this.pointerType=w.pointerType,this.state=w.state,this.i=w,w.defaultPrevented&&Q.Z.h.call(this)},Q.prototype.h=function(){Q.Z.h.call(this);const w=this.i;w.preventDefault?w.preventDefault():w.returnValue=!1};var ee="closure_listenable_"+(Math.random()*1e6|0),q=0;function Z(w,A,V,K,ye){this.listener=w,this.proxy=null,this.src=A,this.type=V,this.capture=!!K,this.ha=ye,this.key=++q,this.da=this.fa=!1}function ne(w){w.da=!0,w.listener=null,w.proxy=null,w.src=null,w.ha=null}function me(w,A,V){for(const K in w)A.call(V,w[K],K,w)}function xe(w,A){for(const V in w)A.call(void 0,w[V],V,w)}function H(w){const A={};for(const V in w)A[V]=w[V];return A}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(w,A){let V,K;for(let ye=1;ye<arguments.length;ye++){K=arguments[ye];for(V in K)w[V]=K[V];for(let _e=0;_e<se.length;_e++)V=se[_e],Object.prototype.hasOwnProperty.call(K,V)&&(w[V]=K[V])}}function ge(w){this.src=w,this.g={},this.h=0}ge.prototype.add=function(w,A,V,K,ye){const _e=w.toString();w=this.g[_e],w||(w=this.g[_e]=[],this.h++);const Be=$e(w,A,K,ye);return Be>-1?(A=w[Be],V||(A.fa=!1)):(A=new Z(A,this.src,_e,!!K,ye),A.fa=V,w.push(A)),A};function Ee(w,A){const V=A.type;if(V in w.g){var K=w.g[V],ye=Array.prototype.indexOf.call(K,A,void 0),_e;(_e=ye>=0)&&Array.prototype.splice.call(K,ye,1),_e&&(ne(A),w.g[V].length==0&&(delete w.g[V],w.h--))}}function $e(w,A,V,K){for(let ye=0;ye<w.length;++ye){const _e=w[ye];if(!_e.da&&_e.listener==A&&_e.capture==!!V&&_e.ha==K)return ye}return-1}var Oe="closure_lm_"+(Math.random()*1e6|0),Fe={};function We(w,A,V,K,ye){if(Array.isArray(A)){for(let _e=0;_e<A.length;_e++)We(w,A[_e],V,K,ye);return null}return V=nn(V),w&&w[ee]?w.J(A,V,o(K)?!!K.capture:!1,ye):at(w,A,V,!1,K,ye)}function at(w,A,V,K,ye,_e){if(!A)throw Error("Invalid event type");const Be=o(ye)?!!ye.capture:!!ye;let Rt=ut(w);if(Rt||(w[Oe]=Rt=new ge(w)),V=Rt.add(A,V,K,Be,_e),V.proxy)return V;if(K=pt(),V.proxy=K,K.src=w,K.listener=V,w.addEventListener)N||(ye=Be),ye===void 0&&(ye=!1),w.addEventListener(A.toString(),K,ye);else if(w.attachEvent)w.attachEvent(vt(A.toString()),K);else if(w.addListener&&w.removeListener)w.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return V}function pt(){function w(V){return A.call(w.src,w.listener,V)}const A=Mt;return w}function bt(w,A,V,K,ye){if(Array.isArray(A))for(var _e=0;_e<A.length;_e++)bt(w,A[_e],V,K,ye);else K=o(K)?!!K.capture:!!K,V=nn(V),w&&w[ee]?(w=w.i,_e=String(A).toString(),_e in w.g&&(A=w.g[_e],V=$e(A,V,K,ye),V>-1&&(ne(A[V]),Array.prototype.splice.call(A,V,1),A.length==0&&(delete w.g[_e],w.h--)))):w&&(w=ut(w))&&(A=w.g[A.toString()],w=-1,A&&(w=$e(A,V,K,ye)),(V=w>-1?A[w]:null)&&Bt(V))}function Bt(w){if(typeof w!="number"&&w&&!w.da){var A=w.src;if(A&&A[ee])Ee(A.i,w);else{var V=w.type,K=w.proxy;A.removeEventListener?A.removeEventListener(V,K,w.capture):A.detachEvent?A.detachEvent(vt(V),K):A.addListener&&A.removeListener&&A.removeListener(K),(V=ut(A))?(Ee(V,w),V.h==0&&(V.src=null,A[Oe]=null)):ne(w)}}}function vt(w){return w in Fe?Fe[w]:Fe[w]="on"+w}function Mt(w,A){if(w.da)w=!0;else{A=new Q(A,this);const V=w.listener,K=w.ha||w.src;w.fa&&Bt(w),w=V.call(K,A)}return w}function ut(w){return w=w[Oe],w instanceof ge?w:null}var Lt="__closure_events_fn_"+(Math.random()*1e9>>>0);function nn(w){return typeof w=="function"?w:(w[Lt]||(w[Lt]=function(A){return w.handleEvent(A)}),w[Lt])}function Xt(){z.call(this),this.i=new ge(this),this.M=this,this.G=null}p(Xt,z),Xt.prototype[ee]=!0,Xt.prototype.removeEventListener=function(w,A,V,K){bt(this,w,A,V,K)};function Et(w,A){var V,K=w.G;if(K)for(V=[];K;K=K.G)V.push(K);if(w=w.M,K=A.type||A,typeof A=="string")A=new M(A,w);else if(A instanceof M)A.target=A.target||w;else{var ye=A;A=new M(K,w),ue(A,ye)}ye=!0;let _e,Be;if(V)for(Be=V.length-1;Be>=0;Be--)_e=A.g=V[Be],ye=Gn(_e,K,!0,A)&&ye;if(_e=A.g=w,ye=Gn(_e,K,!0,A)&&ye,ye=Gn(_e,K,!1,A)&&ye,V)for(Be=0;Be<V.length;Be++)_e=A.g=V[Be],ye=Gn(_e,K,!1,A)&&ye}Xt.prototype.N=function(){if(Xt.Z.N.call(this),this.i){var w=this.i;for(const A in w.g){const V=w.g[A];for(let K=0;K<V.length;K++)ne(V[K]);delete w.g[A],w.h--}}this.G=null},Xt.prototype.J=function(w,A,V,K){return this.i.add(String(w),A,!1,V,K)},Xt.prototype.K=function(w,A,V,K){return this.i.add(String(w),A,!0,V,K)};function Gn(w,A,V,K){if(A=w.i.g[String(A)],!A)return!0;A=A.concat();let ye=!0;for(let _e=0;_e<A.length;++_e){const Be=A[_e];if(Be&&!Be.da&&Be.capture==V){const Rt=Be.listener,wr=Be.ha||Be.src;Be.fa&&Ee(w.i,Be),ye=Rt.call(wr,K)!==!1&&ye}}return ye&&!K.defaultPrevented}function ur(w,A){if(typeof w!="function")if(w&&typeof w.handleEvent=="function")w=h(w.handleEvent,w);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:i.setTimeout(w,A||0)}function Dr(w){w.g=ur(()=>{w.g=null,w.i&&(w.i=!1,Dr(w))},w.l);const A=w.h;w.h=null,w.m.apply(null,A)}class kn extends z{constructor(A,V){super(),this.m=A,this.l=V,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Dr(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cr(w){z.call(this),this.h=w,this.g={}}p(cr,z);var vr=[];function qn(w){me(w.g,function(A,V){this.g.hasOwnProperty(V)&&Bt(A)},w),w.g={}}cr.prototype.N=function(){cr.Z.N.call(this),qn(this)},cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hr=i.JSON.stringify,si=i.JSON.parse,lo=class{stringify(w){return i.JSON.stringify(w,void 0)}parse(w){return i.JSON.parse(w,void 0)}};function ds(){}function uo(){}var dr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function On(){M.call(this,"d")}p(On,M);function ln(){M.call(this,"c")}p(ln,M);var Fn={},nl=null;function Ri(){return nl=nl||new Xt}Fn.Ia="serverreachability";function rl(w){M.call(this,Fn.Ia,w)}p(rl,M);function Mr(w){const A=Ri();Et(A,new rl(A))}Fn.STAT_EVENT="statevent";function ps(w,A){M.call(this,Fn.STAT_EVENT,w),this.stat=A}p(ps,M);function Ln(w){const A=Ri();Et(A,new ps(A,w))}Fn.Ja="timingevent";function oa(w,A){M.call(this,Fn.Ja,w),this.size=A}p(oa,M);function la(w,A){if(typeof w!="function")throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){w()},A)}function Aa(){this.g=!0}Aa.prototype.ua=function(){this.g=!1};function Te(w,A,V,K,ye,_e){w.info(function(){if(w.g)if(_e){var Be="",Rt=_e.split("&");for(let cn=0;cn<Rt.length;cn++){var wr=Rt[cn].split("=");if(wr.length>1){const Xn=wr[0];wr=wr[1];const hi=Xn.split("_");Be=hi.length>=2&&hi[1]=="type"?Be+(Xn+"="+wr+"&"):Be+(Xn+"=redacted&")}}}else Be=null;else Be=_e;return"XMLHTTP REQ ("+K+") [attempt "+ye+"]: "+A+`
`+V+`
`+Be})}function Le(w,A,V,K,ye,_e,Be){w.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+ye+"]: "+A+`
`+V+`
`+_e+" "+Be})}function Qe(w,A,V,K){w.info(function(){return"XMLHTTP TEXT ("+A+"): "+un(w,V)+(K?" "+K:"")})}function Ve(w,A){w.info(function(){return"TIMEOUT: "+A})}Aa.prototype.info=function(){};function un(w,A){if(!w.g)return A;if(!A)return null;try{const _e=JSON.parse(A);if(_e){for(w=0;w<_e.length;w++)if(Array.isArray(_e[w])){var V=_e[w];if(!(V.length<2)){var K=V[1];if(Array.isArray(K)&&!(K.length<1)){var ye=K[0];if(ye!="noop"&&ye!="stop"&&ye!="close")for(let Be=1;Be<K.length;Be++)K[Be]=""}}}}return hr(_e)}catch{return A}}var rn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},xt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},mt;function bn(){}p(bn,ds),bn.prototype.g=function(){return new XMLHttpRequest},mt=new bn;function nr(w){return encodeURIComponent(String(w))}function fs(w){var A=1;w=w.split(":");const V=[];for(;A>0&&w.length;)V.push(w.shift()),A--;return w.length&&V.push(w.join(":")),V}function Ra(w,A,V,K){this.j=w,this.i=A,this.l=V,this.S=K||1,this.V=new cr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ya}function ya(){this.i=null,this.g="",this.h=!1}var zn={},Yt={};function Kr(w,A,V){w.M=1,w.A=ho(rr(A)),w.u=V,w.R=!0,Di(w,null)}function Di(w,A){w.F=Date.now(),ii(w),w.B=rr(w.A);var V=w.B,K=w.S;Array.isArray(K)||(K=[String(K)]),Oi(V.i,"t",K),w.C=0,V=w.j.L,w.h=new ya,w.g=Vx(w.j,V?A:null,!w.u),w.P>0&&(w.O=new kn(h(w.Y,w,w.g),w.P)),A=w.V,V=w.g,K=w.ba;var ye="readystatechange";Array.isArray(ye)||(ye&&(vr[0]=ye.toString()),ye=vr);for(let _e=0;_e<ye.length;_e++){const Be=We(V,ye[_e],K||A.handleEvent,!1,A.h||A);if(!Be)break;A.g[Be.key]=Be}A=w.J?H(w.J):{},w.u?(w.v||(w.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",w.g.ea(w.B,w.v,w.u,A)):(w.v="GET",w.g.ea(w.B,w.v,null,A)),Mr(),Te(w.i,w.v,w.B,w.l,w.S,w.u)}Ra.prototype.ba=function(w){w=w.target;const A=this.O;A&&ca(w)==3?A.j():this.Y(w)},Ra.prototype.Y=function(w){try{if(w==this.g)e:{const Rt=ca(this.g),wr=this.g.ya(),cn=this.g.ca();if(!(Rt<3)&&(Rt!=3||this.g&&(this.h.h||this.g.la()||$r(this.g)))){this.K||Rt!=4||wr==7||(wr==8||cn<=0?Mr(3):Mr(2)),Da(this);var A=this.g.ca();this.X=A;var V=hy(this);if(this.o=A==200,Le(this.i,this.v,this.B,this.l,this.S,Rt,A),this.o){if(this.U&&!this.L){t:{if(this.g){var K,ye=this.g;if((K=ye.g?ye.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(K)){var _e=K;break t}}_e=null}if(w=_e)Qe(this.i,this.l,w,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ls(this,w);else{this.o=!1,this.m=3,Ln(12),Qa(this),ms(this);break e}}if(this.R){w=!0;let Xn;for(;!this.K&&this.C<V.length;)if(Xn=nf(this,V),Xn==Yt){Rt==4&&(this.m=4,Ln(14),w=!1),Qe(this.i,this.l,null,"[Incomplete Response]");break}else if(Xn==zn){this.m=4,Ln(15),Qe(this.i,this.l,V,"[Invalid Chunk]"),w=!1;break}else Qe(this.i,this.l,Xn,null),Ls(this,Xn);if(iu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Rt!=4||V.length!=0||this.h.h||(this.m=1,Ln(16),w=!1),this.o=this.o&&w,!w)Qe(this.i,this.l,V,"[Invalid Chunked Response]"),Qa(this),ms(this);else if(V.length>0&&!this.W){this.W=!0;var Be=this.j;Be.g==this&&Be.aa&&!Be.P&&(Be.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),fy(Be),Be.P=!0,Ln(11))}}else Qe(this.i,this.l,V,null),Ls(this,V);Rt==4&&Qa(this),this.o&&!this.K&&(Rt==4?Fx(this.j,this):(this.o=!1,ii(this)))}else dl(this.g),A==400&&V.indexOf("Unknown SID")>0?(this.m=3,Ln(12)):(this.m=0,Ln(13)),Qa(this),ms(this)}}}catch{}finally{}};function hy(w){if(!iu(w))return w.g.la();const A=$r(w.g);if(A==="")return"";let V="";const K=A.length,ye=ca(w.g)==4;if(!w.h.i){if(typeof TextDecoder>"u")return Qa(w),ms(w),"";w.h.i=new i.TextDecoder}for(let _e=0;_e<K;_e++)w.h.h=!0,V+=w.h.i.decode(A[_e],{stream:!(ye&&_e==K-1)});return A.length=0,w.h.g+=V,w.C=0,w.h.g}function iu(w){return w.g?w.v=="GET"&&w.M!=2&&w.j.Aa:!1}function nf(w,A){var V=w.C,K=A.indexOf(`
`,V);return K==-1?Yt:(V=Number(A.substring(V,K)),isNaN(V)?zn:(K+=1,K+V>A.length?Yt:(A=A.slice(K,K+V),w.C=K+V,A)))}Ra.prototype.cancel=function(){this.K=!0,Qa(this)};function ii(w){w.T=Date.now()+w.H,ou(w,w.H)}function ou(w,A){if(w.D!=null)throw Error("WatchDog timer not null");w.D=la(h(w.aa,w),A)}function Da(w){w.D&&(i.clearTimeout(w.D),w.D=null)}Ra.prototype.aa=function(){this.D=null;const w=Date.now();w-this.T>=0?(Ve(this.i,this.B),this.M!=2&&(Mr(),Ln(17)),Qa(this),this.m=2,ms(this)):ou(this,this.T-w)};function ms(w){w.j.I==0||w.K||Fx(w.j,w)}function Qa(w){Da(w);var A=w.O;A&&typeof A.dispose=="function"&&A.dispose(),w.O=null,qn(w.V),w.g&&(A=w.g,w.g=null,A.abort(),A.dispose())}function Ls(w,A){try{var V=w.j;if(V.I!=0&&(V.g==w||li(V.h,w))){if(!w.L&&li(V.h,w)&&V.I==3){try{var K=V.Ba.g.parse(A)}catch{K=null}if(Array.isArray(K)&&K.length==3){var ye=K;if(ye[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<w.F)of(V),du(V);else break e;lh(V),Ln(18)}}else V.xa=ye[1],0<V.xa-V.K&&ye[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=la(h(V.Va,V),6e3));oi(V.h)<=1&&V.ta&&(V.ta=void 0)}else bo(V,11)}else if((w.L||V.g==w)&&of(V),!P(A))for(ye=V.Ba.g.parse(A),A=0;A<ye.length;A++){let cn=ye[A];const Xn=cn[0];if(!(Xn<=V.K))if(V.K=Xn,cn=cn[1],V.I==2)if(cn[0]=="c"){V.M=cn[1],V.ba=cn[2];const hi=cn[3];hi!=null&&(V.ka=hi,V.j.info("VER="+V.ka));const vo=cn[4];vo!=null&&(V.za=vo,V.j.info("SVER="+V.za));const Fi=cn[5];Fi!=null&&typeof Fi=="number"&&Fi>0&&(K=1.5*Fi,V.O=K,V.j.info("backChannelRequestTimeoutMs_="+K)),K=V;const Pi=w.g;if(Pi){const uh=Pi.g?Pi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(uh){var _e=K.h;_e.g||uh.indexOf("spdy")==-1&&uh.indexOf("quic")==-1&&uh.indexOf("h2")==-1||(_e.j=_e.l,_e.g=new Set,_e.h&&(ui(_e,_e.h),_e.h=null))}if(K.G){const lf=Pi.g?Pi.g.getResponseHeader("X-HTTP-Session-Id"):null;lf&&(K.wa=lf,an(K.J,K.G,lf))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-w.F,V.j.info("Handshake RTT: "+V.T+"ms")),K=V;var Be=w;if(K.na=zx(K,K.L?K.ba:null,K.W),Be.L){sl(K.h,Be);var Rt=Be,wr=K.O;wr&&(Rt.H=wr),Rt.D&&(Da(Rt),ii(Rt)),K.g=Be}else $x(K);V.i.length>0&&yo(V)}else cn[0]!="stop"&&cn[0]!="close"||bo(V,7);else V.I==3&&(cn[0]=="stop"||cn[0]=="close"?cn[0]=="stop"?bo(V,7):dy(V):cn[0]!="noop"&&V.l&&V.l.qa(cn),V.A=0)}}Mr(4)}catch{}}var pr=class{constructor(w,A){this.g=w,this.map=A}};function al(w){this.l=w||10,i.PerformanceNavigationTiming?(w=i.performance.getEntriesByType("navigation"),w=w.length>0&&(w[0].nextHopProtocol=="hq"||w[0].nextHopProtocol=="h2")):w=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=w?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function th(w){return w.h?!0:w.g?w.g.size>=w.j:!1}function oi(w){return w.h?1:w.g?w.g.size:0}function li(w,A){return w.h?w.h==A:w.g?w.g.has(A):!1}function ui(w,A){w.g?w.g.add(A):w.h=A}function sl(w,A){w.h&&w.h==A?w.h=null:w.g&&w.g.has(A)&&w.g.delete(A)}al.prototype.cancel=function(){if(this.i=nh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const w of this.g.values())w.cancel();this.g.clear()}};function nh(w){if(w.h!=null)return w.i.concat(w.h.G);if(w.g!=null&&w.g.size!==0){let A=w.i;for(const V of w.g.values())A=A.concat(V.G);return A}return g(w.i)}var rf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lu(w,A){if(w){w=w.split("&");for(let V=0;V<w.length;V++){const K=w[V].indexOf("=");let ye,_e=null;K>=0?(ye=w[V].substring(0,K),_e=w[V].substring(K+1)):ye=w[V],A(ye,_e?decodeURIComponent(_e.replace(/\+/g," ")):"")}}}function Za(w){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;w instanceof Za?(this.l=w.l,xr(this,w.j),this.o=w.o,this.g=w.g,co(this,w.u),this.h=w.h,rh(this,ll(w.i)),this.m=w.m):w&&(A=String(w).match(rf))?(this.l=!1,xr(this,A[1]||"",!0),this.o=ci(A[2]||""),this.g=ci(A[3]||"",!0),co(this,A[4]),this.h=ci(A[5]||"",!0),rh(this,A[6]||"",!0),this.m=ci(A[7]||"")):(this.l=!1,this.i=new $i(null,this.l))}Za.prototype.toString=function(){const w=[];var A=this.j;A&&w.push(il(A,uu,!0),":");var V=this.g;return(V||A=="file")&&(w.push("//"),(A=this.o)&&w.push(il(A,uu,!0),"@"),w.push(nr(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&w.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&w.push("/"),w.push(il(V,V.charAt(0)=="/"?po:ah,!0))),(V=this.i.toString())&&w.push("?",V),(V=this.m)&&w.push("#",il(V,sh)),w.join("")},Za.prototype.resolve=function(w){const A=rr(this);let V=!!w.j;V?xr(A,w.j):V=!!w.o,V?A.o=w.o:V=!!w.g,V?A.g=w.g:V=w.u!=null;var K=w.h;if(V)co(A,w.u);else if(V=!!w.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var ye=A.h.lastIndexOf("/");ye!=-1&&(K=A.h.slice(0,ye+1)+K)}if(ye=K,ye==".."||ye==".")K="";else if(ye.indexOf("./")!=-1||ye.indexOf("/.")!=-1){K=ye.lastIndexOf("/",0)==0,ye=ye.split("/");const _e=[];for(let Be=0;Be<ye.length;){const Rt=ye[Be++];Rt=="."?K&&Be==ye.length&&_e.push(""):Rt==".."?((_e.length>1||_e.length==1&&_e[0]!="")&&_e.pop(),K&&Be==ye.length&&_e.push("")):(_e.push(Rt),K=!0)}K=_e.join("/")}else K=ye}return V?A.h=K:V=w.i.toString()!=="",V?rh(A,ll(w.i)):V=!!w.m,V&&(A.m=w.m),A};function rr(w){return new Za(w)}function xr(w,A,V){w.j=V?ci(A,!0):A,w.j&&(w.j=w.j.replace(/:$/,""))}function co(w,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);w.u=A}else w.u=null}function rh(w,A,V){A instanceof $i?(w.i=A,ul(w.i,w.l)):(V||(A=il(A,Mi)),w.i=new $i(A,w.l))}function an(w,A,V){w.i.set(A,V)}function ho(w){return an(w,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),w}function ci(w,A){return w?A?decodeURI(w.replace(/%25/g,"%2525")):decodeURIComponent(w):""}function il(w,A,V){return typeof w=="string"?(w=encodeURI(w).replace(A,Ma),V&&(w=w.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w):null}function Ma(w){return w=w.charCodeAt(0),"%"+(w>>4&15).toString(16)+(w&15).toString(16)}var uu=/[#\/\?@]/g,ah=/[#\?:]/g,po=/[#\?]/g,Mi=/[#\?@]/g,sh=/#/g;function $i(w,A){this.h=this.g=null,this.i=w||null,this.j=!!A}function ua(w){w.g||(w.g=new Map,w.h=0,w.i&&lu(w.i,function(A,V){w.add(decodeURIComponent(A.replace(/\+/g," ")),V)}))}e=$i.prototype,e.add=function(w,A){ua(this),this.i=null,w=zs(this,w);let V=this.g.get(w);return V||this.g.set(w,V=[]),V.push(A),this.h+=1,this};function ih(w,A){ua(w),A=zs(w,A),w.g.has(A)&&(w.i=null,w.h-=w.g.get(A).length,w.g.delete(A))}function cu(w,A){return ua(w),A=zs(w,A),w.g.has(A)}e.forEach=function(w,A){ua(this),this.g.forEach(function(V,K){V.forEach(function(ye){w.call(A,ye,K,this)},this)},this)};function ol(w,A){ua(w);let V=[];if(typeof A=="string")cu(w,A)&&(V=V.concat(w.g.get(zs(w,A))));else for(w=Array.from(w.g.values()),A=0;A<w.length;A++)V=V.concat(w[A]);return V}e.set=function(w,A){return ua(this),this.i=null,w=zs(this,w),cu(this,w)&&(this.h-=this.g.get(w).length),this.g.set(w,[A]),this.h+=1,this},e.get=function(w,A){return w?(w=ol(this,w),w.length>0?String(w[0]):A):A};function Oi(w,A,V){ih(w,A),V.length>0&&(w.i=null,w.g.set(zs(w,A),g(V)),w.h+=V.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const w=[],A=Array.from(this.g.keys());for(let K=0;K<A.length;K++){var V=A[K];const ye=nr(V);V=ol(this,V);for(let _e=0;_e<V.length;_e++){let Be=ye;V[_e]!==""&&(Be+="="+nr(V[_e])),w.push(Be)}}return this.i=w.join("&")};function ll(w){const A=new $i;return A.i=w.i,w.g&&(A.g=new Map(w.g),A.h=w.h),A}function zs(w,A){return A=String(A),w.j&&(A=A.toLowerCase()),A}function ul(w,A){A&&!w.j&&(ua(w),w.i=null,w.g.forEach(function(V,K){const ye=K.toLowerCase();K!=ye&&(ih(this,K),Oi(this,ye,V))},w)),w.j=A}function $a(w,A){const V=new Aa;if(i.Image){const K=new Image;K.onload=c(gs,V,"TestLoadImage: loaded",!0,A,K),K.onerror=c(gs,V,"TestLoadImage: error",!1,A,K),K.onabort=c(gs,V,"TestLoadImage: abort",!1,A,K),K.ontimeout=c(gs,V,"TestLoadImage: timeout",!1,A,K),i.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=w}else A(!1)}function fo(w,A){const V=new Aa,K=new AbortController,ye=setTimeout(()=>{K.abort(),gs(V,"TestPingServer: timeout",!1,A)},1e4);fetch(w,{signal:K.signal}).then(_e=>{clearTimeout(ye),_e.ok?gs(V,"TestPingServer: ok",!0,A):gs(V,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(ye),gs(V,"TestPingServer: error",!1,A)})}function gs(w,A,V,K,ye){try{ye&&(ye.onload=null,ye.onerror=null,ye.onabort=null,ye.ontimeout=null),K(V)}catch{}}function Y(){this.g=new lo}function de(w){this.i=w.Sb||null,this.h=w.ab||!1}p(de,ds),de.prototype.g=function(){return new Pe(this.i,this.h)};function Pe(w,A){Xt.call(this),this.H=w,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Pe,Xt),e=Pe.prototype,e.open=function(w,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=w,this.D=A,this.readyState=1,it(this)},e.send=function(w){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};w&&(A.body=w),(this.H||i).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ct(this)),this.readyState=0},e.Pa=function(w){if(this.g&&(this.l=w,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=w.headers,this.readyState=2,it(this)),this.g&&(this.readyState=3,it(this),this.g)))if(this.responseType==="arraybuffer")w.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof i.ReadableStream<"u"&&"body"in w){if(this.j=w.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;st(this)}else w.text().then(this.Oa.bind(this),this.ga.bind(this))};function st(w){w.j.read().then(w.Ma.bind(w)).catch(w.ga.bind(w))}e.Ma=function(w){if(this.g){if(this.o&&w.value)this.response.push(w.value);else if(!this.o){var A=w.value?w.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!w.done}))&&(this.response=this.responseText+=A)}w.done?ct(this):it(this),this.readyState==3&&st(this)}},e.Oa=function(w){this.g&&(this.response=this.responseText=w,ct(this))},e.Na=function(w){this.g&&(this.response=w,ct(this))},e.ga=function(){this.g&&ct(this)};function ct(w){w.readyState=4,w.l=null,w.j=null,w.B=null,it(w)}e.setRequestHeader=function(w,A){this.A.append(w,A)},e.getResponseHeader=function(w){return this.h&&this.h.get(w.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const w=[],A=this.h.entries();for(var V=A.next();!V.done;)V=V.value,w.push(V[0]+": "+V[1]),V=A.next();return w.join(`\r
`)};function it(w){w.onreadystatechange&&w.onreadystatechange.call(w)}Object.defineProperty(Pe.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(w){this.m=w?"include":"same-origin"}});function Ue(w){let A="";return me(w,function(V,K){A+=K,A+=":",A+=V,A+=`\r
`}),A}function Ze(w,A,V){e:{for(K in V){var K=!1;break e}K=!0}K||(V=Ue(V),typeof w=="string"?V!=null&&nr(V):an(w,A,V))}function ht(w){Xt.call(this),this.headers=new Map,this.L=w||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(ht,Xt);var Kn=/^https?$/i,Ja=["POST","PUT"];e=ht.prototype,e.Fa=function(w){this.H=w},e.ea=function(w,A,V,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+w);A=A?A.toUpperCase():"GET",this.D=w,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():mt.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(A,String(w),!0),this.B=!1}catch(_e){mo(this,_e);return}if(w=V||"",V=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var ye in K)V.set(ye,K[ye]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const _e of K.keys())V.set(_e,K.get(_e));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(V.keys()).find(_e=>_e.toLowerCase()=="content-type"),ye=i.FormData&&w instanceof i.FormData,!(Array.prototype.indexOf.call(Ja,A,void 0)>=0)||K||ye||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[_e,Be]of V)this.g.setRequestHeader(_e,Be);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(w),this.v=!1}catch(_e){mo(this,_e)}};function mo(w,A){w.h=!1,w.g&&(w.j=!0,w.g.abort(),w.j=!1),w.l=A,w.o=5,cl(w),ar(w)}function cl(w){w.A||(w.A=!0,Et(w,"complete"),Et(w,"error"))}e.abort=function(w){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=w||7,Et(this,"complete"),Et(this,"abort"),ar(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ar(this,!0)),ht.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?hl(this):this.Xa())},e.Xa=function(){hl(this)};function hl(w){if(w.h&&typeof s<"u"){if(w.v&&ca(w)==4)setTimeout(w.Ca.bind(w),0);else if(Et(w,"readystatechange"),ca(w)==4){w.h=!1;try{const _e=w.ca();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var V;if(!(V=A)){var K;if(K=_e===0){let Be=String(w.D).match(rf)[1]||null;!Be&&i.self&&i.self.location&&(Be=i.self.location.protocol.slice(0,-1)),K=!Kn.test(Be?Be.toLowerCase():"")}V=K}if(V)Et(w,"complete"),Et(w,"success");else{w.o=6;try{var ye=ca(w)>2?w.g.statusText:""}catch{ye=""}w.l=ye+" ["+w.ca()+"]",cl(w)}}finally{ar(w)}}}}function ar(w,A){if(w.g){w.m&&(clearTimeout(w.m),w.m=null);const V=w.g;w.g=null,A||Et(w,"ready");try{V.onreadystatechange=null}catch{}}}e.isActive=function(){return!!this.g};function ca(w){return w.g?w.g.readyState:0}e.ca=function(){try{return ca(this)>2?this.g.status:-1}catch{return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},e.La=function(w){if(this.g){var A=this.g.responseText;return w&&A.indexOf(w)==0&&(A=A.substring(w.length)),si(A)}};function $r(w){try{if(!w.g)return null;if("response"in w.g)return w.g.response;switch(w.F){case"":case"text":return w.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in w.g)return w.g.mozResponseArrayBuffer}return null}catch{return null}}function dl(w){const A={};w=(w.g&&ca(w)>=2&&w.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<w.length;K++){if(P(w[K]))continue;var V=fs(w[K]);const ye=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const _e=A[ye]||[];A[ye]=_e,_e.push(V)}xe(A,function(K){return K.join(", ")})}e.ya=function(){return this.o},e.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function go(w,A,V){return V&&V.internalChannelParams&&V.internalChannelParams[w]||A}function hu(w){this.za=0,this.i=[],this.j=new Aa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=go("failFast",!1,w),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=go("baseRetryDelayMs",5e3,w),this.Za=go("retryDelaySeedMs",1e4,w),this.Ta=go("forwardChannelMaxRetries",2,w),this.va=go("forwardChannelRequestTimeoutMs",2e4,w),this.ma=w&&w.xmlHttpFactory||void 0,this.Ua=w&&w.Rb||void 0,this.Aa=w&&w.useFetchStreams||!1,this.O=void 0,this.L=w&&w.supportsCrossDomainXhr||!1,this.M="",this.h=new al(w&&w.concurrentRequestLimit),this.Ba=new Y,this.S=w&&w.fastHandshake||!1,this.R=w&&w.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=w&&w.Pb||!1,w&&w.ua&&this.j.ua(),w&&w.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&w&&w.detectBufferingProxy||!1,this.ia=void 0,w&&w.longPollingTimeout&&w.longPollingTimeout>0&&(this.ia=w.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}e=hu.prototype,e.ka=8,e.I=1,e.connect=function(w,A,V,K){Ln(0),this.W=w,this.H=A||{},V&&K!==void 0&&(this.H.OSID=V,this.H.OAID=K),this.F=this.X,this.J=zx(this,null,this.W),yo(this)};function dy(w){if(af(w),w.I==3){var A=w.V++,V=rr(w.J);if(an(V,"SID",w.M),an(V,"RID",A),an(V,"TYPE","terminate"),oh(w,V),A=new Ra(w,w.j,A),A.M=2,A.A=ho(rr(V)),V=!1,i.navigator&&i.navigator.sendBeacon)try{V=i.navigator.sendBeacon(A.A.toString(),"")}catch{}!V&&i.Image&&(new Image().src=A.A,V=!0),V||(A.g=Vx(A.j,null),A.g.ea(A.A)),A.F=Date.now(),ii(A)}Lx(w)}function du(w){w.g&&(fy(w),w.g.cancel(),w.g=null)}function af(w){du(w),w.v&&(i.clearTimeout(w.v),w.v=null),of(w),w.h.cancel(),w.m&&(typeof w.m=="number"&&i.clearTimeout(w.m),w.m=null)}function yo(w){if(!th(w.h)&&!w.m){w.m=!0;var A=w.Ea;R||C(),U||(R(),U=!0),D.add(A,w),w.D=0}}function sf(w,A){return oi(w.h)>=w.h.j-(w.m?1:0)?!1:w.m?(w.i=A.G.concat(w.i),!0):w.I==1||w.I==2||w.D>=(w.Sa?0:w.Ta)?!1:(w.m=la(h(w.Ea,w,A),Px(w,w.D)),w.D++,!0)}e.Ea=function(w){if(this.m)if(this.m=null,this.I==1){if(!w){this.V=Math.floor(Math.random()*1e5),w=this.V++;const ye=new Ra(this,this.j,w);let _e=this.o;if(this.U&&(_e?(_e=H(_e),ue(_e,this.U)):_e=this.U),this.u!==null||this.R||(ye.J=_e,_e=null),this.S)e:{for(var A=0,V=0;V<this.i.length;V++){t:{var K=this.i[V];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(A+=K,A>4096){A=V;break e}if(A===4096||V===this.i.length-1){A=V+1;break e}}A=1e3}else A=1e3;A=Mx(this,ye,A),V=rr(this.J),an(V,"RID",w),an(V,"CVER",22),this.G&&an(V,"X-HTTP-Session-Id",this.G),oh(this,V),_e&&(this.R?A="headers="+nr(Ue(_e))+"&"+A:this.u&&Ze(V,this.u,_e)),ui(this.h,ye),this.Ra&&an(V,"TYPE","init"),this.S?(an(V,"$req",A),an(V,"SID","null"),ye.U=!0,Kr(ye,V,null)):Kr(ye,V,A),this.I=2}}else this.I==3&&(w?py(this,w):this.i.length==0||th(this.h)||py(this))};function py(w,A){var V;A?V=A.l:V=w.V++;const K=rr(w.J);an(K,"SID",w.M),an(K,"RID",V),an(K,"AID",w.K),oh(w,K),w.u&&w.o&&Ze(K,w.u,w.o),V=new Ra(w,w.j,V,w.D+1),w.u===null&&(V.J=w.o),A&&(w.i=A.G.concat(w.i)),A=Mx(w,V,1e3),V.H=Math.round(w.va*.5)+Math.round(w.va*.5*Math.random()),ui(w.h,V),Kr(V,K,A)}function oh(w,A){w.H&&me(w.H,function(V,K){an(A,K,V)}),w.l&&me({},function(V,K){an(A,K,V)})}function Mx(w,A,V){V=Math.min(w.i.length,V);const K=w.l?h(w.l.Ka,w.l,w):null;e:{var ye=w.i;let Rt=-1;for(;;){const wr=["count="+V];Rt==-1?V>0?(Rt=ye[0].g,wr.push("ofs="+Rt)):Rt=0:wr.push("ofs="+Rt);let cn=!0;for(let Xn=0;Xn<V;Xn++){var _e=ye[Xn].g;const hi=ye[Xn].map;if(_e-=Rt,_e<0)Rt=Math.max(0,ye[Xn].g-100),cn=!1;else try{_e="req"+_e+"_"||"";try{var Be=hi instanceof Map?hi:Object.entries(hi);for(const[vo,Fi]of Be){let Pi=Fi;o(Fi)&&(Pi=hr(Fi)),wr.push(_e+vo+"="+encodeURIComponent(Pi))}}catch(vo){throw wr.push(_e+"type="+encodeURIComponent("_badmap")),vo}}catch{K&&K(hi)}}if(cn){Be=wr.join("&");break e}}Be=void 0}return w=w.i.splice(0,V),A.G=w,Be}function $x(w){if(!w.g&&!w.v){w.Y=1;var A=w.Da;R||C(),U||(R(),U=!0),D.add(A,w),w.A=0}}function lh(w){return w.g||w.v||w.A>=3?!1:(w.Y++,w.v=la(h(w.Da,w),Px(w,w.A)),w.A++,!0)}e.Da=function(){if(this.v=null,Ox(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var w=4*this.T;this.j.info("BP detection timer enabled: "+w),this.B=la(h(this.Wa,this),w)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ln(10),du(this),Ox(this))};function fy(w){w.B!=null&&(i.clearTimeout(w.B),w.B=null)}function Ox(w){w.g=new Ra(w,w.j,"rpc",w.Y),w.u===null&&(w.g.J=w.o),w.g.P=0;var A=rr(w.na);an(A,"RID","rpc"),an(A,"SID",w.M),an(A,"AID",w.K),an(A,"CI",w.F?"0":"1"),!w.F&&w.ia&&an(A,"TO",w.ia),an(A,"TYPE","xmlhttp"),oh(w,A),w.u&&w.o&&Ze(A,w.u,w.o),w.O&&(w.g.H=w.O);var V=w.g;w=w.ba,V.M=1,V.A=ho(rr(A)),V.u=null,V.R=!0,Di(V,w)}e.Va=function(){this.C!=null&&(this.C=null,du(this),lh(this),Ln(19))};function of(w){w.C!=null&&(i.clearTimeout(w.C),w.C=null)}function Fx(w,A){var V=null;if(w.g==A){of(w),fy(w),w.g=null;var K=2}else if(li(w.h,A))V=A.G,sl(w.h,A),K=1;else return;if(w.I!=0){if(A.o)if(K==1){V=A.u?A.u.length:0,A=Date.now()-A.F;var ye=w.D;K=Ri(),Et(K,new oa(K,V)),yo(w)}else $x(w);else if(ye=A.m,ye==3||ye==0&&A.X>0||!(K==1&&sf(w,A)||K==2&&lh(w)))switch(V&&V.length>0&&(A=w.h,A.i=A.i.concat(V)),ye){case 1:bo(w,5);break;case 4:bo(w,10);break;case 3:bo(w,6);break;default:bo(w,2)}}}function Px(w,A){let V=w.Qa+Math.floor(Math.random()*w.Za);return w.isActive()||(V*=2),V*A}function bo(w,A){if(w.j.info("Error code "+A),A==2){var V=h(w.bb,w),K=w.Ua;const ye=!K;K=new Za(K||"//www.google.com/images/cleardot.gif"),i.location&&i.location.protocol=="http"||xr(K,"https"),ho(K),ye?$a(K.toString(),V):fo(K.toString(),V)}else Ln(2);w.I=0,w.l&&w.l.pa(A),Lx(w),af(w)}e.bb=function(w){w?(this.j.info("Successfully pinged google.com"),Ln(2)):(this.j.info("Failed to ping google.com"),Ln(1))};function Lx(w){if(w.I=0,w.ja=[],w.l){const A=nh(w.h);(A.length!=0||w.i.length!=0)&&(b(w.ja,A),b(w.ja,w.i),w.h.i.length=0,g(w.i),w.i.length=0),w.l.oa()}}function zx(w,A,V){var K=V instanceof Za?rr(V):new Za(V);if(K.g!="")A&&(K.g=A+"."+K.g),co(K,K.u);else{var ye=i.location;K=ye.protocol,A=A?A+"."+ye.hostname:ye.hostname,ye=+ye.port;const _e=new Za(null);K&&xr(_e,K),A&&(_e.g=A),ye&&co(_e,ye),V&&(_e.h=V),K=_e}return V=w.G,A=w.wa,V&&A&&an(K,V,A),an(K,"VER",w.ka),oh(w,K),K}function Vx(w,A,V){if(A&&!w.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=w.Aa&&!w.ma?new ht(new de({ab:V})):new ht(w.ma),A.Fa(w.L),A}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ux(){}e=Ux.prototype,e.ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){};function pu(){}pu.prototype.g=function(w,A){return new es(w,A)};function es(w,A){Xt.call(this),this.g=new hu(A),this.l=w,this.h=A&&A.messageUrlParams||null,w=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(w?w["X-Client-Protocol"]="webchannel":w={"X-Client-Protocol":"webchannel"}),this.g.o=w,w=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(w?w["X-WebChannel-Content-Type"]=A.messageContentType:w={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(w?w["X-WebChannel-Client-Profile"]=A.sa:w={"X-WebChannel-Client-Profile":A.sa}),this.g.U=w,(w=A&&A.Qb)&&!P(w)&&(this.g.u=w),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!P(A)&&(this.g.G=A,w=this.h,w!==null&&A in w&&(w=this.h,A in w&&delete w[A])),this.j=new pl(this)}p(es,Xt),es.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},es.prototype.close=function(){dy(this.g)},es.prototype.o=function(w){var A=this.g;if(typeof w=="string"){var V={};V.__data__=w,w=V}else this.v&&(V={},V.__data__=hr(w),w=V);A.i.push(new pr(A.Ya++,w)),A.I==3&&yo(A)},es.prototype.N=function(){this.g.l=null,delete this.j,dy(this.g),delete this.g,es.Z.N.call(this)};function Bx(w){On.call(this),w.__headers__&&(this.headers=w.__headers__,this.statusCode=w.__status__,delete w.__headers__,delete w.__status__);var A=w.__sm__;if(A){e:{for(const V in A){w=V;break e}w=void 0}(this.i=w)&&(w=this.i,A=A!==null&&w in A?A[w]:void 0),this.data=A}else this.data=w}p(Bx,On);function Wx(){ln.call(this),this.status=1}p(Wx,ln);function pl(w){this.g=w}p(pl,Ux),pl.prototype.ra=function(){Et(this.g,"a")},pl.prototype.qa=function(w){Et(this.g,new Bx(w))},pl.prototype.pa=function(w){Et(this.g,new Wx)},pl.prototype.oa=function(){Et(this.g,"b")},pu.prototype.createWebChannel=pu.prototype.g,es.prototype.send=es.prototype.o,es.prototype.open=es.prototype.m,es.prototype.close=es.prototype.close,p4=function(){return new pu},d4=function(){return Ri()},h4=Fn,Uk={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},rn.NO_ERROR=0,rn.TIMEOUT=8,rn.HTTP_ERROR=6,T0=rn,xt.COMPLETE="complete",c4=xt,uo.EventType=dr,dr.OPEN="a",dr.CLOSE="b",dr.ERROR="c",dr.MESSAGE="d",Xt.prototype.listen=Xt.prototype.J,ub=uo,ht.prototype.listenOnce=ht.prototype.K,ht.prototype.getLastError=ht.prototype.Ha,ht.prototype.getLastErrorCode=ht.prototype.ya,ht.prototype.getStatus=ht.prototype.ca,ht.prototype.getResponseJson=ht.prototype.La,ht.prototype.getResponseText=ht.prototype.la,ht.prototype.send=ht.prototype.ea,ht.prototype.setWithCredentials=ht.prototype.Fa,u4=ht}).apply(typeof Xw<"u"?Xw:typeof self<"u"?self:typeof window<"u"?window:{});const l3="@firebase/firestore",u3="4.9.2";class Pa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Pa.UNAUTHENTICATED=new Pa(null),Pa.GOOGLE_CREDENTIALS=new Pa("google-credentials-uid"),Pa.FIRST_PARTY=new Pa("first-party-uid"),Pa.MOCK_USER=new Pa("mock-user");let Om="12.3.0";const Qh=new TN("@firebase/firestore");function Wf(){return Qh.logLevel}function Xe(e,...t){if(Qh.logLevel<=Ht.DEBUG){const n=t.map(LN);Qh.debug(`Firestore (${Om}): ${e}`,...n)}}function Gl(e,...t){if(Qh.logLevel<=Ht.ERROR){const n=t.map(LN);Qh.error(`Firestore (${Om}): ${e}`,...n)}}function om(e,...t){if(Qh.logLevel<=Ht.WARN){const n=t.map(LN);Qh.warn(`Firestore (${Om}): ${e}`,...n)}}function LN(e){if(typeof e=="string")return e;try{return(function(n){return JSON.stringify(n)})(e)}catch{return e}}function yt(e,t,n){let r="Unexpected state";typeof t=="string"?r=t:n=t,f4(e,r,n)}function f4(e,t,n){let r=`FIRESTORE (${Om}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Gl(r),new Error(r)}function mn(e,t,n,r){let a="Unexpected state";typeof n=="string"?a=n:r=n,e||f4(t,a,r)}function kt(e,t){return e}const Ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qe extends Qo{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ll{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}}class m4{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class IJ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable((()=>n(Pa.UNAUTHENTICATED)))}shutdown(){}}class TJ{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,n){this.changeListener=n,t.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class kJ{constructor(t){this.t=t,this.currentUser=Pa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){mn(this.o===void 0,42304);let r=this.i;const a=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new Ll;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ll,t.enqueueRetryable((()=>a(this.currentUser)))};const i=()=>{const l=s;t.enqueueRetryable((async()=>{await l.promise,await a(this.currentUser)}))},o=l=>{Xe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((l=>o(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(Xe("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ll)}}),0),i()}getToken(){const t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==t?(Xe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(mn(typeof r.accessToken=="string",31837,{l:r}),new m4(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return mn(t===null||typeof t=="string",2055,{h:t}),new Pa(t)}}class EJ{constructor(t,n,r){this.P=t,this.T=n,this.I=r,this.type="FirstParty",this.user=Pa.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class NJ{constructor(t,n,r){this.P=t,this.T=n,this.I=r}getToken(){return Promise.resolve(new EJ(this.P,this.T,this.I))}start(t,n){t.enqueueRetryable((()=>n(Pa.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class c3{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CJ{constructor(t,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ns(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,n){mn(this.o===void 0,3512);const r=s=>{s.error!=null&&Xe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const i=s.token!==this.m;return this.m=s.token,Xe("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?n(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable((()=>r(s)))};const a=s=>{Xe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>a(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?a(s):Xe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new c3(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((n=>n?(mn(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new c3(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function AJ(e){const t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class zN{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const a=AJ(40);for(let s=0;s<a.length;++s)r.length<20&&a[s]<n&&(r+=t.charAt(a[s]%62))}return r}}function Gt(e,t){return e<t?-1:e>t?1:0}function Bk(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const a=e.charAt(r),s=t.charAt(r);if(a!==s)return tk(a)===tk(s)?Gt(a,s):tk(a)?1:-1}return Gt(e.length,t.length)}const RJ=55296,DJ=57343;function tk(e){const t=e.charCodeAt(0);return t>=RJ&&t<=DJ}function lm(e,t,n){return e.length===t.length&&e.every(((r,a)=>n(r,t[a])))}const h3="__name__";class No{constructor(t,n,r){n===void 0?n=0:n>t.length&&yt(637,{offset:n,range:t.length}),r===void 0?r=t.length-n:r>t.length-n&&yt(1746,{length:r,range:t.length-n}),this.segments=t,this.offset=n,this.len=r}get length(){return this.len}isEqual(t){return No.comparator(this,t)===0}child(t){const n=this.segments.slice(this.offset,this.limit());return t instanceof No?t.forEach((r=>{n.push(r)})):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let a=0;a<r;a++){const s=No.compareSegments(t.get(a),n.get(a));if(s!==0)return s}return Gt(t.length,n.length)}static compareSegments(t,n){const r=No.isNumericId(t),a=No.isNumericId(n);return r&&!a?-1:!r&&a?1:r&&a?No.extractNumericId(t).compare(No.extractNumericId(n)):Bk(t,n)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return nc.fromString(t.substring(4,t.length-2))}}class Pn extends No{construct(t,n,r){return new Pn(t,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const n=[];for(const r of t){if(r.indexOf("//")>=0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((a=>a.length>0)))}return new Pn(n)}static emptyPath(){return new Pn([])}}const MJ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Sa extends No{construct(t,n,r){return new Sa(t,n,r)}static isValidIdentifier(t){return MJ.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Sa.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===h3}static keyField(){return new Sa([h3])}static fromServerFormat(t){const n=[];let r="",a=0;const s=()=>{if(r.length===0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let i=!1;for(;a<t.length;){const o=t[a];if(o==="\\"){if(a+1===t.length)throw new qe(Ae.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[a+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new qe(Ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=l,a+=2}else o==="`"?(i=!i,a++):o!=="."||i?(r+=o,a++):(s(),a++)}if(s(),i)throw new qe(Ae.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Sa(n)}static emptyPath(){return new Sa([])}}class lt{constructor(t){this.path=t}static fromPath(t){return new lt(Pn.fromString(t))}static fromName(t){return new lt(Pn.fromString(t).popFirst(5))}static empty(){return new lt(Pn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Pn.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return Pn.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new lt(new Pn(t.slice()))}}function g4(e,t,n){if(!n)throw new qe(Ae.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function $J(e,t,n,r){if(t===!0&&r===!0)throw new qe(Ae.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function d3(e){if(!lt.isDocumentKey(e))throw new qe(Ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function p3(e){if(lt.isDocumentKey(e))throw new qe(Ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function y4(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function X_(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":yt(12329,{type:typeof e})}function Js(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new qe(Ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=X_(e);throw new qe(Ae.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function OJ(e,t){if(t<=0)throw new qe(Ae.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function Ur(e,t){const n={typeString:e};return t&&(n.value=t),n}function xv(e,t){if(!y4(e))throw new qe(Ae.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const a=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const i=e[r];if(a&&typeof i!==a){n=`JSON field '${r}' must be a ${a}.`;break}if(s!==void 0&&i!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new qe(Ae.INVALID_ARGUMENT,n);return!0}const f3=-62135596800,m3=1e6;class Bn{static now(){return Bn.fromMillis(Date.now())}static fromDate(t){return Bn.fromMillis(t.getTime())}static fromMillis(t){const n=Math.floor(t/1e3),r=Math.floor((t-1e3*n)*m3);return new Bn(n,r)}constructor(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<f3)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/m3}_compareTo(t){return this.seconds===t.seconds?Gt(this.nanoseconds,t.nanoseconds):Gt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Bn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(xv(t,Bn._jsonSchema))return new Bn(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-f3;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Bn._jsonSchemaVersion="firestore/timestamp/1.0",Bn._jsonSchema={type:Ur("string",Bn._jsonSchemaVersion),seconds:Ur("number"),nanoseconds:Ur("number")};class St{static fromTimestamp(t){return new St(t)}static min(){return new St(new Bn(0,0))}static max(){return new St(new Bn(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const zb=-1;function FJ(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,a=St.fromTimestamp(r===1e9?new Bn(n+1,0):new Bn(n,r));return new lc(a,lt.empty(),t)}function PJ(e){return new lc(e.readTime,e.key,zb)}class lc{constructor(t,n,r){this.readTime=t,this.documentKey=n,this.largestBatchId=r}static min(){return new lc(St.min(),lt.empty(),zb)}static max(){return new lc(St.max(),lt.empty(),zb)}}function LJ(e,t){let n=e.readTime.compareTo(t.readTime);return n!==0?n:(n=lt.comparator(e.documentKey,t.documentKey),n!==0?n:Gt(e.largestBatchId,t.largestBatchId))}const zJ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VJ{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Fm(e){if(e.code!==Ae.FAILED_PRECONDITION||e.message!==zJ)throw e;Xe("LocalStore","Unexpectedly lost primary lease")}class Me{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(t){return this.next(void 0,t)}next(t,n){return this.callbackAttached&&yt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new Me(((r,a)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,a)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,a)}}))}toPromise(){return new Promise(((t,n)=>{this.next(t,n)}))}wrapUserFunction(t){try{const n=t();return n instanceof Me?n:Me.resolve(n)}catch(n){return Me.reject(n)}}wrapSuccess(t,n){return t?this.wrapUserFunction((()=>t(n))):Me.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction((()=>t(n))):Me.reject(n)}static resolve(t){return new Me(((n,r)=>{n(t)}))}static reject(t){return new Me(((n,r)=>{r(t)}))}static waitFor(t){return new Me(((n,r)=>{let a=0,s=0,i=!1;t.forEach((o=>{++a,o.next((()=>{++s,i&&s===a&&n()}),(l=>r(l)))})),i=!0,s===a&&n()}))}static or(t){let n=Me.resolve(!1);for(const r of t)n=n.next((a=>a?Me.resolve(a):r()));return n}static forEach(t,n){const r=[];return t.forEach(((a,s)=>{r.push(n.call(this,a,s))})),this.waitFor(r)}static mapArray(t,n){return new Me(((r,a)=>{const s=t.length,i=new Array(s);let o=0;for(let l=0;l<s;l++){const h=l;n(t[h]).next((c=>{i[h]=c,++o,o===s&&r(i)}),(c=>a(c)))}}))}static doWhile(t,n){return new Me(((r,a)=>{const s=()=>{t()===!0?n().next((()=>{s()}),a):r()};s()}))}}function UJ(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Pm(e){return e.name==="IndexedDbTransactionError"}class Y_{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Y_.ce=-1;const VN=-1;function Q_(e){return e==null}function X0(e){return e===0&&1/e==-1/0}function BJ(e){return typeof e=="number"&&Number.isInteger(e)&&!X0(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const b4="";function WJ(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=g3(t)),t=jJ(e.get(n),t);return g3(t)}function jJ(e,t){let n=t;const r=e.length;for(let a=0;a<r;a++){const s=e.charAt(a);switch(s){case"\0":n+="";break;case b4:n+="";break;default:n+=s}}return n}function g3(e){return e+b4+""}function y3(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Oc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function v4(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ir{constructor(t,n){this.comparator=t,this.root=n||_a.EMPTY}insert(t,n){return new ir(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,_a.BLACK,null,null))}remove(t){return new ir(this.comparator,this.root.remove(t,this.comparator).copy(null,null,_a.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(t){let n=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(t,r.key);if(a===0)return n+r.left.size;a<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((n,r)=>(t(n,r),!1)))}toString(){const t=[];return this.inorderTraversal(((n,r)=>(t.push(`${n}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Yw(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Yw(this.root,t,this.comparator,!1)}getReverseIterator(){return new Yw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Yw(this.root,t,this.comparator,!0)}}class Yw{constructor(t,n,r,a){this.isReverse=a,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=n?r(t.key,n):1,n&&a&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class _a{constructor(t,n,r,a,s){this.key=t,this.value=n,this.color=r??_a.RED,this.left=a??_a.EMPTY,this.right=s??_a.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,a,s){return new _a(t??this.key,n??this.value,r??this.color,a??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let a=this;const s=r(t,a.key);return a=s<0?a.copy(null,null,null,a.left.insert(t,n,r),null):s===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(t,n,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return _a.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,a=this;if(n(t,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(t,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(t,a.key)===0){if(a.right.isEmpty())return _a.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(t,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,_a.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,_a.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw yt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw yt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw yt(27949);return t+(this.isRed()?0:1)}}_a.EMPTY=null,_a.RED=!0,_a.BLACK=!1;_a.EMPTY=new class{constructor(){this.size=0}get key(){throw yt(57766)}get value(){throw yt(16141)}get color(){throw yt(16727)}get left(){throw yt(29726)}get right(){throw yt(36894)}copy(t,n,r,a,s){return this}insert(t,n,r){return new _a(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class na{constructor(t){this.comparator=t,this.data=new ir(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((n,r)=>(t(n),!1)))}forEachInRange(t,n){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,t[1])>=0)return;n(a.key)}}forEachWhile(t,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new b3(this.data.getIterator())}getIteratorFrom(t){return new b3(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach((r=>{n=n.add(r)})),n}isEqual(t){if(!(t instanceof na)||this.size!==t.size)return!1;const n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,s=r.getNext().key;if(this.comparator(a,s)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((n=>{t.push(n)})),t}toString(){const t=[];return this.forEach((n=>t.push(n))),"SortedSet("+t.toString()+")"}copy(t){const n=new na(this.comparator);return n.data=t,n}}class b3{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qs{constructor(t){this.fields=t,t.sort(Sa.comparator)}static empty(){return new qs([])}unionWith(t){let n=new na(Sa.comparator);for(const r of this.fields)n=n.add(r);for(const r of t)n=n.add(r);return new qs(n.toArray())}covers(t){for(const n of this.fields)if(n.isPrefixOf(t))return!0;return!1}isEqual(t){return lm(this.fields,t.fields,((n,r)=>n.isEqual(r)))}}class x4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ia{constructor(t){this.binaryString=t}static fromBase64String(t){const n=(function(a){try{return atob(a)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new x4("Invalid base64 string: "+s):s}})(t);return new Ia(n)}static fromUint8Array(t){const n=(function(a){let s="";for(let i=0;i<a.length;++i)s+=String.fromCharCode(a[i]);return s})(t);return new Ia(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Gt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ia.EMPTY_BYTE_STRING=new Ia("");const HJ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function uc(e){if(mn(!!e,39018),typeof e=="string"){let t=0;const n=HJ.exec(e);if(mn(!!n,46558,{timestamp:e}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),t=Number(a)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ir(e.seconds),nanos:Ir(e.nanos)}}function Ir(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function cc(e){return typeof e=="string"?Ia.fromBase64String(e):Ia.fromUint8Array(e)}const w4="server_timestamp",_4="__type__",S4="__previous_value__",I4="__local_write_time__";function UN(e){return(e?.mapValue?.fields||{})[_4]?.stringValue===w4}function Z_(e){const t=e.mapValue.fields[S4];return UN(t)?Z_(t):t}function Vb(e){const t=uc(e.mapValue.fields[I4].timestampValue);return new Bn(t.seconds,t.nanos)}class GJ{constructor(t,n,r,a,s,i,o,l,h,c){this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=a,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=c}}const Y0="(default)";class Ub{constructor(t,n){this.projectId=t,this.database=n||Y0}static empty(){return new Ub("","")}get isDefaultDatabase(){return this.database===Y0}isEqual(t){return t instanceof Ub&&t.projectId===this.projectId&&t.database===this.database}}const T4="__type__",qJ="__max__",Qw={mapValue:{}},k4="__vector__",Q0="value";function hc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?UN(e)?4:XJ(e)?9007199254740991:KJ(e)?10:11:yt(28295,{value:e})}function jo(e,t){if(e===t)return!0;const n=hc(e);if(n!==hc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Vb(e).isEqual(Vb(t));case 3:return(function(a,s){if(typeof a.timestampValue=="string"&&typeof s.timestampValue=="string"&&a.timestampValue.length===s.timestampValue.length)return a.timestampValue===s.timestampValue;const i=uc(a.timestampValue),o=uc(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos})(e,t);case 5:return e.stringValue===t.stringValue;case 6:return(function(a,s){return cc(a.bytesValue).isEqual(cc(s.bytesValue))})(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return(function(a,s){return Ir(a.geoPointValue.latitude)===Ir(s.geoPointValue.latitude)&&Ir(a.geoPointValue.longitude)===Ir(s.geoPointValue.longitude)})(e,t);case 2:return(function(a,s){if("integerValue"in a&&"integerValue"in s)return Ir(a.integerValue)===Ir(s.integerValue);if("doubleValue"in a&&"doubleValue"in s){const i=Ir(a.doubleValue),o=Ir(s.doubleValue);return i===o?X0(i)===X0(o):isNaN(i)&&isNaN(o)}return!1})(e,t);case 9:return lm(e.arrayValue.values||[],t.arrayValue.values||[],jo);case 10:case 11:return(function(a,s){const i=a.mapValue.fields||{},o=s.mapValue.fields||{};if(y3(i)!==y3(o))return!1;for(const l in i)if(i.hasOwnProperty(l)&&(o[l]===void 0||!jo(i[l],o[l])))return!1;return!0})(e,t);default:return yt(52216,{left:e})}}function Bb(e,t){return(e.values||[]).find((n=>jo(n,t)))!==void 0}function um(e,t){if(e===t)return 0;const n=hc(e),r=hc(t);if(n!==r)return Gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Gt(e.booleanValue,t.booleanValue);case 2:return(function(s,i){const o=Ir(s.integerValue||s.doubleValue),l=Ir(i.integerValue||i.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1})(e,t);case 3:return v3(e.timestampValue,t.timestampValue);case 4:return v3(Vb(e),Vb(t));case 5:return Bk(e.stringValue,t.stringValue);case 6:return(function(s,i){const o=cc(s),l=cc(i);return o.compareTo(l)})(e.bytesValue,t.bytesValue);case 7:return(function(s,i){const o=s.split("/"),l=i.split("/");for(let h=0;h<o.length&&h<l.length;h++){const c=Gt(o[h],l[h]);if(c!==0)return c}return Gt(o.length,l.length)})(e.referenceValue,t.referenceValue);case 8:return(function(s,i){const o=Gt(Ir(s.latitude),Ir(i.latitude));return o!==0?o:Gt(Ir(s.longitude),Ir(i.longitude))})(e.geoPointValue,t.geoPointValue);case 9:return x3(e.arrayValue,t.arrayValue);case 10:return(function(s,i){const o=s.fields||{},l=i.fields||{},h=o[Q0]?.arrayValue,c=l[Q0]?.arrayValue,p=Gt(h?.values?.length||0,c?.values?.length||0);return p!==0?p:x3(h,c)})(e.mapValue,t.mapValue);case 11:return(function(s,i){if(s===Qw.mapValue&&i===Qw.mapValue)return 0;if(s===Qw.mapValue)return 1;if(i===Qw.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),h=i.fields||{},c=Object.keys(h);l.sort(),c.sort();for(let p=0;p<l.length&&p<c.length;++p){const m=Bk(l[p],c[p]);if(m!==0)return m;const g=um(o[l[p]],h[c[p]]);if(g!==0)return g}return Gt(l.length,c.length)})(e.mapValue,t.mapValue);default:throw yt(23264,{he:n})}}function v3(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return Gt(e,t);const n=uc(e),r=uc(t),a=Gt(n.seconds,r.seconds);return a!==0?a:Gt(n.nanos,r.nanos)}function x3(e,t){const n=e.values||[],r=t.values||[];for(let a=0;a<n.length&&a<r.length;++a){const s=um(n[a],r[a]);if(s)return s}return Gt(n.length,r.length)}function cm(e){return Wk(e)}function Wk(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(function(n){const r=uc(n);return`time(${r.seconds},${r.nanos})`})(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?(function(n){return cc(n).toBase64()})(e.bytesValue):"referenceValue"in e?(function(n){return lt.fromName(n).toString()})(e.referenceValue):"geoPointValue"in e?(function(n){return`geo(${n.latitude},${n.longitude})`})(e.geoPointValue):"arrayValue"in e?(function(n){let r="[",a=!0;for(const s of n.values||[])a?a=!1:r+=",",r+=Wk(s);return r+"]"})(e.arrayValue):"mapValue"in e?(function(n){const r=Object.keys(n.fields||{}).sort();let a="{",s=!0;for(const i of r)s?s=!1:a+=",",a+=`${i}:${Wk(n.fields[i])}`;return a+"}"})(e.mapValue):yt(61005,{value:e})}function k0(e){switch(hc(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Z_(e);return t?16+k0(t):16;case 5:return 2*e.stringValue.length;case 6:return cc(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((a,s)=>a+k0(s)),0)})(e.arrayValue);case 10:case 11:return(function(r){let a=0;return Oc(r.fields,((s,i)=>{a+=s.length+k0(i)})),a})(e.mapValue);default:throw yt(13486,{value:e})}}function w3(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function jk(e){return!!e&&"integerValue"in e}function BN(e){return!!e&&"arrayValue"in e}function _3(e){return!!e&&"nullValue"in e}function S3(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function E0(e){return!!e&&"mapValue"in e}function KJ(e){return(e?.mapValue?.fields||{})[T4]?.stringValue===k4}function Tb(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return Oc(e.mapValue.fields,((n,r)=>t.mapValue.fields[n]=Tb(r))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Tb(e.arrayValue.values[n]);return t}return{...e}}function XJ(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===qJ}class Cs{constructor(t){this.value=t}static empty(){return new Cs({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let n=this.value;for(let r=0;r<t.length-1;++r)if(n=(n.mapValue.fields||{})[t.get(r)],!E0(n))return null;return n=(n.mapValue.fields||{})[t.lastSegment()],n||null}}set(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Tb(n)}setAll(t){let n=Sa.emptyPath(),r={},a=[];t.forEach(((i,o)=>{if(!n.isImmediateParentOf(o)){const l=this.getFieldsMap(n);this.applyChanges(l,r,a),r={},a=[],n=o.popLast()}i?r[o.lastSegment()]=Tb(i):a.push(o.lastSegment())}));const s=this.getFieldsMap(n);this.applyChanges(s,r,a)}delete(t){const n=this.field(t.popLast());E0(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]}isEqual(t){return jo(this.value,t.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let a=n.mapValue.fields[t.get(r)];E0(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=a),n=a}return n.mapValue.fields}applyChanges(t,n,r){Oc(n,((a,s)=>t[a]=s));for(const a of r)delete t[a]}clone(){return new Cs(Tb(this.value))}}function E4(e){const t=[];return Oc(e.fields,((n,r)=>{const a=new Sa([n]);if(E0(r)){const s=E4(r.mapValue).fields;if(s.length===0)t.push(a);else for(const i of s)t.push(a.child(i))}else t.push(a)})),new qs(t)}class La{constructor(t,n,r,a,s,i,o){this.key=t,this.documentType=n,this.version=r,this.readTime=a,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new La(t,0,St.min(),St.min(),St.min(),Cs.empty(),0)}static newFoundDocument(t,n,r,a){return new La(t,1,n,St.min(),r,a,0)}static newNoDocument(t,n){return new La(t,2,n,St.min(),St.min(),Cs.empty(),0)}static newUnknownDocument(t,n){return new La(t,3,n,St.min(),St.min(),Cs.empty(),2)}convertToFoundDocument(t,n){return!this.createTime.isEqual(St.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Cs.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Cs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=St.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof La&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new La(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Z0{constructor(t,n){this.position=t,this.inclusive=n}}function I3(e,t,n){let r=0;for(let a=0;a<e.position.length;a++){const s=t[a],i=e.position[a];if(s.field.isKeyField()?r=lt.comparator(lt.fromName(i.referenceValue),n.key):r=um(i,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function T3(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!jo(e.position[n],t.position[n]))return!1;return!0}class Wb{constructor(t,n="asc"){this.field=t,this.dir=n}}function YJ(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class N4{}class Vr extends N4{constructor(t,n,r){super(),this.field=t,this.op=n,this.value=r}static create(t,n,r){return t.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(t,n,r):new ZJ(t,n,r):n==="array-contains"?new tee(t,r):n==="in"?new nee(t,r):n==="not-in"?new ree(t,r):n==="array-contains-any"?new aee(t,r):new Vr(t,n,r)}static createKeyFieldInFilter(t,n,r){return n==="in"?new JJ(t,r):new eee(t,r)}matches(t){const n=t.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(um(n,this.value)):n!==null&&hc(this.value)===hc(n)&&this.matchesComparison(um(n,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return yt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ji extends N4{constructor(t,n){super(),this.filters=t,this.op=n,this.Pe=null}static create(t,n){return new Ji(t,n)}matches(t){return C4(this)?this.filters.find((n=>!n.matches(t)))===void 0:this.filters.find((n=>n.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,n)=>t.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function C4(e){return e.op==="and"}function A4(e){return QJ(e)&&C4(e)}function QJ(e){for(const t of e.filters)if(t instanceof Ji)return!1;return!0}function Hk(e){if(e instanceof Vr)return e.field.canonicalString()+e.op.toString()+cm(e.value);if(A4(e))return e.filters.map((t=>Hk(t))).join(",");{const t=e.filters.map((n=>Hk(n))).join(",");return`${e.op}(${t})`}}function R4(e,t){return e instanceof Vr?(function(r,a){return a instanceof Vr&&r.op===a.op&&r.field.isEqual(a.field)&&jo(r.value,a.value)})(e,t):e instanceof Ji?(function(r,a){return a instanceof Ji&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce(((s,i,o)=>s&&R4(i,a.filters[o])),!0):!1})(e,t):void yt(19439)}function D4(e){return e instanceof Vr?(function(n){return`${n.field.canonicalString()} ${n.op} ${cm(n.value)}`})(e):e instanceof Ji?(function(n){return n.op.toString()+" {"+n.getFilters().map(D4).join(" ,")+"}"})(e):"Filter"}class ZJ extends Vr{constructor(t,n,r){super(t,n,r),this.key=lt.fromName(r.referenceValue)}matches(t){const n=lt.comparator(t.key,this.key);return this.matchesComparison(n)}}class JJ extends Vr{constructor(t,n){super(t,"in",n),this.keys=M4("in",n)}matches(t){return this.keys.some((n=>n.isEqual(t.key)))}}class eee extends Vr{constructor(t,n){super(t,"not-in",n),this.keys=M4("not-in",n)}matches(t){return!this.keys.some((n=>n.isEqual(t.key)))}}function M4(e,t){return(t.arrayValue?.values||[]).map((n=>lt.fromName(n.referenceValue)))}class tee extends Vr{constructor(t,n){super(t,"array-contains",n)}matches(t){const n=t.data.field(this.field);return BN(n)&&Bb(n.arrayValue,this.value)}}class nee extends Vr{constructor(t,n){super(t,"in",n)}matches(t){const n=t.data.field(this.field);return n!==null&&Bb(this.value.arrayValue,n)}}class ree extends Vr{constructor(t,n){super(t,"not-in",n)}matches(t){if(Bb(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=t.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Bb(this.value.arrayValue,n)}}class aee extends Vr{constructor(t,n){super(t,"array-contains-any",n)}matches(t){const n=t.data.field(this.field);return!(!BN(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Bb(this.value.arrayValue,r)))}}class see{constructor(t,n=null,r=[],a=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=a,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function k3(e,t=null,n=[],r=[],a=null,s=null,i=null){return new see(e,t,n,r,a,s,i)}function WN(e){const t=kt(e);if(t.Te===null){let n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((r=>Hk(r))).join(","),n+="|ob:",n+=t.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),Q_(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((r=>cm(r))).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((r=>cm(r))).join(",")),t.Te=n}return t.Te}function jN(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!YJ(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!R4(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!T3(e.startAt,t.startAt)&&T3(e.endAt,t.endAt)}function Gk(e){return lt.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}class Lm{constructor(t,n=null,r=[],a=[],s=null,i="F",o=null,l=null){this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=a,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iee(e,t,n,r,a,s,i,o){return new Lm(e,t,n,r,a,s,i,o)}function J_(e){return new Lm(e)}function E3(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function $4(e){return e.collectionGroup!==null}function kb(e){const t=kt(e);if(t.Ie===null){t.Ie=[];const n=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),n.add(s.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(i){let o=new na(Sa.comparator);return i.filters.forEach((l=>{l.getFlattenedFilters().forEach((h=>{h.isInequality()&&(o=o.add(h.field))}))})),o})(t).forEach((s=>{n.has(s.canonicalString())||s.isKeyField()||t.Ie.push(new Wb(s,r))})),n.has(Sa.keyField().canonicalString())||t.Ie.push(new Wb(Sa.keyField(),r))}return t.Ie}function Po(e){const t=kt(e);return t.Ee||(t.Ee=oee(t,kb(e))),t.Ee}function oee(e,t){if(e.limitType==="F")return k3(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((a=>{const s=a.dir==="desc"?"asc":"desc";return new Wb(a.field,s)}));const n=e.endAt?new Z0(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Z0(e.startAt.position,e.startAt.inclusive):null;return k3(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function qk(e,t){const n=e.filters.concat([t]);return new Lm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function J0(e,t,n){return new Lm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function e1(e,t){return jN(Po(e),Po(t))&&e.limitType===t.limitType}function O4(e){return`${WN(Po(e))}|lt:${e.limitType}`}function jf(e){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((a=>D4(a))).join(", ")}]`),Q_(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((a=>(function(i){return`${i.field.canonicalString()} (${i.dir})`})(a))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((a=>cm(a))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((a=>cm(a))).join(",")),`Target(${r})`})(Po(e))}; limitType=${e.limitType})`}function t1(e,t){return t.isFoundDocument()&&(function(r,a){const s=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):lt.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(e,t)&&(function(r,a){for(const s of kb(r))if(!s.field.isKeyField()&&a.data.field(s.field)===null)return!1;return!0})(e,t)&&(function(r,a){for(const s of r.filters)if(!s.matches(a))return!1;return!0})(e,t)&&(function(r,a){return!(r.startAt&&!(function(i,o,l){const h=I3(i,o,l);return i.inclusive?h<=0:h<0})(r.startAt,kb(r),a)||r.endAt&&!(function(i,o,l){const h=I3(i,o,l);return i.inclusive?h>=0:h>0})(r.endAt,kb(r),a))})(e,t)}function lee(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function F4(e){return(t,n)=>{let r=!1;for(const a of kb(e)){const s=uee(a,t,n);if(s!==0)return s;r=r||a.field.isKeyField()}return 0}}function uee(e,t,n){const r=e.field.isKeyField()?lt.comparator(t.key,n.key):(function(s,i,o){const l=i.data.field(s),h=o.data.field(s);return l!==null&&h!==null?um(l,h):yt(42886)})(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return yt(19790,{direction:e.dir})}}class _d{constructor(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}get(t){const n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0){for(const[a,s]of r)if(this.equalsFn(a,t))return s}}has(t){return this.get(t)!==void 0}set(t,n){const r=this.mapKeyFn(t),a=this.inner[r];if(a===void 0)return this.inner[r]=[[t,n]],void this.innerSize++;for(let s=0;s<a.length;s++)if(this.equalsFn(a[s][0],t))return void(a[s]=[t,n]);a.push([t,n]),this.innerSize++}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],t))return r.length===1?delete this.inner[n]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(t){Oc(this.inner,((n,r)=>{for(const[a,s]of r)t(a,s)}))}isEmpty(){return v4(this.inner)}size(){return this.innerSize}}const cee=new ir(lt.comparator);function ql(){return cee}const P4=new ir(lt.comparator);function cb(...e){let t=P4;for(const n of e)t=t.insert(n.key,n);return t}function L4(e){let t=P4;return e.forEach(((n,r)=>t=t.insert(n,r.overlayedDocument))),t}function Ph(){return Eb()}function z4(){return Eb()}function Eb(){return new _d((e=>e.toString()),((e,t)=>e.isEqual(t)))}const hee=new ir(lt.comparator),dee=new na(lt.comparator);function qt(...e){let t=dee;for(const n of e)t=t.add(n);return t}const pee=new na(Gt);function fee(){return pee}function HN(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:X0(t)?"-0":t}}function V4(e){return{integerValue:""+e}}function mee(e,t){return BJ(t)?V4(t):HN(e,t)}class n1{constructor(){this._=void 0}}function gee(e,t,n){return e instanceof jb?(function(a,s){const i={fields:{[_4]:{stringValue:w4},[I4]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&UN(s)&&(s=Z_(s)),s&&(i.fields[S4]=s),{mapValue:i}})(n,t):e instanceof Hb?B4(e,t):e instanceof Gb?W4(e,t):(function(a,s){const i=U4(a,s),o=N3(i)+N3(a.Ae);return jk(i)&&jk(a.Ae)?V4(o):HN(a.serializer,o)})(e,t)}function yee(e,t,n){return e instanceof Hb?B4(e,t):e instanceof Gb?W4(e,t):n}function U4(e,t){return e instanceof e_?(function(r){return jk(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(t)?t:{integerValue:0}:null}class jb extends n1{}class Hb extends n1{constructor(t){super(),this.elements=t}}function B4(e,t){const n=j4(t);for(const r of e.elements)n.some((a=>jo(a,r)))||n.push(r);return{arrayValue:{values:n}}}class Gb extends n1{constructor(t){super(),this.elements=t}}function W4(e,t){let n=j4(t);for(const r of e.elements)n=n.filter((a=>!jo(a,r)));return{arrayValue:{values:n}}}class e_ extends n1{constructor(t,n){super(),this.serializer=t,this.Ae=n}}function N3(e){return Ir(e.integerValue||e.doubleValue)}function j4(e){return BN(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class bee{constructor(t,n){this.field=t,this.transform=n}}function vee(e,t){return e.field.isEqual(t.field)&&(function(r,a){return r instanceof Hb&&a instanceof Hb||r instanceof Gb&&a instanceof Gb?lm(r.elements,a.elements,jo):r instanceof e_&&a instanceof e_?jo(r.Ae,a.Ae):r instanceof jb&&a instanceof jb})(e.transform,t.transform)}class xee{constructor(t,n){this.version=t,this.transformResults=n}}class Ki{constructor(t,n){this.updateTime=t,this.exists=n}static none(){return new Ki}static exists(t){return new Ki(void 0,t)}static updateTime(t){return new Ki(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function N0(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}class r1{}function H4(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new q4(e.key,Ki.none()):new wv(e.key,e.data,Ki.none());{const n=e.data,r=Cs.empty();let a=new na(Sa.comparator);for(let s of t.fields)if(!a.has(s)){let i=n.field(s);i===null&&s.length>1&&(s=s.popLast(),i=n.field(s)),i===null?r.delete(s):r.set(s,i),a=a.add(s)}return new Fc(e.key,r,new qs(a.toArray()),Ki.none())}}function wee(e,t,n){e instanceof wv?(function(a,s,i){const o=a.value.clone(),l=A3(a.fieldTransforms,s,i.transformResults);o.setAll(l),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()})(e,t,n):e instanceof Fc?(function(a,s,i){if(!N0(a.precondition,s))return void s.convertToUnknownDocument(i.version);const o=A3(a.fieldTransforms,s,i.transformResults),l=s.data;l.setAll(G4(a)),l.setAll(o),s.convertToFoundDocument(i.version,l).setHasCommittedMutations()})(e,t,n):(function(a,s,i){s.convertToNoDocument(i.version).setHasCommittedMutations()})(0,t,n)}function Nb(e,t,n,r){return e instanceof wv?(function(s,i,o,l){if(!N0(s.precondition,i))return o;const h=s.value.clone(),c=R3(s.fieldTransforms,l,i);return h.setAll(c),i.convertToFoundDocument(i.version,h).setHasLocalMutations(),null})(e,t,n,r):e instanceof Fc?(function(s,i,o,l){if(!N0(s.precondition,i))return o;const h=R3(s.fieldTransforms,l,i),c=i.data;return c.setAll(G4(s)),c.setAll(h),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((p=>p.field)))})(e,t,n,r):(function(s,i,o){return N0(s.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o})(e,t,n)}function _ee(e,t){let n=null;for(const r of e.fieldTransforms){const a=t.data.field(r.field),s=U4(r.transform,a||null);s!=null&&(n===null&&(n=Cs.empty()),n.set(r.field,s))}return n||null}function C3(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!(function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&lm(r,a,((s,i)=>vee(s,i)))})(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class wv extends r1{constructor(t,n,r,a=[]){super(),this.key=t,this.value=n,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Fc extends r1{constructor(t,n,r,a,s=[]){super(),this.key=t,this.data=n,this.fieldMask=r,this.precondition=a,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function G4(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function A3(e,t,n){const r=new Map;mn(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let a=0;a<n.length;a++){const s=e[a],i=s.transform,o=t.data.field(s.field);r.set(s.field,yee(i,o,n[a]))}return r}function R3(e,t,n){const r=new Map;for(const a of e){const s=a.transform,i=n.data.field(a.field);r.set(a.field,gee(s,i,t))}return r}class q4 extends r1{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class See extends r1{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Iee{constructor(t,n,r,a){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(t,n){const r=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const s=this.mutations[a];s.key.isEqual(t.key)&&wee(s,t,r[a])}}applyToLocalView(t,n){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(n=Nb(r,t,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(n=Nb(r,t,n,this.localWriteTime));return n}applyToLocalDocumentSet(t,n){const r=z4();return this.mutations.forEach((a=>{const s=t.get(a.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=n.has(a.key)?null:o;const l=H4(i,o);l!==null&&r.set(a.key,l),i.isValidDocument()||i.convertToNoDocument(St.min())})),r}keys(){return this.mutations.reduce(((t,n)=>t.add(n.key)),qt())}isEqual(t){return this.batchId===t.batchId&&lm(this.mutations,t.mutations,((n,r)=>C3(n,r)))&&lm(this.baseMutations,t.baseMutations,((n,r)=>C3(n,r)))}}class GN{constructor(t,n,r,a){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=a}static from(t,n,r){mn(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let a=(function(){return hee})();const s=t.mutations;for(let i=0;i<s.length;i++)a=a.insert(s[i].key,r[i].version);return new GN(t,n,r,a)}}class Tee{constructor(t,n){this.largestBatchId=t,this.mutation=n}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class kee{constructor(t,n){this.count=t,this.unchangedNames=n}}var zr,Jt;function Eee(e){switch(e){case Ae.OK:return yt(64938);case Ae.CANCELLED:case Ae.UNKNOWN:case Ae.DEADLINE_EXCEEDED:case Ae.RESOURCE_EXHAUSTED:case Ae.INTERNAL:case Ae.UNAVAILABLE:case Ae.UNAUTHENTICATED:return!1;case Ae.INVALID_ARGUMENT:case Ae.NOT_FOUND:case Ae.ALREADY_EXISTS:case Ae.PERMISSION_DENIED:case Ae.FAILED_PRECONDITION:case Ae.ABORTED:case Ae.OUT_OF_RANGE:case Ae.UNIMPLEMENTED:case Ae.DATA_LOSS:return!0;default:return yt(15467,{code:e})}}function K4(e){if(e===void 0)return Gl("GRPC error has no .code"),Ae.UNKNOWN;switch(e){case zr.OK:return Ae.OK;case zr.CANCELLED:return Ae.CANCELLED;case zr.UNKNOWN:return Ae.UNKNOWN;case zr.DEADLINE_EXCEEDED:return Ae.DEADLINE_EXCEEDED;case zr.RESOURCE_EXHAUSTED:return Ae.RESOURCE_EXHAUSTED;case zr.INTERNAL:return Ae.INTERNAL;case zr.UNAVAILABLE:return Ae.UNAVAILABLE;case zr.UNAUTHENTICATED:return Ae.UNAUTHENTICATED;case zr.INVALID_ARGUMENT:return Ae.INVALID_ARGUMENT;case zr.NOT_FOUND:return Ae.NOT_FOUND;case zr.ALREADY_EXISTS:return Ae.ALREADY_EXISTS;case zr.PERMISSION_DENIED:return Ae.PERMISSION_DENIED;case zr.FAILED_PRECONDITION:return Ae.FAILED_PRECONDITION;case zr.ABORTED:return Ae.ABORTED;case zr.OUT_OF_RANGE:return Ae.OUT_OF_RANGE;case zr.UNIMPLEMENTED:return Ae.UNIMPLEMENTED;case zr.DATA_LOSS:return Ae.DATA_LOSS;default:return yt(39323,{code:e})}}(Jt=zr||(zr={}))[Jt.OK=0]="OK",Jt[Jt.CANCELLED=1]="CANCELLED",Jt[Jt.UNKNOWN=2]="UNKNOWN",Jt[Jt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Jt[Jt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Jt[Jt.NOT_FOUND=5]="NOT_FOUND",Jt[Jt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Jt[Jt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Jt[Jt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Jt[Jt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Jt[Jt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Jt[Jt.ABORTED=10]="ABORTED",Jt[Jt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Jt[Jt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Jt[Jt.INTERNAL=13]="INTERNAL",Jt[Jt.UNAVAILABLE=14]="UNAVAILABLE",Jt[Jt.DATA_LOSS=15]="DATA_LOSS";function Nee(){return new TextEncoder}const Cee=new nc([4294967295,4294967295],0);function D3(e){const t=Nee().encode(e),n=new l4;return n.update(t),new Uint8Array(n.digest())}function M3(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),a=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new nc([n,r],0),new nc([a,s],0)]}class qN{constructor(t,n,r){if(this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new hb(`Invalid padding: ${n}`);if(r<0)throw new hb(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new hb(`Invalid hash count: ${r}`);if(t.length===0&&n!==0)throw new hb(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*t.length-n,this.pe=nc.fromNumber(this.ge)}ye(t,n,r){let a=t.add(n.multiply(nc.fromNumber(r)));return a.compare(Cee)===1&&(a=new nc([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const n=D3(t),[r,a]=M3(n);for(let s=0;s<this.hashCount;s++){const i=this.ye(r,a,s);if(!this.we(i))return!1}return!0}static create(t,n,r){const a=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new qN(s,a,n);return r.forEach((o=>i.insert(o))),i}insert(t){if(this.ge===0)return;const n=D3(t),[r,a]=M3(n);for(let s=0;s<this.hashCount;s++){const i=this.ye(r,a,s);this.Se(i)}}Se(t){const n=Math.floor(t/8),r=t%8;this.bitmap[n]|=1<<r}}class hb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class a1{constructor(t,n,r,a,s){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,n,r){const a=new Map;return a.set(t,_v.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new a1(St.min(),a,new ir(Gt),ql(),qt())}}class _v{constructor(t,n,r,a,s){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,n,r){return new _v(r,n,qt(),qt(),qt())}}class C0{constructor(t,n,r,a){this.be=t,this.removedTargetIds=n,this.key=r,this.De=a}}class X4{constructor(t,n){this.targetId=t,this.Ce=n}}class Y4{constructor(t,n,r=Ia.EMPTY_BYTE_STRING,a=null){this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=a}}class $3{constructor(){this.ve=0,this.Fe=O3(),this.Me=Ia.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=qt(),n=qt(),r=qt();return this.Fe.forEach(((a,s)=>{switch(s){case 0:t=t.add(a);break;case 2:n=n.add(a);break;case 1:r=r.add(a);break;default:yt(38017,{changeType:s})}})),new _v(this.Me,this.xe,t,n,r)}qe(){this.Oe=!1,this.Fe=O3()}Qe(t,n){this.Oe=!0,this.Fe=this.Fe.insert(t,n)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,mn(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Aee{constructor(t){this.Ge=t,this.ze=new Map,this.je=ql(),this.Je=Zw(),this.He=Zw(),this.Ye=new ir(Gt)}Ze(t){for(const n of t.be)t.De&&t.De.isFoundDocument()?this.Xe(n,t.De):this.et(n,t.key,t.De);for(const n of t.removedTargetIds)this.et(n,t.key,t.De)}tt(t){this.forEachTarget(t,(n=>{const r=this.nt(n);switch(t.state){case 0:this.rt(n)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(t.resumeToken));break;default:yt(56790,{state:t.state})}}))}forEachTarget(t,n){t.targetIds.length>0?t.targetIds.forEach(n):this.ze.forEach(((r,a)=>{this.rt(a)&&n(a)}))}st(t){const n=t.targetId,r=t.Ce.count,a=this.ot(n);if(a){const s=a.target;if(Gk(s))if(r===0){const i=new lt(s.path);this.et(n,i,La.newNoDocument(i,St.min()))}else mn(r===1,20013,{expectedCount:r});else{const i=this._t(n);if(i!==r){const o=this.ut(t),l=o?this.ct(o,t,i):1;if(l!==0){this.it(n);const h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,h)}}}}}ut(t){const n=t.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:s=0}=n;let i,o;try{i=cc(r).toUint8Array()}catch(l){if(l instanceof x4)return om("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new qN(i,a,s)}catch(l){return om(l instanceof hb?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(t,n,r){return n.Ce.count===r-this.Pt(t,n.targetId)?0:2}Pt(t,n){const r=this.Ge.getRemoteKeysForTarget(n);let a=0;return r.forEach((s=>{const i=this.Ge.ht(),o=`projects/${i.projectId}/databases/${i.database}/documents/${s.path.canonicalString()}`;t.mightContain(o)||(this.et(n,s,null),a++)})),a}Tt(t){const n=new Map;this.ze.forEach(((s,i)=>{const o=this.ot(i);if(o){if(s.current&&Gk(o.target)){const l=new lt(o.target.path);this.It(l).has(i)||this.Et(i,l)||this.et(i,l,La.newNoDocument(l,t))}s.Be&&(n.set(i,s.ke()),s.qe())}}));let r=qt();this.He.forEach(((s,i)=>{let o=!0;i.forEachWhile((l=>{const h=this.ot(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)})),o&&(r=r.add(s))})),this.je.forEach(((s,i)=>i.setReadTime(t)));const a=new a1(t,n,this.Ye,this.je,r);return this.je=ql(),this.Je=Zw(),this.He=Zw(),this.Ye=new ir(Gt),a}Xe(t,n){if(!this.rt(t))return;const r=this.Et(t,n.key)?2:0;this.nt(t).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(t)),this.He=this.He.insert(n.key,this.dt(n.key).add(t))}et(t,n,r){if(!this.rt(t))return;const a=this.nt(t);this.Et(t,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(t)),this.He=this.He.insert(n,this.dt(n).add(t)),r&&(this.je=this.je.insert(n,r))}removeTarget(t){this.ze.delete(t)}_t(t){const n=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let n=this.ze.get(t);return n||(n=new $3,this.ze.set(t,n)),n}dt(t){let n=this.He.get(t);return n||(n=new na(Gt),this.He=this.He.insert(t,n)),n}It(t){let n=this.Je.get(t);return n||(n=new na(Gt),this.Je=this.Je.insert(t,n)),n}rt(t){const n=this.ot(t)!==null;return n||Xe("WatchChangeAggregator","Detected inactive target",t),n}ot(t){const n=this.ze.get(t);return n&&n.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new $3),this.Ge.getRemoteKeysForTarget(t).forEach((n=>{this.et(t,n,null)}))}Et(t,n){return this.Ge.getRemoteKeysForTarget(t).has(n)}}function Zw(){return new ir(lt.comparator)}function O3(){return new ir(lt.comparator)}const Ree={asc:"ASCENDING",desc:"DESCENDING"},Dee={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Mee={and:"AND",or:"OR"};class $ee{constructor(t,n){this.databaseId=t,this.useProto3Json=n}}function Kk(e,t){return e.useProto3Json||Q_(t)?t:{value:t}}function t_(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Q4(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Oee(e,t){return t_(e,t.toTimestamp())}function Lo(e){return mn(!!e,49232),St.fromTimestamp((function(n){const r=uc(n);return new Bn(r.seconds,r.nanos)})(e))}function KN(e,t){return Xk(e,t).canonicalString()}function Xk(e,t){const n=(function(a){return new Pn(["projects",a.projectId,"databases",a.database])})(e).child("documents");return t===void 0?n:n.child(t)}function Z4(e){const t=Pn.fromString(e);return mn(rV(t),10190,{key:t.toString()}),t}function Yk(e,t){return KN(e.databaseId,t.path)}function nk(e,t){const n=Z4(t);if(n.get(1)!==e.databaseId.projectId)throw new qe(Ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new qe(Ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new lt(eV(n))}function J4(e,t){return KN(e.databaseId,t)}function Fee(e){const t=Z4(e);return t.length===4?Pn.emptyPath():eV(t)}function Qk(e){return new Pn(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function eV(e){return mn(e.length>4&&e.get(4)==="documents",29091,{key:e.toString()}),e.popFirst(5)}function F3(e,t,n){return{name:Yk(e,t),fields:n.value.mapValue.fields}}function Pee(e,t){let n;if("targetChange"in t){t.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:yt(39313,{state:h})})(t.targetChange.targetChangeType||"NO_CHANGE"),a=t.targetChange.targetIds||[],s=(function(h,c){return h.useProto3Json?(mn(c===void 0||typeof c=="string",58123),Ia.fromBase64String(c||"")):(mn(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),Ia.fromUint8Array(c||new Uint8Array))})(e,t.targetChange.resumeToken),i=t.targetChange.cause,o=i&&(function(h){const c=h.code===void 0?Ae.UNKNOWN:K4(h.code);return new qe(c,h.message||"")})(i);n=new Y4(r,a,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const a=nk(e,r.document.name),s=Lo(r.document.updateTime),i=r.document.createTime?Lo(r.document.createTime):St.min(),o=new Cs({mapValue:{fields:r.document.fields}}),l=La.newFoundDocument(a,s,i,o),h=r.targetIds||[],c=r.removedTargetIds||[];n=new C0(h,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const a=nk(e,r.document),s=r.readTime?Lo(r.readTime):St.min(),i=La.newNoDocument(a,s),o=r.removedTargetIds||[];n=new C0([],o,i.key,i)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const a=nk(e,r.document),s=r.removedTargetIds||[];n=new C0([],s,a,null)}else{if(!("filter"in t))return yt(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:a=0,unchangedNames:s}=r,i=new kee(a,s),o=r.targetId;n=new X4(o,i)}}return n}function Lee(e,t){let n;if(t instanceof wv)n={update:F3(e,t.key,t.value)};else if(t instanceof q4)n={delete:Yk(e,t.key)};else if(t instanceof Fc)n={update:F3(e,t.key,t.data),updateMask:qee(t.fieldMask)};else{if(!(t instanceof See))return yt(16599,{Vt:t.type});n={verify:Yk(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((r=>(function(s,i){const o=i.transform;if(o instanceof jb)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Hb)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Gb)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof e_)return{fieldPath:i.field.canonicalString(),increment:o.Ae};throw yt(20930,{transform:i.transform})})(0,r)))),t.precondition.isNone||(n.currentDocument=(function(a,s){return s.updateTime!==void 0?{updateTime:Oee(a,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:yt(27497)})(e,t.precondition)),n}function zee(e,t){return e&&e.length>0?(mn(t!==void 0,14353),e.map((n=>(function(a,s){let i=a.updateTime?Lo(a.updateTime):Lo(s);return i.isEqual(St.min())&&(i=Lo(s)),new xee(i,a.transformResults||[])})(n,t)))):[]}function Vee(e,t){return{documents:[J4(e,t.path)]}}function Uee(e,t){const n={structuredQuery:{}},r=t.path;let a;t.collectionGroup!==null?(a=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(a=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=J4(e,a);const s=(function(h){if(h.length!==0)return nV(Ji.create(h,"and"))})(t.filters);s&&(n.structuredQuery.where=s);const i=(function(h){if(h.length!==0)return h.map((c=>(function(m){return{field:Hf(m.field),direction:jee(m.dir)}})(c)))})(t.orderBy);i&&(n.structuredQuery.orderBy=i);const o=Kk(e,t.limit);return o!==null&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(t.startAt)),t.endAt&&(n.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(t.endAt)),{ft:n,parent:a}}function Bee(e){let t=Fee(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let a=null;if(r>0){mn(r===1,65062);const c=n.from[0];c.allDescendants?a=c.collectionId:t=t.child(c.collectionId)}let s=[];n.where&&(s=(function(p){const m=tV(p);return m instanceof Ji&&A4(m)?m.getFilters():[m]})(n.where));let i=[];n.orderBy&&(i=(function(p){return p.map((m=>(function(b){return new Wb(Gf(b.field),(function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(m)))})(n.orderBy));let o=null;n.limit&&(o=(function(p){let m;return m=typeof p=="object"?p.value:p,Q_(m)?null:m})(n.limit));let l=null;n.startAt&&(l=(function(p){const m=!!p.before,g=p.values||[];return new Z0(g,m)})(n.startAt));let h=null;return n.endAt&&(h=(function(p){const m=!p.before,g=p.values||[];return new Z0(g,m)})(n.endAt)),iee(t,a,i,s,o,"F",l,h)}function Wee(e,t){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return yt(28987,{purpose:a})}})(t.purpose);return n==null?null:{"goog-listen-tags":n}}function tV(e){return e.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Gf(n.unaryFilter.field);return Vr.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=Gf(n.unaryFilter.field);return Vr.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Gf(n.unaryFilter.field);return Vr.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Gf(n.unaryFilter.field);return Vr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return yt(61313);default:return yt(60726)}})(e):e.fieldFilter!==void 0?(function(n){return Vr.create(Gf(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return yt(58110);default:return yt(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(e):e.compositeFilter!==void 0?(function(n){return Ji.create(n.compositeFilter.filters.map((r=>tV(r))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return yt(1026)}})(n.compositeFilter.op))})(e):yt(30097,{filter:e})}function jee(e){return Ree[e]}function Hee(e){return Dee[e]}function Gee(e){return Mee[e]}function Hf(e){return{fieldPath:e.canonicalString()}}function Gf(e){return Sa.fromServerFormat(e.fieldPath)}function nV(e){return e instanceof Vr?(function(n){if(n.op==="=="){if(S3(n.value))return{unaryFilter:{field:Hf(n.field),op:"IS_NAN"}};if(_3(n.value))return{unaryFilter:{field:Hf(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(S3(n.value))return{unaryFilter:{field:Hf(n.field),op:"IS_NOT_NAN"}};if(_3(n.value))return{unaryFilter:{field:Hf(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hf(n.field),op:Hee(n.op),value:n.value}}})(e):e instanceof Ji?(function(n){const r=n.getFilters().map((a=>nV(a)));return r.length===1?r[0]:{compositeFilter:{op:Gee(n.op),filters:r}}})(e):yt(54877,{filter:e})}function qee(e){const t=[];return e.fields.forEach((n=>t.push(n.canonicalString()))),{fieldPaths:t}}function rV(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}class Xu{constructor(t,n,r,a,s=St.min(),i=St.min(),o=Ia.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(t){return new Xu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new Xu(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Xu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Xu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Kee{constructor(t){this.yt=t}}function Xee(e){const t=Bee({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?J0(t,t.limit,"L"):t}class Yee{constructor(){this.Cn=new Qee}addToCollectionParentIndex(t,n){return this.Cn.add(n),Me.resolve()}getCollectionParents(t,n){return Me.resolve(this.Cn.getEntries(n))}addFieldIndex(t,n){return Me.resolve()}deleteFieldIndex(t,n){return Me.resolve()}deleteAllFieldIndexes(t){return Me.resolve()}createTargetIndexes(t,n){return Me.resolve()}getDocumentsMatchingTarget(t,n){return Me.resolve(null)}getIndexType(t,n){return Me.resolve(0)}getFieldIndexes(t,n){return Me.resolve([])}getNextCollectionGroupToUpdate(t){return Me.resolve(null)}getMinOffset(t,n){return Me.resolve(lc.min())}getMinOffsetFromCollectionGroup(t,n){return Me.resolve(lc.min())}updateCollectionGroup(t,n,r){return Me.resolve()}updateIndexEntries(t,n){return Me.resolve()}}class Qee{constructor(){this.index={}}add(t){const n=t.lastSegment(),r=t.popLast(),a=this.index[n]||new na(Pn.comparator),s=!a.has(r);return this.index[n]=a.add(r),s}has(t){const n=t.lastSegment(),r=t.popLast(),a=this.index[n];return a&&a.has(r)}getEntries(t){return(this.index[t]||new na(Pn.comparator)).toArray()}}const P3={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},aV=41943040;class ks{static withCacheSize(t){return new ks(t,ks.DEFAULT_COLLECTION_PERCENTILE,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}ks.DEFAULT_COLLECTION_PERCENTILE=10,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ks.DEFAULT=new ks(aV,ks.DEFAULT_COLLECTION_PERCENTILE,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ks.DISABLED=new ks(-1,0,0);class hm{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new hm(0)}static cr(){return new hm(-1)}}const L3="LruGarbageCollector",Zee=1048576;function z3([e,t],[n,r]){const a=Gt(e,n);return a===0?Gt(t,r):a}class Jee{constructor(t){this.Ir=t,this.buffer=new na(z3),this.Er=0}dr(){return++this.Er}Ar(t){const n=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();z3(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class ete{constructor(t,n,r){this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){Xe(L3,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Pm(n)?Xe(L3,"Ignoring IndexedDB error during garbage collection: ",n):await Fm(n)}await this.Vr(3e5)}))}}class tte{constructor(t,n){this.mr=t,this.params=n}calculateTargetCount(t,n){return this.mr.gr(t).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(t,n){if(n===0)return Me.resolve(Y_.ce);const r=new Jee(n);return this.mr.forEachTarget(t,(a=>r.Ar(a.sequenceNumber))).next((()=>this.mr.pr(t,(a=>r.Ar(a))))).next((()=>r.maxValue))}removeTargets(t,n,r){return this.mr.removeTargets(t,n,r)}removeOrphanedDocuments(t,n){return this.mr.removeOrphanedDocuments(t,n)}collect(t,n){return this.params.cacheSizeCollectionThreshold===-1?(Xe("LruGarbageCollector","Garbage collection skipped; disabled"),Me.resolve(P3)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(Xe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),P3):this.yr(t,n)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,n){let r,a,s,i,o,l,h;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(Xe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),a=this.params.maximumSequenceNumbersToCollect):a=p,i=Date.now(),this.nthSequenceNumber(t,a)))).next((p=>(r=p,o=Date.now(),this.removeTargets(t,r,n)))).next((p=>(s=p,l=Date.now(),this.removeOrphanedDocuments(t,r)))).next((p=>(h=Date.now(),Wf()<=Ht.DEBUG&&Xe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${i-c}ms
	Determined least recently used ${a} in `+(o-i)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${p} documents in `+(h-l)+`ms
Total Duration: ${h-c}ms`),Me.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:s,documentsRemoved:p}))))}}function nte(e,t){return new tte(e,t)}class rte{constructor(){this.changes=new _d((t=>t.toString()),((t,n)=>t.isEqual(n))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,n){this.assertNotApplied(),this.changes.set(t,La.newInvalidDocument(t).setReadTime(n))}getEntry(t,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Me.resolve(r):this.getFromCache(t,n)}getEntries(t,n){return this.getAllFromCache(t,n)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ate{constructor(t,n){this.overlayedDocument=t,this.mutatedFields=n}}class ste{constructor(t,n,r,a){this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=a}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next((a=>(r=a,this.remoteDocumentCache.getEntry(t,n)))).next((a=>(r!==null&&Nb(r.mutation,a,qs.empty(),Bn.now()),a)))}getDocuments(t,n){return this.remoteDocumentCache.getEntries(t,n).next((r=>this.getLocalViewOfDocuments(t,r,qt()).next((()=>r))))}getLocalViewOfDocuments(t,n,r=qt()){const a=Ph();return this.populateOverlays(t,a,n).next((()=>this.computeViews(t,n,a,r).next((s=>{let i=cb();return s.forEach(((o,l)=>{i=i.insert(o,l.overlayedDocument)})),i}))))}getOverlayedDocuments(t,n){const r=Ph();return this.populateOverlays(t,r,n).next((()=>this.computeViews(t,n,r,qt())))}populateOverlays(t,n,r){const a=[];return r.forEach((s=>{n.has(s)||a.push(s)})),this.documentOverlayCache.getOverlays(t,a).next((s=>{s.forEach(((i,o)=>{n.set(i,o)}))}))}computeViews(t,n,r,a){let s=ql();const i=Eb(),o=(function(){return Eb()})();return n.forEach(((l,h)=>{const c=r.get(h.key);a.has(h.key)&&(c===void 0||c.mutation instanceof Fc)?s=s.insert(h.key,h):c!==void 0?(i.set(h.key,c.mutation.getFieldMask()),Nb(c.mutation,h,c.mutation.getFieldMask(),Bn.now())):i.set(h.key,qs.empty())})),this.recalculateAndSaveOverlays(t,s).next((l=>(l.forEach(((h,c)=>i.set(h,c))),n.forEach(((h,c)=>o.set(h,new ate(c,i.get(h)??null)))),o)))}recalculateAndSaveOverlays(t,n){const r=Eb();let a=new ir(((i,o)=>i-o)),s=qt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,n).next((i=>{for(const o of i)o.keys().forEach((l=>{const h=n.get(l);if(h===null)return;let c=r.get(l)||qs.empty();c=o.applyToLocalView(h,c),r.set(l,c);const p=(a.get(o.batchId)||qt()).add(l);a=a.insert(o.batchId,p)}))})).next((()=>{const i=[],o=a.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),h=l.key,c=l.value,p=z4();c.forEach((m=>{if(!s.has(m)){const g=H4(n.get(m),r.get(m));g!==null&&p.set(m,g),s=s.add(m)}})),i.push(this.documentOverlayCache.saveOverlays(t,h,p))}return Me.waitFor(i)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,n){return this.remoteDocumentCache.getEntries(t,n).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,n,r,a){return(function(i){return lt.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(t,n.path):$4(n)?this.getDocumentsMatchingCollectionGroupQuery(t,n,r,a):this.getDocumentsMatchingCollectionQuery(t,n,r,a)}getNextDocuments(t,n,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(t,n,r,a).next((s=>{const i=a-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,n,r.largestBatchId,a-s.size):Me.resolve(Ph());let o=zb,l=s;return i.next((h=>Me.forEach(h,((c,p)=>(o<p.largestBatchId&&(o=p.largestBatchId),s.get(c)?Me.resolve():this.remoteDocumentCache.getEntry(t,c).next((m=>{l=l.insert(c,m)}))))).next((()=>this.populateOverlays(t,h,s))).next((()=>this.computeViews(t,l,h,qt()))).next((c=>({batchId:o,changes:L4(c)})))))}))}getDocumentsMatchingDocumentQuery(t,n){return this.getDocument(t,new lt(n)).next((r=>{let a=cb();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a}))}getDocumentsMatchingCollectionGroupQuery(t,n,r,a){const s=n.collectionGroup;let i=cb();return this.indexManager.getCollectionParents(t,s).next((o=>Me.forEach(o,(l=>{const h=(function(p,m){return new Lm(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,h,r,a).next((c=>{c.forEach(((p,m)=>{i=i.insert(p,m)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,n,r,a){let s;return this.documentOverlayCache.getOverlaysForCollection(t,n.path,r.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,r,s,a)))).next((i=>{s.forEach(((l,h)=>{const c=h.getKey();i.get(c)===null&&(i=i.insert(c,La.newInvalidDocument(c)))}));let o=cb();return i.forEach(((l,h)=>{const c=s.get(l);c!==void 0&&Nb(c.mutation,h,qs.empty(),Bn.now()),t1(n,h)&&(o=o.insert(l,h))})),o}))}}class ite{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,n){return Me.resolve(this.Lr.get(n))}saveBundleMetadata(t,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:Lo(a.createTime)}})(n)),Me.resolve()}getNamedQuery(t,n){return Me.resolve(this.kr.get(n))}saveNamedQuery(t,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:Xee(a.bundledQuery),readTime:Lo(a.readTime)}})(n)),Me.resolve()}}class ote{constructor(){this.overlays=new ir(lt.comparator),this.qr=new Map}getOverlay(t,n){return Me.resolve(this.overlays.get(n))}getOverlays(t,n){const r=Ph();return Me.forEach(n,(a=>this.getOverlay(t,a).next((s=>{s!==null&&r.set(a,s)})))).next((()=>r))}saveOverlays(t,n,r){return r.forEach(((a,s)=>{this.St(t,n,s)})),Me.resolve()}removeOverlaysForBatchId(t,n,r){const a=this.qr.get(r);return a!==void 0&&(a.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),Me.resolve()}getOverlaysForCollection(t,n,r){const a=Ph(),s=n.length+1,i=new lt(n.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const l=o.getNext().value,h=l.getKey();if(!n.isPrefixOf(h.path))break;h.path.length===s&&l.largestBatchId>r&&a.set(l.getKey(),l)}return Me.resolve(a)}getOverlaysForCollectionGroup(t,n,r,a){let s=new ir(((h,c)=>h-c));const i=this.overlays.getIterator();for(;i.hasNext();){const h=i.getNext().value;if(h.getKey().getCollectionGroup()===n&&h.largestBatchId>r){let c=s.get(h.largestBatchId);c===null&&(c=Ph(),s=s.insert(h.largestBatchId,c)),c.set(h.getKey(),h)}}const o=Ph(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((h,c)=>o.set(h,c))),!(o.size()>=a)););return Me.resolve(o)}St(t,n,r){const a=this.overlays.get(r.key);if(a!==null){const i=this.qr.get(a.largestBatchId).delete(r.key);this.qr.set(a.largestBatchId,i)}this.overlays=this.overlays.insert(r.key,new Tee(n,r));let s=this.qr.get(n);s===void 0&&(s=qt(),this.qr.set(n,s)),this.qr.set(n,s.add(r.key))}}class lte{constructor(){this.sessionToken=Ia.EMPTY_BYTE_STRING}getSessionToken(t){return Me.resolve(this.sessionToken)}setSessionToken(t,n){return this.sessionToken=n,Me.resolve()}}class XN{constructor(){this.Qr=new na(da.$r),this.Ur=new na(da.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,n){const r=new da(t,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,n){t.forEach((r=>this.addReference(r,n)))}removeReference(t,n){this.Gr(new da(t,n))}zr(t,n){t.forEach((r=>this.removeReference(r,n)))}jr(t){const n=new lt(new Pn([])),r=new da(n,t),a=new da(n,t+1),s=[];return this.Ur.forEachInRange([r,a],(i=>{this.Gr(i),s.push(i.key)})),s}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const n=new lt(new Pn([])),r=new da(n,t),a=new da(n,t+1);let s=qt();return this.Ur.forEachInRange([r,a],(i=>{s=s.add(i.key)})),s}containsKey(t){const n=new da(t,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)}}class da{constructor(t,n){this.key=t,this.Yr=n}static $r(t,n){return lt.comparator(t.key,n.key)||Gt(t.Yr,n.Yr)}static Kr(t,n){return Gt(t.Yr,n.Yr)||lt.comparator(t.key,n.key)}}class ute{constructor(t,n){this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new na(da.$r)}checkEmpty(t){return Me.resolve(this.mutationQueue.length===0)}addMutationBatch(t,n,r,a){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Iee(s,n,r,a);this.mutationQueue.push(i);for(const o of a)this.Zr=this.Zr.add(new da(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return Me.resolve(i)}lookupMutationBatch(t,n){return Me.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(t,n){const r=n+1,a=this.ei(r),s=a<0?0:a;return Me.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Me.resolve(this.mutationQueue.length===0?VN:this.tr-1)}getAllMutationBatches(t){return Me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,n){const r=new da(n,0),a=new da(n,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,a],(i=>{const o=this.Xr(i.Yr);s.push(o)})),Me.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,n){let r=new na(Gt);return n.forEach((a=>{const s=new da(a,0),i=new da(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,i],(o=>{r=r.add(o.Yr)}))})),Me.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,n){const r=n.path,a=r.length+1;let s=r;lt.isDocumentKey(s)||(s=s.child(""));const i=new da(new lt(s),0);let o=new na(Gt);return this.Zr.forEachWhile((l=>{const h=l.key.path;return!!r.isPrefixOf(h)&&(h.length===a&&(o=o.add(l.Yr)),!0)}),i),Me.resolve(this.ti(o))}ti(t){const n=[];return t.forEach((r=>{const a=this.Xr(r);a!==null&&n.push(a)})),n}removeMutationBatch(t,n){mn(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Me.forEach(n.mutations,(a=>{const s=new da(a.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,a.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,n){const r=new da(n,0),a=this.Zr.firstAfterOrEqual(r);return Me.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(t){return this.mutationQueue.length,Me.resolve()}ni(t,n){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const n=this.ei(t);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class cte{constructor(t){this.ri=t,this.docs=(function(){return new ir(lt.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,n){const r=n.key,a=this.docs.get(r),s=a?a.size:0,i=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)}getEntry(t,n){const r=this.docs.get(n);return Me.resolve(r?r.document.mutableCopy():La.newInvalidDocument(n))}getEntries(t,n){let r=ql();return n.forEach((a=>{const s=this.docs.get(a);r=r.insert(a,s?s.document.mutableCopy():La.newInvalidDocument(a))})),Me.resolve(r)}getDocumentsMatchingQuery(t,n,r,a){let s=ql();const i=n.path,o=new lt(i.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:h,value:{document:c}}=l.getNext();if(!i.isPrefixOf(h.path))break;h.path.length>i.length+1||LJ(PJ(c),r)<=0||(a.has(c.key)||t1(n,c))&&(s=s.insert(c.key,c.mutableCopy()))}return Me.resolve(s)}getAllFromCollectionGroup(t,n,r,a){yt(9500)}ii(t,n){return Me.forEach(this.docs,(r=>n(r)))}newChangeBuffer(t){return new hte(this)}getSize(t){return Me.resolve(this.size)}}class hte extends rte{constructor(t){super(),this.Nr=t}applyChanges(t){const n=[];return this.changes.forEach(((r,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(t,a)):this.Nr.removeEntry(r)})),Me.waitFor(n)}getFromCache(t,n){return this.Nr.getEntry(t,n)}getAllFromCache(t,n){return this.Nr.getEntries(t,n)}}class dte{constructor(t){this.persistence=t,this.si=new _d((n=>WN(n)),jN),this.lastRemoteSnapshotVersion=St.min(),this.highestTargetId=0,this.oi=0,this._i=new XN,this.targetCount=0,this.ai=hm.ur()}forEachTarget(t,n){return this.si.forEach(((r,a)=>n(a))),Me.resolve()}getLastRemoteSnapshotVersion(t){return Me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Me.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),Me.resolve(this.highestTargetId)}setTargetsMetadata(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),Me.resolve()}Pr(t){this.si.set(t.target,t);const n=t.targetId;n>this.highestTargetId&&(this.ai=new hm(n),this.highestTargetId=n),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,n){return this.Pr(n),this.targetCount+=1,Me.resolve()}updateTargetData(t,n){return this.Pr(n),Me.resolve()}removeTargetData(t,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Me.resolve()}removeTargets(t,n,r){let a=0;const s=[];return this.si.forEach(((i,o)=>{o.sequenceNumber<=n&&r.get(o.targetId)===null&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),a++)})),Me.waitFor(s).next((()=>a))}getTargetCount(t){return Me.resolve(this.targetCount)}getTargetData(t,n){const r=this.si.get(n)||null;return Me.resolve(r)}addMatchingKeys(t,n,r){return this._i.Wr(n,r),Me.resolve()}removeMatchingKeys(t,n,r){this._i.zr(n,r);const a=this.persistence.referenceDelegate,s=[];return a&&n.forEach((i=>{s.push(a.markPotentiallyOrphaned(t,i))})),Me.waitFor(s)}removeMatchingKeysForTargetId(t,n){return this._i.jr(n),Me.resolve()}getMatchingKeysForTargetId(t,n){const r=this._i.Hr(n);return Me.resolve(r)}containsKey(t,n){return Me.resolve(this._i.containsKey(n))}}class sV{constructor(t,n){this.ui={},this.overlays={},this.ci=new Y_(0),this.li=!1,this.li=!0,this.hi=new lte,this.referenceDelegate=t(this),this.Pi=new dte(this),this.indexManager=new Yee,this.remoteDocumentCache=(function(a){return new cte(a)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Kee(n),this.Ii=new ite(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let n=this.overlays[t.toKey()];return n||(n=new ote,this.overlays[t.toKey()]=n),n}getMutationQueue(t,n){let r=this.ui[t.toKey()];return r||(r=new ute(n,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,n,r){Xe("MemoryPersistence","Starting transaction:",t);const a=new pte(this.ci.next());return this.referenceDelegate.Ei(),r(a).next((s=>this.referenceDelegate.di(a).next((()=>s)))).toPromise().then((s=>(a.raiseOnCommittedEvent(),s)))}Ai(t,n){return Me.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,n))))}}class pte extends VJ{constructor(t){super(),this.currentSequenceNumber=t}}class YN{constructor(t){this.persistence=t,this.Ri=new XN,this.Vi=null}static mi(t){return new YN(t)}get fi(){if(this.Vi)return this.Vi;throw yt(60996)}addReference(t,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),Me.resolve()}removeReference(t,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),Me.resolve()}markPotentiallyOrphaned(t,n){return this.fi.add(n.toString()),Me.resolve()}removeTarget(t,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,n.targetId).next((a=>{a.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(t,n)))}Ei(){this.Vi=new Set}di(t){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Me.forEach(this.fi,(r=>{const a=lt.fromPath(r);return this.gi(t,a).next((s=>{s||n.removeEntry(a,St.min())}))})).next((()=>(this.Vi=null,n.apply(t))))}updateLimboDocument(t,n){return this.gi(t,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(t){return 0}gi(t,n){return Me.or([()=>Me.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(t,n),()=>this.persistence.Ai(t,n)])}}class n_{constructor(t,n){this.persistence=t,this.pi=new _d((r=>WJ(r.path)),((r,a)=>r.isEqual(a))),this.garbageCollector=nte(this,n)}static mi(t,n){return new n_(t,n)}Ei(){}di(t){return Me.resolve()}forEachTarget(t,n){return this.persistence.getTargetCache().forEachTarget(t,n)}gr(t){const n=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>n.next((a=>r+a))))}wr(t){let n=0;return this.pr(t,(r=>{n++})).next((()=>n))}pr(t,n){return Me.forEach(this.pi,((r,a)=>this.br(t,r,a).next((s=>s?Me.resolve():n(a)))))}removeTargets(t,n,r){return this.persistence.getTargetCache().removeTargets(t,n,r)}removeOrphanedDocuments(t,n){let r=0;const a=this.persistence.getRemoteDocumentCache(),s=a.newChangeBuffer();return a.ii(t,(i=>this.br(t,i,n).next((o=>{o||(r++,s.removeEntry(i,St.min()))})))).next((()=>s.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,n){return this.pi.set(n,t.currentSequenceNumber),Me.resolve()}removeTarget(t,n){const r=n.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,n,r){return this.pi.set(r,t.currentSequenceNumber),Me.resolve()}removeReference(t,n,r){return this.pi.set(r,t.currentSequenceNumber),Me.resolve()}updateLimboDocument(t,n){return this.pi.set(n,t.currentSequenceNumber),Me.resolve()}Ti(t){let n=t.key.toString().length;return t.isFoundDocument()&&(n+=k0(t.data.value)),n}br(t,n,r){return Me.or([()=>this.persistence.Ai(t,n),()=>this.persistence.getTargetCache().containsKey(t,n),()=>{const a=this.pi.get(n);return Me.resolve(a!==void 0&&a>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class QN{constructor(t,n,r,a){this.targetId=t,this.fromCache=n,this.Es=r,this.ds=a}static As(t,n){let r=qt(),a=qt();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}return new QN(t,n.fromCache,r,a)}}class fte{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class mte{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return jX()?8:UJ(Wa())>0?6:4})()}initialize(t,n){this.ps=t,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(t,n,r,a){const s={result:null};return this.ys(t,n).next((i=>{s.result=i})).next((()=>{if(!s.result)return this.ws(t,n,a,r).next((i=>{s.result=i}))})).next((()=>{if(s.result)return;const i=new fte;return this.Ss(t,n,i).next((o=>{if(s.result=o,this.Vs)return this.bs(t,n,i,o.size)}))})).next((()=>s.result))}bs(t,n,r,a){return r.documentReadCount<this.fs?(Wf()<=Ht.DEBUG&&Xe("QueryEngine","SDK will not create cache indexes for query:",jf(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Me.resolve()):(Wf()<=Ht.DEBUG&&Xe("QueryEngine","Query:",jf(n),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.gs*a?(Wf()<=Ht.DEBUG&&Xe("QueryEngine","The SDK decides to create cache indexes for query:",jf(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Po(n))):Me.resolve())}ys(t,n){if(E3(n))return Me.resolve(null);let r=Po(n);return this.indexManager.getIndexType(t,r).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=J0(n,null,"F"),r=Po(n)),this.indexManager.getDocumentsMatchingTarget(t,r).next((s=>{const i=qt(...s);return this.ps.getDocuments(t,i).next((o=>this.indexManager.getMinOffset(t,r).next((l=>{const h=this.Ds(n,o);return this.Cs(n,h,i,l.readTime)?this.ys(t,J0(n,null,"F")):this.vs(t,h,n,l)}))))})))))}ws(t,n,r,a){return E3(n)||a.isEqual(St.min())?Me.resolve(null):this.ps.getDocuments(t,r).next((s=>{const i=this.Ds(n,s);return this.Cs(n,i,r,a)?Me.resolve(null):(Wf()<=Ht.DEBUG&&Xe("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),jf(n)),this.vs(t,i,n,FJ(a,zb)).next((o=>o)))}))}Ds(t,n){let r=new na(F4(t));return n.forEach(((a,s)=>{t1(t,s)&&(r=r.add(s))})),r}Cs(t,n,r,a){if(t.limit===null)return!1;if(r.size!==n.size)return!0;const s=t.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(a)>0)}Ss(t,n,r){return Wf()<=Ht.DEBUG&&Xe("QueryEngine","Using full collection scan to execute query:",jf(n)),this.ps.getDocumentsMatchingQuery(t,n,lc.min(),r)}vs(t,n,r,a){return this.ps.getDocumentsMatchingQuery(t,r,a).next((s=>(n.forEach((i=>{s=s.insert(i.key,i)})),s)))}}const ZN="LocalStore",gte=3e8;class yte{constructor(t,n,r,a){this.persistence=t,this.Fs=n,this.serializer=a,this.Ms=new ir(Gt),this.xs=new _d((s=>WN(s)),jN),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ste(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>t.collect(n,this.Ms)))}}function bte(e,t,n,r){return new yte(e,t,n,r)}async function iV(e,t){const n=kt(e);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let a;return n.mutationQueue.getAllMutationBatches(r).next((s=>(a=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(r)))).next((s=>{const i=[],o=[];let l=qt();for(const h of a){i.push(h.batchId);for(const c of h.mutations)l=l.add(c.key)}for(const h of s){o.push(h.batchId);for(const c of h.mutations)l=l.add(c.key)}return n.localDocuments.getDocuments(r,l).next((h=>({Ls:h,removedBatchIds:i,addedBatchIds:o})))}))}))}function vte(e,t){const n=kt(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const a=t.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(o,l,h,c){const p=h.batch,m=p.keys();let g=Me.resolve();return m.forEach((b=>{g=g.next((()=>c.getEntry(l,b))).next((v=>{const x=h.docVersions.get(b);mn(x!==null,48541),v.version.compareTo(x)<0&&(p.applyToRemoteDocument(v,h),v.isValidDocument()&&(v.setReadTime(h.commitVersion),c.addEntry(v)))}))})),g.next((()=>o.mutationQueue.removeMutationBatch(l,p)))})(n,r,t,s).next((()=>s.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,a,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(o){let l=qt();for(let h=0;h<o.mutationResults.length;++h)o.mutationResults[h].transformResults.length>0&&(l=l.add(o.batch.mutations[h].key));return l})(t)))).next((()=>n.localDocuments.getDocuments(r,a)))}))}function oV(e){const t=kt(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>t.Pi.getLastRemoteSnapshotVersion(n)))}function xte(e,t){const n=kt(e),r=t.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const o=[];t.targetChanges.forEach(((c,p)=>{const m=a.get(p);if(!m)return;o.push(n.Pi.removeMatchingKeys(s,c.removedDocuments,p).next((()=>n.Pi.addMatchingKeys(s,c.addedDocuments,p))));let g=m.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(p)!==null?g=g.withResumeToken(Ia.EMPTY_BYTE_STRING,St.min()).withLastLimboFreeSnapshotVersion(St.min()):c.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(c.resumeToken,r)),a=a.insert(p,g),(function(v,x,_){return v.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=gte?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0})(m,g,c)&&o.push(n.Pi.updateTargetData(s,g))}));let l=ql(),h=qt();if(t.documentUpdates.forEach((c=>{t.resolvedLimboDocuments.has(c)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(s,c))})),o.push(wte(s,i,t.documentUpdates).next((c=>{l=c.ks,h=c.qs}))),!r.isEqual(St.min())){const c=n.Pi.getLastRemoteSnapshotVersion(s).next((p=>n.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));o.push(c)}return Me.waitFor(o).next((()=>i.apply(s))).next((()=>n.localDocuments.getLocalViewOfDocuments(s,l,h))).next((()=>l))})).then((s=>(n.Ms=a,s)))}function wte(e,t,n){let r=qt(),a=qt();return n.forEach((s=>r=r.add(s))),t.getEntries(e,r).next((s=>{let i=ql();return n.forEach(((o,l)=>{const h=s.get(o);l.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(o)),l.isNoDocument()&&l.version.isEqual(St.min())?(t.removeEntry(o,l.readTime),i=i.insert(o,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(l),i=i.insert(o,l)):Xe(ZN,"Ignoring outdated watch update for ",o,". Current version:",h.version," Watch version:",l.version)})),{ks:i,qs:a}}))}function _te(e,t){const n=kt(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=VN),n.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function Ste(e,t){const n=kt(e);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let a;return n.Pi.getTargetData(r,t).next((s=>s?(a=s,Me.resolve(a)):n.Pi.allocateTargetId(r).next((i=>(a=new Xu(t,i,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,a).next((()=>a)))))))})).then((r=>{const a=n.Ms.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(t,r.targetId)),r}))}async function Zk(e,t,n){const r=kt(e),a=r.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(i=>r.persistence.referenceDelegate.removeTarget(i,a)))}catch(i){if(!Pm(i))throw i;Xe(ZN,`Failed to update sequence numbers for target ${t}: ${i}`)}r.Ms=r.Ms.remove(t),r.xs.delete(a.target)}function V3(e,t,n){const r=kt(e);let a=St.min(),s=qt();return r.persistence.runTransaction("Execute query","readwrite",(i=>(function(l,h,c){const p=kt(l),m=p.xs.get(c);return m!==void 0?Me.resolve(p.Ms.get(m)):p.Pi.getTargetData(h,c)})(r,i,Po(t)).next((o=>{if(o)return a=o.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(i,o.targetId).next((l=>{s=l}))})).next((()=>r.Fs.getDocumentsMatchingQuery(i,t,n?a:St.min(),n?s:qt()))).next((o=>(Ite(r,lee(t),o),{documents:o,Qs:s})))))}function Ite(e,t,n){let r=e.Os.get(t)||St.min();n.forEach(((a,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),e.Os.set(t,r)}class U3{constructor(){this.activeTargetIds=fee()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Tte{constructor(){this.Mo=new U3,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,n,r){}addLocalQueryTarget(t,n=!0){return n&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,n,r){this.xo[t]=n}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new U3,Promise.resolve()}handleUserChange(t,n,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class kte{Oo(t){}shutdown(){}}const B3="ConnectivityMonitor";class W3{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Xe(B3,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){Xe(B3,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Jw=null;function Jk(){return Jw===null?Jw=(function(){return 268435456+Math.round(2147483648*Math.random())})():Jw++,"0x"+Jw.toString(16)}const rk="RestConnection",Ete={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Nte{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+t.host,this.Ko=`projects/${r}/databases/${a}`,this.Wo=this.databaseId.database===Y0?`project_id=${r}`:`project_id=${r}&database_id=${a}`}Go(t,n,r,a,s){const i=Jk(),o=this.zo(t,n.toUriEncodedString());Xe(rk,`Sending RPC '${t}' ${i}:`,o,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,a,s);const{host:h}=new URL(o),c=Rc(h);return this.Jo(t,o,l,r,c).then((p=>(Xe(rk,`Received RPC '${t}' ${i}: `,p),p)),(p=>{throw om(rk,`RPC '${t}' ${i} failed with error: `,p,"url: ",o,"request:",r),p}))}Ho(t,n,r,a,s,i){return this.Go(t,n,r,a,s)}jo(t,n,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Om})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,s)=>t[s]=a)),r&&r.headers.forEach(((a,s)=>t[s]=a))}zo(t,n){const r=Ete[t];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class Cte{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Fa="WebChannelConnection";class Ate extends Nte{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,n,r,a,s){const i=Jk();return new Promise(((o,l)=>{const h=new u4;h.setWithCredentials(!0),h.listenOnce(c4.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case T0.NO_ERROR:const p=h.getResponseJson();Xe(Fa,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(p)),o(p);break;case T0.TIMEOUT:Xe(Fa,`RPC '${t}' ${i} timed out`),l(new qe(Ae.DEADLINE_EXCEEDED,"Request time out"));break;case T0.HTTP_ERROR:const m=h.getStatus();if(Xe(Fa,`RPC '${t}' ${i} failed with status:`,m,"response text:",h.getResponseText()),m>0){let g=h.getResponseJson();Array.isArray(g)&&(g=g[0]);const b=g?.error;if(b&&b.status&&b.message){const v=(function(_){const I=_.toLowerCase().replace(/_/g,"-");return Object.values(Ae).indexOf(I)>=0?I:Ae.UNKNOWN})(b.status);l(new qe(v,b.message))}else l(new qe(Ae.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new qe(Ae.UNAVAILABLE,"Connection failed."));break;default:yt(9055,{l_:t,streamId:i,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{Xe(Fa,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(a);Xe(Fa,`RPC '${t}' ${i} sending request:`,a),h.send(n,"POST",c,r,15)}))}T_(t,n,r){const a=Jk(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=p4(),o=d4(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const c=s.join("");Xe(Fa,`Creating RPC '${t}' stream ${a}: ${c}`,l);const p=i.createWebChannel(c,l);this.I_(p);let m=!1,g=!1;const b=new Cte({Yo:x=>{g?Xe(Fa,`Not sending because RPC '${t}' stream ${a} is closed:`,x):(m||(Xe(Fa,`Opening RPC '${t}' stream ${a} transport.`),p.open(),m=!0),Xe(Fa,`RPC '${t}' stream ${a} sending:`,x),p.send(x))},Zo:()=>p.close()}),v=(x,_,I)=>{x.listen(_,(k=>{try{I(k)}catch(E){setTimeout((()=>{throw E}),0)}}))};return v(p,ub.EventType.OPEN,(()=>{g||(Xe(Fa,`RPC '${t}' stream ${a} transport opened.`),b.o_())})),v(p,ub.EventType.CLOSE,(()=>{g||(g=!0,Xe(Fa,`RPC '${t}' stream ${a} transport closed`),b.a_(),this.E_(p))})),v(p,ub.EventType.ERROR,(x=>{g||(g=!0,om(Fa,`RPC '${t}' stream ${a} transport errored. Name:`,x.name,"Message:",x.message),b.a_(new qe(Ae.UNAVAILABLE,"The operation could not be completed")))})),v(p,ub.EventType.MESSAGE,(x=>{if(!g){const _=x.data[0];mn(!!_,16349);const I=_,k=I?.error||I[0]?.error;if(k){Xe(Fa,`RPC '${t}' stream ${a} received error:`,k);const E=k.status;let R=(function(C){const O=zr[C];if(O!==void 0)return K4(O)})(E),U=k.message;R===void 0&&(R=Ae.INTERNAL,U="Unknown error status: "+E+" with message "+k.message),g=!0,b.a_(new qe(R,U)),p.close()}else Xe(Fa,`RPC '${t}' stream ${a} received:`,_),b.u_(_)}})),v(o,h4.STAT_EVENT,(x=>{x.stat===Uk.PROXY?Xe(Fa,`RPC '${t}' stream ${a} detected buffering proxy`):x.stat===Uk.NOPROXY&&Xe(Fa,`RPC '${t}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((n=>n===t))}}function ak(){return typeof document<"u"?document:null}function s1(e){return new $ee(e,!0)}class lV{constructor(t,n,r=1e3,a=1.5,s=6e4){this.Mi=t,this.timerId=n,this.d_=r,this.A_=a,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-r);a>0&&Xe("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const j3="PersistentStream";class uV{constructor(t,n,r,a,s,i,o,l){this.Mi=t,this.S_=r,this.b_=a,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lV(t,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():n&&n.code===Ae.RESOURCE_EXHAUSTED?(Gl(n.toString()),Gl("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(n)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,a])=>{this.D_===n&&this.G_(r,a)}),(r=>{t((()=>{const a=new qe(Ae.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(a)}))}))}G_(t,n){const r=this.W_(this.D_);this.stream=this.j_(t,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{r((()=>this.z_(a)))})),this.stream.onMessage((a=>{r((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return Xe(j3,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return n=>{this.Mi.enqueueAndForget((()=>this.D_===t?n():(Xe(j3,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Rte extends uV{constructor(t,n,r,a,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,a,i),this.serializer=s}j_(t,n){return this.connection.T_("Listen",t,n)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const n=Pee(this.serializer,t),r=(function(s){if(!("targetChange"in s))return St.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?St.min():i.readTime?Lo(i.readTime):St.min()})(t);return this.listener.H_(n,r)}Y_(t){const n={};n.database=Qk(this.serializer),n.addTarget=(function(s,i){let o;const l=i.target;if(o=Gk(l)?{documents:Vee(s,l)}:{query:Uee(s,l).ft},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){o.resumeToken=Q4(s,i.resumeToken);const h=Kk(s,i.expectedCount);h!==null&&(o.expectedCount=h)}else if(i.snapshotVersion.compareTo(St.min())>0){o.readTime=t_(s,i.snapshotVersion.toTimestamp());const h=Kk(s,i.expectedCount);h!==null&&(o.expectedCount=h)}return o})(this.serializer,t);const r=Wee(this.serializer,t);r&&(n.labels=r),this.q_(n)}Z_(t){const n={};n.database=Qk(this.serializer),n.removeTarget=t,this.q_(n)}}class Dte extends uV{constructor(t,n,r,a,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,a,i),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,n){return this.connection.T_("Write",t,n)}J_(t){return mn(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,mn(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){mn(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const n=zee(t.writeResults,t.commitTime),r=Lo(t.commitTime);return this.listener.na(r,n)}ra(){const t={};t.database=Qk(this.serializer),this.q_(t)}ea(t){const n={streamToken:this.lastStreamToken,writes:t.map((r=>Lee(this.serializer,r)))};this.q_(n)}}class Mte{}class $te extends Mte{constructor(t,n,r,a){super(),this.authCredentials=t,this.appCheckCredentials=n,this.connection=r,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new qe(Ae.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,n,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.Go(t,Xk(n,r),a,s,i))).catch((s=>{throw s.name==="FirebaseError"?(s.code===Ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new qe(Ae.UNKNOWN,s.toString())}))}Ho(t,n,r,a,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Ho(t,Xk(n,r),a,i,o,s))).catch((i=>{throw i.name==="FirebaseError"?(i.code===Ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new qe(Ae.UNKNOWN,i.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Ote{constructor(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const n=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Gl(n),this.aa=!1):Xe("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Zh="RemoteStore";class Fte{constructor(t,n,r,a,s){this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((i=>{r.enqueueAndForget((async()=>{Sd(this)&&(Xe(Zh,"Restarting streams for network reachability change."),await(async function(l){const h=kt(l);h.Ea.add(4),await Sv(h),h.Ra.set("Unknown"),h.Ea.delete(4),await i1(h)})(this))}))})),this.Ra=new Ote(r,a)}}async function i1(e){if(Sd(e))for(const t of e.da)await t(!0)}async function Sv(e){for(const t of e.da)await t(!1)}function cV(e,t){const n=kt(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),n2(n)?t2(n):zm(n).O_()&&e2(n,t))}function JN(e,t){const n=kt(e),r=zm(n);n.Ia.delete(t),r.O_()&&hV(n,t),n.Ia.size===0&&(r.O_()?r.L_():Sd(n)&&n.Ra.set("Unknown"))}function e2(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(St.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}zm(e).Y_(t)}function hV(e,t){e.Va.Ue(t),zm(e).Z_(t)}function t2(e){e.Va=new Aee({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),zm(e).start(),e.Ra.ua()}function n2(e){return Sd(e)&&!zm(e).x_()&&e.Ia.size>0}function Sd(e){return kt(e).Ea.size===0}function dV(e){e.Va=void 0}async function Pte(e){e.Ra.set("Online")}async function Lte(e){e.Ia.forEach(((t,n)=>{e2(e,t)}))}async function zte(e,t){dV(e),n2(e)?(e.Ra.ha(t),t2(e)):e.Ra.set("Unknown")}async function Vte(e,t,n){if(e.Ra.set("Online"),t instanceof Y4&&t.state===2&&t.cause)try{await(async function(a,s){const i=s.cause;for(const o of s.targetIds)a.Ia.has(o)&&(await a.remoteSyncer.rejectListen(o,i),a.Ia.delete(o),a.Va.removeTarget(o))})(e,t)}catch(r){Xe(Zh,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await r_(e,r)}else if(t instanceof C0?e.Va.Ze(t):t instanceof X4?e.Va.st(t):e.Va.tt(t),!n.isEqual(St.min()))try{const r=await oV(e.localStore);n.compareTo(r)>=0&&await(function(s,i){const o=s.Va.Tt(i);return o.targetChanges.forEach(((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const c=s.Ia.get(h);c&&s.Ia.set(h,c.withResumeToken(l.resumeToken,i))}})),o.targetMismatches.forEach(((l,h)=>{const c=s.Ia.get(l);if(!c)return;s.Ia.set(l,c.withResumeToken(Ia.EMPTY_BYTE_STRING,c.snapshotVersion)),hV(s,l);const p=new Xu(c.target,l,h,c.sequenceNumber);e2(s,p)})),s.remoteSyncer.applyRemoteEvent(o)})(e,n)}catch(r){Xe(Zh,"Failed to raise snapshot:",r),await r_(e,r)}}async function r_(e,t,n){if(!Pm(t))throw t;e.Ea.add(1),await Sv(e),e.Ra.set("Offline"),n||(n=()=>oV(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Xe(Zh,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await i1(e)}))}function pV(e,t){return t().catch((n=>r_(e,n,t)))}async function o1(e){const t=kt(e),n=dc(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:VN;for(;Ute(t);)try{const a=await _te(t.localStore,r);if(a===null){t.Ta.length===0&&n.L_();break}r=a.batchId,Bte(t,a)}catch(a){await r_(t,a)}fV(t)&&mV(t)}function Ute(e){return Sd(e)&&e.Ta.length<10}function Bte(e,t){e.Ta.push(t);const n=dc(e);n.O_()&&n.X_&&n.ea(t.mutations)}function fV(e){return Sd(e)&&!dc(e).x_()&&e.Ta.length>0}function mV(e){dc(e).start()}async function Wte(e){dc(e).ra()}async function jte(e){const t=dc(e);for(const n of e.Ta)t.ea(n.mutations)}async function Hte(e,t,n){const r=e.Ta.shift(),a=GN.from(r,t,n);await pV(e,(()=>e.remoteSyncer.applySuccessfulWrite(a))),await o1(e)}async function Gte(e,t){t&&dc(e).X_&&await(async function(r,a){if((function(i){return Eee(i)&&i!==Ae.ABORTED})(a.code)){const s=r.Ta.shift();dc(r).B_(),await pV(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,a))),await o1(r)}})(e,t),fV(e)&&mV(e)}async function H3(e,t){const n=kt(e);n.asyncQueue.verifyOperationInProgress(),Xe(Zh,"RemoteStore received new credentials");const r=Sd(n);n.Ea.add(3),await Sv(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await i1(n)}async function qte(e,t){const n=kt(e);t?(n.Ea.delete(2),await i1(n)):t||(n.Ea.add(2),await Sv(n),n.Ra.set("Unknown"))}function zm(e){return e.ma||(e.ma=(function(n,r,a){const s=kt(n);return s.sa(),new Rte(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,a)})(e.datastore,e.asyncQueue,{Xo:Pte.bind(null,e),t_:Lte.bind(null,e),r_:zte.bind(null,e),H_:Vte.bind(null,e)}),e.da.push((async t=>{t?(e.ma.B_(),n2(e)?t2(e):e.Ra.set("Unknown")):(await e.ma.stop(),dV(e))}))),e.ma}function dc(e){return e.fa||(e.fa=(function(n,r,a){const s=kt(n);return s.sa(),new Dte(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,a)})(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Wte.bind(null,e),r_:Gte.bind(null,e),ta:jte.bind(null,e),na:Hte.bind(null,e)}),e.da.push((async t=>{t?(e.fa.B_(),await o1(e)):(await e.fa.stop(),e.Ta.length>0&&(Xe(Zh,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}class r2{constructor(t,n,r,a,s){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=a,this.removalCallback=s,this.deferred=new Ll,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((i=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,a,s){const i=Date.now()+r,o=new r2(t,n,i,a,s);return o.start(r),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new qe(Ae.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function a2(e,t){if(Gl("AsyncQueue",`${t}: ${e}`),Pm(e))return new qe(Ae.UNAVAILABLE,`${t}: ${e}`);throw e}class tm{static emptySet(t){return new tm(t.comparator)}constructor(t){this.comparator=t?(n,r)=>t(n,r)||lt.comparator(n.key,r.key):(n,r)=>lt.comparator(n.key,r.key),this.keyedMap=cb(),this.sortedSet=new ir(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((n,r)=>(t(n),!1)))}add(t){const n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))}delete(t){const n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this}isEqual(t){if(!(t instanceof tm)||this.size!==t.size)return!1;const n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,s=r.getNext().key;if(!a.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((n=>{t.push(n.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,n){const r=new tm;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}class G3{constructor(){this.ga=new ir(lt.comparator)}track(t){const n=t.doc.key,r=this.ga.get(n);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(n,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(n):t.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:t.doc}):yt(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(n,t)}ya(){const t=[];return this.ga.inorderTraversal(((n,r)=>{t.push(r)})),t}}class dm{constructor(t,n,r,a,s,i,o,l,h){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(t,n,r,a,s){const i=[];return n.forEach((o=>{i.push({type:0,doc:o})})),new dm(t,n,tm.emptySet(n),i,r,a,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&e1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==r[a].type||!n[a].doc.isEqual(r[a].doc))return!1;return!0}}class Kte{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Xte{constructor(){this.queries=q3(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const a=kt(n),s=a.queries;a.queries=q3(),s.forEach(((i,o)=>{for(const l of o.Sa)l.onError(r)}))})(this,new qe(Ae.ABORTED,"Firestore shutting down"))}}function q3(){return new _d((e=>O4(e)),e1)}async function s2(e,t){const n=kt(e);let r=3;const a=t.query;let s=n.queries.get(a);s?!s.ba()&&t.Da()&&(r=2):(s=new Kte,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(a,!0);break;case 1:s.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(i){const o=a2(i,`Initialization of query '${jf(t.query)}' failed`);return void t.onError(o)}n.queries.set(a,s),s.Sa.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&o2(n)}async function i2(e,t){const n=kt(e),r=t.query;let a=3;const s=n.queries.get(r);if(s){const i=s.Sa.indexOf(t);i>=0&&(s.Sa.splice(i,1),s.Sa.length===0?a=t.Da()?0:1:!s.ba()&&t.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Yte(e,t){const n=kt(e);let r=!1;for(const a of t){const s=a.query,i=n.queries.get(s);if(i){for(const o of i.Sa)o.Fa(a)&&(r=!0);i.wa=a}}r&&o2(n)}function Qte(e,t,n){const r=kt(e),a=r.queries.get(t);if(a)for(const s of a.Sa)s.onError(n);r.queries.delete(t)}function o2(e){e.Ca.forEach((t=>{t.next()}))}var eE,K3;(K3=eE||(eE={})).Ma="default",K3.Cache="cache";class l2{constructor(t,n,r){this.query=t,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const a of t.docChanges)a.type!==3&&r.push(a);t=new dm(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let n=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),n=!0):this.La(t,this.onlineState)&&(this.ka(t),n=!0),this.Na=t,n}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),n=!0),n}La(t,n){if(!t.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||n==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(t){t=dm.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==eE.Cache}}class gV{constructor(t){this.key=t}}class yV{constructor(t){this.key=t}}class Zte{constructor(t,n){this.query=t,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=qt(),this.mutatedKeys=qt(),this.eu=F4(t),this.tu=new tm(this.eu)}get nu(){return this.Ya}ru(t,n){const r=n?n.iu:new G3,a=n?n.tu:this.tu;let s=n?n.mutatedKeys:this.mutatedKeys,i=a,o=!1;const l=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(t.inorderTraversal(((c,p)=>{const m=a.get(c),g=t1(this.query,p)?p:null,b=!!m&&this.mutatedKeys.has(m.key),v=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let x=!1;m&&g?m.data.isEqual(g.data)?b!==v&&(r.track({type:3,doc:g}),x=!0):this.su(m,g)||(r.track({type:2,doc:g}),x=!0,(l&&this.eu(g,l)>0||h&&this.eu(g,h)<0)&&(o=!0)):!m&&g?(r.track({type:0,doc:g}),x=!0):m&&!g&&(r.track({type:1,doc:m}),x=!0,(l||h)&&(o=!0)),x&&(g?(i=i.add(g),s=v?s.add(c):s.delete(c)):(i=i.delete(c),s=s.delete(c)))})),this.query.limit!==null)for(;i.size>this.query.limit;){const c=this.query.limitType==="F"?i.last():i.first();i=i.delete(c.key),s=s.delete(c.key),r.track({type:1,doc:c})}return{tu:i,iu:r,Cs:o,mutatedKeys:s}}su(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(t,n,r,a){const s=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const i=t.iu.ya();i.sort(((c,p)=>(function(g,b){const v=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return yt(20277,{Rt:x})}};return v(g)-v(b)})(c.type,p.type)||this.eu(c.doc,p.doc))),this.ou(r),a=a??!1;const o=n&&!a?this._u():[],l=this.Xa.size===0&&this.current&&!a?1:0,h=l!==this.Za;return this.Za=l,i.length!==0||h?{snapshot:new dm(this.query,t.tu,s,i,t.mutatedKeys,l===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new G3,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),t.modifiedDocuments.forEach((n=>{})),t.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=qt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return t.forEach((r=>{this.Xa.has(r)||n.push(new yV(r))})),this.Xa.forEach((r=>{t.has(r)||n.push(new gV(r))})),n}cu(t){this.Ya=t.Qs,this.Xa=qt();const n=this.ru(t.documents);return this.applyChanges(n,!0)}lu(){return dm.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const u2="SyncEngine";class Jte{constructor(t,n,r){this.query=t,this.targetId=n,this.view=r}}class ene{constructor(t){this.key=t,this.hu=!1}}class tne{constructor(t,n,r,a,s,i){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=a,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new _d((o=>O4(o)),e1),this.Iu=new Map,this.Eu=new Set,this.du=new ir(lt.comparator),this.Au=new Map,this.Ru=new XN,this.Vu={},this.mu=new Map,this.fu=hm.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function nne(e,t,n=!0){const r=SV(e);let a;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),a=s.view.lu()):a=await bV(r,t,n,!0),a}async function rne(e,t){const n=SV(e);await bV(n,t,!0,!1)}async function bV(e,t,n,r){const a=await Ste(e.localStore,Po(t)),s=a.targetId,i=e.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await ane(e,t,s,i==="current",a.resumeToken)),e.isPrimaryClient&&n&&cV(e.remoteStore,a),o}async function ane(e,t,n,r,a){e.pu=(p,m,g)=>(async function(v,x,_,I){let k=x.view.ru(_);k.Cs&&(k=await V3(v.localStore,x.query,!1).then((({documents:D})=>x.view.ru(D,k))));const E=I&&I.targetChanges.get(x.targetId),R=I&&I.targetMismatches.get(x.targetId)!=null,U=x.view.applyChanges(k,v.isPrimaryClient,E,R);return Y3(v,x.targetId,U.au),U.snapshot})(e,p,m,g);const s=await V3(e.localStore,t,!0),i=new Zte(t,s.Qs),o=i.ru(s.documents),l=_v.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline",a),h=i.applyChanges(o,e.isPrimaryClient,l);Y3(e,n,h.au);const c=new Jte(t,n,i);return e.Tu.set(t,c),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function sne(e,t,n){const r=kt(e),a=r.Tu.get(t),s=r.Iu.get(a.targetId);if(s.length>1)return r.Iu.set(a.targetId,s.filter((i=>!e1(i,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await Zk(r.localStore,a.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(a.targetId),n&&JN(r.remoteStore,a.targetId),tE(r,a.targetId)})).catch(Fm)):(tE(r,a.targetId),await Zk(r.localStore,a.targetId,!0))}async function ine(e,t){const n=kt(e),r=n.Tu.get(t),a=n.Iu.get(r.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),JN(n.remoteStore,r.targetId))}async function one(e,t,n){const r=fne(e);try{const a=await(function(i,o){const l=kt(i),h=Bn.now(),c=o.reduce(((g,b)=>g.add(b.key)),qt());let p,m;return l.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let b=ql(),v=qt();return l.Ns.getEntries(g,c).next((x=>{b=x,b.forEach(((_,I)=>{I.isValidDocument()||(v=v.add(_))}))})).next((()=>l.localDocuments.getOverlayedDocuments(g,b))).next((x=>{p=x;const _=[];for(const I of o){const k=_ee(I,p.get(I.key).overlayedDocument);k!=null&&_.push(new Fc(I.key,k,E4(k.value.mapValue),Ki.exists(!0)))}return l.mutationQueue.addMutationBatch(g,h,_,o)})).next((x=>{m=x;const _=x.applyToLocalDocumentSet(p,v);return l.documentOverlayCache.saveOverlays(g,x.batchId,_)}))})).then((()=>({batchId:m.batchId,changes:L4(p)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(a.batchId),(function(i,o,l){let h=i.Vu[i.currentUser.toKey()];h||(h=new ir(Gt)),h=h.insert(o,l),i.Vu[i.currentUser.toKey()]=h})(r,a.batchId,n),await Iv(r,a.changes),await o1(r.remoteStore)}catch(a){const s=a2(a,"Failed to persist write");n.reject(s)}}async function vV(e,t){const n=kt(e);try{const r=await xte(n.localStore,t);t.targetChanges.forEach(((a,s)=>{const i=n.Au.get(s);i&&(mn(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?i.hu=!0:a.modifiedDocuments.size>0?mn(i.hu,14607):a.removedDocuments.size>0&&(mn(i.hu,42227),i.hu=!1))})),await Iv(n,r,t)}catch(r){await Fm(r)}}function X3(e,t,n){const r=kt(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const a=[];r.Tu.forEach(((s,i)=>{const o=i.view.va(t);o.snapshot&&a.push(o.snapshot)})),(function(i,o){const l=kt(i);l.onlineState=o;let h=!1;l.queries.forEach(((c,p)=>{for(const m of p.Sa)m.va(o)&&(h=!0)})),h&&o2(l)})(r.eventManager,t),a.length&&r.Pu.H_(a),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function lne(e,t,n){const r=kt(e);r.sharedClientState.updateQueryState(t,"rejected",n);const a=r.Au.get(t),s=a&&a.key;if(s){let i=new ir(lt.comparator);i=i.insert(s,La.newNoDocument(s,St.min()));const o=qt().add(s),l=new a1(St.min(),new Map,new ir(Gt),i,o);await vV(r,l),r.du=r.du.remove(s),r.Au.delete(t),c2(r)}else await Zk(r.localStore,t,!1).then((()=>tE(r,t,n))).catch(Fm)}async function une(e,t){const n=kt(e),r=t.batch.batchId;try{const a=await vte(n.localStore,t);wV(n,r,null),xV(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Iv(n,a)}catch(a){await Fm(a)}}async function cne(e,t,n){const r=kt(e);try{const a=await(function(i,o){const l=kt(i);return l.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let c;return l.mutationQueue.lookupMutationBatch(h,o).next((p=>(mn(p!==null,37113),c=p.keys(),l.mutationQueue.removeMutationBatch(h,p)))).next((()=>l.mutationQueue.performConsistencyCheck(h))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(h,c,o))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,c))).next((()=>l.localDocuments.getDocuments(h,c)))}))})(r.localStore,t);wV(r,t,n),xV(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Iv(r,a)}catch(a){await Fm(a)}}function xV(e,t){(e.mu.get(t)||[]).forEach((n=>{n.resolve()})),e.mu.delete(t)}function wV(e,t,n){const r=kt(e);let a=r.Vu[r.currentUser.toKey()];if(a){const s=a.get(t);s&&(n?s.reject(n):s.resolve(),a=a.remove(t)),r.Vu[r.currentUser.toKey()]=a}}function tE(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach((r=>{e.Ru.containsKey(r)||_V(e,r)}))}function _V(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);n!==null&&(JN(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),c2(e))}function Y3(e,t,n){for(const r of n)r instanceof gV?(e.Ru.addReference(r.key,t),hne(e,r)):r instanceof yV?(Xe(u2,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||_V(e,r.key)):yt(19791,{wu:r})}function hne(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(Xe(u2,"New document in limbo: "+n),e.Eu.add(r),c2(e))}function c2(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new lt(Pn.fromString(t)),r=e.fu.next();e.Au.set(r,new ene(n)),e.du=e.du.insert(n,r),cV(e.remoteStore,new Xu(Po(J_(n.path)),r,"TargetPurposeLimboResolution",Y_.ce))}}async function Iv(e,t,n){const r=kt(e),a=[],s=[],i=[];r.Tu.isEmpty()||(r.Tu.forEach(((o,l)=>{i.push(r.pu(l,t,n).then((h=>{if((h||n)&&r.isPrimaryClient){const c=h?!h.fromCache:n?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,c?"current":"not-current")}if(h){a.push(h);const c=QN.As(l.targetId,h);s.push(c)}})))})),await Promise.all(i),r.Pu.H_(a),await(async function(l,h){const c=kt(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>Me.forEach(h,(m=>Me.forEach(m.Es,(g=>c.persistence.referenceDelegate.addReference(p,m.targetId,g))).next((()=>Me.forEach(m.ds,(g=>c.persistence.referenceDelegate.removeReference(p,m.targetId,g)))))))))}catch(p){if(!Pm(p))throw p;Xe(ZN,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const g=c.Ms.get(m),b=g.snapshotVersion,v=g.withLastLimboFreeSnapshotVersion(b);c.Ms=c.Ms.insert(m,v)}}})(r.localStore,s))}async function dne(e,t){const n=kt(e);if(!n.currentUser.isEqual(t)){Xe(u2,"User change. New user:",t.toKey());const r=await iV(n.localStore,t);n.currentUser=t,(function(s,i){s.mu.forEach((o=>{o.forEach((l=>{l.reject(new qe(Ae.CANCELLED,i))}))})),s.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Iv(n,r.Ls)}}function pne(e,t){const n=kt(e),r=n.Au.get(t);if(r&&r.hu)return qt().add(r.key);{let a=qt();const s=n.Iu.get(t);if(!s)return a;for(const i of s){const o=n.Tu.get(i);a=a.unionWith(o.view.nu)}return a}}function SV(e){const t=kt(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=vV.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=pne.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lne.bind(null,t),t.Pu.H_=Yte.bind(null,t.eventManager),t.Pu.yu=Qte.bind(null,t.eventManager),t}function fne(e){const t=kt(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=une.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=cne.bind(null,t),t}class a_{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=s1(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,n){return null}Mu(t,n){return null}vu(t){return bte(this.persistence,new mte,t.initialUser,this.serializer)}Cu(t){return new sV(YN.mi,this.serializer)}Du(t){return new Tte}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}a_.provider={build:()=>new a_};class mne extends a_{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,n){mn(this.persistence.referenceDelegate instanceof n_,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new ete(r,t.asyncQueue,n)}Cu(t){const n=this.cacheSizeBytes!==void 0?ks.withCacheSize(this.cacheSizeBytes):ks.DEFAULT;return new sV((r=>n_.mi(r,n)),this.serializer)}}class nE{async initialize(t,n){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>X3(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dne.bind(null,this.syncEngine),await qte(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Xte})()}createDatastore(t){const n=s1(t.databaseInfo.databaseId),r=(function(s){return new Ate(s)})(t.databaseInfo);return(function(s,i,o,l){return new $te(s,i,o,l)})(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return(function(r,a,s,i,o){return new Fte(r,a,s,i,o)})(this.localStore,this.datastore,t.asyncQueue,(n=>X3(this.syncEngine,n,0)),(function(){return W3.v()?new W3:new kte})())}createSyncEngine(t,n){return(function(a,s,i,o,l,h,c){const p=new tne(a,s,i,o,l,h);return c&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=kt(n);Xe(Zh,"RemoteStore shutting down."),r.Ea.add(5),await Sv(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}nE.provider={build:()=>new nE};class h2{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Gl("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,n){setTimeout((()=>{this.muted||t(n)}),0)}}const pc="FirestoreClient";class gne{constructor(t,n,r,a,s){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=a,this.user=Pa.UNAUTHENTICATED,this.clientId=zN.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async i=>{Xe(pc,"Received user=",i.uid),await this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(r,(i=>(Xe(pc,"Received new app check token=",i),this.appCheckCredentialListener(i,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ll;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){const r=a2(n,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function sk(e,t){e.asyncQueue.verifyOperationInProgress(),Xe(pc,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async a=>{r.isEqual(a)||(await iV(t.localStore,a),r=a)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Q3(e,t){e.asyncQueue.verifyOperationInProgress();const n=await yne(e);Xe(pc,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((r=>H3(t.remoteStore,r))),e.setAppCheckTokenChangeListener(((r,a)=>H3(t.remoteStore,a))),e._onlineComponents=t}async function yne(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Xe(pc,"Using user provided OfflineComponentProvider");try{await sk(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!(function(a){return a.name==="FirebaseError"?a.code===Ae.FAILED_PRECONDITION||a.code===Ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;om("Error using user provided cache. Falling back to memory cache: "+n),await sk(e,new a_)}}else Xe(pc,"Using default OfflineComponentProvider"),await sk(e,new mne(void 0));return e._offlineComponents}async function IV(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Xe(pc,"Using user provided OnlineComponentProvider"),await Q3(e,e._uninitializedComponentsProvider._online)):(Xe(pc,"Using default OnlineComponentProvider"),await Q3(e,new nE))),e._onlineComponents}function bne(e){return IV(e).then((t=>t.syncEngine))}async function s_(e){const t=await IV(e),n=t.eventManager;return n.onListen=nne.bind(null,t.syncEngine),n.onUnlisten=sne.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=rne.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=ine.bind(null,t.syncEngine),n}function vne(e,t,n={}){const r=new Ll;return e.asyncQueue.enqueueAndForget((async()=>(function(s,i,o,l,h){const c=new h2({next:m=>{c.Nu(),i.enqueueAndForget((()=>i2(s,p)));const g=m.docs.has(o);!g&&m.fromCache?h.reject(new qe(Ae.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&m.fromCache&&l&&l.source==="server"?h.reject(new qe(Ae.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new l2(J_(o.path),c,{includeMetadataChanges:!0,qa:!0});return s2(s,p)})(await s_(e),e.asyncQueue,t,n,r))),r.promise}function xne(e,t,n={}){const r=new Ll;return e.asyncQueue.enqueueAndForget((async()=>(function(s,i,o,l,h){const c=new h2({next:m=>{c.Nu(),i.enqueueAndForget((()=>i2(s,p))),m.fromCache&&l.source==="server"?h.reject(new qe(Ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new l2(o,c,{includeMetadataChanges:!0,qa:!0});return s2(s,p)})(await s_(e),e.asyncQueue,t,n,r))),r.promise}function TV(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}const Z3=new Map;const kV="firestore.googleapis.com",J3=!0;class eP{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new qe(Ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kV,this.ssl=J3}else this.host=t.host,this.ssl=t.ssl??J3;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=aV;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Zee)throw new qe(Ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}$J("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TV(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,a){return r.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class l1{constructor(t,n,r,a){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eP({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new qe(Ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new qe(Ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eP(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new IJ;switch(r.type){case"firstParty":return new NJ(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new qe(Ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=Z3.get(n);r&&(Xe("ComponentProvider","Removing Datastore"),Z3.delete(n),r.terminate())})(this),Promise.resolve()}}function wne(e,t,n,r={}){e=Js(e,l1);const a=Rc(t),s=e._getSettings(),i={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;a&&(SN(`https://${o}`),IN("Firestore",!0)),s.host!==kV&&s.host!==o&&om("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:a,emulatorOptions:r};if(!qh(l,i)&&(e._setSettings(l),r.mockUserToken)){let h,c;if(typeof r.mockUserToken=="string")h=r.mockUserToken,c=Pa.MOCK_USER;else{h=Sz(r.mockUserToken,e._app?.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new qe(Ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Pa(p)}e._authCredentials=new TJ(new m4(h,c))}}class Ql{constructor(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new Ql(this.firestore,t,this._query)}}class gr{constructor(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new gr(this.firestore,t,this._key)}toJSON(){return{type:gr._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,n,r){if(xv(n,gr._jsonSchema))return new gr(t,r||null,new lt(Pn.fromString(n.referencePath)))}}gr._jsonSchemaVersion="firestore/documentReference/1.0",gr._jsonSchema={type:Ur("string",gr._jsonSchemaVersion),referencePath:Ur("string")};class rc extends Ql{constructor(t,n,r){super(t,n,J_(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new gr(this.firestore,null,new lt(t))}withConverter(t){return new rc(this.firestore,t,this._path)}}function Ho(e,t,...n){if(e=sr(e),g4("collection","path",t),e instanceof l1){const r=Pn.fromString(t,...n);return p3(r),new rc(e,null,r)}{if(!(e instanceof gr||e instanceof rc))throw new qe(Ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Pn.fromString(t,...n));return p3(r),new rc(e.firestore,null,r)}}function fc(e,t,...n){if(e=sr(e),arguments.length===1&&(t=zN.newId()),g4("doc","path",t),e instanceof l1){const r=Pn.fromString(t,...n);return d3(r),new gr(e,null,new lt(r))}{if(!(e instanceof gr||e instanceof rc))throw new qe(Ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Pn.fromString(t,...n));return d3(r),new gr(e.firestore,e instanceof rc?e.converter:null,new lt(r))}}const tP="AsyncQueue";class nP{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lV(this,"async_queue_retry"),this._c=()=>{const r=ak();r&&Xe(tP,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const n=ak();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const n=ak();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Ll;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Pm(t))throw t;Xe(tP,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const n=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Gl("INTERNAL UNHANDLED ERROR: ",rP(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(t,n,r){this.uc(),this.oc.indexOf(t)>-1&&(n=0);const a=r2.createAndSchedule(this,t,n,r,(s=>this.hc(s)));return this.tc.push(a),a}uc(){this.nc&&yt(47125,{Pc:rP(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const n of this.tc)if(n.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const n=this.tc.indexOf(t);this.tc.splice(n,1)}}function rP(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+`
`+e.stack),t}function aP(e){return(function(n,r){if(typeof n!="object"||n===null)return!1;const a=n;for(const s of r)if(s in a&&typeof a[s]=="function")return!0;return!1})(e,["next","error","complete"])}class mc extends l1{constructor(t,n,r,a){super(t,n,r,a),this.type="firestore",this._queue=new nP,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new nP(t),this._firestoreClient=void 0,await t}}}function _ne(e,t){const n=typeof e=="object"?e:EN(),r=typeof e=="string"?e:Y0,a=H_(n,"firestore").getImmediate({identifier:r});if(!a._initialized){const s=xz("firestore");s&&wne(a,...s)}return a}function u1(e){if(e._terminated)throw new qe(Ae.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Sne(e),e._firestoreClient}function Sne(e){const t=e._freezeSettings(),n=(function(a,s,i,o){return new GJ(a,s,i,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,TV(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator)})(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new gne(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&(function(a){const s=a?._online.build();return{_offline:a?._offline.build(s),_online:s}})(e._componentsProvider))}class Ii{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ii(Ia.fromBase64String(t))}catch(n){throw new qe(Ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(t){return new Ii(Ia.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ii._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(xv(t,Ii._jsonSchema))return Ii.fromBase64String(t.bytes)}}Ii._jsonSchemaVersion="firestore/bytes/1.0",Ii._jsonSchema={type:Ur("string",Ii._jsonSchemaVersion),bytes:Ur("string")};class c1{constructor(...t){for(let n=0;n<t.length;++n)if(t[n].length===0)throw new qe(Ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Sa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class h1{constructor(t){this._methodName=t}}class zo{constructor(t,n){if(!isFinite(t)||t<-90||t>90)throw new qe(Ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new qe(Ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Gt(this._lat,t._lat)||Gt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:zo._jsonSchemaVersion}}static fromJSON(t){if(xv(t,zo._jsonSchema))return new zo(t.latitude,t.longitude)}}zo._jsonSchemaVersion="firestore/geoPoint/1.0",zo._jsonSchema={type:Ur("string",zo._jsonSchemaVersion),latitude:Ur("number"),longitude:Ur("number")};class Vo{constructor(t){this._values=(t||[]).map((n=>n))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,a){if(r.length!==a.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==a[s])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Vo._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(xv(t,Vo._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((n=>typeof n=="number")))return new Vo(t.vectorValues);throw new qe(Ae.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Vo._jsonSchemaVersion="firestore/vectorValue/1.0",Vo._jsonSchema={type:Ur("string",Vo._jsonSchemaVersion),vectorValues:Ur("object")};const Ine=/^__.*__$/;class Tne{constructor(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}toMutation(t,n){return this.fieldMask!==null?new Fc(t,this.data,this.fieldMask,n,this.fieldTransforms):new wv(t,this.data,n,this.fieldTransforms)}}class EV{constructor(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}toMutation(t,n){return new Fc(t,this.data,this.fieldMask,n,this.fieldTransforms)}}function NV(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw yt(40011,{Ac:e})}}class d2{constructor(t,n,r,a,s,i){this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=a,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new d2({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const n=this.path?.child(t),r=this.Vc({path:n,fc:!1});return r.gc(t),r}yc(t){const n=this.path?.child(t),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return i_(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((n=>t.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>t.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(NV(this.Ac)&&Ine.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class kne{constructor(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||s1(t)}Cc(t,n,r,a=!1){return new d2({Ac:t,methodName:n,Dc:r,path:Sa.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function d1(e){const t=e._freezeSettings(),n=s1(e._databaseId);return new kne(e._databaseId,!!t.ignoreUndefinedProperties,n)}function CV(e,t,n,r,a,s={}){const i=e.Cc(s.merge||s.mergeFields?2:0,t,n,a);f2("Data must be an object, but it was:",i,r);const o=AV(r,i);let l,h;if(s.merge)l=new qs(i.fieldMask),h=i.fieldTransforms;else if(s.mergeFields){const c=[];for(const p of s.mergeFields){const m=rE(t,p,n);if(!i.contains(m))throw new qe(Ae.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);DV(c,m)||c.push(m)}l=new qs(c),h=i.fieldTransforms.filter((p=>l.covers(p.field)))}else l=null,h=i.fieldTransforms;return new Tne(new Cs(o),l,h)}class p1 extends h1{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof p1}}class p2 extends h1{_toFieldTransform(t){return new bee(t.path,new jb)}isEqual(t){return t instanceof p2}}function Ene(e,t,n,r){const a=e.Cc(1,t,n);f2("Data must be an object, but it was:",a,r);const s=[],i=Cs.empty();Oc(r,((l,h)=>{const c=m2(t,l,n);h=sr(h);const p=a.yc(c);if(h instanceof p1)s.push(c);else{const m=Tv(h,p);m!=null&&(s.push(c),i.set(c,m))}}));const o=new qs(s);return new EV(i,o,a.fieldTransforms)}function Nne(e,t,n,r,a,s){const i=e.Cc(1,t,n),o=[rE(t,r,n)],l=[a];if(s.length%2!=0)throw new qe(Ae.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)o.push(rE(t,s[m])),l.push(s[m+1]);const h=[],c=Cs.empty();for(let m=o.length-1;m>=0;--m)if(!DV(h,o[m])){const g=o[m];let b=l[m];b=sr(b);const v=i.yc(g);if(b instanceof p1)h.push(g);else{const x=Tv(b,v);x!=null&&(h.push(g),c.set(g,x))}}const p=new qs(h);return new EV(c,p,i.fieldTransforms)}function Cne(e,t,n,r=!1){return Tv(n,e.Cc(r?4:3,t))}function Tv(e,t){if(RV(e=sr(e)))return f2("Unsupported field value:",t,e),AV(e,t);if(e instanceof h1)return(function(r,a){if(!NV(a.Ac))throw a.Sc(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(a);s&&a.fieldTransforms.push(s)})(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,a){const s=[];let i=0;for(const o of r){let l=Tv(o,a.wc(i));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),i++}return{arrayValue:{values:s}}})(e,t)}return(function(r,a){if((r=sr(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return mee(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Bn.fromDate(r);return{timestampValue:t_(a.serializer,s)}}if(r instanceof Bn){const s=new Bn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:t_(a.serializer,s)}}if(r instanceof zo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ii)return{bytesValue:Q4(a.serializer,r._byteString)};if(r instanceof gr){const s=a.databaseId,i=r.firestore._databaseId;if(!i.isEqual(s))throw a.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:KN(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Vo)return(function(i,o){return{mapValue:{fields:{[T4]:{stringValue:k4},[Q0]:{arrayValue:{values:i.toArray().map((h=>{if(typeof h!="number")throw o.Sc("VectorValues must only contain numeric values.");return HN(o.serializer,h)}))}}}}}})(r,a);throw a.Sc(`Unsupported field value: ${X_(r)}`)})(e,t)}function AV(e,t){const n={};return v4(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Oc(e,((r,a)=>{const s=Tv(a,t.mc(r));s!=null&&(n[r]=s)})),{mapValue:{fields:n}}}function RV(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Bn||e instanceof zo||e instanceof Ii||e instanceof gr||e instanceof h1||e instanceof Vo)}function f2(e,t,n){if(!RV(n)||!y4(n)){const r=X_(n);throw r==="an object"?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function rE(e,t,n){if((t=sr(t))instanceof c1)return t._internalPath;if(typeof t=="string")return m2(e,t);throw i_("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ane=new RegExp("[~\\*/\\[\\]]");function m2(e,t,n){if(t.search(Ane)>=0)throw i_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new c1(...t.split("."))._internalPath}catch{throw i_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function i_(e,t,n,r,a){const s=r&&!r.isEmpty(),i=a!==void 0;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||i)&&(l+=" (found",s&&(l+=` in field ${r}`),i&&(l+=` in document ${a}`),l+=")"),new qe(Ae.INVALID_ARGUMENT,o+e+l)}function DV(e,t){return e.some((n=>n.isEqual(t)))}class MV{constructor(t,n,r,a,s){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=a,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new gr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Rne(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const n=this._document.data.field(f1("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Rne extends MV{data(){return super.data()}}function f1(e,t){return typeof t=="string"?m2(e,t):t instanceof c1?t._internalPath:t._delegate._internalPath}function $V(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new qe(Ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class g2{}class y2 extends g2{}function Jh(e,t,...n){let r=[];t instanceof g2&&r.push(t),r=r.concat(n),(function(s){const i=s.filter((l=>l instanceof b2)).length,o=s.filter((l=>l instanceof m1)).length;if(i>1||i>0&&o>0)throw new qe(Ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const a of r)e=a._apply(e);return e}class m1 extends y2{constructor(t,n,r){super(),this._field=t,this._op=n,this._value=r,this.type="where"}static _create(t,n,r){return new m1(t,n,r)}_apply(t){const n=this._parse(t);return OV(t._query,n),new Ql(t.firestore,t.converter,qk(t._query,n))}_parse(t){const n=d1(t.firestore);return(function(s,i,o,l,h,c,p){let m;if(h.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new qe(Ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){iP(p,c);const b=[];for(const v of p)b.push(sP(l,s,v));m={arrayValue:{values:b}}}else m=sP(l,s,p)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||iP(p,c),m=Cne(o,i,p,c==="in"||c==="not-in");return Vr.create(h,c,m)})(t._query,"where",n,t.firestore._databaseId,this._field,this._op,this._value)}}function aE(e,t,n){const r=t,a=f1("where",e);return m1._create(a,r,n)}class b2 extends g2{constructor(t,n){super(),this.type=t,this._queryConstraints=n}static _create(t,n){return new b2(t,n)}_parse(t){const n=this._queryConstraints.map((r=>r._parse(t))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:Ji.create(n,this._getOperator())}_apply(t){const n=this._parse(t);return n.getFilters().length===0?t:((function(a,s){let i=a;const o=s.getFlattenedFilters();for(const l of o)OV(i,l),i=qk(i,l)})(t._query,n),new Ql(t.firestore,t.converter,qk(t._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class v2 extends y2{constructor(t,n){super(),this._field=t,this._direction=n,this.type="orderBy"}static _create(t,n){return new v2(t,n)}_apply(t){const n=(function(a,s,i){if(a.startAt!==null)throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Wb(s,i)})(t._query,this._field,this._direction);return new Ql(t.firestore,t.converter,(function(a,s){const i=a.explicitOrderBy.concat([s]);return new Lm(a.path,a.collectionGroup,i,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(t._query,n))}}function sE(e,t="asc"){const n=t,r=f1("orderBy",e);return v2._create(r,n)}class x2 extends y2{constructor(t,n,r){super(),this.type=t,this._limit=n,this._limitType=r}static _create(t,n,r){return new x2(t,n,r)}_apply(t){return new Ql(t.firestore,t.converter,J0(t._query,this._limit,this._limitType))}}function iE(e){return OJ("limit",e),x2._create("limit",e,"F")}function sP(e,t,n){if(typeof(n=sr(n))=="string"){if(n==="")throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$4(t)&&n.indexOf("/")!==-1)throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Pn.fromString(n));if(!lt.isDocumentKey(r))throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return w3(e,new lt(r))}if(n instanceof gr)return w3(e,n._key);throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${X_(n)}.`)}function iP(e,t){if(!Array.isArray(e)||e.length===0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function OV(e,t){const n=(function(a,s){for(const i of a)for(const o of i.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null})(e.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(n!==null)throw n===t.op?new qe(Ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new qe(Ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Dne{convertValue(t,n="none"){switch(hc(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ir(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(cc(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 11:return this.convertObject(t.mapValue,n);case 10:return this.convertVectorValue(t.mapValue);default:throw yt(62114,{value:t})}}convertObject(t,n){return this.convertObjectMap(t.fields,n)}convertObjectMap(t,n="none"){const r={};return Oc(t,((a,s)=>{r[a]=this.convertValue(s,n)})),r}convertVectorValue(t){const n=t.fields?.[Q0].arrayValue?.values?.map((r=>Ir(r.doubleValue)));return new Vo(n)}convertGeoPoint(t){return new zo(Ir(t.latitude),Ir(t.longitude))}convertArray(t,n){return(t.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(t,n){switch(n){case"previous":const r=Z_(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Vb(t));default:return null}}convertTimestamp(t){const n=uc(t);return new Bn(n.seconds,n.nanos)}convertDocumentKey(t,n){const r=Pn.fromString(t);mn(rV(r),9688,{name:t});const a=new Ub(r.get(1),r.get(3)),s=new lt(r.popFirst(5));return a.isEqual(n)||Gl(`Document ${s} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}function FV(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class db{constructor(t,n){this.hasPendingWrites=t,this.fromCache=n}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Vh extends MV{constructor(t,n,r,a,s,i){super(t,n,r,a,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const n=new A0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,n={}){if(this._document){const r=this._document.data.field(f1("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new qe(Ae.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,n={};return n.type=Vh._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Vh._jsonSchemaVersion="firestore/documentSnapshot/1.0",Vh._jsonSchema={type:Ur("string",Vh._jsonSchemaVersion),bundleSource:Ur("string","DocumentSnapshot"),bundleName:Ur("string"),bundle:Ur("string")};class A0 extends Vh{data(t={}){return super.data(t)}}class Uh{constructor(t,n,r,a){this._firestore=t,this._userDataWriter=n,this._snapshot=a,this.metadata=new db(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const t=[];return this.forEach((n=>t.push(n))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,n){this._snapshot.docs.forEach((r=>{t.call(n,new A0(this._firestore,this._userDataWriter,r.key,r,new db(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new qe(Ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,s){if(a._snapshot.oldDocs.isEmpty()){let i=0;return a._snapshot.docChanges.map((o=>{const l=new A0(a._firestore,a._userDataWriter,o.doc.key,o.doc,new db(a._snapshot.mutatedKeys.has(o.doc.key),a._snapshot.fromCache),a.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:i++}}))}{let i=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((o=>s||o.type!==3)).map((o=>{const l=new A0(a._firestore,a._userDataWriter,o.doc.key,o.doc,new db(a._snapshot.mutatedKeys.has(o.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,c=-1;return o.type!==0&&(h=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),o.type!==1&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Mne(o.type),doc:l,oldIndex:h,newIndex:c}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new qe(Ae.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Uh._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=zN.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],a=[];return this.docs.forEach((s=>{s._document!==null&&(n.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),a.push(s.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Mne(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return yt(61501,{type:e})}}function $ne(e){e=Js(e,gr);const t=Js(e.firestore,mc);return vne(u1(t),e._key).then((n=>zV(t,e,n)))}Uh._jsonSchemaVersion="firestore/querySnapshot/1.0",Uh._jsonSchema={type:Ur("string",Uh._jsonSchemaVersion),bundleSource:Ur("string","QuerySnapshot"),bundleName:Ur("string"),bundle:Ur("string")};class w2 extends Dne{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ii(t)}convertReference(t){const n=this.convertDocumentKey(t,this.firestore._databaseId);return new gr(this.firestore,null,n)}}function qb(e){e=Js(e,Ql);const t=Js(e.firestore,mc),n=u1(t),r=new w2(t);return $V(e._query),xne(n,e._query).then((a=>new Uh(t,r,e,a)))}function o_(e,t,n){e=Js(e,gr);const r=Js(e.firestore,mc),a=FV(e.converter,t,n);return S2(r,[CV(d1(r),"setDoc",e._key,a,e.converter!==null,n).toMutation(e._key,Ki.none())])}function PV(e,t,n,...r){e=Js(e,gr);const a=Js(e.firestore,mc),s=d1(a);let i;return i=typeof(t=sr(t))=="string"||t instanceof c1?Nne(s,"updateDoc",e._key,t,n,r):Ene(s,"updateDoc",e._key,t),S2(a,[i.toMutation(e._key,Ki.exists(!0))])}function _2(e,t){const n=Js(e.firestore,mc),r=fc(e),a=FV(e.converter,t);return S2(n,[CV(d1(e.firestore),"addDoc",r._key,a,e.converter!==null,{}).toMutation(r._key,Ki.exists(!1))]).then((()=>r))}function LV(e,...t){e=sr(e);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||aP(t[r])||(n=t[r++]);const a={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(aP(t[r])){const l=t[r];t[r]=l.next?.bind(l),t[r+1]=l.error?.bind(l),t[r+2]=l.complete?.bind(l)}let s,i,o;if(e instanceof gr)i=Js(e.firestore,mc),o=J_(e._key.path),s={next:l=>{t[r]&&t[r](zV(i,e,l))},error:t[r+1],complete:t[r+2]};else{const l=Js(e,Ql);i=Js(l.firestore,mc),o=l._query;const h=new w2(i);s={next:c=>{t[r]&&t[r](new Uh(i,h,l,c))},error:t[r+1],complete:t[r+2]},$V(e._query)}return(function(h,c,p,m){const g=new h2(m),b=new l2(c,g,p);return h.asyncQueue.enqueueAndForget((async()=>s2(await s_(h),b))),()=>{g.Nu(),h.asyncQueue.enqueueAndForget((async()=>i2(await s_(h),b)))}})(u1(i),o,a,s)}function S2(e,t){return(function(r,a){const s=new Ll;return r.asyncQueue.enqueueAndForget((async()=>one(await bne(r),a,s))),s.promise})(u1(e),t)}function zV(e,t,n){const r=n.docs.get(t._key),a=new w2(e);return new Vh(e,a,t._key,r,new db(n.hasPendingWrites,n.fromCache),t.converter)}function Id(){return new p2("serverTimestamp")}(function(t,n=!0){(function(a){Om=a})(wd),Kh(new oc("firestore",((r,{instanceIdentifier:a,options:s})=>{const i=r.getProvider("app").getImmediate(),o=new mc(new kJ(r.getProvider("auth-internal")),new CJ(i,r.getProvider("app-check-internal")),(function(h,c){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new qe(Ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ub(h.options.projectId,c)})(i,a),i);return s={useFetchStreams:n,...s},o._setSettings(s),o}),"PUBLIC").setMultipleInstances(!0)),Oo(l3,u3,t),Oo(l3,u3,"esm2020")})();var One="firebase",Fne="12.5.0";Oo(One,Fne,"app");const VV="firebasestorage.googleapis.com",UV="storageBucket",Pne=120*1e3,Lne=600*1e3,zne=1e3;class lr extends Qo{constructor(t,n,r=0){super(ik(t),`Firebase Storage: ${n} (${ik(t)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,lr.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return ik(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hn;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hn||(Hn={}));function ik(e){return"storage/"+e}function I2(){const e="An unknown error occurred, please check the error payload for server response.";return new lr(Hn.UNKNOWN,e)}function Vne(e){return new lr(Hn.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function Une(e){return new lr(Hn.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Bne(){const e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new lr(Hn.UNAUTHENTICATED,e)}function Wne(){return new lr(Hn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function jne(e){return new lr(Hn.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function BV(){return new lr(Hn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function WV(){return new lr(Hn.CANCELED,"User canceled the upload/download.")}function Hne(e){return new lr(Hn.INVALID_URL,"Invalid URL '"+e+"'.")}function Gne(e){return new lr(Hn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function qne(){return new lr(Hn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+UV+"' property when initializing the app?")}function jV(){return new lr(Hn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Kne(){return new lr(Hn.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Xne(){return new lr(Hn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Yne(e){return new lr(Hn.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function oE(e){return new lr(Hn.INVALID_ARGUMENT,e)}function HV(){return new lr(Hn.APP_DELETED,"The Firebase app was deleted.")}function Qne(e){return new lr(Hn.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Cb(e,t){return new lr(Hn.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function eb(e){throw new lr(Hn.INTERNAL_ERROR,"Internal error: "+e)}class Ks{constructor(t,n){this.bucket=t,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,n){let r;try{r=Ks.makeFromUrl(t,n)}catch{return new Ks(t,"")}if(r.path==="")return r;throw Gne(t)}static makeFromUrl(t,n){let r=null;const a="([A-Za-z0-9.\\-_]+)";function s(E){E.path.charAt(E.path.length-1)==="/"&&(E.path_=E.path_.slice(0,-1))}const i="(/(.*))?$",o=new RegExp("^gs://"+a+i,"i"),l={bucket:1,path:3};function h(E){E.path_=decodeURIComponent(E.path)}const c="v[A-Za-z0-9_]+",p=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",g=new RegExp(`^https?://${p}/${c}/b/${a}/o${m}`,"i"),b={bucket:1,path:3},v=n===VV?"(?:storage.googleapis.com|storage.cloud.google.com)":n,x="([^?#]*)",_=new RegExp(`^https?://${v}/${a}/${x}`,"i"),k=[{regex:o,indices:l,postModify:s},{regex:g,indices:b,postModify:h},{regex:_,indices:{bucket:1,path:2},postModify:h}];for(let E=0;E<k.length;E++){const R=k[E],U=R.regex.exec(t);if(U){const D=U[R.indices.bucket];let C=U[R.indices.path];C||(C=""),r=new Ks(D,C),R.postModify(r);break}}if(r==null)throw Hne(t);return r}}class Zne{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function Jne(e,t,n){let r=1,a=null,s=null,i=!1,o=0;function l(){return o===2}let h=!1;function c(...x){h||(h=!0,t.apply(null,x))}function p(x){a=setTimeout(()=>{a=null,e(g,l())},x)}function m(){s&&clearTimeout(s)}function g(x,..._){if(h){m();return}if(x){m(),c.call(null,x,..._);return}if(l()||i){m(),c.call(null,x,..._);return}r<64&&(r*=2);let k;o===1?(o=2,k=0):k=(r+Math.random())*1e3,p(k)}let b=!1;function v(x){b||(b=!0,m(),!h&&(a!==null?(x||(o=2),clearTimeout(a),p(0)):x||(o=1)))}return p(0),s=setTimeout(()=>{i=!0,v(!0)},n),v}function ere(e){e(!1)}function tre(e){return e!==void 0}function nre(e){return typeof e=="function"}function rre(e){return typeof e=="object"&&!Array.isArray(e)}function g1(e){return typeof e=="string"||e instanceof String}function oP(e){return T2()&&e instanceof Blob}function T2(){return typeof Blob<"u"}function lP(e,t,n,r){if(r<t)throw oE(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw oE(`Invalid value for '${e}'. Expected ${n} or less.`)}function kv(e,t,n){let r=t;return n==null&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function GV(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){const a=t(r)+"="+t(e[r]);n=n+a+"&"}return n=n.slice(0,-1),n}var Bh;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(Bh||(Bh={}));function qV(e,t){const n=e>=500&&e<600,a=[408,429].indexOf(e)!==-1,s=t.indexOf(e)!==-1;return n||a||s}class are{constructor(t,n,r,a,s,i,o,l,h,c,p,m=!0,g=!1){this.url_=t,this.method_=n,this.headers_=r,this.body_=a,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=l,this.timeout_=h,this.progressCallback_=c,this.connectionFactory_=p,this.retry=m,this.isUsingEmulator=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((b,v)=>{this.resolve_=b,this.reject_=v,this.start_()})}start_(){const t=(r,a)=>{if(a){r(!1,new e0(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const i=o=>{const l=o.loaded,h=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,h)};this.progressCallback_!==null&&s.addUploadProgressListener(i),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(i),this.pendingConnection_=null;const o=s.getErrorCode()===Bh.NO_ERROR,l=s.getStatus();if(!o||qV(l,this.additionalRetryCodes_)&&this.retry){const c=s.getErrorCode()===Bh.ABORT;r(!1,new e0(!1,null,c));return}const h=this.successCodes_.indexOf(l)!==-1;r(!0,new e0(h,s))})},n=(r,a)=>{const s=this.resolve_,i=this.reject_,o=a.connection;if(a.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());tre(l)?s(l):s()}catch(l){i(l)}else if(o!==null){const l=I2();l.serverResponse=o.getErrorText(),this.errorCallback_?i(this.errorCallback_(o,l)):i(l)}else if(a.canceled){const l=this.appDelete_?HV():WV();i(l)}else{const l=BV();i(l)}};this.canceled_?n(!1,new e0(!1,null,!0)):this.backoffId_=Jne(t,n,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&ere(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class e0{constructor(t,n,r){this.wasSuccessCode=t,this.connection=n,this.canceled=!!r}}function sre(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function ire(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function ore(e,t){t&&(e["X-Firebase-GMPID"]=t)}function lre(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function ure(e,t,n,r,a,s,i=!0,o=!1){const l=GV(e.urlParams),h=e.url+l,c=Object.assign({},e.headers);return ore(c,t),sre(c,n),ire(c,s),lre(c,r),new are(h,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,a,i,o)}function cre(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function hre(...e){const t=cre();if(t!==void 0){const n=new t;for(let r=0;r<e.length;r++)n.append(e[r]);return n.getBlob()}else{if(T2())return new Blob(e);throw new lr(Hn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function dre(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}function pre(e){if(typeof atob>"u")throw Yne("base-64");return atob(e)}const Do={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class ok{constructor(t,n){this.data=t,this.contentType=n||null}}function fre(e,t){switch(e){case Do.RAW:return new ok(KV(t));case Do.BASE64:case Do.BASE64URL:return new ok(XV(e,t));case Do.DATA_URL:return new ok(gre(t),yre(t))}throw I2()}function KV(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<e.length-1&&(e.charCodeAt(n+1)&64512)===56320))t.push(239,191,189);else{const s=r,i=e.charCodeAt(++n);r=65536|(s&1023)<<10|i&1023,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(t)}function mre(e){let t;try{t=decodeURIComponent(e)}catch{throw Cb(Do.DATA_URL,"Malformed data URL.")}return KV(t)}function XV(e,t){switch(e){case Do.BASE64:{const a=t.indexOf("-")!==-1,s=t.indexOf("_")!==-1;if(a||s)throw Cb(e,"Invalid character '"+(a?"-":"_")+"' found: is it base64url encoded?");break}case Do.BASE64URL:{const a=t.indexOf("+")!==-1,s=t.indexOf("/")!==-1;if(a||s)throw Cb(e,"Invalid character '"+(a?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=pre(t)}catch(a){throw a.message.includes("polyfill")?a:Cb(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r}class YV{constructor(t){this.base64=!1,this.contentType=null;const n=t.match(/^data:([^,]+)?,/);if(n===null)throw Cb(Do.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=bre(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=t.substring(t.indexOf(",")+1)}}function gre(e){const t=new YV(e);return t.base64?XV(Do.BASE64,t.rest):mre(t.rest)}function yre(e){return new YV(e).contentType}function bre(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}class qu{constructor(t,n){let r=0,a="";oP(t)?(this.data_=t,r=t.size,a=t.type):t instanceof ArrayBuffer?(n?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),r=this.data_.length):t instanceof Uint8Array&&(n?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),r=t.length),this.size_=r,this.type_=a}size(){return this.size_}type(){return this.type_}slice(t,n){if(oP(this.data_)){const r=this.data_,a=dre(r,t,n);return a===null?null:new qu(a)}else{const r=new Uint8Array(this.data_.buffer,t,n-t);return new qu(r,!0)}}static getBlob(...t){if(T2()){const n=t.map(r=>r instanceof qu?r.data_:r);return new qu(hre.apply(null,n))}else{const n=t.map(i=>g1(i)?fre(Do.RAW,i).data:i.data_);let r=0;n.forEach(i=>{r+=i.byteLength});const a=new Uint8Array(r);let s=0;return n.forEach(i=>{for(let o=0;o<i.length;o++)a[s++]=i[o]}),new qu(a,!0)}}uploadData(){return this.data_}}function QV(e){let t;try{t=JSON.parse(e)}catch{return null}return rre(t)?t:null}function vre(e){if(e.length===0)return null;const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function xre(e,t){const n=t.split("/").filter(r=>r.length>0).join("/");return e.length===0?n:e+"/"+n}function ZV(e){const t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}function wre(e,t){return t}class ns{constructor(t,n,r,a){this.server=t,this.local=n||t,this.writable=!!r,this.xform=a||wre}}let t0=null;function _re(e){return!g1(e)||e.length<2?e:ZV(e)}function JV(){if(t0)return t0;const e=[];e.push(new ns("bucket")),e.push(new ns("generation")),e.push(new ns("metageneration")),e.push(new ns("name","fullPath",!0));function t(s,i){return _re(i)}const n=new ns("name");n.xform=t,e.push(n);function r(s,i){return i!==void 0?Number(i):i}const a=new ns("size");return a.xform=r,e.push(a),e.push(new ns("timeCreated")),e.push(new ns("updated")),e.push(new ns("md5Hash",null,!0)),e.push(new ns("cacheControl",null,!0)),e.push(new ns("contentDisposition",null,!0)),e.push(new ns("contentEncoding",null,!0)),e.push(new ns("contentLanguage",null,!0)),e.push(new ns("contentType",null,!0)),e.push(new ns("metadata","customMetadata",!0)),t0=e,t0}function Sre(e,t){function n(){const r=e.bucket,a=e.fullPath,s=new Ks(r,a);return t._makeStorageReference(s)}Object.defineProperty(e,"ref",{get:n})}function Ire(e,t,n){const r={};r.type="file";const a=n.length;for(let s=0;s<a;s++){const i=n[s];r[i.local]=i.xform(r,t[i.server])}return Sre(r,e),r}function eU(e,t,n){const r=QV(t);return r===null?null:Ire(e,r,n)}function Tre(e,t,n,r){const a=QV(t);if(a===null||!g1(a.downloadTokens))return null;const s=a.downloadTokens;if(s.length===0)return null;const i=encodeURIComponent;return s.split(",").map(h=>{const c=e.bucket,p=e.fullPath,m="/b/"+i(c)+"/o/"+i(p),g=kv(m,n,r),b=GV({alt:"media",token:h});return g+b})[0]}function tU(e,t){const n={},r=t.length;for(let a=0;a<r;a++){const s=t[a];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}class Vm{constructor(t,n,r,a){this.url=t,this.method=n,this.handler=r,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function zl(e){if(!e)throw I2()}function k2(e,t){function n(r,a){const s=eU(e,a,t);return zl(s!==null),s}return n}function kre(e,t){function n(r,a){const s=eU(e,a,t);return zl(s!==null),Tre(s,a,e.host,e._protocol)}return n}function Ev(e){function t(n,r){let a;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?a=Wne():a=Bne():n.getStatus()===402?a=Une(e.bucket):n.getStatus()===403?a=jne(e.path):a=r,a.status=n.getStatus(),a.serverResponse=r.serverResponse,a}return t}function nU(e){const t=Ev(e);function n(r,a){let s=t(r,a);return r.getStatus()===404&&(s=Vne(e.path)),s.serverResponse=a.serverResponse,s}return n}function Ere(e,t,n){const r=t.fullServerUrl(),a=kv(r,e.host,e._protocol),s="GET",i=e.maxOperationRetryTime,o=new Vm(a,s,k2(e,n),i);return o.errorHandler=nU(t),o}function Nre(e,t,n){const r=t.fullServerUrl(),a=kv(r,e.host,e._protocol),s="GET",i=e.maxOperationRetryTime,o=new Vm(a,s,kre(e,n),i);return o.errorHandler=nU(t),o}function Cre(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function rU(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=Cre(null,t)),r}function Are(e,t,n,r,a){const s=t.bucketOnlyServerUrl(),i={"X-Goog-Upload-Protocol":"multipart"};function o(){let k="";for(let E=0;E<2;E++)k=k+Math.random().toString().slice(2);return k}const l=o();i["Content-Type"]="multipart/related; boundary="+l;const h=rU(t,r,a),c=tU(h,n),p="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+c+`\r
--`+l+`\r
Content-Type: `+h.contentType+`\r
\r
`,m=`\r
--`+l+"--",g=qu.getBlob(p,r,m);if(g===null)throw jV();const b={name:h.fullPath},v=kv(s,e.host,e._protocol),x="POST",_=e.maxUploadRetryTime,I=new Vm(v,x,k2(e,n),_);return I.urlParams=b,I.headers=i,I.body=g.uploadData(),I.errorHandler=Ev(t),I}class l_{constructor(t,n,r,a){this.current=t,this.total=n,this.finalized=!!r,this.metadata=a||null}}function E2(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch{zl(!1)}return zl(!!n&&(t||["active"]).indexOf(n)!==-1),n}function Rre(e,t,n,r,a){const s=t.bucketOnlyServerUrl(),i=rU(t,r,a),o={name:i.fullPath},l=kv(s,e.host,e._protocol),h="POST",c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":i.contentType,"Content-Type":"application/json; charset=utf-8"},p=tU(i,n),m=e.maxUploadRetryTime;function g(v){E2(v);let x;try{x=v.getResponseHeader("X-Goog-Upload-URL")}catch{zl(!1)}return zl(g1(x)),x}const b=new Vm(l,h,g,m);return b.urlParams=o,b.headers=c,b.body=p,b.errorHandler=Ev(t),b}function Dre(e,t,n,r){const a={"X-Goog-Upload-Command":"query"};function s(h){const c=E2(h,["active","final"]);let p=null;try{p=h.getResponseHeader("X-Goog-Upload-Size-Received")}catch{zl(!1)}p||zl(!1);const m=Number(p);return zl(!isNaN(m)),new l_(m,r.size(),c==="final")}const i="POST",o=e.maxUploadRetryTime,l=new Vm(n,i,s,o);return l.headers=a,l.errorHandler=Ev(t),l}const uP=256*1024;function Mre(e,t,n,r,a,s,i,o){const l=new l_(0,0);if(i?(l.current=i.current,l.total=i.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw Kne();const h=l.total-l.current;let c=h;a>0&&(c=Math.min(c,a));const p=l.current,m=p+c;let g="";c===0?g="finalize":h===c?g="upload, finalize":g="upload";const b={"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":`${l.current}`},v=r.slice(p,m);if(v===null)throw jV();function x(E,R){const U=E2(E,["active","final"]),D=l.current+c,C=r.size();let O;return U==="final"?O=k2(t,s)(E,R):O=null,new l_(D,C,U==="final",O)}const _="POST",I=t.maxUploadRetryTime,k=new Vm(n,_,x,I);return k.headers=b,k.body=v.uploadData(),k.progressCallback=o||null,k.errorHandler=Ev(e),k}const Es={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function lk(e){switch(e){case"running":case"pausing":case"canceling":return Es.RUNNING;case"paused":return Es.PAUSED;case"success":return Es.SUCCESS;case"canceled":return Es.CANCELED;case"error":return Es.ERROR;default:return Es.ERROR}}class $re{constructor(t,n,r){if(nre(t)||n!=null||r!=null)this.next=t,this.error=n??void 0,this.complete=r??void 0;else{const s=t;this.next=s.next,this.error=s.error,this.complete=s.complete}}}function Lf(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class Ore{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Bh.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Bh.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Bh.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,n,r,a,s){if(this.sent_)throw eb("cannot .send() more than once");if(Rc(t)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,t,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw eb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw eb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw eb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw eb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class Fre extends Ore{initXhr(){this.xhr_.responseType="text"}}function qf(){return new Fre}class Pre{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(t,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=n,this._metadata=r,this._mappings=JV(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=a=>{if(this._request=void 0,this._chunkMultiplier=1,a._codeEquals(Hn.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(qV(a.status,[]))if(s)a=BV();else{this.sleepTime=Math.max(this.sleepTime*2,zne),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=a,this._transition("error")}},this._metadataErrorHandler=a=>{this._request=void 0,a._codeEquals(Hn.CANCELED)?this.completeTransitions_():(this._error=a,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((a,s)=>{this._resolve=a,this._reject=s,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return n=>this._updateProgress(t+n)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":t(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,n)=>{const r=Rre(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(r,qf,t,n);this._request=a,a.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const t=this._uploadUrl;this._resolveToken((n,r)=>{const a=Dre(this._ref.storage,this._ref._location,t,this._blob),s=this._ref.storage._makeRequest(a,qf,n,r);this._request=s,s.getPromise().then(i=>{i=i,this._request=void 0,this._updateProgress(i.current),this._needToFetchStatus=!1,i.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const t=uP*this._chunkMultiplier,n=new l_(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((a,s)=>{let i;try{i=Mre(this._ref._location,this._ref.storage,r,this._blob,t,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const o=this._ref.storage._makeRequest(i,qf,a,s,!1);this._request=o,o.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){uP*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,n)=>{const r=Ere(this._ref.storage,this._ref._location,this._mappings),a=this._ref.storage._makeRequest(r,qf,t,n);this._request=a,a.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,n)=>{const r=Are(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(r,qf,t,n);this._request=a,a.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){const n=this._transferred;this._transferred=t,this._transferred!==n&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=t,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=WV(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const t=lk(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,n,r,a){const s=new $re(n||void 0,r||void 0,a||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(t,n){return this._promise.then(t,n)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){const n=this._observers.indexOf(t);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(lk(this._state)){case Es.SUCCESS:Lf(this._resolve.bind(null,this.snapshot))();break;case Es.CANCELED:case Es.ERROR:const n=this._reject;Lf(n.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(lk(this._state)){case Es.RUNNING:case Es.PAUSED:t.next&&Lf(t.next.bind(t,this.snapshot))();break;case Es.SUCCESS:t.complete&&Lf(t.complete.bind(t))();break;case Es.CANCELED:case Es.ERROR:t.error&&Lf(t.error.bind(t,this._error))();break;default:t.error&&Lf(t.error.bind(t,this._error))()}}resume(){const t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){const t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){const t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}}class ed{constructor(t,n){this._service=t,n instanceof Ks?this._location=n:this._location=Ks.makeFromUrl(n,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,n){return new ed(t,n)}get root(){const t=new Ks(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ZV(this._location.path)}get storage(){return this._service}get parent(){const t=vre(this._location.path);if(t===null)return null;const n=new Ks(this._location.bucket,t);return new ed(this._service,n)}_throwIfRoot(t){if(this._location.path==="")throw Qne(t)}}function Lre(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Pre(e,new qu(t),n)}function zre(e){e._throwIfRoot("getDownloadURL");const t=Nre(e.storage,e._location,JV());return e.storage.makeRequestWithTokens(t,qf).then(n=>{if(n===null)throw Xne();return n})}function Vre(e,t){const n=xre(e._location.path,t),r=new Ks(e._location.bucket,n);return new ed(e.storage,r)}function Ure(e){return/^[A-Za-z]+:\/\//.test(e)}function Bre(e,t){return new ed(e,t)}function aU(e,t){if(e instanceof N2){const n=e;if(n._bucket==null)throw qne();const r=new ed(n,n._bucket);return t!=null?aU(r,t):r}else return t!==void 0?Vre(e,t):e}function Wre(e,t){if(t&&Ure(t)){if(e instanceof N2)return Bre(e,t);throw oE("To use ref(service, url), the first argument must be a Storage instance.")}else return aU(e,t)}function cP(e,t){const n=t?.[UV];return n==null?null:Ks.makeFromBucketSpec(n,e)}function jre(e,t,n,r={}){e.host=`${t}:${n}`;const a=Rc(t);a&&(SN(`https://${e.host}/b`),IN("Storage",!0)),e._isUsingEmulator=!0,e._protocol=a?"https":"http";const{mockUserToken:s}=r;s&&(e._overrideAuthToken=typeof s=="string"?s:Sz(s,e.app.options.projectId))}class N2{constructor(t,n,r,a,s,i=!1){this.app=t,this._authProvider=n,this._appCheckProvider=r,this._url=a,this._firebaseVersion=s,this._isUsingEmulator=i,this._bucket=null,this._host=VV,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Pne,this._maxUploadRetryTime=Lne,this._requests=new Set,a!=null?this._bucket=Ks.makeFromBucketSpec(a,this._host):this._bucket=cP(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Ks.makeFromBucketSpec(this._url,t):this._bucket=cP(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){lP("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){lP("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const n=await t.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(Ns(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new ed(this,t)}_makeRequest(t,n,r,a,s=!0){if(this._deleted)return new Zne(HV());{const i=ure(t,this._appId,r,a,n,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(t,n){const[r,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,n,r,a).getPromise()}}const hP="@firebase/storage",dP="0.14.0";const sU="storage";function Hre(e,t,n){return e=sr(e),Lre(e,t,n)}function Gre(e){return e=sr(e),zre(e)}function qre(e,t){return e=sr(e),Wre(e,t)}function Kre(e=EN(),t){e=sr(e);const r=H_(e,sU).getImmediate({identifier:t}),a=xz("storage");return a&&Xre(r,...a),r}function Xre(e,t,n,r={}){jre(e,t,n,r)}function Yre(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return new N2(n,r,a,t,wd)}function Qre(){Kh(new oc(sU,Yre,"PUBLIC").setMultipleInstances(!0)),Oo(hP,dP,""),Oo(hP,dP,"esm2020")}Qre();const Zre={apiKey:"AIzaSyC8wmHDtX9AHFKhd9IHLmYqi87myF5o7lo",authDomain:"async-music.firebaseapp.com",projectId:"async-music",storageBucket:"async-music.appspot.com",messagingSenderId:"425046929612",appId:"1:425046929612:web:1cd532c172a70de5db5269",measurementId:"G-WJQ8E0BM0C"},C2=kz(Zre),tb=_J(C2),Ta=_ne(C2),Jre=Kre(C2),iU=fe.createContext(),Pc=()=>fe.useContext(iU);function eae({children:e}){const[t,n]=fe.useState(null),[r,a]=fe.useState(null),[s,i]=fe.useState(!0),o=(m,g)=>iZ(tb,m,g),l=(m,g)=>oZ(tb,m,g),h=()=>{const m=new Dl;return RZ(tb,m)},c=()=>hZ(tb);fe.useEffect(()=>cZ(tb,async g=>{if(g)try{const b=await $ne(fc(Ta,"users",g.uid));b.exists()&&a(b.data())}catch(b){console.error("Error fetching user profile:",b)}else a(null);n(g),i(!1)}),[]);const p={user:t,userProfile:r,loading:s,signup:o,login:l,logout:c,loginWithGoogle:h};return G.jsx(iU.Provider,{value:p,children:!s&&e})}function tae(){const{signup:e,loginWithGoogle:t}=Pc(),[n,r]=fe.useState(""),[a,s]=fe.useState(""),[i,o]=fe.useState(""),[l,h]=fe.useState(""),c=B_(),p=async g=>{if(g.preventDefault(),!i.trim()){h("Username is required");return}try{const b=await e(n,a);await o_(fc(Ta,"users",b.user.uid),{username:i.trim(),email:n,createdAt:new Date}),c("/")}catch(b){h(b.message)}},m=async()=>{try{const g=await t(),b=fc(Ta,"users",g.user.uid);await o_(b,{username:g.user.displayName||g.user.email.split("@")[0],email:g.user.email,createdAt:new Date},{merge:!0}),c("/")}catch(g){h(g.message)}};return G.jsx("div",{className:"auth-container",children:G.jsxs("div",{className:"auth-card",children:[G.jsx("h2",{children:"Create Account "}),l&&G.jsx("p",{style:{color:"red"},children:l}),G.jsxs("form",{onSubmit:p,children:[G.jsx("input",{type:"text",placeholder:"Choose Username",value:i,onChange:g=>o(g.target.value),required:!0}),G.jsx("input",{type:"email",placeholder:"Email Address",value:n,onChange:g=>r(g.target.value)}),G.jsx("input",{type:"password",placeholder:"Create Password",value:a,onChange:g=>s(g.target.value)}),G.jsx("button",{type:"submit",children:"Sign Up"})]}),G.jsx("button",{className:"google-btn",onClick:m,children:"Continue with Google"}),G.jsxs("p",{style:{marginTop:"10px"},children:["Already have an account?"," ",G.jsx("span",{onClick:()=>c("/login"),style:{color:"#58a6ff",cursor:"pointer"},children:"Log In"})]})]})})}function nae(){const{login:e,loginWithGoogle:t}=Pc(),[n,r]=fe.useState(""),[a,s]=fe.useState(""),[i,o]=fe.useState(""),l=B_(),h=async p=>{p.preventDefault();try{await e(n,a),l("/")}catch(m){o(m.message)}},c=async()=>{try{await t(),l("/")}catch(p){o(p.message)}};return G.jsx("div",{className:"auth-container",children:G.jsxs("div",{className:"auth-card",children:[G.jsx("h2",{children:"Welcome Back "}),i&&G.jsx("p",{style:{color:"red"},children:i}),G.jsxs("form",{onSubmit:h,children:[G.jsx("input",{type:"email",placeholder:"Email Address",value:n,onChange:p=>r(p.target.value)}),G.jsx("input",{type:"password",placeholder:"Password",value:a,onChange:p=>s(p.target.value)}),G.jsx("button",{type:"submit",children:"Login"})]}),G.jsx("button",{className:"google-btn",onClick:c,children:"Continue with Google"}),G.jsxs("p",{style:{marginTop:"10px"},children:["Dont have an account?"," ",G.jsx("span",{onClick:()=>l("/signup"),style:{color:"#58a6ff",cursor:"pointer"},children:"Sign Up"})]})]})})}var rae=Object.defineProperty,aae=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),A2=(e,t)=>{for(var n in t)rae(e,n,{get:t[n],enumerable:!0})},sae={};A2(sae,{Abs:()=>Bm,Acos:()=>kd,Acosh:()=>Ed,AdadeltaOptimizer:()=>YC,AdagradOptimizer:()=>QC,AdamOptimizer:()=>ZC,AdamaxOptimizer:()=>JC,Add:()=>zc,AddN:()=>Nd,All:()=>Wm,Any:()=>jm,ArgMax:()=>Hm,ArgMin:()=>Gm,Asin:()=>Cd,Asinh:()=>Ad,Atan:()=>Rd,Atan2:()=>Md,Atanh:()=>Dd,AvgPool:()=>$d,AvgPool3D:()=>qm,AvgPool3DGrad:()=>Rv,AvgPoolGrad:()=>Av,BackendWasm:()=>m8,BatchMatMul:()=>Od,BatchToSpaceND:()=>Km,Bincount:()=>Xm,BitwiseAnd:()=>Ym,BroadcastArgs:()=>Dv,BroadcastTo:()=>wU,Callback:()=>fj,CallbackList:()=>oW,Cast:()=>Fd,Ceil:()=>Pd,ClipByValue:()=>Vc,Complex:()=>w1,ComplexAbs:()=>Mv,Concat:()=>Qm,Conv2D:()=>Ld,Conv2DBackpropFilter:()=>_1,Conv2DBackpropInput:()=>zd,Conv3D:()=>Vd,Conv3DBackpropFilterV2:()=>Zm,Conv3DBackpropInputV2:()=>Jm,Cos:()=>Ud,Cosh:()=>Bd,CropAndResize:()=>tg,Cumprod:()=>eg,Cumsum:()=>Wd,CustomCallback:()=>uW,DataStorage:()=>b1,DenseBincount:()=>$v,DepthToSpace:()=>ng,DepthwiseConv2dNative:()=>jd,DepthwiseConv2dNativeBackpropFilter:()=>S1,DepthwiseConv2dNativeBackpropInput:()=>I1,Diag:()=>Ov,Dilation2D:()=>Hd,Dilation2DBackpropFilter:()=>mm,Dilation2DBackpropInput:()=>fm,Draw:()=>T1,ENV:()=>O2,EarlyStopping:()=>mj,Einsum:()=>k1,Elu:()=>qd,EluGrad:()=>rg,Environment:()=>vU,Equal:()=>ag,Erf:()=>Kd,Exp:()=>Xd,ExpandDims:()=>sg,Expm1:()=>Yd,FFT:()=>E1,Fill:()=>Fv,FlipLeftRight:()=>ig,Floor:()=>Qd,FloorDiv:()=>Zd,FromPixels:()=>d_,FusedBatchNorm:()=>Jd,FusedConv2D:()=>nd,FusedDepthwiseConv2D:()=>rd,GPGPUContext:()=>L0,GatherNd:()=>lg,GatherV2:()=>og,GraphModel:()=>zR,Greater:()=>ug,GreaterEqual:()=>ep,History:()=>lW,IFFT:()=>N1,Identity:()=>tp,Imag:()=>C1,InputSpec:()=>kr,IsFinite:()=>np,IsInf:()=>rp,IsNan:()=>ap,KernelBackend:()=>Nv,LRN:()=>lp,LRNGrad:()=>gg,LayerVariable:()=>J6,LayersModel:()=>Ul,LeakyRelu:()=>sp,Less:()=>cg,LessEqual:()=>hg,LinSpace:()=>dg,Log:()=>ip,Log1p:()=>op,LogSoftmax:()=>SU,LogicalAnd:()=>pg,LogicalNot:()=>fg,LogicalOr:()=>mg,LogicalXor:()=>_U,LowerBound:()=>Yae,MathBackendCPU:()=>BR,MathBackendWebGL:()=>gD,MatrixBandPart:()=>Qae,Max:()=>up,MaxPool:()=>hp,MaxPool3D:()=>yg,MaxPool3DGrad:()=>Lv,MaxPoolGrad:()=>Pv,MaxPoolWithArgmax:()=>zv,Maximum:()=>cp,Mean:()=>dp,Min:()=>pp,Minimum:()=>fp,MirrorPad:()=>mp,Mod:()=>gp,MomentumOptimizer:()=>eA,Multinomial:()=>bg,Multiply:()=>yp,Neg:()=>vg,NonMaxSuppressionV3:()=>wg,NonMaxSuppressionV4:()=>_g,NonMaxSuppressionV5:()=>Sg,NotEqual:()=>xg,OP_SCOPE_SUFFIX:()=>V2,OneHot:()=>bp,OnesLike:()=>Ig,Optimizer:()=>ru,OptimizerConstructors:()=>D6,Pack:()=>Tg,PadV2:()=>vp,Pool:()=>Zae,Pow:()=>xp,Prelu:()=>wp,Prod:()=>_p,RMSPropOptimizer:()=>tA,RNN:()=>au,RaggedGather:()=>A1,RaggedRange:()=>R1,RaggedTensorToTensor:()=>D1,Range:()=>Vv,Rank:()=>cE,Real:()=>M1,RealDiv:()=>Gd,Reciprocal:()=>Sp,Reduction:()=>Va,Relu:()=>Ip,Relu6:()=>Ep,Reshape:()=>kg,ResizeBilinear:()=>kp,ResizeBilinearGrad:()=>Ng,ResizeNearestNeighbor:()=>Tp,ResizeNearestNeighborGrad:()=>Eg,Reverse:()=>Np,RotateWithOffset:()=>Wg,Round:()=>Cp,Rsqrt:()=>Ap,SGDOptimizer:()=>mS,ScatterNd:()=>Cg,SearchSorted:()=>Rg,Select:()=>Dg,Selu:()=>Rp,Sequential:()=>NS,Sigmoid:()=>Op,Sign:()=>$p,Sin:()=>Dp,Sinh:()=>Mp,Slice:()=>Mg,Softmax:()=>zp,Softplus:()=>Fp,SpaceToBatchND:()=>$g,SparseFillEmptyRows:()=>Uv,SparseReshape:()=>Fg,SparseSegmentMean:()=>Bv,SparseSegmentSum:()=>Wv,SparseToDense:()=>Pg,SplitV:()=>Og,Sqrt:()=>Pp,Square:()=>jv,SquaredDifference:()=>Vp,StaticRegexReplace:()=>Hv,Step:()=>Bc,StridedSlice:()=>Lg,StringNGrams:()=>Gv,StringSplit:()=>qv,StringToHashBucketFast:()=>Kv,Sub:()=>Up,Sum:()=>Lp,SymbolicTensor:()=>no,Tan:()=>Bp,Tanh:()=>Wp,Tensor:()=>Tt,TensorBuffer:()=>Er,TensorScatterUpdate:()=>Ag,Tile:()=>Uc,TopK:()=>zg,Transform:()=>Vg,Transpose:()=>Vl,Unique:()=>Xv,Unpack:()=>Ug,UnsortedSegmentSum:()=>Yv,UpperBound:()=>Jae,Variable:()=>ad,ZerosLike:()=>Bg,_FusedMatMul:()=>td,abs:()=>Tr,acos:()=>H2,acosh:()=>G2,add:()=>Se,addN:()=>QU,all:()=>L1,any:()=>Jb,argMax:()=>ld,argMin:()=>q2,asin:()=>K2,asinh:()=>X2,atan:()=>Y2,atan2:()=>Q2,atanh:()=>Z2,avgPool:()=>eu,avgPool3d:()=>eC,backend:()=>U2,backend_util:()=>B,basicLSTMCell:()=>tB,batchNorm:()=>jp,batchNorm2d:()=>tC,batchNorm3d:()=>nC,batchNorm4d:()=>rC,batchToSpaceND:()=>rx,bincount:()=>aC,bitwiseAnd:()=>nB,booleanMaskAsync:()=>HB,broadcastArgs:()=>rB,broadcastTo:()=>Wh,broadcast_util:()=>jg,browser:()=>gx,buffer:()=>At,callbacks:()=>Kve,cast:()=>ze,ceil:()=>sC,clipByValue:()=>ka,clone:()=>Uo,complex:()=>Kl,concat:()=>Sn,concat1d:()=>iC,concat2d:()=>oC,concat3d:()=>lC,concat4d:()=>uC,constraints:()=>rW,conv1d:()=>z1,conv2d:()=>ja,conv2dTranspose:()=>V1,conv3d:()=>hC,conv3dTranspose:()=>dC,copyRegisteredKernels:()=>rse,cos:()=>ax,cosh:()=>U1,cosineWindow:()=>cS,cumprod:()=>nv,cumsum:()=>B1,customGrad:()=>Ko,data:()=>zj,denseBincount:()=>m_,deprecationWarn:()=>PU,depthToSpace:()=>pC,depthwiseConv2d:()=>Hp,deregisterOp:()=>Qve,device_util:()=>ex,diag:()=>sB,dilation2d:()=>fC,disableDeprecationWarnings:()=>Mse,dispose:()=>wt,disposeVariables:()=>$se,div:()=>Ke,divNoNan:()=>mC,dot:()=>gC,dropout:()=>HC,einsum:()=>Dh,elu:()=>Hg,enableDebugMode:()=>Dse,enableProdMode:()=>Rse,enclosingPowerOfTwo:()=>GC,engine:()=>_i,ensureShape:()=>oB,env:()=>he,equal:()=>Ms,erf:()=>W1,euclideanNorm:()=>vC,exp:()=>Ea,expandDims:()=>ea,expm1:()=>xC,eye:()=>j1,fft:()=>fx,fill:()=>Ds,findBackend:()=>Vse,findBackendFactory:()=>Use,floor:()=>qg,floorDiv:()=>P1,forceHalfFloat:()=>uG,fused:()=>Sm,gather:()=>Kg,gatherND:()=>XB,gather_util:()=>aA,getBackend:()=>LU,getGradient:()=>lE,getKernel:()=>Yb,getKernelsForBackend:()=>p_,getThreadsCount:()=>tUe,gpgpu_util:()=>VH,grad:()=>vle,grads:()=>xle,greater:()=>Xa,greaterEqual:()=>tu,ifft:()=>_m,imag:()=>sx,image:()=>Xs,inTopKAsync:()=>YB,initializers:()=>aW,input:()=>SW,io:()=>ma,irfft:()=>rS,isFinite:()=>wC,isInf:()=>_C,isNaN:()=>SC,keep:()=>Br,kernel_impls:()=>el,layers:()=>sW,leakyRelu:()=>ix,less:()=>bm,lessEqual:()=>jc,linalg:()=>XC,linspace:()=>dB,loadGraphModel:()=>rwe,loadGraphModelSync:()=>awe,loadLayersModel:()=>Wye,localResponseNormalization:()=>IC,log:()=>$s,log1p:()=>ox,logSigmoid:()=>TC,logSoftmax:()=>G1,logSumExp:()=>lx,logicalAnd:()=>Ei,logicalNot:()=>ux,logicalOr:()=>q1,logicalXor:()=>kC,losses:()=>l6,lowerBound:()=>fB,matMul:()=>Nt,math:()=>v6,max:()=>ei,maxPool:()=>Qr,maxPool3d:()=>EC,maxPoolWithArgmax:()=>mB,maximum:()=>Jo,mean:()=>Qn,memory:()=>yE,meshgrid:()=>gB,metrics:()=>hj,min:()=>ym,minimum:()=>_c,mirrorPad:()=>NC,mod:()=>CC,model:()=>Gye,models:()=>dj,moments:()=>cx,movingAverage:()=>GB,mul:()=>re,multiRNNCell:()=>yB,multinomial:()=>bB,neg:()=>Mn,nextFrame:()=>sA,norm:()=>Gg,notEqual:()=>hd,oneHot:()=>vm,ones:()=>as,onesLike:()=>Os,op:()=>te,outerProduct:()=>vB,pad:()=>io,pad1d:()=>xB,pad2d:()=>wB,pad3d:()=>_B,pad4d:()=>SB,pool:()=>AC,pow:()=>qo,prelu:()=>dx,print:()=>j2,prod:()=>RC,profile:()=>Ose,raggedGather:()=>IB,raggedRange:()=>TB,raggedTensorToTensor:()=>kB,rand:()=>EB,randomGamma:()=>RB,randomNormal:()=>X1,randomStandardNormal:()=>DB,randomUniform:()=>Hc,randomUniformInt:()=>MB,range:()=>dd,ready:()=>Lse,real:()=>xm,reciprocal:()=>FC,registerBackend:()=>F1,registerCallbackConstructor:()=>Kye,registerGradient:()=>IU,registerKernel:()=>Qv,registerOp:()=>Yve,regularizers:()=>pj,relu:()=>fn,relu6:()=>Y1,removeBackend:()=>zse,reshape:()=>ie,reverse:()=>ri,reverse1d:()=>$B,reverse2d:()=>OB,reverse3d:()=>FB,reverse4d:()=>PB,rfft:()=>mx,round:()=>Q1,rsqrt:()=>Z1,scalar:()=>rt,scatterND:()=>qB,scatter_util:()=>iS,searchSorted:()=>K1,selu:()=>J1,separableConv2d:()=>Xg,sequential:()=>qye,serialization:()=>Re,setBackend:()=>Pse,setPlatform:()=>Bse,setThreadsCount:()=>eUe,setWasmPath:()=>ZVe,setWasmPaths:()=>JVe,setWebGLContext:()=>cH,setdiff1dAsync:()=>LB,shared:()=>WR,sigmoid:()=>Ti,sign:()=>PC,signal:()=>o6,sin:()=>eS,sinh:()=>tS,slice:()=>Pt,slice1d:()=>px,slice2d:()=>nS,slice3d:()=>Yg,slice4d:()=>wm,slice_util:()=>jr,softmax:()=>Gc,softplus:()=>Gp,spaceToBatchND:()=>hx,sparse:()=>u6,sparseToDense:()=>KB,spectral:()=>i6,split:()=>is,sqrt:()=>aa,square:()=>_n,squaredDifference:()=>aS,squeeze:()=>qc,stack:()=>Nr,step:()=>qp,stridedSlice:()=>LC,string:()=>c6,sub:()=>Ge,sum:()=>Ye,sumOutType:()=>O1,tan:()=>zC,tanh:()=>wc,tensor:()=>Ba,tensor1d:()=>dn,tensor2d:()=>Bo,tensor3d:()=>sS,tensor4d:()=>Sc,tensor5d:()=>zB,tensor6d:()=>VB,tensorScatterUpdate:()=>BB,tensor_util:()=>Xi,test_util:()=>NB,tidy:()=>oe,tile:()=>Rs,time:()=>Fse,topk:()=>UC,train:()=>Ch,transpose:()=>Ct,truncatedNormal:()=>lS,unique:()=>BC,unregisterGradient:()=>nse,unregisterKernel:()=>tse,unsortedSegmentSum:()=>uS,unstack:()=>or,upcastType:()=>ti,upperBound:()=>WB,util:()=>$,valueAndGrad:()=>wle,valueAndGrads:()=>_le,variable:()=>WC,variableGrads:()=>pB,version:()=>lUe,version_converter:()=>iwe,version_core:()=>Gde,version_cpu:()=>o_e,version_layers:()=>NA,version_wasm:()=>nUe,version_webgl:()=>YNe,webgl:()=>QNe,webgl_util:()=>uH,where:()=>ra,whereAsync:()=>jC,zeros:()=>Zn,zerosLike:()=>Ut});var iae=Object.create,R2=Object.defineProperty,oae=Object.getOwnPropertyDescriptor,lae=Object.getOwnPropertyNames,uae=Object.getPrototypeOf,cae=Object.prototype.hasOwnProperty,Ar=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),_t=(e,t)=>{for(var n in t)R2(e,n,{get:t[n],enumerable:!0})},hae=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of lae(t))!cae.call(e,a)&&a!==n&&R2(e,a,{get:()=>t[a],enumerable:!(r=oae(t,a))||r.enumerable});return e},Lc=(e,t,n)=>(n=e!=null?iae(uae(e)):{},hae(!e||!e.__esModule?R2(n,"default",{value:e,enumerable:!0}):n,e)),dae=Ar((e,t)=>{t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(N,P,Q){this.low=N|0,this.high=P|0,this.unsigned=!!Q}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0});function a(N){return(N&&N.__isLong__)===!0}r.isLong=a;var s={},i={};function o(N,P){var Q,ee,q;return P?(N>>>=0,(q=0<=N&&N<256)&&(ee=i[N],ee)?ee:(Q=h(N,(N|0)<0?-1:0,!0),q&&(i[N]=Q),Q)):(N|=0,(q=-128<=N&&N<128)&&(ee=s[N],ee)?ee:(Q=h(N,N<0?-1:0,!1),q&&(s[N]=Q),Q))}r.fromInt=o;function l(N,P){if(isNaN(N))return P?E:k;if(P){if(N<0)return E;if(N>=x)return O}else{if(N<=-_)return z;if(N+1>=_)return C}return N<0?l(-N,P).neg():h(N%v|0,N/v|0,P)}r.fromNumber=l;function h(N,P,Q){return new r(N,P,Q)}r.fromBits=h;var c=Math.pow;function p(N,P,Q){if(N.length===0)throw Error("empty string");if(N==="NaN"||N==="Infinity"||N==="+Infinity"||N==="-Infinity")return k;if(typeof P=="number"?(Q=P,P=!1):P=!!P,Q=Q||10,Q<2||36<Q)throw RangeError("radix");var ee;if((ee=N.indexOf("-"))>0)throw Error("interior hyphen");if(ee===0)return p(N.substring(1),P,Q).neg();for(var q=l(c(Q,8)),Z=k,ne=0;ne<N.length;ne+=8){var me=Math.min(8,N.length-ne),xe=parseInt(N.substring(ne,ne+me),Q);if(me<8){var H=l(c(Q,me));Z=Z.mul(H).add(l(xe))}else Z=Z.mul(q),Z=Z.add(l(xe))}return Z.unsigned=P,Z}r.fromString=p;function m(N,P){return typeof N=="number"?l(N,P):typeof N=="string"?p(N,P):h(N.low,N.high,typeof P=="boolean"?P:N.unsigned)}r.fromValue=m;var g=65536,b=1<<24,v=g*g,x=v*v,_=x/2,I=o(b),k=o(0);r.ZERO=k;var E=o(0,!0);r.UZERO=E;var R=o(1);r.ONE=R;var U=o(1,!0);r.UONE=U;var D=o(-1);r.NEG_ONE=D;var C=h(-1,2147483647,!1);r.MAX_VALUE=C;var O=h(-1,-1,!0);r.MAX_UNSIGNED_VALUE=O;var z=h(0,-2147483648,!1);r.MIN_VALUE=z;var M=r.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*v+(this.low>>>0):this.high*v+(this.low>>>0)},M.toString=function(N){if(N=N||10,N<2||36<N)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(z)){var P=l(N),Q=this.div(P),ee=Q.mul(P).sub(this);return Q.toString(N)+ee.toInt().toString(N)}else return"-"+this.neg().toString(N);for(var q=l(c(N,6),this.unsigned),Z=this,ne="";;){var me=Z.div(q),xe=Z.sub(me.mul(q)).toInt()>>>0,H=xe.toString(N);if(Z=me,Z.isZero())return H+ne;for(;H.length<6;)H="0"+H;ne=""+H+ne}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(z)?64:this.neg().getNumBitsAbs();for(var N=this.high!=0?this.high:this.low,P=31;P>0&&!(N&1<<P);P--);return this.high!=0?P+33:P+1},M.isZero=function(){return this.high===0&&this.low===0},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return(this.low&1)===1},M.isEven=function(){return(this.low&1)===0},M.equals=function(N){return a(N)||(N=m(N)),this.unsigned!==N.unsigned&&this.high>>>31===1&&N.high>>>31===1?!1:this.high===N.high&&this.low===N.low},M.eq=M.equals,M.notEquals=function(N){return!this.eq(N)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(N){return this.comp(N)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(N){return this.comp(N)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(N){return this.comp(N)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(N){return this.comp(N)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(N){if(a(N)||(N=m(N)),this.eq(N))return 0;var P=this.isNegative(),Q=N.isNegative();return P&&!Q?-1:!P&&Q?1:this.unsigned?N.high>>>0>this.high>>>0||N.high===this.high&&N.low>>>0>this.low>>>0?-1:1:this.sub(N).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(z)?z:this.not().add(R)},M.neg=M.negate,M.add=function(N){a(N)||(N=m(N));var P=this.high>>>16,Q=this.high&65535,ee=this.low>>>16,q=this.low&65535,Z=N.high>>>16,ne=N.high&65535,me=N.low>>>16,xe=N.low&65535,H=0,se=0,ue=0,ge=0;return ge+=q+xe,ue+=ge>>>16,ge&=65535,ue+=ee+me,se+=ue>>>16,ue&=65535,se+=Q+ne,H+=se>>>16,se&=65535,H+=P+Z,H&=65535,h(ue<<16|ge,H<<16|se,this.unsigned)},M.subtract=function(N){return a(N)||(N=m(N)),this.add(N.neg())},M.sub=M.subtract,M.multiply=function(N){if(this.isZero())return k;if(a(N)||(N=m(N)),n){var P=n.mul(this.low,this.high,N.low,N.high);return h(P,n.get_high(),this.unsigned)}if(N.isZero())return k;if(this.eq(z))return N.isOdd()?z:k;if(N.eq(z))return this.isOdd()?z:k;if(this.isNegative())return N.isNegative()?this.neg().mul(N.neg()):this.neg().mul(N).neg();if(N.isNegative())return this.mul(N.neg()).neg();if(this.lt(I)&&N.lt(I))return l(this.toNumber()*N.toNumber(),this.unsigned);var Q=this.high>>>16,ee=this.high&65535,q=this.low>>>16,Z=this.low&65535,ne=N.high>>>16,me=N.high&65535,xe=N.low>>>16,H=N.low&65535,se=0,ue=0,ge=0,Ee=0;return Ee+=Z*H,ge+=Ee>>>16,Ee&=65535,ge+=q*H,ue+=ge>>>16,ge&=65535,ge+=Z*xe,ue+=ge>>>16,ge&=65535,ue+=ee*H,se+=ue>>>16,ue&=65535,ue+=q*xe,se+=ue>>>16,ue&=65535,ue+=Z*me,se+=ue>>>16,ue&=65535,se+=Q*H+ee*xe+q*me+Z*ne,se&=65535,h(ge<<16|Ee,se<<16|ue,this.unsigned)},M.mul=M.multiply,M.divide=function(N){if(a(N)||(N=m(N)),N.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&N.low===-1&&N.high===-1)return this;var P=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,N.low,N.high);return h(P,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?E:k;var Q,ee,q;if(this.unsigned){if(N.unsigned||(N=N.toUnsigned()),N.gt(this))return E;if(N.gt(this.shru(1)))return U;q=E}else{if(this.eq(z)){if(N.eq(R)||N.eq(D))return z;if(N.eq(z))return R;var Z=this.shr(1);return Q=Z.div(N).shl(1),Q.eq(k)?N.isNegative()?R:D:(ee=this.sub(N.mul(Q)),q=Q.add(ee.div(N)),q)}else if(N.eq(z))return this.unsigned?E:k;if(this.isNegative())return N.isNegative()?this.neg().div(N.neg()):this.neg().div(N).neg();if(N.isNegative())return this.div(N.neg()).neg();q=k}for(ee=this;ee.gte(N);){Q=Math.max(1,Math.floor(ee.toNumber()/N.toNumber()));for(var ne=Math.ceil(Math.log(Q)/Math.LN2),me=ne<=48?1:c(2,ne-48),xe=l(Q),H=xe.mul(N);H.isNegative()||H.gt(ee);)Q-=me,xe=l(Q,this.unsigned),H=xe.mul(N);xe.isZero()&&(xe=R),q=q.add(xe),ee=ee.sub(H)}return q},M.div=M.divide,M.modulo=function(N){if(a(N)||(N=m(N)),n){var P=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,N.low,N.high);return h(P,n.get_high(),this.unsigned)}return this.sub(this.div(N).mul(N))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return h(~this.low,~this.high,this.unsigned)},M.and=function(N){return a(N)||(N=m(N)),h(this.low&N.low,this.high&N.high,this.unsigned)},M.or=function(N){return a(N)||(N=m(N)),h(this.low|N.low,this.high|N.high,this.unsigned)},M.xor=function(N){return a(N)||(N=m(N)),h(this.low^N.low,this.high^N.high,this.unsigned)},M.shiftLeft=function(N){return a(N)&&(N=N.toInt()),(N&=63)===0?this:N<32?h(this.low<<N,this.high<<N|this.low>>>32-N,this.unsigned):h(0,this.low<<N-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(N){return a(N)&&(N=N.toInt()),(N&=63)===0?this:N<32?h(this.low>>>N|this.high<<32-N,this.high>>N,this.unsigned):h(this.high>>N-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(N){if(a(N)&&(N=N.toInt()),N&=63,N===0)return this;var P=this.high;if(N<32){var Q=this.low;return h(Q>>>N|P<<32-N,P>>>N,this.unsigned)}else return N===32?h(P,0,this.unsigned):h(P>>>N-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},M.toBytes=function(N){return N?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var N=this.high,P=this.low;return[P&255,P>>>8&255,P>>>16&255,P>>>24,N&255,N>>>8&255,N>>>16&255,N>>>24]},M.toBytesBE=function(){var N=this.high,P=this.low;return[N>>>24,N>>>16&255,N>>>8&255,N&255,P>>>24,P>>>16&255,P>>>8&255,P&255]},r.fromBytes=function(N,P,Q){return Q?r.fromBytesLE(N,P):r.fromBytesBE(N,P)},r.fromBytesLE=function(N,P){return new r(N[0]|N[1]<<8|N[2]<<16|N[3]<<24,N[4]|N[5]<<8|N[6]<<16|N[7]<<24,P)},r.fromBytesBE=function(N,P){return new r(N[4]<<24|N[5]<<16|N[6]<<8|N[7],N[0]<<24|N[1]<<16|N[2]<<8|N[3],P)}}),pae=Ar(()=>{}),fae=Ar(()=>{}),mae=Ar((e,t)=>{(function(n,r,a){function s(h){var c=this,p=l();c.next=function(){var m=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=m-(c.c=m|0)},c.c=1,c.s0=p(" "),c.s1=p(" "),c.s2=p(" "),c.s0-=p(h),c.s0<0&&(c.s0+=1),c.s1-=p(h),c.s1<0&&(c.s1+=1),c.s2-=p(h),c.s2<0&&(c.s2+=1),p=null}function i(h,c){return c.c=h.c,c.s0=h.s0,c.s1=h.s1,c.s2=h.s2,c}function o(h,c){var p=new s(h),m=c&&c.state,g=p.next;return g.int32=function(){return p.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,m&&(typeof m=="object"&&i(m,p),g.state=function(){return i(p,{})}),g}function l(){var h=4022871197,c=function(p){p=String(p);for(var m=0;m<p.length;m++){h+=p.charCodeAt(m);var g=.02519603282416938*h;h=g>>>0,g-=h,g*=h,h=g>>>0,g-=h,h+=g*4294967296}return(h>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.alea=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),gae=Ar((e,t)=>{(function(n,r,a){function s(l){var h=this,c="";h.x=0,h.y=0,h.z=0,h.w=0,h.next=function(){var m=h.x^h.x<<11;return h.x=h.y,h.y=h.z,h.z=h.w,h.w^=h.w>>>19^m^m>>>8},l===(l|0)?h.x=l:c+=l;for(var p=0;p<c.length+64;p++)h.x^=c.charCodeAt(p)|0,h.next()}function i(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h}function o(l,h){var c=new s(l),p=h&&h.state,m=function(){return(c.next()>>>0)/4294967296};return m.double=function(){do var g=c.next()>>>11,b=(c.next()>>>0)/4294967296,v=(g+b)/(1<<21);while(v===0);return v},m.int32=c.next,m.quick=m,p&&(typeof p=="object"&&i(p,c),m.state=function(){return i(c,{})}),m}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.xor128=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),yae=Ar((e,t)=>{(function(n,r,a){function s(l){var h=this,c="";h.next=function(){var m=h.x^h.x>>>2;return h.x=h.y,h.y=h.z,h.z=h.w,h.w=h.v,(h.d=h.d+362437|0)+(h.v=h.v^h.v<<4^(m^m<<1))|0},h.x=0,h.y=0,h.z=0,h.w=0,h.v=0,l===(l|0)?h.x=l:c+=l;for(var p=0;p<c.length+64;p++)h.x^=c.charCodeAt(p)|0,p==c.length&&(h.d=h.x<<10^h.x>>>4),h.next()}function i(l,h){return h.x=l.x,h.y=l.y,h.z=l.z,h.w=l.w,h.v=l.v,h.d=l.d,h}function o(l,h){var c=new s(l),p=h&&h.state,m=function(){return(c.next()>>>0)/4294967296};return m.double=function(){do var g=c.next()>>>11,b=(c.next()>>>0)/4294967296,v=(g+b)/(1<<21);while(v===0);return v},m.int32=c.next,m.quick=m,p&&(typeof p=="object"&&i(p,c),m.state=function(){return i(c,{})}),m}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.xorwow=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),bae=Ar((e,t)=>{(function(n,r,a){function s(l){var h=this;h.next=function(){var p=h.x,m=h.i,g,b;return g=p[m],g^=g>>>7,b=g^g<<24,g=p[m+1&7],b^=g^g>>>10,g=p[m+3&7],b^=g^g>>>3,g=p[m+4&7],b^=g^g<<7,g=p[m+7&7],g=g^g<<13,b^=g^g<<9,p[m]=b,h.i=m+1&7,b};function c(p,m){var g,b=[];if(m===(m|0))b[0]=m;else for(m=""+m,g=0;g<m.length;++g)b[g&7]=b[g&7]<<15^m.charCodeAt(g)+b[g+1&7]<<13;for(;b.length<8;)b.push(0);for(g=0;g<8&&b[g]===0;++g);for(g==8?b[7]=-1:b[g],p.x=b,p.i=0,g=256;g>0;--g)p.next()}c(h,l)}function i(l,h){return h.x=l.x.slice(),h.i=l.i,h}function o(l,h){l==null&&(l=+new Date);var c=new s(l),p=h&&h.state,m=function(){return(c.next()>>>0)/4294967296};return m.double=function(){do var g=c.next()>>>11,b=(c.next()>>>0)/4294967296,v=(g+b)/(1<<21);while(v===0);return v},m.int32=c.next,m.quick=m,p&&(p.x&&i(p,c),m.state=function(){return i(c,{})}),m}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.xorshift7=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),vae=Ar((e,t)=>{(function(n,r,a){function s(l){var h=this;h.next=function(){var p=h.w,m=h.X,g=h.i,b,v;return h.w=p=p+1640531527|0,v=m[g+34&127],b=m[g=g+1&127],v^=v<<13,b^=b<<17,v^=v>>>15,b^=b>>>12,v=m[g]=v^b,h.i=g,v+(p^p>>>16)|0};function c(p,m){var g,b,v,x,_,I=[],k=128;for(m===(m|0)?(b=m,m=null):(m=m+"\0",b=0,k=Math.max(k,m.length)),v=0,x=-32;x<k;++x)m&&(b^=m.charCodeAt((x+32)%m.length)),x===0&&(_=b),b^=b<<10,b^=b>>>15,b^=b<<4,b^=b>>>13,x>=0&&(_=_+1640531527|0,g=I[x&127]^=b+_,v=g==0?v+1:0);for(v>=128&&(I[(m&&m.length||0)&127]=-1),v=127,x=512;x>0;--x)b=I[v+34&127],g=I[v=v+1&127],b^=b<<13,g^=g<<17,b^=b>>>15,g^=g>>>12,I[v]=b^g;p.w=_,p.X=I,p.i=v}c(h,l)}function i(l,h){return h.i=l.i,h.w=l.w,h.X=l.X.slice(),h}function o(l,h){l==null&&(l=+new Date);var c=new s(l),p=h&&h.state,m=function(){return(c.next()>>>0)/4294967296};return m.double=function(){do var g=c.next()>>>11,b=(c.next()>>>0)/4294967296,v=(g+b)/(1<<21);while(v===0);return v},m.int32=c.next,m.quick=m,p&&(p.X&&i(p,c),m.state=function(){return i(c,{})}),m}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.xor4096=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),xae=Ar((e,t)=>{(function(n,r,a){function s(l){var h=this,c="";h.next=function(){var m=h.b,g=h.c,b=h.d,v=h.a;return m=m<<25^m>>>7^g,g=g-b|0,b=b<<24^b>>>8^v,v=v-m|0,h.b=m=m<<20^m>>>12^g,h.c=g=g-b|0,h.d=b<<16^g>>>16^v,h.a=v-m|0},h.a=0,h.b=0,h.c=-1640531527,h.d=1367130551,l===Math.floor(l)?(h.a=l/4294967296|0,h.b=l|0):c+=l;for(var p=0;p<c.length+20;p++)h.b^=c.charCodeAt(p)|0,h.next()}function i(l,h){return h.a=l.a,h.b=l.b,h.c=l.c,h.d=l.d,h}function o(l,h){var c=new s(l),p=h&&h.state,m=function(){return(c.next()>>>0)/4294967296};return m.double=function(){do var g=c.next()>>>11,b=(c.next()>>>0)/4294967296,v=(g+b)/(1<<21);while(v===0);return v},m.int32=c.next,m.quick=m,p&&(typeof p=="object"&&i(p,c),m.state=function(){return i(c,{})}),m}r&&r.exports?r.exports=o:a&&a.amd?a(function(){return o}):this.tychei=o})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),wae=Ar(()=>{}),_ae=Ar((e,t)=>{(function(n,r,a){var s=256,i=6,o=52,l="random",h=a.pow(s,i),c=a.pow(2,o),p=c*2,m=s-1,g;function b(R,U,D){var C=[];U=U==!0?{entropy:!0}:U||{};var O=I(_(U.entropy?[R,E(r)]:R??k(),3),C),z=new v(C),M=function(){for(var N=z.g(i),P=h,Q=0;N<c;)N=(N+Q)*s,P*=s,Q=z.g(1);for(;N>=p;)N/=2,P/=2,Q>>>=1;return(N+Q)/P};return M.int32=function(){return z.g(4)|0},M.quick=function(){return z.g(4)/4294967296},M.double=M,I(E(z.S),r),(U.pass||D||function(N,P,Q,ee){return ee&&(ee.S&&x(ee,z),N.state=function(){return x(z,{})}),Q?(a[l]=N,P):N})(M,O,"global"in U?U.global:this==a,U.state)}function v(R){var U,D=R.length,C=this,O=0,z=C.i=C.j=0,M=C.S=[];for(D||(R=[D++]);O<s;)M[O]=O++;for(O=0;O<s;O++)M[O]=M[z=m&z+R[O%D]+(U=M[O])],M[z]=U;(C.g=function(N){for(var P,Q=0,ee=C.i,q=C.j,Z=C.S;N--;)P=Z[ee=m&ee+1],Q=Q*s+Z[m&(Z[ee]=Z[q=m&q+P])+(Z[q]=P)];return C.i=ee,C.j=q,Q})(s)}function x(R,U){return U.i=R.i,U.j=R.j,U.S=R.S.slice(),U}function _(R,U){var D=[],C=typeof R,O;if(U&&C=="object")for(O in R)try{D.push(_(R[O],U-1))}catch{}return D.length?D:C=="string"?R:R+"\0"}function I(R,U){for(var D=R+"",C,O=0;O<D.length;)U[m&O]=m&(C^=U[m&O]*19)+D.charCodeAt(O++);return E(U)}function k(){try{var R;return g&&(R=g.randomBytes)?R=R(s):(R=new Uint8Array(s),(n.crypto||n.msCrypto).getRandomValues(R)),E(R)}catch{var U=n.navigator,D=U&&U.plugins;return[+new Date,n,D,n.screen,E(r)]}}function E(R){return String.fromCharCode.apply(0,R)}if(I(a.random(),r),typeof t=="object"&&t.exports){t.exports=b;try{g=wae()}catch{}}else typeof define=="function"&&define.amd?define(function(){return b}):a["seed"+l]=b})(typeof self<"u"?self:e,[],Math)}),y1=Ar((e,t)=>{var n=mae(),r=gae(),a=yae(),s=bae(),i=vae(),o=xae(),l=_ae();l.alea=n,l.xor128=r,l.xorwow=a,l.xorshift7=s,l.xor4096=i,l.tychei=o,t.exports=l}),oU=Ar(()=>{}),D2=Ar(()=>{}),lU=Ar(()=>{}),Sae=Ar(()=>{}),Iae=Ar(()=>{}),Tae=Ar(()=>{}),kae=Ar((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};function s(){return ne.buffer!=Fe&&vt(ne.buffer),We}function i(){return ne.buffer!=Fe&&vt(ne.buffer),at}function o(){return ne.buffer!=Fe&&vt(ne.buffer),pt}function l(){return ne.buffer!=Fe&&vt(ne.buffer),bt}function h(){return ne.buffer!=Fe&&vt(ne.buffer),Bt}var c=typeof a<"u"?a:{},p,m;c.ready=new Promise(function(Y,de){p=Y,m=de});var g;typeof process<"u"&&process.listeners&&(g={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var b=Object.assign({},c),v=(Y,de)=>{throw de},x=typeof window=="object",_=typeof importScripts=="function",I=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",k=c.ENVIRONMENT_IS_PTHREAD||!1,E="";function R(Y){return c.locateFile?c.locateFile(Y,E):E+Y}var U,D,C;function O(Y){Y instanceof Mr||ee("exiting due to exception: "+Y)}if(I){var z=D2(),M=lU();_?E=M.dirname(E)+"/":E=__dirname+"/",U=(de,Pe)=>(de=On(de)?new URL(de):M.normalize(de),z.readFileSync(de,Pe?void 0:"utf8")),C=de=>{var Pe=U(de,!0);return Pe.buffer||(Pe=new Uint8Array(Pe)),Pe},D=(de,Pe,st)=>{de=On(de)?new URL(de):M.normalize(de),z.readFile(de,function(ct,it){ct?st(ct):Pe(it.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(de){if(!(de instanceof Mr))throw de}),process.on("unhandledRejection",function(de){throw de}),v=(de,Pe)=>{if(Et())throw process.exitCode=de,Pe;O(Pe),process.exit(de)},c.inspect=function(){return"[Emscripten Module object]"};let Y;try{Y=Sae()}catch(de){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),de}global.Worker=Y.Worker}else(x||_)&&(_?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),typeof r<"u"&&r&&(E=r),E.indexOf("blob:")!==0?E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1):E="",I||(U=Y=>{var de=new XMLHttpRequest;return de.open("GET",Y,!1),de.send(null),de.responseText},_&&(C=Y=>{var de=new XMLHttpRequest;return de.open("GET",Y,!1),de.responseType="arraybuffer",de.send(null),new Uint8Array(de.response)}),D=(Y,de,Pe)=>{var st=new XMLHttpRequest;st.open("GET",Y,!0),st.responseType="arraybuffer",st.onload=()=>{if(st.status==200||st.status==0&&st.response){de(st.response);return}Pe()},st.onerror=Pe,st.send(null)}));I&&typeof performance>"u"&&(global.performance=Iae().performance);var N=console.log.bind(console),P=console.warn.bind(console);I&&(N=Y=>z.writeSync(1,Y+`
`),P=Y=>z.writeSync(2,Y+`
`));var Q=c.print||N,ee=c.printErr||P;Object.assign(c,b),b=null,c.arguments&&c.arguments,c.thisProgram&&c.thisProgram,c.quit&&(v=c.quit);var q;c.wasmBinary&&(q=c.wasmBinary);var Z=c.noExitRuntime||!0;typeof WebAssembly!="object"&&ds("no native wasm support detected");var ne,me,xe=!1,H;function se(Y,de){Y||ds(de)}var ue=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ge(Y,de,Pe){de>>>=0;for(var st=de+Pe,ct=de;Y[ct]&&!(ct>=st);)++ct;if(ct-de>16&&Y.buffer&&ue)return ue.decode(Y.buffer instanceof SharedArrayBuffer?Y.slice(de,ct):Y.subarray(de,ct));for(var it="";de<ct;){var Ue=Y[de++];if(!(Ue&128)){it+=String.fromCharCode(Ue);continue}var Ze=Y[de++]&63;if((Ue&224)==192){it+=String.fromCharCode((Ue&31)<<6|Ze);continue}var ht=Y[de++]&63;if((Ue&240)==224?Ue=(Ue&15)<<12|Ze<<6|ht:Ue=(Ue&7)<<18|Ze<<12|ht<<6|Y[de++]&63,Ue<65536)it+=String.fromCharCode(Ue);else{var Kn=Ue-65536;it+=String.fromCharCode(55296|Kn>>10,56320|Kn&1023)}}return it}function Ee(Y,de){return Y>>>=0,Y?ge(i(),Y,de):""}function $e(Y,de,Pe,st){if(Pe>>>=0,!(st>0))return 0;for(var ct=Pe,it=Pe+st-1,Ue=0;Ue<Y.length;++Ue){var Ze=Y.charCodeAt(Ue);if(Ze>=55296&&Ze<=57343){var ht=Y.charCodeAt(++Ue);Ze=65536+((Ze&1023)<<10)|ht&1023}if(Ze<=127){if(Pe>=it)break;de[Pe++>>>0]=Ze}else if(Ze<=2047){if(Pe+1>=it)break;de[Pe++>>>0]=192|Ze>>6,de[Pe++>>>0]=128|Ze&63}else if(Ze<=65535){if(Pe+2>=it)break;de[Pe++>>>0]=224|Ze>>12,de[Pe++>>>0]=128|Ze>>6&63,de[Pe++>>>0]=128|Ze&63}else{if(Pe+3>=it)break;de[Pe++>>>0]=240|Ze>>18,de[Pe++>>>0]=128|Ze>>12&63,de[Pe++>>>0]=128|Ze>>6&63,de[Pe++>>>0]=128|Ze&63}}return de[Pe>>>0]=0,Pe-ct}function Oe(Y,de,Pe){return $e(Y,i(),de,Pe)}var Fe,We,at,pt,bt,Bt;k&&(Fe=c.buffer);function vt(Y){Fe=Y,c.HEAP8=We=new Int8Array(Y),c.HEAP16=new Int16Array(Y),c.HEAP32=pt=new Int32Array(Y),c.HEAPU8=at=new Uint8Array(Y),c.HEAPU16=new Uint16Array(Y),c.HEAPU32=bt=new Uint32Array(Y),c.HEAPF32=new Float32Array(Y),c.HEAPF64=Bt=new Float64Array(Y)}var Mt=c.INITIAL_MEMORY||16777216;if(k)ne=c.wasmMemory,Fe=c.buffer;else if(c.wasmMemory)ne=c.wasmMemory;else if(ne=new WebAssembly.Memory({initial:Mt/65536,maximum:65536,shared:!0}),!(ne.buffer instanceof SharedArrayBuffer))throw ee("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),I&&ee("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");ne&&(Fe=ne.buffer),Mt=Fe.byteLength,vt(Fe);var ut,Lt=[],nn=[],Xt=[];function Et(){return Z}function Gn(){if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)kn(c.preRun.shift());un(Lt)}function ur(){!k&&un(nn)}function Dr(){if(!k){if(c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;)vr(c.postRun.shift());un(Xt)}}function kn(Y){Lt.unshift(Y)}function cr(Y){nn.unshift(Y)}function vr(Y){Xt.unshift(Y)}var qn=0,hr=null;function si(Y){qn++,c.monitorRunDependencies&&c.monitorRunDependencies(qn)}function lo(Y){if(qn--,c.monitorRunDependencies&&c.monitorRunDependencies(qn),qn==0&&hr){var de=hr;hr=null,de()}}function ds(Y){c.onAbort&&c.onAbort(Y),Y="Aborted("+Y+")",ee(Y),xe=!0,H=1,Y+=". Build with -sASSERTIONS for more info.";var de=new WebAssembly.RuntimeError(Y);throw m(de),de}var uo="data:application/octet-stream;base64,";function dr(Y){return Y.startsWith(uo)}function On(Y){return Y.startsWith("file://")}var ln;ln="tfjs-backend-wasm-threaded-simd.wasm",dr(ln)||(ln=R(ln));function Fn(Y){try{if(Y==ln&&q)return new Uint8Array(q);if(C)return C(Y);throw"both async and sync fetching of the wasm failed"}catch(de){ds(de)}}function nl(){if(!q&&(x||_)){if(typeof fetch=="function"&&!On(ln))return fetch(ln,{credentials:"same-origin"}).then(function(Y){if(!Y.ok)throw"failed to load wasm binary file at '"+ln+"'";return Y.arrayBuffer()}).catch(function(){return Fn(ln)});if(D)return new Promise(function(Y,de){D(ln,function(Pe){Y(new Uint8Array(Pe))},de)})}return Promise.resolve().then(function(){return Fn(ln)})}function Ri(){var Y={env:ah,wasi_snapshot_preview1:ah};function de(Ue,Ze){var ht=Ue.exports;if(c.asm=ht,fs(c.asm._emscripten_tls_init),ut=c.asm.__indirect_function_table,cr(c.asm.__wasm_call_ctors),me=Ze,!k){var Kn=Ve.unusedWorkers.length;Ve.unusedWorkers.forEach(function(Ja){Ve.loadWasmModuleToWorker(Ja,function(){--Kn||lo()})})}}k||si();function Pe(Ue){de(Ue.instance,Ue.module)}function st(Ue){return nl().then(function(Ze){return WebAssembly.instantiate(Ze,Y)}).then(function(Ze){return Ze}).then(Ue,function(Ze){ee("failed to asynchronously prepare wasm: "+Ze),ds(Ze)})}function ct(){return!q&&typeof WebAssembly.instantiateStreaming=="function"&&!dr(ln)&&!On(ln)&&!I&&typeof fetch=="function"?fetch(ln,{credentials:"same-origin"}).then(function(Ue){var Ze=WebAssembly.instantiateStreaming(Ue,Y);return Ze.then(Pe,function(ht){return ee("wasm streaming compile failed: "+ht),ee("falling back to ArrayBuffer instantiation"),st(Pe)})}):st(Pe)}if(c.instantiateWasm)try{var it=c.instantiateWasm(Y,de);return it}catch(Ue){ee("Module.instantiateWasm callback failed with error: "+Ue),m(Ue)}return ct().catch(m),{}}var rl={};function Mr(Y){this.name="ExitStatus",this.message="Program terminated with exit("+Y+")",this.status=Y}function ps(Y){var de=Ve.pthreads[Y];delete Ve.pthreads[Y],de.terminate(),ua(Y),Ve.runningWorkers.splice(Ve.runningWorkers.indexOf(de),1),de.pthread_ptr=0}function Ln(Y){var de=Ve.pthreads[Y];de.postMessage({cmd:"cancel"})}function oa(Y){var de=Ve.pthreads[Y];se(de),Ve.returnWorkerToPool(de)}function la(Y){var de=Ve.getNewWorker();if(!de)return 6;Ve.runningWorkers.push(de),Ve.pthreads[Y.pthread_ptr]=de,de.pthread_ptr=Y.pthread_ptr;var Pe={cmd:"run",start_routine:Y.startRoutine,arg:Y.arg,pthread_ptr:Y.pthread_ptr};return de.runPthread=()=>{I&&de.ref(),de.postMessage(Pe,Y.transferList),delete de.runPthread},de.loaded&&de.runPthread(),0}function Aa(Y){if(k)return ui(1,1,Y);H=Y,Et()||(Ve.terminateAllThreads(),c.onExit&&c.onExit(Y),xe=!0),v(Y,new Mr(Y))}function Te(Y,de){if(H=Y,!de&&k)throw xt(Y),"unwind";Aa(Y)}var Le=Te;function Qe(Y){if(Y instanceof Mr||Y=="unwind")return H;v(1,Y)}var Ve={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){k?Ve.initWorker():Ve.initMainThread()},initMainThread:function(){for(var Y=8;Y--;)Ve.allocateUnusedWorker()},initWorker:function(){Z=!1},setExitStatus:function(Y){H=Y},terminateAllThreads:function(){for(var Y of Object.values(Ve.pthreads))Ve.returnWorkerToPool(Y);for(var Y of Ve.unusedWorkers)Y.terminate();Ve.unusedWorkers=[]},returnWorkerToPool:function(Y){var de=Y.pthread_ptr;delete Ve.pthreads[de],Ve.unusedWorkers.push(Y),Ve.runningWorkers.splice(Ve.runningWorkers.indexOf(Y),1),Y.pthread_ptr=0,I&&Y.unref(),ua(de)},receiveObjectTransfer:function(Y){},threadInitTLS:function(){Ve.tlsInitFunctions.forEach(Y=>Y())},loadWasmModuleToWorker:function(Y,de){Y.onmessage=it=>{var Ue=it.data,Ze=Ue.cmd;if(Y.pthread_ptr&&(Ve.currentProxiedOperationCallerThread=Y.pthread_ptr),Ue.targetThread&&Ue.targetThread!=po()){var ht=Ve.pthreads[Ue.targetThread];ht?ht.postMessage(Ue,Ue.transferList):ee('Internal error! Worker sent a message "'+Ze+'" to target pthread '+Ue.targetThread+", but that thread no longer exists!"),Ve.currentProxiedOperationCallerThread=void 0;return}Ze==="processProxyingQueue"?iu(Ue.queue):Ze==="spawnThread"?la(Ue):Ze==="cleanupThread"?oa(Ue.thread):Ze==="killThread"?ps(Ue.thread):Ze==="cancelThread"?Ln(Ue.thread):Ze==="loaded"?(Y.loaded=!0,I&&Y.unref(),de&&de(Y),Y.runPthread&&Y.runPthread()):Ze==="print"?Q("Thread "+Ue.threadId+": "+Ue.text):Ze==="printErr"?ee("Thread "+Ue.threadId+": "+Ue.text):Ze==="alert"?alert("Thread "+Ue.threadId+": "+Ue.text):Ue.target==="setimmediate"?Y.postMessage(Ue):Ze==="callHandler"?c[Ue.handler](...Ue.args):Ze&&ee("worker sent an unknown command "+Ze),Ve.currentProxiedOperationCallerThread=void 0},Y.onerror=it=>{var Ue="worker sent an error!";throw ee(Ue+" "+it.filename+":"+it.lineno+": "+it.message),it},I&&(Y.on("message",function(it){Y.onmessage({data:it})}),Y.on("error",function(it){Y.onerror(it)}),Y.on("detachedExit",function(){}));var Pe=[],st=["onExit","onAbort","print","printErr"];for(var ct of st)c.hasOwnProperty(ct)&&Pe.push(ct);Y.postMessage({cmd:"load",handlers:Pe,urlOrBlob:c.mainScriptUrlOrBlob||r,wasmMemory:ne,wasmModule:me})},allocateUnusedWorker:function(){var Y,de=R("tfjs-backend-wasm-threaded-simd.worker.js");Y=new Worker(de),Ve.unusedWorkers.push(Y)},getNewWorker:function(){return Ve.unusedWorkers.length==0&&(Ve.allocateUnusedWorker(),Ve.loadWasmModuleToWorker(Ve.unusedWorkers[0])),Ve.unusedWorkers.pop()}};c.PThread=Ve;function un(Y){for(;Y.length>0;)Y.shift()(c)}function rn(){var Y=po(),de=o()[Y+52>>>2],Pe=o()[Y+56>>>2],st=de-Pe;cu(de,st),Oi(de)}c.establishStackSpace=rn;function xt(Y){if(k)return ui(2,0,Y);try{Le(Y)}catch(de){Qe(de)}}var mt=[];function bn(Y){var de=mt[Y];return de||(Y>=mt.length&&(mt.length=Y+1),mt[Y]=de=ut.get(Y)),de}function nr(Y,de){var Pe=bn(Y)(de);Et()?Ve.setExitStatus(Pe):ih(Pe)}c.invokeEntryPoint=nr;function fs(Y){Ve.tlsInitFunctions.push(Y)}function Ra(Y){Mi(Y,!_,1,!x),Ve.threadInitTLS()}function ya(Y){k?postMessage({cmd:"cleanupThread",thread:Y}):oa(Y)}function zn(Y,de,Pe,st){return k?ui(3,1,Y,de,Pe,st):Yt(Y,de,Pe,st)}function Yt(Y,de,Pe,st){if(typeof SharedArrayBuffer>"u")return ee("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var ct=[],it=0;if(k&&(ct.length===0||it))return zn(Y,de,Pe,st);var Ue={startRoutine:Pe,pthread_ptr:Y,arg:st,transferList:ct};return k?(Ue.cmd="spawnThread",postMessage(Ue,ct),0):la(Ue)}function Kr(){return 65536}var Di=!0;function hy(){return Di}function iu(Y){Atomics.store(o(),Y>>2,1),po()&&$i(Y),Atomics.compareExchange(o(),Y>>2,1,0)}c.executeNotifiedProxyingQueue=iu;function nf(Y,de,Pe,st){if(Y==de)setTimeout(()=>iu(st));else if(k)postMessage({targetThread:Y,cmd:"processProxyingQueue",queue:st});else{var ct=Ve.pthreads[Y];if(!ct)return;ct.postMessage({cmd:"processProxyingQueue",queue:st})}return 1}function ii(Y,de,Pe){return-1}function ou(){ds("")}function Da(Y){Da.shown||(Da.shown={}),Da.shown[Y]||(Da.shown[Y]=1,I&&(Y="warning: "+Y),ee(Y))}function ms(){I||_||Da("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")}function Qa(){return Date.now()}function Ls(){return 4294901760}function pr(){return Ls()}var al;I?al=()=>{var Y=process.hrtime();return Y[0]*1e3+Y[1]/1e6}:al=()=>performance.timeOrigin+performance.now();function th(Y,de,Pe){i().copyWithin(Y>>>0,de>>>0,de+Pe>>>0)}function oi(){return I?Tae().cpus().length:navigator.hardwareConcurrency}function li(Y){var de=ol(),Pe=Y();return Oi(de),Pe}function ui(Y,de){var Pe=arguments.length-2,st=arguments;return li(()=>{for(var ct=Pe,it=ll(ct*8),Ue=it>>3,Ze=0;Ze<Pe;Ze++){var ht=st[2+Ze];h()[Ue+Ze>>>0]=ht}return sh(Y,ct,it,de)})}var sl=[];function nh(Y,de,Pe){sl.length=de;for(var st=Pe>>3,ct=0;ct<de;ct++)sl[ct]=h()[st+ct>>>0];var it=Y<0,Ue=it?rl[-Y-1]:uu[Y];return Ue.apply(null,sl)}function rf(Y){try{return ne.grow(Y-Fe.byteLength+65535>>>16),vt(ne.buffer),1}catch{}}function lu(Y){var de=i().length;if(Y=Y>>>0,Y<=de)return!1;var Pe=Ls();if(Y>Pe)return!1;let st=(ht,Kn)=>ht+(Kn-ht%Kn)%Kn;for(var ct=1;ct<=4;ct*=2){var it=de*(1+.2/ct);it=Math.min(it,Y+100663296);var Ue=Math.min(Pe,st(Math.max(Y,it),65536)),Ze=rf(Ue);if(Ze)return!0}return!1}function Za(){throw"unwind"}function rr(Y){return k?ui(4,1,Y):52}function xr(Y,de,Pe,st,ct){return k?ui(5,1,Y,de,Pe,st,ct):70}var co=[null,[],[]];function rh(Y,de){var Pe=co[Y];de===0||de===10?((Y===1?Q:ee)(ge(Pe,0)),Pe.length=0):Pe.push(de)}function an(Y,de,Pe,st){if(k)return ui(6,1,Y,de,Pe,st);for(var ct=0,it=0;it<Pe;it++){var Ue=l()[de>>>2],Ze=l()[de+4>>>2];de+=8;for(var ht=0;ht<Ze;ht++)rh(Y,i()[Ue+ht>>>0]);ct+=Ze}return l()[st>>>2]=ct,0}function ho(Y){var de=c["_"+Y];return de}function ci(Y,de){s().set(Y,de>>>0)}function il(Y,de,Pe,st,ct){var it={string:ar=>{var ca=0;if(ar!=null&&ar!==0){var $r=(ar.length<<2)+1;ca=ll($r),Oe(ar,ca,$r)}return ca},array:ar=>{var ca=ll(ar.length);return ci(ar,ca),ca}};function Ue(ar){return de==="string"?Ee(ar):de==="boolean"?!!ar:ar}var Ze=ho(Y),ht=[],Kn=0;if(st)for(var Ja=0;Ja<st.length;Ja++){var mo=it[Pe[Ja]];mo?(Kn===0&&(Kn=ol()),ht[Ja]=mo(st[Ja])):ht[Ja]=st[Ja]}var cl=Ze.apply(null,ht);function hl(ar){return Kn!==0&&Oi(Kn),Ue(ar)}return cl=hl(cl),cl}function Ma(Y,de,Pe,st){Pe=Pe||[];var ct=Pe.every(Ue=>Ue==="number"||Ue==="boolean"),it=de!=="string";return it&&ct&&!st?ho(Y):function(){return il(Y,de,Pe,arguments)}}Ve.init();var uu=[null,Aa,xt,zn,rr,xr,an],ah={__emscripten_init_main_thread_js:Ra,__emscripten_thread_cleanup:ya,__pthread_create_js:Yt,_emscripten_default_pthread_stack_size:Kr,_emscripten_get_now_is_monotonic:hy,_emscripten_notify_task_queue:nf,_emscripten_set_offscreencanvas_size:ii,abort:ou,emscripten_check_blocking_allowed:ms,emscripten_date_now:Qa,emscripten_get_heap_max:pr,emscripten_get_now:al,emscripten_memcpy_big:th,emscripten_num_logical_cores:oi,emscripten_receive_on_main_thread_js:nh,emscripten_resize_heap:lu,emscripten_unwind_to_js_event_loop:Za,exit:Le,fd_close:rr,fd_seek:xr,fd_write:an,memory:ne||c.wasmMemory};Ri(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.__wasm_call_ctors).apply(null,arguments)},c._init=function(){return(c._init=c.asm.init).apply(null,arguments)},c._init_with_threads_count=function(){return(c._init_with_threads_count=c.asm.init_with_threads_count).apply(null,arguments)},c._get_threads_count=function(){return(c._get_threads_count=c.asm.get_threads_count).apply(null,arguments)},c._register_tensor=function(){return(c._register_tensor=c.asm.register_tensor).apply(null,arguments)},c._dispose_data=function(){return(c._dispose_data=c.asm.dispose_data).apply(null,arguments)},c._dispose=function(){return(c._dispose=c.asm.dispose).apply(null,arguments)},c._Abs=function(){return(c._Abs=c.asm.Abs).apply(null,arguments)},c._Acos=function(){return(c._Acos=c.asm.Acos).apply(null,arguments)},c._Acosh=function(){return(c._Acosh=c.asm.Acosh).apply(null,arguments)},c._Add=function(){return(c._Add=c.asm.Add).apply(null,arguments)},c._AddN=function(){return(c._AddN=c.asm.AddN).apply(null,arguments)},c._All=function(){return(c._All=c.asm.All).apply(null,arguments)},c._Any=function(){return(c._Any=c.asm.Any).apply(null,arguments)},c._ArgMax=function(){return(c._ArgMax=c.asm.ArgMax).apply(null,arguments)},c._ArgMin=function(){return(c._ArgMin=c.asm.ArgMin).apply(null,arguments)},c._Asin=function(){return(c._Asin=c.asm.Asin).apply(null,arguments)},c._Asinh=function(){return(c._Asinh=c.asm.Asinh).apply(null,arguments)},c._Atan=function(){return(c._Atan=c.asm.Atan).apply(null,arguments)},c._Atan2=function(){return(c._Atan2=c.asm.Atan2).apply(null,arguments)},c._Atanh=function(){return(c._Atanh=c.asm.Atanh).apply(null,arguments)},c._AvgPool=function(){return(c._AvgPool=c.asm.AvgPool).apply(null,arguments)},c._AvgPool3D=function(){return(c._AvgPool3D=c.asm.AvgPool3D).apply(null,arguments)},c._AvgPool3DGrad=function(){return(c._AvgPool3DGrad=c.asm.AvgPool3DGrad).apply(null,arguments)},c._AvgPoolGrad=function(){return(c._AvgPoolGrad=c.asm.AvgPoolGrad).apply(null,arguments)},c._BatchMatMul=function(){return(c._BatchMatMul=c.asm.BatchMatMul).apply(null,arguments)},c._Bincount=function(){return(c._Bincount=c.asm.Bincount).apply(null,arguments)},c._BitwiseAnd=function(){return(c._BitwiseAnd=c.asm.BitwiseAnd).apply(null,arguments)},c._Ceil=function(){return(c._Ceil=c.asm.Ceil).apply(null,arguments)},c._ClipByValue=function(){return(c._ClipByValue=c.asm.ClipByValue).apply(null,arguments)},c._Conv2D=function(){return(c._Conv2D=c.asm.Conv2D).apply(null,arguments)},c._Conv2DBackpropInput=function(){return(c._Conv2DBackpropInput=c.asm.Conv2DBackpropInput).apply(null,arguments)},c._Conv3D=function(){return(c._Conv3D=c.asm.Conv3D).apply(null,arguments)},c._Conv3DBackpropFilterV2=function(){return(c._Conv3DBackpropFilterV2=c.asm.Conv3DBackpropFilterV2).apply(null,arguments)},c._Conv3DBackpropInputV2=function(){return(c._Conv3DBackpropInputV2=c.asm.Conv3DBackpropInputV2).apply(null,arguments)},c._Cos=function(){return(c._Cos=c.asm.Cos).apply(null,arguments)},c._Cosh=function(){return(c._Cosh=c.asm.Cosh).apply(null,arguments)},c._CropAndResize=function(){return(c._CropAndResize=c.asm.CropAndResize).apply(null,arguments)},c._Cumprod=function(){return(c._Cumprod=c.asm.Cumprod).apply(null,arguments)},c._Cumsum=function(){return(c._Cumsum=c.asm.Cumsum).apply(null,arguments)},c._DenseBincount=function(){return(c._DenseBincount=c.asm.DenseBincount).apply(null,arguments)},c._DepthToSpace=function(){return(c._DepthToSpace=c.asm.DepthToSpace).apply(null,arguments)},c._DepthwiseConv2dNative=function(){return(c._DepthwiseConv2dNative=c.asm.DepthwiseConv2dNative).apply(null,arguments)},c._Diag=function(){return(c._Diag=c.asm.Diag).apply(null,arguments)},c._Dilation2D=function(){return(c._Dilation2D=c.asm.Dilation2D).apply(null,arguments)},c._Dilation2DBackpropFilter=function(){return(c._Dilation2DBackpropFilter=c.asm.Dilation2DBackpropFilter).apply(null,arguments)},c._Dilation2DBackpropInput=function(){return(c._Dilation2DBackpropInput=c.asm.Dilation2DBackpropInput).apply(null,arguments)},c._Elu=function(){return(c._Elu=c.asm.Elu).apply(null,arguments)},c._EluGrad=function(){return(c._EluGrad=c.asm.EluGrad).apply(null,arguments)},c._Equal=function(){return(c._Equal=c.asm.Equal).apply(null,arguments)},c._Erf=function(){return(c._Erf=c.asm.Erf).apply(null,arguments)},c._Exp=function(){return(c._Exp=c.asm.Exp).apply(null,arguments)},c._Expm1=function(){return(c._Expm1=c.asm.Expm1).apply(null,arguments)},c._FlipLeftRight=function(){return(c._FlipLeftRight=c.asm.FlipLeftRight).apply(null,arguments)},c._Floor=function(){return(c._Floor=c.asm.Floor).apply(null,arguments)},c._FloorDiv=function(){return(c._FloorDiv=c.asm.FloorDiv).apply(null,arguments)},c._FusedBatchNorm=function(){return(c._FusedBatchNorm=c.asm.FusedBatchNorm).apply(null,arguments)},c._FusedConv2D=function(){return(c._FusedConv2D=c.asm.FusedConv2D).apply(null,arguments)},c._FusedDepthwiseConv2D=function(){return(c._FusedDepthwiseConv2D=c.asm.FusedDepthwiseConv2D).apply(null,arguments)},c._Gather=function(){return(c._Gather=c.asm.Gather).apply(null,arguments)},c._GatherNd=function(){return(c._GatherNd=c.asm.GatherNd).apply(null,arguments)},c._Greater=function(){return(c._Greater=c.asm.Greater).apply(null,arguments)},c._GreaterEqual=function(){return(c._GreaterEqual=c.asm.GreaterEqual).apply(null,arguments)},c._IsFinite=function(){return(c._IsFinite=c.asm.IsFinite).apply(null,arguments)},c._IsInf=function(){return(c._IsInf=c.asm.IsInf).apply(null,arguments)},c._IsNan=function(){return(c._IsNan=c.asm.IsNan).apply(null,arguments)},c._LRN=function(){return(c._LRN=c.asm.LRN).apply(null,arguments)},c._LRNGrad=function(){return(c._LRNGrad=c.asm.LRNGrad).apply(null,arguments)},c._LeakyRelu=function(){return(c._LeakyRelu=c.asm.LeakyRelu).apply(null,arguments)},c._Less=function(){return(c._Less=c.asm.Less).apply(null,arguments)},c._LessEqual=function(){return(c._LessEqual=c.asm.LessEqual).apply(null,arguments)},c._LinSpace=function(){return(c._LinSpace=c.asm.LinSpace).apply(null,arguments)},c._Log=function(){return(c._Log=c.asm.Log).apply(null,arguments)},c._Log1p=function(){return(c._Log1p=c.asm.Log1p).apply(null,arguments)},c._LogicalAnd=function(){return(c._LogicalAnd=c.asm.LogicalAnd).apply(null,arguments)},c._LogicalNot=function(){return(c._LogicalNot=c.asm.LogicalNot).apply(null,arguments)},c._LogicalOr=function(){return(c._LogicalOr=c.asm.LogicalOr).apply(null,arguments)},c._LogicalXor=function(){return(c._LogicalXor=c.asm.LogicalXor).apply(null,arguments)},c._Max=function(){return(c._Max=c.asm.Max).apply(null,arguments)},c._MaxPool=function(){return(c._MaxPool=c.asm.MaxPool).apply(null,arguments)},c._MaxPool3D=function(){return(c._MaxPool3D=c.asm.MaxPool3D).apply(null,arguments)},c._MaxPool3DGrad=function(){return(c._MaxPool3DGrad=c.asm.MaxPool3DGrad).apply(null,arguments)},c._MaxPoolGrad=function(){return(c._MaxPoolGrad=c.asm.MaxPoolGrad).apply(null,arguments)},c._MaxPoolWithArgmax=function(){return(c._MaxPoolWithArgmax=c.asm.MaxPoolWithArgmax).apply(null,arguments)},c._Maximum=function(){return(c._Maximum=c.asm.Maximum).apply(null,arguments)},c._Mean=function(){return(c._Mean=c.asm.Mean).apply(null,arguments)},c._Min=function(){return(c._Min=c.asm.Min).apply(null,arguments)},c._Minimum=function(){return(c._Minimum=c.asm.Minimum).apply(null,arguments)},c._MirrorPad=function(){return(c._MirrorPad=c.asm.MirrorPad).apply(null,arguments)},c._Mod=function(){return(c._Mod=c.asm.Mod).apply(null,arguments)},c._Multinomial=function(){return(c._Multinomial=c.asm.Multinomial).apply(null,arguments)},c._Multiply=function(){return(c._Multiply=c.asm.Multiply).apply(null,arguments)},c._Neg=function(){return(c._Neg=c.asm.Neg).apply(null,arguments)},c._NonMaxSuppressionV3=function(){return(c._NonMaxSuppressionV3=c.asm.NonMaxSuppressionV3).apply(null,arguments)},c._NonMaxSuppressionV4=function(){return(c._NonMaxSuppressionV4=c.asm.NonMaxSuppressionV4).apply(null,arguments)},c._NonMaxSuppressionV5=function(){return(c._NonMaxSuppressionV5=c.asm.NonMaxSuppressionV5).apply(null,arguments)},c._NotEqual=function(){return(c._NotEqual=c.asm.NotEqual).apply(null,arguments)},c._OneHot=function(){return(c._OneHot=c.asm.OneHot).apply(null,arguments)},c._PadV2=function(){return(c._PadV2=c.asm.PadV2).apply(null,arguments)},c._Pow=function(){return(c._Pow=c.asm.Pow).apply(null,arguments)},c._Prelu=function(){return(c._Prelu=c.asm.Prelu).apply(null,arguments)},c._Prod=function(){return(c._Prod=c.asm.Prod).apply(null,arguments)},c._RealDiv=function(){return(c._RealDiv=c.asm.RealDiv).apply(null,arguments)},c._Reciprocal=function(){return(c._Reciprocal=c.asm.Reciprocal).apply(null,arguments)},c._Relu=function(){return(c._Relu=c.asm.Relu).apply(null,arguments)},c._Relu6=function(){return(c._Relu6=c.asm.Relu6).apply(null,arguments)},c._ResizeBilinear=function(){return(c._ResizeBilinear=c.asm.ResizeBilinear).apply(null,arguments)},c._ResizeBilinearGrad=function(){return(c._ResizeBilinearGrad=c.asm.ResizeBilinearGrad).apply(null,arguments)},c._ResizeNearestNeighbor=function(){return(c._ResizeNearestNeighbor=c.asm.ResizeNearestNeighbor).apply(null,arguments)},c._ResizeNearestNeighborGrad=function(){return(c._ResizeNearestNeighborGrad=c.asm.ResizeNearestNeighborGrad).apply(null,arguments)},c._Reverse=function(){return(c._Reverse=c.asm.Reverse).apply(null,arguments)},c._RotateWithOffset=function(){return(c._RotateWithOffset=c.asm.RotateWithOffset).apply(null,arguments)},c._Round=function(){return(c._Round=c.asm.Round).apply(null,arguments)},c._Rsqrt=function(){return(c._Rsqrt=c.asm.Rsqrt).apply(null,arguments)},c._ScatterNd=function(){return(c._ScatterNd=c.asm.ScatterNd).apply(null,arguments)},c._SearchSorted=function(){return(c._SearchSorted=c.asm.SearchSorted).apply(null,arguments)},c._SelectV2=function(){return(c._SelectV2=c.asm.SelectV2).apply(null,arguments)},c._Selu=function(){return(c._Selu=c.asm.Selu).apply(null,arguments)},c._Sigmoid=function(){return(c._Sigmoid=c.asm.Sigmoid).apply(null,arguments)},c._Sign=function(){return(c._Sign=c.asm.Sign).apply(null,arguments)},c._Sin=function(){return(c._Sin=c.asm.Sin).apply(null,arguments)},c._Sinh=function(){return(c._Sinh=c.asm.Sinh).apply(null,arguments)},c._Softmax=function(){return(c._Softmax=c.asm.Softmax).apply(null,arguments)},c._Softplus=function(){return(c._Softplus=c.asm.Softplus).apply(null,arguments)},c._SparseFillEmptyRows=function(){return(c._SparseFillEmptyRows=c.asm.SparseFillEmptyRows).apply(null,arguments)},c._SparseReshape=function(){return(c._SparseReshape=c.asm.SparseReshape).apply(null,arguments)},c._SparseSegmentReduction=function(){return(c._SparseSegmentReduction=c.asm.SparseSegmentReduction).apply(null,arguments)},c._SparseToDense=function(){return(c._SparseToDense=c.asm.SparseToDense).apply(null,arguments)},c._Sqrt=function(){return(c._Sqrt=c.asm.Sqrt).apply(null,arguments)},c._Square=function(){return(c._Square=c.asm.Square).apply(null,arguments)},c._SquaredDifference=function(){return(c._SquaredDifference=c.asm.SquaredDifference).apply(null,arguments)},c._Step=function(){return(c._Step=c.asm.Step).apply(null,arguments)},c._StridedSlice=function(){return(c._StridedSlice=c.asm.StridedSlice).apply(null,arguments)},c._Sub=function(){return(c._Sub=c.asm.Sub).apply(null,arguments)},c._Sum=function(){return(c._Sum=c.asm.Sum).apply(null,arguments)},c._Tan=function(){return(c._Tan=c.asm.Tan).apply(null,arguments)},c._Tanh=function(){return(c._Tanh=c.asm.Tanh).apply(null,arguments)},c._TensorScatterUpdate=function(){return(c._TensorScatterUpdate=c.asm.TensorScatterUpdate).apply(null,arguments)},c._Tile=function(){return(c._Tile=c.asm.Tile).apply(null,arguments)},c._TopK=function(){return(c._TopK=c.asm.TopK).apply(null,arguments)},c._Transform=function(){return(c._Transform=c.asm.Transform).apply(null,arguments)},c._Transpose=function(){return(c._Transpose=c.asm.Transpose).apply(null,arguments)},c.__FusedMatMul=function(){return(c.__FusedMatMul=c.asm._FusedMatMul).apply(null,arguments)},c._malloc=function(){return(c._malloc=c.asm.malloc).apply(null,arguments)},c._free=function(){return(c._free=c.asm.free).apply(null,arguments)},c.__emscripten_tls_init=function(){return(c.__emscripten_tls_init=c.asm._emscripten_tls_init).apply(null,arguments)};var po=c._pthread_self=function(){return(po=c._pthread_self=c.asm.pthread_self).apply(null,arguments)};c.___errno_location=function(){return(c.___errno_location=c.asm.__errno_location).apply(null,arguments)};var Mi=c.__emscripten_thread_init=function(){return(Mi=c.__emscripten_thread_init=c.asm._emscripten_thread_init).apply(null,arguments)};c.__emscripten_thread_crashed=function(){return(c.__emscripten_thread_crashed=c.asm._emscripten_thread_crashed).apply(null,arguments)},c._emscripten_main_thread_process_queued_calls=function(){return(c._emscripten_main_thread_process_queued_calls=c.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},c._emscripten_main_browser_thread_id=function(){return(c._emscripten_main_browser_thread_id=c.asm.emscripten_main_browser_thread_id).apply(null,arguments)};var sh=c._emscripten_run_in_main_runtime_thread_js=function(){return(sh=c._emscripten_run_in_main_runtime_thread_js=c.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)};c._emscripten_dispatch_to_thread_=function(){return(c._emscripten_dispatch_to_thread_=c.asm.emscripten_dispatch_to_thread_).apply(null,arguments)};var $i=c.__emscripten_proxy_execute_task_queue=function(){return($i=c.__emscripten_proxy_execute_task_queue=c.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)},ua=c.__emscripten_thread_free_data=function(){return(ua=c.__emscripten_thread_free_data=c.asm._emscripten_thread_free_data).apply(null,arguments)},ih=c.__emscripten_thread_exit=function(){return(ih=c.__emscripten_thread_exit=c.asm._emscripten_thread_exit).apply(null,arguments)},cu=c._emscripten_stack_set_limits=function(){return(cu=c._emscripten_stack_set_limits=c.asm.emscripten_stack_set_limits).apply(null,arguments)},ol=c.stackSave=function(){return(ol=c.stackSave=c.asm.stackSave).apply(null,arguments)},Oi=c.stackRestore=function(){return(Oi=c.stackRestore=c.asm.stackRestore).apply(null,arguments)},ll=c.stackAlloc=function(){return(ll=c.stackAlloc=c.asm.stackAlloc).apply(null,arguments)};c.dynCall_iijjiiii=function(){return(c.dynCall_iijjiiii=c.asm.dynCall_iijjiiii).apply(null,arguments)},c.dynCall_jiji=function(){return(c.dynCall_jiji=c.asm.dynCall_jiji).apply(null,arguments)},c.keepRuntimeAlive=Et,c.wasmMemory=ne,c.cwrap=Ma,c.ExitStatus=Mr,c.PThread=Ve;var zs;hr=function Y(){zs||ul(),zs||(hr=Y)};function ul(Y){if(qn>0)return;if(k){p(c),ur(),startWorker(c);return}if(Gn(),qn>0)return;function de(){zs||(zs=!0,c.calledRun=!0,!xe&&(ur(),p(c),c.onRuntimeInitialized&&c.onRuntimeInitialized(),Dr()))}c.setStatus?(c.setStatus("Running..."),setTimeout(function(){setTimeout(function(){c.setStatus("")},1),de()},1)):de()}if(c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);c.preInit.length>0;)c.preInit.pop()();ul();var $a;g&&($a={uncaughtException:process.listeners("uncaughtException").filter(function(Y){return!g.uncaughtException.indexOf(Y)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(Y){return!g.unhandledRejection.indexOf(Y)>-1})});var fo;if(typeof WasmBackendModule<"u")fo=WasmBackendModule;else if(typeof a<"u")fo=a;else throw new Error("Could not find wasm module in post.js");if($a){var gs=fo._dispose;fo._dispose=function(){gs(),$a.uncaughtException.forEach(function(Y){process.removeListener("uncaughtException",Y)}),$a.unhandledRejection.forEach(function(Y){process.removeListener("unhandledRejection",Y)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModuleThreadedSimd=n)}),Eae=Ar((e,t)=>{t.exports.wasmWorkerContents=`"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"
");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};`}),Nae=Ar((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};var s=typeof a<"u"?a:{},i,o;s.ready=new Promise(function(Te,Le){i=Te,o=Le});var l;typeof process<"u"&&process.listeners&&(l={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var h=Object.assign({},s),c=typeof window=="object",p=typeof importScripts=="function",m=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function b(Te){return s.locateFile?s.locateFile(Te,g):g+Te}var v,x,_;if(m){var I=D2(),k=lU();p?g=k.dirname(g)+"/":g=__dirname+"/",v=(Te,Le)=>(Te=Mt(Te)?new URL(Te):k.normalize(Te),I.readFileSync(Te,Le?void 0:"utf8")),_=Te=>{var Le=v(Te,!0);return Le.buffer||(Le=new Uint8Array(Le)),Le},x=(Te,Le,Qe)=>{Te=Mt(Te)?new URL(Te):k.normalize(Te),I.readFile(Te,function(Ve,un){Ve?Qe(Ve):Le(un.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(Te){if(!(Te instanceof Et))throw Te}),process.on("unhandledRejection",function(Te){throw Te}),s.inspect=function(){return"[Emscripten Module object]"}}else(c||p)&&(p?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),r&&(g=r),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",v=Te=>{var Le=new XMLHttpRequest;return Le.open("GET",Te,!1),Le.send(null),Le.responseText},p&&(_=Te=>{var Le=new XMLHttpRequest;return Le.open("GET",Te,!1),Le.responseType="arraybuffer",Le.send(null),new Uint8Array(Le.response)}),x=(Te,Le,Qe)=>{var Ve=new XMLHttpRequest;Ve.open("GET",Te,!0),Ve.responseType="arraybuffer",Ve.onload=()=>{if(Ve.status==200||Ve.status==0&&Ve.response){Le(Ve.response);return}Qe()},Ve.onerror=Qe,Ve.send(null)});var E=s.print||console.log.bind(console),R=s.printErr||console.warn.bind(console);Object.assign(s,h),h=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&s.quit;var U;s.wasmBinary&&(U=s.wasmBinary),s.noExitRuntime,typeof WebAssembly!="object"&&bt("no native wasm support detected");var D,C=!1,O=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function z(Te,Le,Qe){Le>>>=0;for(var Ve=Le+Qe,un=Le;Te[un]&&!(un>=Ve);)++un;if(un-Le>16&&Te.buffer&&O)return O.decode(Te.subarray(Le,un));for(var rn="";Le<un;){var xt=Te[Le++];if(!(xt&128)){rn+=String.fromCharCode(xt);continue}var mt=Te[Le++]&63;if((xt&224)==192){rn+=String.fromCharCode((xt&31)<<6|mt);continue}var bn=Te[Le++]&63;if((xt&240)==224?xt=(xt&15)<<12|mt<<6|bn:xt=(xt&7)<<18|mt<<12|bn<<6|Te[Le++]&63,xt<65536)rn+=String.fromCharCode(xt);else{var nr=xt-65536;rn+=String.fromCharCode(55296|nr>>10,56320|nr&1023)}}return rn}function M(Te,Le){return Te>>>=0,Te?z(q,Te,Le):""}function N(Te,Le,Qe,Ve){if(Qe>>>=0,!(Ve>0))return 0;for(var un=Qe,rn=Qe+Ve-1,xt=0;xt<Te.length;++xt){var mt=Te.charCodeAt(xt);if(mt>=55296&&mt<=57343){var bn=Te.charCodeAt(++xt);mt=65536+((mt&1023)<<10)|bn&1023}if(mt<=127){if(Qe>=rn)break;Le[Qe++>>>0]=mt}else if(mt<=2047){if(Qe+1>=rn)break;Le[Qe++>>>0]=192|mt>>6,Le[Qe++>>>0]=128|mt&63}else if(mt<=65535){if(Qe+2>=rn)break;Le[Qe++>>>0]=224|mt>>12,Le[Qe++>>>0]=128|mt>>6&63,Le[Qe++>>>0]=128|mt&63}else{if(Qe+3>=rn)break;Le[Qe++>>>0]=240|mt>>18,Le[Qe++>>>0]=128|mt>>12&63,Le[Qe++>>>0]=128|mt>>6&63,Le[Qe++>>>0]=128|mt&63}}return Le[Qe>>>0]=0,Qe-un}function P(Te,Le,Qe){return N(Te,q,Le,Qe)}var Q,ee,q,Z;function ne(Te){Q=Te,s.HEAP8=ee=new Int8Array(Te),s.HEAP16=new Int16Array(Te),s.HEAP32=new Int32Array(Te),s.HEAPU8=q=new Uint8Array(Te),s.HEAPU16=new Uint16Array(Te),s.HEAPU32=Z=new Uint32Array(Te),s.HEAPF32=new Float32Array(Te),s.HEAPF64=new Float64Array(Te)}s.INITIAL_MEMORY;var me=[],xe=[],H=[];function se(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)Ee(s.preRun.shift());Gn(me)}function ue(){Gn(xe)}function ge(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)Oe(s.postRun.shift());Gn(H)}function Ee(Te){me.unshift(Te)}function $e(Te){xe.unshift(Te)}function Oe(Te){H.unshift(Te)}var Fe=0,We=null;function at(Te){Fe++,s.monitorRunDependencies&&s.monitorRunDependencies(Fe)}function pt(Te){if(Fe--,s.monitorRunDependencies&&s.monitorRunDependencies(Fe),Fe==0&&We){var Le=We;We=null,Le()}}function bt(Te){s.onAbort&&s.onAbort(Te),Te="Aborted("+Te+")",R(Te),C=!0,Te+=". Build with -sASSERTIONS for more info.";var Le=new WebAssembly.RuntimeError(Te);throw o(Le),Le}var Bt="data:application/octet-stream;base64,";function vt(Te){return Te.startsWith(Bt)}function Mt(Te){return Te.startsWith("file://")}var ut;ut="tfjs-backend-wasm.wasm",vt(ut)||(ut=b(ut));function Lt(Te){try{if(Te==ut&&U)return new Uint8Array(U);if(_)return _(Te);throw"both async and sync fetching of the wasm failed"}catch(Le){bt(Le)}}function nn(){if(!U&&(c||p)){if(typeof fetch=="function"&&!Mt(ut))return fetch(ut,{credentials:"same-origin"}).then(function(Te){if(!Te.ok)throw"failed to load wasm binary file at '"+ut+"'";return Te.arrayBuffer()}).catch(function(){return Lt(ut)});if(x)return new Promise(function(Te,Le){x(ut,function(Qe){Te(new Uint8Array(Qe))},Le)})}return Promise.resolve().then(function(){return Lt(ut)})}function Xt(){var Te={env:nl,wasi_snapshot_preview1:nl};function Le(xt,mt){var bn=xt.exports;s.asm=bn,D=s.asm.memory,ne(D.buffer),s.asm.__indirect_function_table,$e(s.asm.__wasm_call_ctors),pt()}at();function Qe(xt){Le(xt.instance)}function Ve(xt){return nn().then(function(mt){return WebAssembly.instantiate(mt,Te)}).then(function(mt){return mt}).then(xt,function(mt){R("failed to asynchronously prepare wasm: "+mt),bt(mt)})}function un(){return!U&&typeof WebAssembly.instantiateStreaming=="function"&&!vt(ut)&&!Mt(ut)&&!m&&typeof fetch=="function"?fetch(ut,{credentials:"same-origin"}).then(function(xt){var mt=WebAssembly.instantiateStreaming(xt,Te);return mt.then(Qe,function(bn){return R("wasm streaming compile failed: "+bn),R("falling back to ArrayBuffer instantiation"),Ve(Qe)})}):Ve(Qe)}if(s.instantiateWasm)try{var rn=s.instantiateWasm(Te,Le);return rn}catch(xt){R("Module.instantiateWasm callback failed with error: "+xt),o(xt)}return un().catch(o),{}}function Et(Te){this.name="ExitStatus",this.message="Program terminated with exit("+Te+")",this.status=Te}function Gn(Te){for(;Te.length>0;)Te.shift()(s)}function ur(){bt("")}function Dr(){return 4294901760}function kn(){return Dr()}function cr(Te,Le,Qe){q.copyWithin(Te>>>0,Le>>>0,Le+Qe>>>0)}function vr(Te){try{return D.grow(Te-Q.byteLength+65535>>>16),ne(D.buffer),1}catch{}}function qn(Te){var Le=q.length;Te=Te>>>0;var Qe=Dr();if(Te>Qe)return!1;let Ve=(bn,nr)=>bn+(nr-bn%nr)%nr;for(var un=1;un<=4;un*=2){var rn=Le*(1+.2/un);rn=Math.min(rn,Te+100663296);var xt=Math.min(Qe,Ve(Math.max(Te,rn),65536)),mt=vr(xt);if(mt)return!0}return!1}function hr(Te){return 52}function si(Te,Le,Qe,Ve,un){return 70}var lo=[null,[],[]];function ds(Te,Le){var Qe=lo[Te];Le===0||Le===10?((Te===1?E:R)(z(Qe,0)),Qe.length=0):Qe.push(Le)}function uo(Te,Le,Qe,Ve){for(var un=0,rn=0;rn<Qe;rn++){var xt=Z[Le>>>2],mt=Z[Le+4>>>2];Le+=8;for(var bn=0;bn<mt;bn++)ds(Te,q[xt+bn>>>0]);un+=mt}return Z[Ve>>>2]=un,0}function dr(Te){var Le=s["_"+Te];return Le}function On(Te,Le){ee.set(Te,Le>>>0)}function ln(Te,Le,Qe,Ve,un){var rn={string:Yt=>{var Kr=0;if(Yt!=null&&Yt!==0){var Di=(Yt.length<<2)+1;Kr=Mr(Di),P(Yt,Kr,Di)}return Kr},array:Yt=>{var Kr=Mr(Yt.length);return On(Yt,Kr),Kr}};function xt(Yt){return Le==="string"?M(Yt):Le==="boolean"?!!Yt:Yt}var mt=dr(Te),bn=[],nr=0;if(Ve)for(var fs=0;fs<Ve.length;fs++){var Ra=rn[Qe[fs]];Ra?(nr===0&&(nr=Ri()),bn[fs]=Ra(Ve[fs])):bn[fs]=Ve[fs]}var ya=mt.apply(null,bn);function zn(Yt){return nr!==0&&rl(nr),xt(Yt)}return ya=zn(ya),ya}function Fn(Te,Le,Qe,Ve){Qe=Qe||[];var un=Qe.every(xt=>xt==="number"||xt==="boolean"),rn=Le!=="string";return rn&&un&&!Ve?dr(Te):function(){return ln(Te,Le,Qe,arguments)}}var nl={abort:ur,emscripten_get_heap_max:kn,emscripten_memcpy_big:cr,emscripten_resize_heap:qn,fd_close:hr,fd_seek:si,fd_write:uo};Xt(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.__wasm_call_ctors).apply(null,arguments)},s._init=function(){return(s._init=s.asm.init).apply(null,arguments)},s._init_with_threads_count=function(){return(s._init_with_threads_count=s.asm.init_with_threads_count).apply(null,arguments)},s._get_threads_count=function(){return(s._get_threads_count=s.asm.get_threads_count).apply(null,arguments)},s._register_tensor=function(){return(s._register_tensor=s.asm.register_tensor).apply(null,arguments)},s._dispose_data=function(){return(s._dispose_data=s.asm.dispose_data).apply(null,arguments)},s._dispose=function(){return(s._dispose=s.asm.dispose).apply(null,arguments)},s._Abs=function(){return(s._Abs=s.asm.Abs).apply(null,arguments)},s._Acos=function(){return(s._Acos=s.asm.Acos).apply(null,arguments)},s._Acosh=function(){return(s._Acosh=s.asm.Acosh).apply(null,arguments)},s._Add=function(){return(s._Add=s.asm.Add).apply(null,arguments)},s._AddN=function(){return(s._AddN=s.asm.AddN).apply(null,arguments)},s._All=function(){return(s._All=s.asm.All).apply(null,arguments)},s._Any=function(){return(s._Any=s.asm.Any).apply(null,arguments)},s._ArgMax=function(){return(s._ArgMax=s.asm.ArgMax).apply(null,arguments)},s._ArgMin=function(){return(s._ArgMin=s.asm.ArgMin).apply(null,arguments)},s._Asin=function(){return(s._Asin=s.asm.Asin).apply(null,arguments)},s._Asinh=function(){return(s._Asinh=s.asm.Asinh).apply(null,arguments)},s._Atan=function(){return(s._Atan=s.asm.Atan).apply(null,arguments)},s._Atan2=function(){return(s._Atan2=s.asm.Atan2).apply(null,arguments)},s._Atanh=function(){return(s._Atanh=s.asm.Atanh).apply(null,arguments)},s._AvgPool=function(){return(s._AvgPool=s.asm.AvgPool).apply(null,arguments)},s._AvgPool3D=function(){return(s._AvgPool3D=s.asm.AvgPool3D).apply(null,arguments)},s._AvgPool3DGrad=function(){return(s._AvgPool3DGrad=s.asm.AvgPool3DGrad).apply(null,arguments)},s._AvgPoolGrad=function(){return(s._AvgPoolGrad=s.asm.AvgPoolGrad).apply(null,arguments)},s._BatchMatMul=function(){return(s._BatchMatMul=s.asm.BatchMatMul).apply(null,arguments)},s._Bincount=function(){return(s._Bincount=s.asm.Bincount).apply(null,arguments)},s._BitwiseAnd=function(){return(s._BitwiseAnd=s.asm.BitwiseAnd).apply(null,arguments)},s._Ceil=function(){return(s._Ceil=s.asm.Ceil).apply(null,arguments)},s._ClipByValue=function(){return(s._ClipByValue=s.asm.ClipByValue).apply(null,arguments)},s._Conv2D=function(){return(s._Conv2D=s.asm.Conv2D).apply(null,arguments)},s._Conv2DBackpropInput=function(){return(s._Conv2DBackpropInput=s.asm.Conv2DBackpropInput).apply(null,arguments)},s._Conv3D=function(){return(s._Conv3D=s.asm.Conv3D).apply(null,arguments)},s._Conv3DBackpropFilterV2=function(){return(s._Conv3DBackpropFilterV2=s.asm.Conv3DBackpropFilterV2).apply(null,arguments)},s._Conv3DBackpropInputV2=function(){return(s._Conv3DBackpropInputV2=s.asm.Conv3DBackpropInputV2).apply(null,arguments)},s._Cos=function(){return(s._Cos=s.asm.Cos).apply(null,arguments)},s._Cosh=function(){return(s._Cosh=s.asm.Cosh).apply(null,arguments)},s._CropAndResize=function(){return(s._CropAndResize=s.asm.CropAndResize).apply(null,arguments)},s._Cumprod=function(){return(s._Cumprod=s.asm.Cumprod).apply(null,arguments)},s._Cumsum=function(){return(s._Cumsum=s.asm.Cumsum).apply(null,arguments)},s._DenseBincount=function(){return(s._DenseBincount=s.asm.DenseBincount).apply(null,arguments)},s._DepthToSpace=function(){return(s._DepthToSpace=s.asm.DepthToSpace).apply(null,arguments)},s._DepthwiseConv2dNative=function(){return(s._DepthwiseConv2dNative=s.asm.DepthwiseConv2dNative).apply(null,arguments)},s._Diag=function(){return(s._Diag=s.asm.Diag).apply(null,arguments)},s._Dilation2D=function(){return(s._Dilation2D=s.asm.Dilation2D).apply(null,arguments)},s._Dilation2DBackpropFilter=function(){return(s._Dilation2DBackpropFilter=s.asm.Dilation2DBackpropFilter).apply(null,arguments)},s._Dilation2DBackpropInput=function(){return(s._Dilation2DBackpropInput=s.asm.Dilation2DBackpropInput).apply(null,arguments)},s._Elu=function(){return(s._Elu=s.asm.Elu).apply(null,arguments)},s._EluGrad=function(){return(s._EluGrad=s.asm.EluGrad).apply(null,arguments)},s._Equal=function(){return(s._Equal=s.asm.Equal).apply(null,arguments)},s._Erf=function(){return(s._Erf=s.asm.Erf).apply(null,arguments)},s._Exp=function(){return(s._Exp=s.asm.Exp).apply(null,arguments)},s._Expm1=function(){return(s._Expm1=s.asm.Expm1).apply(null,arguments)},s._FlipLeftRight=function(){return(s._FlipLeftRight=s.asm.FlipLeftRight).apply(null,arguments)},s._Floor=function(){return(s._Floor=s.asm.Floor).apply(null,arguments)},s._FloorDiv=function(){return(s._FloorDiv=s.asm.FloorDiv).apply(null,arguments)},s._FusedBatchNorm=function(){return(s._FusedBatchNorm=s.asm.FusedBatchNorm).apply(null,arguments)},s._FusedConv2D=function(){return(s._FusedConv2D=s.asm.FusedConv2D).apply(null,arguments)},s._FusedDepthwiseConv2D=function(){return(s._FusedDepthwiseConv2D=s.asm.FusedDepthwiseConv2D).apply(null,arguments)},s._Gather=function(){return(s._Gather=s.asm.Gather).apply(null,arguments)},s._GatherNd=function(){return(s._GatherNd=s.asm.GatherNd).apply(null,arguments)},s._Greater=function(){return(s._Greater=s.asm.Greater).apply(null,arguments)},s._GreaterEqual=function(){return(s._GreaterEqual=s.asm.GreaterEqual).apply(null,arguments)},s._IsFinite=function(){return(s._IsFinite=s.asm.IsFinite).apply(null,arguments)},s._IsInf=function(){return(s._IsInf=s.asm.IsInf).apply(null,arguments)},s._IsNan=function(){return(s._IsNan=s.asm.IsNan).apply(null,arguments)},s._LRN=function(){return(s._LRN=s.asm.LRN).apply(null,arguments)},s._LRNGrad=function(){return(s._LRNGrad=s.asm.LRNGrad).apply(null,arguments)},s._LeakyRelu=function(){return(s._LeakyRelu=s.asm.LeakyRelu).apply(null,arguments)},s._Less=function(){return(s._Less=s.asm.Less).apply(null,arguments)},s._LessEqual=function(){return(s._LessEqual=s.asm.LessEqual).apply(null,arguments)},s._LinSpace=function(){return(s._LinSpace=s.asm.LinSpace).apply(null,arguments)},s._Log=function(){return(s._Log=s.asm.Log).apply(null,arguments)},s._Log1p=function(){return(s._Log1p=s.asm.Log1p).apply(null,arguments)},s._LogicalAnd=function(){return(s._LogicalAnd=s.asm.LogicalAnd).apply(null,arguments)},s._LogicalNot=function(){return(s._LogicalNot=s.asm.LogicalNot).apply(null,arguments)},s._LogicalOr=function(){return(s._LogicalOr=s.asm.LogicalOr).apply(null,arguments)},s._LogicalXor=function(){return(s._LogicalXor=s.asm.LogicalXor).apply(null,arguments)},s._Max=function(){return(s._Max=s.asm.Max).apply(null,arguments)},s._MaxPool=function(){return(s._MaxPool=s.asm.MaxPool).apply(null,arguments)},s._MaxPool3D=function(){return(s._MaxPool3D=s.asm.MaxPool3D).apply(null,arguments)},s._MaxPool3DGrad=function(){return(s._MaxPool3DGrad=s.asm.MaxPool3DGrad).apply(null,arguments)},s._MaxPoolGrad=function(){return(s._MaxPoolGrad=s.asm.MaxPoolGrad).apply(null,arguments)},s._MaxPoolWithArgmax=function(){return(s._MaxPoolWithArgmax=s.asm.MaxPoolWithArgmax).apply(null,arguments)},s._Maximum=function(){return(s._Maximum=s.asm.Maximum).apply(null,arguments)},s._Mean=function(){return(s._Mean=s.asm.Mean).apply(null,arguments)},s._Min=function(){return(s._Min=s.asm.Min).apply(null,arguments)},s._Minimum=function(){return(s._Minimum=s.asm.Minimum).apply(null,arguments)},s._MirrorPad=function(){return(s._MirrorPad=s.asm.MirrorPad).apply(null,arguments)},s._Mod=function(){return(s._Mod=s.asm.Mod).apply(null,arguments)},s._Multinomial=function(){return(s._Multinomial=s.asm.Multinomial).apply(null,arguments)},s._Multiply=function(){return(s._Multiply=s.asm.Multiply).apply(null,arguments)},s._Neg=function(){return(s._Neg=s.asm.Neg).apply(null,arguments)},s._NonMaxSuppressionV3=function(){return(s._NonMaxSuppressionV3=s.asm.NonMaxSuppressionV3).apply(null,arguments)},s._NonMaxSuppressionV4=function(){return(s._NonMaxSuppressionV4=s.asm.NonMaxSuppressionV4).apply(null,arguments)},s._NonMaxSuppressionV5=function(){return(s._NonMaxSuppressionV5=s.asm.NonMaxSuppressionV5).apply(null,arguments)},s._NotEqual=function(){return(s._NotEqual=s.asm.NotEqual).apply(null,arguments)},s._OneHot=function(){return(s._OneHot=s.asm.OneHot).apply(null,arguments)},s._PadV2=function(){return(s._PadV2=s.asm.PadV2).apply(null,arguments)},s._Pow=function(){return(s._Pow=s.asm.Pow).apply(null,arguments)},s._Prelu=function(){return(s._Prelu=s.asm.Prelu).apply(null,arguments)},s._Prod=function(){return(s._Prod=s.asm.Prod).apply(null,arguments)},s._RealDiv=function(){return(s._RealDiv=s.asm.RealDiv).apply(null,arguments)},s._Reciprocal=function(){return(s._Reciprocal=s.asm.Reciprocal).apply(null,arguments)},s._Relu=function(){return(s._Relu=s.asm.Relu).apply(null,arguments)},s._Relu6=function(){return(s._Relu6=s.asm.Relu6).apply(null,arguments)},s._ResizeBilinear=function(){return(s._ResizeBilinear=s.asm.ResizeBilinear).apply(null,arguments)},s._ResizeBilinearGrad=function(){return(s._ResizeBilinearGrad=s.asm.ResizeBilinearGrad).apply(null,arguments)},s._ResizeNearestNeighbor=function(){return(s._ResizeNearestNeighbor=s.asm.ResizeNearestNeighbor).apply(null,arguments)},s._ResizeNearestNeighborGrad=function(){return(s._ResizeNearestNeighborGrad=s.asm.ResizeNearestNeighborGrad).apply(null,arguments)},s._Reverse=function(){return(s._Reverse=s.asm.Reverse).apply(null,arguments)},s._RotateWithOffset=function(){return(s._RotateWithOffset=s.asm.RotateWithOffset).apply(null,arguments)},s._Round=function(){return(s._Round=s.asm.Round).apply(null,arguments)},s._Rsqrt=function(){return(s._Rsqrt=s.asm.Rsqrt).apply(null,arguments)},s._ScatterNd=function(){return(s._ScatterNd=s.asm.ScatterNd).apply(null,arguments)},s._SearchSorted=function(){return(s._SearchSorted=s.asm.SearchSorted).apply(null,arguments)},s._SelectV2=function(){return(s._SelectV2=s.asm.SelectV2).apply(null,arguments)},s._Selu=function(){return(s._Selu=s.asm.Selu).apply(null,arguments)},s._Sigmoid=function(){return(s._Sigmoid=s.asm.Sigmoid).apply(null,arguments)},s._Sign=function(){return(s._Sign=s.asm.Sign).apply(null,arguments)},s._Sin=function(){return(s._Sin=s.asm.Sin).apply(null,arguments)},s._Sinh=function(){return(s._Sinh=s.asm.Sinh).apply(null,arguments)},s._Softmax=function(){return(s._Softmax=s.asm.Softmax).apply(null,arguments)},s._Softplus=function(){return(s._Softplus=s.asm.Softplus).apply(null,arguments)},s._SparseFillEmptyRows=function(){return(s._SparseFillEmptyRows=s.asm.SparseFillEmptyRows).apply(null,arguments)},s._SparseReshape=function(){return(s._SparseReshape=s.asm.SparseReshape).apply(null,arguments)},s._SparseSegmentReduction=function(){return(s._SparseSegmentReduction=s.asm.SparseSegmentReduction).apply(null,arguments)},s._SparseToDense=function(){return(s._SparseToDense=s.asm.SparseToDense).apply(null,arguments)},s._Sqrt=function(){return(s._Sqrt=s.asm.Sqrt).apply(null,arguments)},s._Square=function(){return(s._Square=s.asm.Square).apply(null,arguments)},s._SquaredDifference=function(){return(s._SquaredDifference=s.asm.SquaredDifference).apply(null,arguments)},s._Step=function(){return(s._Step=s.asm.Step).apply(null,arguments)},s._StridedSlice=function(){return(s._StridedSlice=s.asm.StridedSlice).apply(null,arguments)},s._Sub=function(){return(s._Sub=s.asm.Sub).apply(null,arguments)},s._Sum=function(){return(s._Sum=s.asm.Sum).apply(null,arguments)},s._Tan=function(){return(s._Tan=s.asm.Tan).apply(null,arguments)},s._Tanh=function(){return(s._Tanh=s.asm.Tanh).apply(null,arguments)},s._TensorScatterUpdate=function(){return(s._TensorScatterUpdate=s.asm.TensorScatterUpdate).apply(null,arguments)},s._Tile=function(){return(s._Tile=s.asm.Tile).apply(null,arguments)},s._TopK=function(){return(s._TopK=s.asm.TopK).apply(null,arguments)},s._Transform=function(){return(s._Transform=s.asm.Transform).apply(null,arguments)},s._Transpose=function(){return(s._Transpose=s.asm.Transpose).apply(null,arguments)},s.__FusedMatMul=function(){return(s.__FusedMatMul=s.asm._FusedMatMul).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.malloc).apply(null,arguments)},s._free=function(){return(s._free=s.asm.free).apply(null,arguments)},s.___errno_location=function(){return(s.___errno_location=s.asm.__errno_location).apply(null,arguments)};var Ri=s.stackSave=function(){return(Ri=s.stackSave=s.asm.stackSave).apply(null,arguments)},rl=s.stackRestore=function(){return(rl=s.stackRestore=s.asm.stackRestore).apply(null,arguments)},Mr=s.stackAlloc=function(){return(Mr=s.stackAlloc=s.asm.stackAlloc).apply(null,arguments)};s.dynCall_iijjiiii=function(){return(s.dynCall_iijjiiii=s.asm.dynCall_iijjiiii).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.dynCall_jiji).apply(null,arguments)},s.cwrap=Fn;var ps;We=function Te(){ps||Ln(),ps||(We=Te)};function Ln(Te){if(Fe>0||(se(),Fe>0))return;function Le(){ps||(ps=!0,s.calledRun=!0,!C&&(ue(),i(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),ge()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),Le()},1)):Le()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();Ln();var oa;l&&(oa={uncaughtException:process.listeners("uncaughtException").filter(function(Te){return!l.uncaughtException.indexOf(Te)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(Te){return!l.unhandledRejection.indexOf(Te)>-1})});var la;if(typeof a<"u")la=a;else if(typeof WasmBackendModuleThreadedSimd<"u")la=WasmBackendModuleThreadedSimd;else throw new Error("Could not find wasm module in post.js");if(oa){var Aa=la._dispose;la._dispose=function(){Aa(),oa.uncaughtException.forEach(function(Te){process.removeListener("uncaughtException",Te)}),oa.unhandledRejection.forEach(function(Te){process.removeListener("unhandledRejection",Te)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModule=n)}),b1=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},Nv=class{refCount(e){return _s("refCount")}incRef(e){return _s("incRef")}timerAvailable(){return!0}time(e){return _s("time")}read(e){return _s("read")}readSync(e){return _s("readSync")}readToGPU(e,t){return _s("readToGPU")}numDataIds(){return _s("numDataIds")}disposeData(e,t){return _s("disposeData")}write(e,t,n){return _s("write")}move(e,t,n,r,a){return _s("move")}createTensorFromGPUData(e,t,n){return _s("createTensorFromGPUData")}memory(){return _s("memory")}floatPrecision(){return _s("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return _s("dispose")}};function _s(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function uU(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,u_(e,t,n)}function Cae(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,u_(e,n,r),u_(t,n,r)}function Kb(e,t,n){return Math.max(e,Math.min(t,n))}function Aae(e){return e%2===0?e:e+1}function u_(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function Rae(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function Dae(e,t){let n=Math.random();return t*n+(1-n)*e}function Mae(e,t){let n=0;for(let r=0;r<e.length;r++){let a=Number(e[r])-Number(t[r]);n+=a*a}return n}function X(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function qa(e,t,n=""){X(Zl(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Td(e){X(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function gn(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function $ae(e){return e.length===0}function cU(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function Zl(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function pm(e){return e%1===0}function Oae(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{let t=Math.exp(2*e);return(t-1)/(t+1)}}function Fae(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Pae(e){let t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return uU(t),t}function Ab(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Lae(e,t=a=>0,n,r){return new Promise((a,s)=>{let i=0,o=()=>{if(e()){a();return}i++;let l=t(i);if(n!=null&&i>=n){s();return}r!=null?r(o,l):setTimeout(o,l)};o()})}function zae(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let a=e.slice();return a[r]=t/n,a}function Ni(e,t){let n=t.length;return e=e==null?t.map((r,a)=>a):[].concat(e),X(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),X(e.every(r=>pm(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function hU(e,t){let n=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||a?null:Ni(t,e).sort(),i=0;for(let o=0;o<e.length;++o){if(s!=null){if(s[i]===o&&e[o]!==1)throw new Error(`Can't squeeze axis ${o} since its dim '${e[o]}' is not 1`);(s[i]==null||s[i]>o)&&e[o]===1&&(n.push(e[o]),r.push(o)),s[i]<=o&&i++}e[o]!==1&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function dU(e,t){return M2(e,t)}function M2(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function pU(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function fU(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function Vae(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function c_(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function mU(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function Yu(e){return typeof e=="string"||e instanceof String}function gU(e){return typeof e=="boolean"}function yU(e){return typeof e=="number"}function Cv(e){return Array.isArray(e)?Cv(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":yU(e)?"float32":Yu(e)?"string":gU(e)?"bool":"float32"}function gc(e){return!!(e&&e.constructor&&e.call&&e.apply)}function h_(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Um(e){let t=e.length;if(t<2)return[];let n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function bU(e,t,n,r=!1){let a=new Array;if(t.length===1){let s=t[0]*(r?2:1);for(let i=0;i<s;i++)a[i]=n[e+i]}else{let s=t[0],i=t.slice(1),o=i.reduce((l,h)=>l*h)*(r?2:1);for(let l=0;l<s;l++)a[l]=bU(e+l*o,i,n,r)}return a}function nm(e,t,n=!1){if(e.length===0)return t[0];let r=e.reduce((a,s)=>a*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return bU(0,e,t,n)}function Uae(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function $2(e,t){let n=v1(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function v1(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Bae(e,t){let n=e.reduce((r,a)=>r*a,1);if(t==null||t==="float32")return nm(e,new Float32Array(n));if(t==="int32")return nm(e,new Int32Array(n));if(t==="bool")return nm(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Ps(e){e.forEach(t=>{X(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function Wae(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function jae(e,t,n){if(t===0)return[];if(t===1)return[e];let r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function x1(e){return e&&e.then&&typeof e.then=="function"}var pP="tfjsflags",vU=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Hae,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let r=this.urlFlags[e];he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(x1(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);pP in e&&e[pP].split(",").forEach(t=>{let[n,r]=t.split(":");this.urlFlags[n]=qae(n,r)})}};function Hae(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(Gae(t,r[0],r[1]),r.join("="))),t}function Gae(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function qae(e,t){let n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function he(){return O2}var O2=null;function Kae(e){O2=e}var uk;function xU(){if(uk==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");uk=e}return uk}function Xae(){let e=xU();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function F2(e,t){let n=Xae();if(n.has(e))return n.get(e);{let r=t();return n.set(e,r),n.get(e)}}var Bm="Abs",kd="Acos",Ed="Acosh",zc="Add",Nd="AddN",Wm="All",jm="Any",Hm="ArgMax",Gm="ArgMin",Cd="Asin",Ad="Asinh",Rd="Atan",Dd="Atanh",Md="Atan2",$d="AvgPool",Av="AvgPoolGrad",qm="AvgPool3D",Rv="AvgPool3DGrad",Od="BatchMatMul",Km="BatchToSpaceND",Xm="Bincount",Ym="BitwiseAnd",wU="BroadcastTo",Dv="BroadcastArgs",Fd="Cast",Pd="Ceil",Vc="ClipByValue",w1="Complex",Mv="ComplexAbs",Qm="Concat",Ld="Conv2D",_1="Conv2DBackpropFilter",zd="Conv2DBackpropInput",Vd="Conv3D",Zm="Conv3DBackpropFilterV2",Jm="Conv3DBackpropInputV2",Ud="Cos",Bd="Cosh",eg="Cumprod",Wd="Cumsum",tg="CropAndResize",$v="DenseBincount",ng="DepthToSpace",jd="DepthwiseConv2dNative",S1="DepthwiseConv2dNativeBackpropFilter",I1="DepthwiseConv2dNativeBackpropInput",Ov="Diag",Hd="Dilation2D",fm="Dilation2DBackpropInput",mm="Dilation2DBackpropFilter",T1="Draw",Gd="RealDiv",k1="Einsum",qd="Elu",rg="EluGrad",Kd="Erf",ag="Equal",Xd="Exp",sg="ExpandDims",Yd="Expm1",E1="FFT",Fv="Fill",ig="FlipLeftRight",Qd="Floor",Zd="FloorDiv",Jd="FusedBatchNorm",og="GatherV2",lg="GatherNd",ug="Greater",ep="GreaterEqual",tp="Identity",N1="IFFT",C1="Imag",np="IsFinite",rp="IsInf",ap="IsNan",sp="LeakyRelu",cg="Less",hg="LessEqual",dg="LinSpace",ip="Log",op="Log1p",pg="LogicalAnd",fg="LogicalNot",mg="LogicalOr",_U="LogicalXor",SU="LogSoftmax",Yae="LowerBound",lp="LRN",gg="LRNGrad",Qae="MatrixBandPart",up="Max",cp="Maximum",hp="MaxPool",Pv="MaxPoolGrad",yg="MaxPool3D",Lv="MaxPool3DGrad",zv="MaxPoolWithArgmax",dp="Mean",pp="Min",fp="Minimum",mp="MirrorPad",gp="Mod",bg="Multinomial",yp="Multiply",vg="Neg",xg="NotEqual",wg="NonMaxSuppressionV3",_g="NonMaxSuppressionV4",Sg="NonMaxSuppressionV5",Ig="OnesLike",bp="OneHot",Tg="Pack",vp="PadV2",Zae="Pool",xp="Pow",wp="Prelu",_p="Prod",A1="RaggedGather",R1="RaggedRange",D1="RaggedTensorToTensor",Vv="Range",M1="Real",Sp="Reciprocal",Ip="Relu",kg="Reshape",Tp="ResizeNearestNeighbor",Eg="ResizeNearestNeighborGrad",kp="ResizeBilinear",Ng="ResizeBilinearGrad",Ep="Relu6",Np="Reverse",Cp="Round",Ap="Rsqrt",Cg="ScatterNd",Ag="TensorScatterUpdate",Rg="SearchSorted",Dg="Select",Rp="Selu",Mg="Slice",Dp="Sin",Mp="Sinh",$p="Sign",Op="Sigmoid",Fp="Softplus",Pp="Sqrt",Lp="Sum",$g="SpaceToBatchND",Og="SplitV",zp="Softmax",Uv="SparseFillEmptyRows",Fg="SparseReshape",Bv="SparseSegmentMean",Wv="SparseSegmentSum",Pg="SparseToDense",Vp="SquaredDifference",jv="Square",Hv="StaticRegexReplace",Lg="StridedSlice",Gv="StringNGrams",qv="StringSplit",Kv="StringToHashBucketFast",Up="Sub",Bp="Tan",Wp="Tanh",Uc="Tile",zg="TopK",Vg="Transform",Vl="Transpose",Xv="Unique",Ug="Unpack",Yv="UnsortedSegmentSum",Jae="UpperBound",Bg="ZerosLike",Bc="Step",d_="FromPixels",Wg="RotateWithOffset",td="_FusedMatMul",nd="FusedConv2D",rd="FusedDepthwiseConv2D";function Ku(...e){he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(...e)}function ese(...e){he().getBool("IS_TEST")||he().getBool("PROD")||console.log(...e)}var gm=F2("kernelRegistry",()=>new Map),Xb=F2("gradRegistry",()=>new Map);function Yb(e,t){let n=P2(e,t);return gm.get(n)}function lE(e){return Xb.get(e)}function p_(e){let t=gm.entries(),n=[];for(;;){let{done:r,value:a}=t.next();if(r)break;let[s,i]=a,[o]=s.split("_");o===e&&n.push(i)}return n}function Qv(e){let{kernelName:t,backendName:n}=e,r=P2(t,n);gm.has(r)&&Ku(`The kernel '${t}' for backend '${n}' is already registered`),gm.set(r,e)}function IU(e){let{kernelName:t}=e;Xb.has(t)&&he().getBool("DEBUG")&&Ku(`Overriding the gradient for '${t}'`),Xb.set(t,e)}function tse(e,t){let n=P2(e,t);if(!gm.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);gm.delete(n)}function nse(e){if(!Xb.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);Xb.delete(e)}function rse(e,t){p_(e).forEach(n=>{let r=Object.assign({},n,{backendName:t});Qv(r)})}function P2(e,t){return`${t}_${e}`}var $={};_t($,{arraysEqual:()=>Zl,arraysEqualWithNull:()=>cU,assert:()=>X,assertNonNegativeIntegerDimensions:()=>Ps,assertNonNull:()=>Td,assertShapesMatch:()=>qa,bytesFromStringArray:()=>mU,bytesPerElement:()=>c_,checkConversionForErrors:()=>pU,clamp:()=>Kb,computeStrides:()=>Um,convertBackendValuesAndArrayBuffer:()=>Uae,createScalarValue:()=>use,createShuffledIndices:()=>Pae,decodeString:()=>f_,distSquared:()=>Mae,encodeString:()=>Jv,fetch:()=>hse,fingerPrint64:()=>lse,flatten:()=>yc,getArrayFromDType:()=>M2,getTypedArrayFromDType:()=>dU,hasEncodingLoss:()=>Vae,hexToLong:()=>Zv,indexToLoc:()=>jae,inferDtype:()=>Cv,inferFromImplicitShape:()=>zae,isBoolean:()=>gU,isFunction:()=>gc,isInt:()=>pm,isNumber:()=>yU,isPromise:()=>x1,isScalarShape:()=>$ae,isString:()=>Yu,isTypedArray:()=>Jr,isValidDtype:()=>fU,locToIndex:()=>Wae,makeOnesTypedArray:()=>$2,makeZerosNestedTypedArray:()=>Bae,makeZerosTypedArray:()=>v1,nearestDivisor:()=>h_,nearestLargerEven:()=>Aae,now:()=>Qb,parseAxisParam:()=>Ni,randUniform:()=>Dae,repeatedTry:()=>Lae,rightPad:()=>Ab,shuffle:()=>uU,shuffleCombo:()=>Cae,sizeFromShape:()=>gn,sizeToSquarishShape:()=>Fae,squeezeShape:()=>hU,sum:()=>Rae,swap:()=>u_,tanh:()=>Oae,toNestedArray:()=>nm,toTypedArray:()=>$1});function TU(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var fP=Lc(dae()),Rh=fP.default||fP;function Zv(e){return Rh.fromString(e,!0,16)}var kU=Zv("c3a5c85c97cb3127"),Nh=Zv("b492b66fbe98f273"),za=Zv("9ae16a3b2f90404f");function uE(e){return e.xor(e.shru(47))}function EU(e,t,n){let r=e.slice(t,t+n);return Rh.fromBytes(Array.from(r),!0,!0)}function Dn(e,t){return EU(e,t,8)}function mP(e,t){return EU(e,t,4)}function Zr(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function ac(e,t,n=Zv("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function ase(e,t,n,r,a,s){a=a.add(e),s=Zr(s.add(a).add(r),21);let i=a;return a=a.add(t),a=a.add(n),s=s.add(Zr(a,44)),[a.add(r),s.add(i)]}function n0(e,t,n,r){return ase(Dn(e,t),Dn(e,t+8),Dn(e,t+16),Dn(e,t+24),n,r)}function sse(e,t=e.length){if(t>=8){let n=za.add(t*2),r=Dn(e,0).add(za),a=Dn(e,t-8),s=Zr(a,37).mul(n).add(r),i=Zr(r,25).add(a).mul(n);return ac(s,i,n)}if(t>=4){let n=za.add(t*2),r=mP(e,0);return ac(r.shl(3).add(t),mP(e,t-4),n)}if(t>0){let n=e[0],r=e[t>>1],a=e[t-1],s=n+(r<<8),i=t+(a<<2);return uE(za.mul(s).xor(kU.mul(i))).mul(za)}return za}function ise(e,t=e.length){let n=za.add(t*2),r=Dn(e,0).mul(Nh),a=Dn(e,8),s=Dn(e,t-8).mul(n),i=Dn(e,t-16).mul(za);return ac(Zr(r.add(a),43).add(Zr(s,30)).add(i),r.add(Zr(a.add(za),18)).add(s),n)}function ose(e,t=e.length){let n=za.add(t*2),r=Dn(e,0).mul(za),a=Dn(e,8),s=Dn(e,t-8).mul(n),i=Dn(e,t-16).mul(za),o=Zr(r.add(a),43).add(Zr(s,30)).add(i),l=ac(o,r.add(Zr(a.add(za),18)).add(s),n),h=Dn(e,16).mul(n),c=Dn(e,24),p=o.add(Dn(e,t-32)).mul(n),m=l.add(Dn(e,t-24)).mul(n);return ac(Zr(h.add(c),43).add(Zr(p,30)).add(m),h.add(Zr(c.add(r),18)).add(p),n)}function lse(e,t=e.length){let n=Rh.fromNumber(81,!0);if(t<=32)return t<=16?sse(e,t):ise(e,t);if(t<=64)return ose(e,t);let r=n,a=n.mul(Nh).add(113),s=uE(a.mul(za).add(113)).mul(za),i=[Rh.UZERO,Rh.UZERO],o=[Rh.UZERO,Rh.UZERO];r=r.mul(za).add(Dn(e,0));let l=0,h=(t-1>>6)*64,c=h+(t-1&63)-63;do r=Zr(r.add(a).add(i[0]).add(Dn(e,l+8)),37).mul(Nh),a=Zr(a.add(i[1]).add(Dn(e,l+48)),42).mul(Nh),r=r.xor(o[1]),a=a.add(i[0]).add(Dn(e,l+40)),s=Zr(s.add(o[0]),33).mul(Nh),i=n0(e,l,i[1].mul(Nh),r.add(o[0])),o=n0(e,l+32,s.add(o[1]),a.add(Dn(e,l+16))),[s,r]=[r,s],l+=64;while(l!==h);let p=Nh.add(s.and(255).shl(1));return l=c,o[0]=o[0].add(t-1&63),i[0]=i[0].add(o[0]),o[0]=o[0].add(i[0]),r=Zr(r.add(a).add(i[0]).add(Dn(e,l+8)),37).mul(p),a=Zr(a.add(i[1]).add(Dn(e,l+48)),42).mul(p),r=r.xor(o[1].mul(9)),a=a.add(i[0].mul(9).add(Dn(e,l+40))),s=Zr(s.add(o[0]),33).mul(p),i=n0(e,l,i[1].mul(p),r.add(o[0])),o=n0(e,l+32,s.add(o[1]),a.add(Dn(e,l+16))),[s,r]=[r,s],ac(ac(i[0],o[0],p).add(uE(a).mul(kU)).add(s),ac(i[1],o[1],p).add(r),p)}function use(e,t){return t==="string"?Jv(e):$1([e],t)}function cse(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function $1(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=yc(e)),he().getBool("DEBUG")&&pU(e,t),cse(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){let n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function Qb(){return he().platform.now()}function hse(e,t){return he().platform.fetch(e,t)}function Jv(e,t="utf-8"){return t=t||"utf-8",he().platform.encode(e,t)}function f_(e,t="utf-8"){return t=t||"utf-8",he().platform.decode(e,t)}function Jr(e){return he().platform.isTypedArray!=null?he().platform.isTypedArray(e):TU(e)}function yc(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||x1(e)||e==null||Jr(e)&&n)t.push(e);else if(Array.isArray(e)||Jr(e))for(let r=0;r<e.length;++r)yc(e[r],t,n);else{let r=-1;for(let a of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)yc(e[a],t,n)}return t}var dse=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new fse)}profileKernel(e,t,n){let r,a=()=>{r=n()},s,i=Qb();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(a);else{a();for(let o of r)o.dataSync();s=Promise.resolve({kernelMs:Qb()-i})}if(he().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<r.length;o++){let l=r[o];l.data().then(h=>{pse(h,l.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then(o=>o.kernelMs),extraInfo:s.then(o=>o.getExtraProfileInfo!=null?o.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:s}=e;n.forEach(i=>{Promise.all([i.data(),r,s]).then(o=>{this.logger.logKernelProfile(t,i,o[0],o[1],a,o[2])})})}};function pse(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){let a=e[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${n}'`),!0}return!1}var fse=class{logKernelProfile(e,t,n,r,a,s){let i=typeof r=="number"?Ab(`${r}ms`,9):r.error,o=Ab(e,25),l=t.rank,h=t.size,c=Ab(t.shape.toString(),14),p="";for(let m in a){let g=a[m];if(g!=null){let b=g.shape||t.shape,v=b.length;p+=`${m}: ${v}D ${v>0?b:""} `}}console.log(`%c${o}	%c${i}	%c${l}D ${c}	%c${h}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function mse(e,t,n){let r={},a={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){let h=e[l],c=h.inputs;for(let p in c){let m=c[p],g=!1;for(let b=0;b<t.length;b++)if(r[m.id]){h.outputs.forEach(v=>r[v.id]=!0),g=!0,a[h.id]=!0;break}if(g)break}}let s={};s[n.id]=!0;let i={};for(let l=e.length-1;l>=0;l--){let h=e[l],c=h.inputs;for(let p=0;p<h.outputs.length;p++)if(s[h.outputs[p].id]){for(let m in c)s[c[m].id]=!0,i[h.id]=!0;break}}let o=[];for(let l=0;l<e.length;l++){let h=e[l];if(a[h.id]&&i[h.id]){let c={};for(let m in h.inputs){let g=h.inputs[m];r[g.id]&&(c[m]=g)}let p=Object.assign({},h);p.inputs=c,p.outputs=h.outputs,o.push(p)}}return o}function gse(e,t,n,r){for(let a=t.length-1;a>=0;a--){let s=t[a],i=[];if(s.outputs.forEach(l=>{let h=e[l.id];h!=null?i.push(h):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let o=s.gradient(i);for(let l in s.inputs){if(!(l in o))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(o)}.`);let h=n(()=>o[l]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${h.dtype}'`);let c=s.inputs[l];if(!Zl(h.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${h.shape}', which does not match the shape of the input '${c.shape}'`);if(e[c.id]==null)e[c.id]=h;else{let p=e[c.id];e[c.id]=r(p,h),p.dispose()}}}}var gP=20,nb=3,ck=7;function yse(e,t,n,r){let a=Um(t),s=bse(e,t,n,a),i=t.length,o=R0(e,t,n,a,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(o.map(h=>"    "+h).join(`
`)),l.join(`
`)}function bse(e,t,n,r){let a=gn(t),s=r[r.length-1],i=new Array(s).fill(0),o=t.length,l=n==="complex64"?fb(e):e;if(o>1)for(let h=0;h<a/s;h++){let c=h*s;for(let p=0;p<s;p++)i[p]=Math.max(i[p],pb(l[c+p],0,n).length)}return i}function pb(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(ck))} + ${parseFloat(e[1].toFixed(ck))}j`:Yu(e)?r=`'${e}'`:n==="bool"?r=NU(e):r=parseFloat(e.toFixed(ck)).toString(),Ab(r,t)}function NU(e){return e===0?"false":"true"}function R0(e,t,n,r,a,s=!0){let i=n==="complex64"?2:1,o=t[0],l=t.length;if(l===0){if(n==="complex64"){let v=fb(e);return[pb(v[0],0,n)]}return n==="bool"?[NU(e[0])]:[e[0].toString()]}if(l===1){if(o>gP){let v=nb*i,x=Array.from(e.slice(0,v)),_=Array.from(e.slice((o-nb)*i,o*i));return n==="complex64"&&(x=fb(x),_=fb(_)),["["+x.map((I,k)=>pb(I,a[k],n)).join(", ")+", ..., "+_.map((I,k)=>pb(I,a[o-nb+k],n)).join(", ")+"]"]}return["["+(n==="complex64"?fb(e):Array.from(e)).map((v,x)=>pb(v,a[x],n)).join(", ")+"]"]}let h=t.slice(1),c=r.slice(1),p=r[0]*i,m=[];if(o>gP){for(let v=0;v<nb;v++){let x=v*p,_=x+p;m.push(...R0(e.slice(x,_),h,n,c,a,!1))}m.push("...");for(let v=o-nb;v<o;v++){let x=v*p,_=x+p;m.push(...R0(e.slice(x,_),h,n,c,a,v===o-1))}}else for(let v=0;v<o;v++){let x=v*p,_=x+p;m.push(...R0(e.slice(x,_),h,n,c,a,v===o-1))}let g=l===2?",":"";m[0]="["+(o>0?m[0]+g:"");for(let v=1;v<m.length-1;v++)m[v]=" "+m[v]+g;let b=`,
`;for(let v=2;v<l;v++)b+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(s?"":b),m}function fb(e){let t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Er=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=gn(e),n!=null){let r=n.length;X(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||M2(t,this.size),this.strides=Um(e)}set(e,...t){t.length===0&&(t=[0]),X(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let r of e){if(r<0||r>=this.shape[t]){let a=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(a)}t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Hi().makeTensor(this.values,this.shape,this.dtype)}},Hi=null,Kf=null;function vse(e){Hi=e}function xse(e){Kf=e}var Tt=class{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=gn(e),this.strides=Um(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Kf.buffer(this.shape,this.dtype,e)}bufferSync(){return Kf.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return nm(this.shape,e,this.dtype==="complex64")}arraySync(){return nm(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Hi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>f_(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Hi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Hi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>f_(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Hi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Hi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Kf.print(this,e)}clone(){return this.throwIfDisposed(),Kf.clone(this)}toString(e=!1){let t=this.dataSync();return yse(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Kf.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Hi().makeVariable(this,e,t,n)}};Object.defineProperty(Tt,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function ke(){return F2("Tensor",()=>Tt)}ke();var ad=class extends Tt{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Zl(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Hi().disposeTensor(this),this.dataId=e.dataId,Hi().incRef(this,null)}dispose(){Hi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(ad,Symbol.hasInstance,{value:e=>e instanceof Tt&&e.assign!=null&&e.assign instanceof Function});var Xi={};_t(Xi,{assertTypesMatch:()=>RU,getTensorsInContainer:()=>L2,isTensorInList:()=>_se,makeTypesMatch:()=>tr});var cE;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(cE||(cE={}));var hE;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(hE||(hE={}));var dE;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(dE||(dE={}));var pE;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(pE||(pE={}));var fE;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(fE||(fE={}));var wse={float32:pE,int32:hE,bool:dE,complex64:fE};function ti(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return wse[e][t]}function O1(e){return ti(e,"int32")}function CU(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function AU(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}function tr(e,t){if(e.dtype===t.dtype)return[e,t];let n=ti(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function RU(e,t){X(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function _se(e,t){return t.some(n=>n.id===e.id)}function L2(e){let t=[];return DU(e,t,new Set),t}function DU(e,t,n){if(e==null)return;if(e instanceof Tt){t.push(e);return}if(!Sse(e))return;let r=e;for(let a in r){let s=r[a];n.has(s)||(n.add(s),DU(s,t,n))}}function Sse(e){return Array.isArray(e)||typeof e=="object"}function hk(e){return e.kernelName!=null}var yP=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},z2=class mE{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new yP}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){let{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(Ku(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;let{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new dse(this.backendInstance),!0}setupRegisteredKernels(){p_(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){p_(t).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[t])})}initializeBackend(t){let n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{let r=n.factory();if(r&&!(r instanceof Nv)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,s=r.then(i=>a<this.pendingBackendInitId?!1:(this.registry[t]=i,this.pendingBackendInit=null,!0)).catch(i=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Ku(`Initialization of backend ${t} failed`),Ku(i.stack||i.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return Ku(`Initialization of backend ${t} failed`),Ku(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n],{success:a,asyncInit:s}=this.initializeBackend(r);if(s||a)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){let r=this.state.tensorInfo.get(n),a=r.backend,s=this.readSync(n),i=a.refCount(n);a.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=n(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(t,n,r){t();try{let a=r();return n(),a}catch(a){throw n(),a}}nextTensorId(){return mE.nextTensorId++}nextVariableId(){return mE.nextVariableId++}clone(t){let n=J.runKernel(tp,{x:t}),r={x:t},a=i=>({x:()=>{let o="float32",l={x:i},h={dtype:o};return J.runKernel(Fd,l,h)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],a,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,Yb(t,this.backendName)==null)throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){let a=this.backend.numDataIds(),s=0;r.forEach(l=>{s+=l.dtype==="complex64"?3:1});let i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=a-n-s-i;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[],a=this.isTapeOn(),s=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let o;this.backendName==null&&this.backend;let l,h=hk(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(hk(t)){let{kernelName:b,inputs:v,attrs:x}=t;this.backendName==null&&this.backend;let _=Yb(b,this.backendName);X(_!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),o=()=>{let I=this.backend.numDataIds();l=_.kernelFunc({inputs:v,attrs:x,backend:this.backend});let k=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,I,k);let E=k.map(R=>R.rank!=null?R:this.makeTensorFromTensorInfo(R));if(a){let R=this.getTensorsForGradient(b,v,E);r=this.saveTensorsForBackwardMode(R)}return E}}else{let{forwardFunc:b}=t,v=x=>{a&&(r=x.map(_=>this.keep(this.clone(_))))};o=()=>{let x=this.backend.numDataIds();l=this.tidy(()=>b(this.backend,v));let _=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,x,_),_}}let{inputs:c,attrs:p}=t,m=hk(t)?null:t.backwardsFunc,g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=o():(g=this.profiler.profileKernel(h,c,()=>o()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),n=g.outputs)}),a&&this.addTapeNode(h,c,n,m,r,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(b=>c[b]!=null?c[b].shape:null),outputShapes:n.map(b=>b.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(t,n,r){let a=lE(t);if(a!=null){let s=a.inputsToSave||[],i=a.outputsToSave||[],o;a.saveAllInputs?(X(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),o=Object.keys(n).map(h=>n[h])):o=s.map(h=>n[h]);let l=r.filter((h,c)=>i[c]);return o.concat(l)}return[]}makeTensor(t,n,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let s=t;r==="string"&&Yu(t[0])&&(s=t.map(l=>Jv(l)));let i=a.write(s,n,r),o=new Tt(n,r,i,this.nextTensorId());if(this.trackTensor(o,a),r==="string"){let l=this.state.tensorInfo.get(i),h=mU(s);this.state.numBytes+=h-l.bytes,l.bytes=h}return o}makeTensorFromDataId(t,n,r,a){r=r||"float32";let s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,a)}makeTensorFromTensorInfo(t,n){let{dataId:r,shape:a,dtype:s}=t,i=new Tt(a,s,r,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(t,n=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.cast(a));let s=new ad(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*c_(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof ad||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;let n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){let r=t.size*c_(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(let t in this.state.registeredVariables){let n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){let t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;let n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,a,s,i){let o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},l=lE(t);l!=null&&(a=l.gradFunc),a!=null&&(o.gradient=h=>(h=h.map((c,p)=>{if(c==null){let m=r[p],g=v1(m.size,m.dtype);return this.makeTensor(g,m.shape,m.dtype)}return c}),a(h.length>1?h:h[0],s,i))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){let n=L2(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let i=this.state.activeScope.track[s];!i.kept&&!r.has(i.id)&&i.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===a.id&&this.track(s)})}gradients(t,n,r,a=!1){if(X(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));X(s instanceof Tt,()=>"The result y returned by f() must be a tensor.");let i=mse(this.state.activeTape,n,s);if(!a&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let o={};o[s.id]=r??Ise(s.shape),gse(o,i,h=>this.tidy(h),Tse);let l=n.map(h=>o[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(let c of h.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(t){return X(gc(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{X(n.every(o=>o instanceof Tt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};n.forEach((o,l)=>{a[l]=o});let s=(o,l)=>(r=t(...n,l),X(r.value instanceof Tt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),X(gc(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),i=(o,l)=>{let h=r.gradFunc(o,l),c=Array.isArray(h)?h:[h];X(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),X(c.every(m=>m instanceof Tt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return c.forEach((m,g)=>{p[g]=()=>m}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:i,inputs:a})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){let n=Qb(),r=await this.backend.time(t);return r.wallMs=Qb()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new yP;for(let t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};z2.nextTensorId=0;z2.nextVariableId=0;function Ise(e){let t=$2(gn(e),"float32");return J.makeTensor(t,e,"float32")}function MU(){let e=xU();if(e._tfengine==null){let t=new vU(e);e._tfengine=new z2(t)}return Kae(e._tfengine.ENV),vse(()=>e._tfengine),e._tfengine}var J=MU();function Tse(e,t){let n={a:e,b:t};return J.runKernel(zc,n)}var ex={};_t(ex,{isBrowser:()=>$U,isMobile:()=>Nse,mockIsMobile:()=>Ese});function kse(){return typeof navigator<"u"&&navigator!=null}var gE;function Ese(e){gE=e}function Nse(e){if(gE!==void 0)return gE;if(e||kse()){if(e||(e=navigator),e.product==="ReactNative")return!0;let t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){let n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function $U(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ls=he();ls.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ls.registerFlag("IS_BROWSER",()=>$U());ls.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ls.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ls.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ls.registerFlag("PROD",()=>!1);ls.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ls.getBool("DEBUG"));ls.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ls.registerFlag("IS_TEST",()=>!1);ls.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ls.getBool("DEBUG"));ls.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ls.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ls.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function Go(e,t){let n=e;if(Jr(e))return t==="string"?[]:[e.length];if(CU(e)){let a=e.channels||"RGBA";return[e.height,e.width*a.length]}else if(AU(e))return[e.buffer.size/(t==null?4:c_(t))];if(!Array.isArray(e))return[];let r=[];for(;Array.isArray(n)||Jr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&he().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&OU(e,r,[]),r}function OU(e,t,n){if(n=n||[],!Array.isArray(e)&&!Jr(e)){X(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}X(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),X(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);let r=t.slice(1);for(let a=0;a<e.length;++a)OU(e[a],r,n.concat(a))}function bP(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function W(e,t,n,r="numeric"){if(e instanceof ke())return bP(r,e.dtype,t,n),e;let a=Cv(e);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),bP(r,a,t,n),e==null||!Jr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){let o=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${o}'`)}let s=Go(e,a);!Jr(e)&&!Array.isArray(e)&&(e=[e]);let i=a!=="string"?$1(e,a):yc(e,[],!0);return J.makeTensor(i,s,a)}function Zb(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((a,s)=>W(a,`${t}[${s}]`,n,r))}var V2="__op";function te(e){let t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+V2;let a=(...s)=>{J.startScope(n);try{let i=r(...s);return x1(i)&&console.error("Cannot return a Promise inside of tidy."),J.endScope(i),i}catch(i){throw J.endScope(null),i}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}function Cse(e,t){let n=W(e,"real","complex"),r=W(t,"imag","complex");qa(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:n,imag:r};return J.runKernel(w1,a)}var Kl=te({complex_:Cse});function Wc(e,t,n,r){if(r==null)r=Cv(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(AU(e)||CU(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return J.backend.createTensorFromGPUData(e,t||n,r)}if(!Jr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Ps(t);let a=gn(t),s=gn(n);X(a===s,()=>`Based on the provided shape, [${t}], the tensor should have ${a} values but has ${s}`);for(let i=0;i<n.length;++i){let o=n[i],l=i===n.length-1?o!==gn(t.slice(i)):!0;X(n[i]===t[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Jr(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?$1(e,r):yc(e,[],!0),J.makeTensor(e,t,r)}function Ba(e,t,n){let r=Go(e,n);return Wc(e,t,r,n)}var sd={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Jl=class FU{static join(t){return new FU(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>Jr(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){let a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let s=n+a.byteLength;this.shards.push({buffer:a,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);let r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);let a=n-t,s=new ArrayBuffer(a),i=new Uint8Array(s),o=0;for(let l=r;l<this.shards.length;l++){let h=this.shards[l],c=t+o-h.start,p=o,m=Math.min(n,h.end)-h.start,g=new Uint8Array(h.buffer,c,m-c);if(i.set(g,p),o+=g.length,n<h.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(a){return t<a.start?-1:t>=a.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let r=Ase(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}};function Ase(e,t){let n=0,r=e.length;for(;n<=r;){let a=Math.floor((r-n)/2)+n,s=t(e[a]);if(s===0)return a;s<0?r=a:n=a+1}return-1}function Rse(){he().set("PROD",!0)}function Dse(){he().set("DEBUG",!0)}function Mse(){he().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function PU(e){he().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function $se(){J.disposeVariables()}function _i(){return J}function yE(){return J.memory()}function Ose(e){return J.profile(e)}function oe(e,t){return J.tidy(e,t)}function wt(e){L2(e).forEach(t=>t.dispose())}function Br(e){return J.keep(e)}function Fse(e){return J.time(e)}function Pse(e){return J.setBackend(e)}function Lse(){return J.ready()}function LU(){return J.backendName}function zse(e){J.removeBackend(e)}function Vse(e){return J.findBackend(e)}function Use(e){return J.findBackendFactory(e)}function F1(e,t,n=1){return J.registerBackend(e,t,n)}function U2(){return J.backend}function Bse(e,t){he().setPlatform(e,t)}var bc=4;async function Wse(e,t){let n=[],r=[],a=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);for(let i=0;i<a.length;++i){let o=a[i],l=Array.isArray(e)?e[i].tensor:e[o];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${o}': ${l.dtype}`);let h={name:o,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let c=new Promise(async p=>{let m=await l.bytes(),g=m.reduce((x,_)=>x+_.length,0)+bc*m.length,b=new Uint8Array(g),v=0;for(let x=0;x<m.length;x++){let _=m[x],I=new Uint8Array(new Uint32Array([_.length]).buffer);b.set(I,v),v+=bc,b.set(_,v),v+=_.length}p(b)});r.push(c)}else r.push(l.data());t!=null&&(h.group=t),n.push(h)}let s=await Promise.all(r);return{data:Gse(s),specs:n}}function zU(e,t){let n=new Jl(e),r={},a=0;for(let s of t){let i=jse(s,(o,l)=>n.slice(a+o,a+l));r[s.name]=VU(s,n.slice(a,a+i)),a+=i}return r}function jse(e,t){let n=gn(e.shape),r;if("quantization"in e){let a=e.quantization;r=sd[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=bc+new Uint32Array(t(a,a+bc))[0];return a}else r=sd[e.dtype];return n*r}async function Hse(e,t){let n=gn(e.shape),r;if("quantization"in e){let a=e.quantization;r=sd[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=bc+new Uint32Array(await t(a,a+bc))[0];return a}else r=sd[e.dtype];return n*r}function VU(e,t){let n=e.name,r=e.dtype,a=e.shape,s=gn(a),i,o=0;if("quantization"in e){let l=e.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${e.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${e.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${e.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let h=sd[l.dtype],c=l.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(c.length);for(let p=0;p<c.length;p++){let m=c[p];i[p]=m*l.scale+l.min}}else if(l.dtype==="float16")i=Jse()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(c.length);for(let p=0;p<c.length;p++){let m=c[p];i[p]=Math.round(m*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);o+=s*h}else if(r==="string"){let l=gn(e.shape);i=[];for(let h=0;h<l;h++){let c=new Uint32Array(t.slice(o,o+bc))[0];o+=bc;let p=new Uint8Array(t.slice(o,o+c));i.push(p),o+=c}}else{let l=sd[r];if(r==="float32")i=new Float32Array(t);else if(r==="int32")i=new Int32Array(t);else if(r==="bool")i=new Uint8Array(t);else if(r==="complex64"){i=new Float32Array(t);let h=new Float32Array(i.length/2),c=new Float32Array(i.length/2);for(let b=0;b<h.length;b++)h[b]=i[b*2],c[b]=i[b*2+1];let p=Ba(h,a,"float32"),m=Ba(c,a,"float32"),g=Kl(p,m);return p.dispose(),m.dispose(),g}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);o+=s*l}return Ba(i,a,r)}async function vP(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){let{done:a,value:s}=await e.read();if(a&&s==null){let o=n-r.byteLength;throw new Error(`Reader is done but ${o} bytes are still expected`)}let i=new Uint8Array(r.length+s.byteLength);i.set(r,0),i.set(new Uint8Array(s),r.length),r=i}return r.buffer}async function UU(e,t){let n={},r=e.getReader(),a=new ArrayBuffer(0);for(let s of t){let i=await Hse(s,async(h,c)=>(a=await vP(r,a,c),a.slice(h,c)));a=await vP(r,a,i);let o=a.slice(0,i);a=a.slice(i);let l=VU(s,o);if(n[s.name]=l,LU()==="webgpu"){let h=U2();"uploadToGPU"in h&&gn(l.shape)>=he().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&h.uploadToGPU(l.dataId)}}return n}function Gse(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let r=new Uint8Array(t),a=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),a),a+=s.byteLength}),r.buffer}var B2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xP(e){return B2?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function qse(e){if(B2)return Buffer.from(e).toString("base64");let t=new Uint8Array(e),n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Kse(e){if(B2){let r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function Xse(e){return Jl.join(e)}function wP(e){let t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);let n=e.split(t);return n[n.length-1]}function BU(e,t){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function WU(e,t,n){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function W2(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),WU(e,n,r)}function tx(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:xP(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:xP(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Jl(e.weightData).byteLength}}function bE(e){let t=[];for(let n of e)t.push(...n.weights);return t}function Yse(){let e=n=>{let r=n<<13,a=0;for(;!(r&8388608);)a-=8388608,r<<=1;return r&=-8388609,a+=947912704,r|a},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function Qse(){let e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function Zse(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function Jse(){let e=Yse(),t=Qse(),n=Zse();return r=>{let a=new ArrayBuffer(4*r.length),s=new Uint32Array(a);for(let i=0;i<r.length;i++){let o=r[i],l=e[n[o>>10]+(o&1023)]+t[o>>10];s[i]=l}return new Float32Array(a)}}var ni=class Bi{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Bi.instance==null&&(Bi.instance=new Bi),Bi.instance}static registerSaveRouter(t){Bi.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Bi.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Bi.getHandlers(t,"save")}static getLoadHandlers(t,n){return Bi.getHandlers(t,"load",n)}static getHandlers(t,n,r){let a=[];return(n==="load"?Bi.getInstance().loadRouters:Bi.getInstance().saveRouters).forEach(s=>{let i=s(t,r);i!==null&&a.push(i)}),a}},eie=e=>ni.registerSaveRouter(e),tie=e=>ni.registerLoadRouter(e),nie=e=>ni.getSaveHandlers(e),rie=(e,t)=>ni.getLoadHandlers(e,t),vE="tensorflowjs",xE=1,Lh="models_store",Qu="model_info_store";function jU(){if(!he().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function wE(e){let t=e.result;t.createObjectStore(Lh,{keyPath:"modelPath"}),t.createObjectStore(Qu,{keyPath:"modelPath"})}var id=class{constructor(e){if(this.indexedDB=jU(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,r)=>{let a=this.indexedDB.open(vE,xE);a.onupgradeneeded=()=>wE(a),a.onsuccess=()=>{let s=a.result;if(t==null){let i=s.transaction(Lh,"readonly"),o=i.objectStore(Lh).get(this.modelPath);o.onsuccess=()=>{if(o.result==null)return s.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(o.result.modelArtifacts)},o.onerror=l=>(s.close(),r(o.error)),i.oncomplete=()=>s.close()}else{t.weightData=Jl.join(t.weightData);let i=tx(t),o=s.transaction(Qu,"readwrite"),l=o.objectStore(Qu),h;try{h=l.put({modelPath:this.modelPath,modelArtifactsInfo:i})}catch(p){return r(p)}let c;h.onsuccess=()=>{c=s.transaction(Lh,"readwrite");let p=c.objectStore(Lh),m;try{m=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i})}catch(g){return r(g)}m.onsuccess=()=>n({modelArtifactsInfo:i}),m.onerror=g=>{l=o.objectStore(Qu);let b=l.delete(this.modelPath);b.onsuccess=()=>(s.close(),r(m.error)),b.onerror=v=>(s.close(),r(m.error))}},h.onerror=p=>(s.close(),r(h.error)),o.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}}},a.onerror=s=>r(a.error)})}};id.URL_SCHEME="indexeddb://";var HU=e=>he().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(id.URL_SCHEME)?aie(e.slice(id.URL_SCHEME.length)):null;ni.registerSaveRouter(HU);ni.registerLoadRouter(HU);function aie(e){return new id(e)}function sie(e){return e.startsWith(id.URL_SCHEME)?e.slice(id.URL_SCHEME.length):e}var iie=class{constructor(){this.indexedDB=jU()}async listModels(){return new Promise((e,t)=>{let n=this.indexedDB.open(vE,xE);n.onupgradeneeded=()=>wE(n),n.onsuccess=()=>{let r=n.result,a=r.transaction(Qu,"readonly"),s=a.objectStore(Qu).getAll();s.onsuccess=()=>{let i={};for(let o of s.result)i[o.modelPath]=o.modelArtifactsInfo;e(i)},s.onerror=i=>(r.close(),t(s.error)),a.oncomplete=()=>r.close()},n.onerror=r=>t(n.error)})}async removeModel(e){return e=sie(e),new Promise((t,n)=>{let r=this.indexedDB.open(vE,xE);r.onupgradeneeded=()=>wE(r),r.onsuccess=()=>{let a=r.result,s=a.transaction(Qu,"readwrite"),i=s.objectStore(Qu),o=i.get(e),l;o.onsuccess=()=>{if(o.result==null)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let h=i.delete(e),c=()=>{l=a.transaction(Lh,"readwrite");let p=l.objectStore(Lh).delete(e);p.onsuccess=()=>t(o.result.modelArtifactsInfo),p.onerror=m=>n(o.error)};h.onsuccess=c,h.onerror=p=>(c(),a.close(),n(o.error))}},o.onerror=h=>(a.close(),n(o.error)),s.oncomplete=()=>{l==null?a.close():l.oncomplete=()=>a.close()}},r.onerror=a=>n(r.error)})}},Ml="/",Xf="tensorflowjs_models",GU="info",oie="model_topology",lie="weight_specs",uie="weight_data",cie="model_metadata";function qU(e){return{info:[Xf,e,GU].join(Ml),topology:[Xf,e,oie].join(Ml),weightSpecs:[Xf,e,lie].join(Ml),weightData:[Xf,e,uie].join(Ml),modelMetadata:[Xf,e,cie].join(Ml)}}function KU(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function hie(e){let t=e.split(Ml);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Ml)}function die(e){return e.startsWith(od.URL_SCHEME)?e.slice(od.URL_SCHEME.length):e}var od=class{constructor(e){if(!he().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=qU(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=tx(e),a=Jl.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,qse(a));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch{throw KU(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;let a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){let i=JSON.parse(a);t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,i.signature!=null&&(t.signature=i.signature),i.userDefinedMetadata!=null&&(t.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(t.modelInitializer=i.modelInitializer),i.initializerSignature!=null&&(t.initializerSignature=i.initializerSignature),i.trainingConfig!=null&&(t.trainingConfig=i.trainingConfig)}let s=this.LS.getItem(this.keys.weightData);if(s==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Kse(s),t}};od.URL_SCHEME="localstorage://";var XU=e=>he().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(od.URL_SCHEME)?pie(e.slice(od.URL_SCHEME.length)):null;ni.registerSaveRouter(XU);ni.registerLoadRouter(XU);function pie(e){return new od(e)}var fie=class{constructor(){X(he().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),X(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},t=Xf+Ml,n=Ml+GU;for(let r=0;r<this.LS.length;++r){let a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){let s=hie(a);e[s]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){e=die(e);let t=qU(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return KU(t),n}},rm="://",vc=class zu{constructor(){this.managers={}}static getInstance(){return zu.instance==null&&(zu.instance=new zu),zu.instance}static registerManager(t,n){X(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(rm)&&(t=t.slice(0,t.indexOf(rm))),X(t.length>0,()=>"scheme must not be an empty string.");let r=zu.getInstance();X(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){let n=zu.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(zu.getInstance().managers)}};function D0(e){if(e.indexOf(rm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${vc.getSchemes().join(",")}`);return{scheme:e.split(rm)[0],path:e.split(rm)[1]}}async function YU(e,t,n=!1){X(e!==t,()=>`Old path and new path are the same: '${e}'`);let r=ni.getLoadHandlers(e);X(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),X(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);let a=r[0],s=ni.getSaveHandlers(t);X(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),X(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);let i=s[0],o=D0(e).scheme,l=D0(e).path,h=o===D0(e).scheme,c=await a.load();n&&h&&await vc.getManager(o).removeModel(l);let p=await i.save(c);return n&&!h&&await vc.getManager(o).removeModel(l),p.modelArtifactsInfo}async function mie(){let e=vc.getSchemes(),t={};for(let n of e){let r=await vc.getManager(n).listModels();for(let a in r){let s=n+rm+a;t[s]=r[a]}}return t}async function gie(e){let t=D0(e);return vc.getManager(t.scheme).removeModel(t.path)}async function yie(e,t){return YU(e,t,!1)}async function bie(e,t){return YU(e,t,!0)}var vie=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!he().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let r=this.functionRefs[n.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return TU(e)}};if(he().get("IS_BROWSER")){he().setPlatform("browser",new vie);try{vc.registerManager(od.URL_SCHEME,new fie)}catch{}try{vc.registerManager(id.URL_SCHEME,new iie)}catch{}}var xie={importFetch:()=>pae()},dk,wie=class{constructor(){this.util=fae(),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return he().global.fetch!=null?he().global.fetch(e,t):(dk==null&&(dk=xie.importFetch()),dk(e,t))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}};he().get("IS_NODE")&&!he().get("IS_BROWSER")&&he().setPlatform("node",new wie);function At(e,t="float32",n){return t=t||"float32",Ps(e),new Er(e,t,n)}function _ie(e,t){let n=W(e,"x","cast");if(!fU(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:n},a={dtype:t};return J.runKernel(Fd,r,a)}var ze=te({cast_:_ie});function Sie(e){let t={x:W(e,"x","clone","string_or_numeric")};return J.runKernel(tp,t)}var Uo=te({clone_:Sie});function j2(e,t=!1){console.log(e.toString(t))}MU();var Iie={buffer:At,cast:ze,clone:Uo,print:j2};xse(Iie);function Tie(e,t){let n=W(e,"a","add"),r=W(t,"b","add");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(zc,a)}var Se=te({add_:Tie});function kie(e,t){let n=W(e,"a","floorDiv"),r=W(t,"b","floorDiv");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(Zd,a)}var P1=te({floorDiv_:kie});function Eie(e,t){let n=W(e,"a","div"),r=W(t,"b","div");if([n,r]=tr(n,r),n.dtype==="int32"&&r.dtype==="int32")return P1(n,r);let a={a:n,b:r},s={};return J.runKernel(Gd,a,s)}var Ke=te({div_:Eie});function Nie(e,t){let n=W(e,"a","mul"),r=W(t,"b","mul");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(yp,a)}var re=te({mul_:Nie});function Cie(e){let t=W(e,"x","abs");if(t.dtype==="complex64"){let n={x:t};return J.runKernel(Mv,n)}else{let n={x:t};return J.runKernel(Bm,n)}}var Tr=te({abs_:Cie});function Aie(e){let t={x:W(e,"x","acos")};return J.runKernel(kd,t)}var H2=te({acos_:Aie});function Rie(e){let t={x:W(e,"x","acosh")};return J.runKernel(Ed,t)}var G2=te({acosh_:Rie});function Die(e){X(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),X(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);let t=e.map((a,s)=>W(a,`tensors${s}`,"addN")),n=t[0];t.forEach(a=>{if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(a=>{if(!Zl(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let r=t;return J.runKernel(Nd,r)}var QU=te({addN_:Die});function Mie(e,t=null,n=!1){let r={x:W(e,"x","all","bool")},a={axis:t,keepDims:n};return J.runKernel(Wm,r,a)}var L1=te({all_:Mie});function $ie(e,t=null,n=!1){let r={x:W(e,"x","any","bool")},a={axis:t,keepDims:n};return J.runKernel(jm,r,a)}var Jb=te({any_:$ie});function Oie(e,t=0){let n={x:W(e,"x","argMax")},r={axis:t};return J.runKernel(Hm,n,r)}var ld=te({argMax_:Oie});function Fie(e,t=0){let n={x:W(e,"x","argMin")},r={axis:t};return J.runKernel(Gm,n,r)}var q2=te({argMin_:Fie});function Pie(e){let t={x:W(e,"x","asin")};return J.runKernel(Cd,t)}var K2=te({asin_:Pie});function Lie(e){let t={x:W(e,"x","asinh")};return J.runKernel(Ad,t)}var X2=te({asinh_:Lie});function zie(e){let t={x:W(e,"x","atan")};return J.runKernel(Rd,t)}var Y2=te({atan_:zie});function Vie(e,t){let n=W(e,"a","atan2"),r=W(t,"b","atan2");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(Md,a)}var Q2=te({atan2_:Vie});function Uie(e){let t={x:W(e,"x","atanh")};return J.runKernel(Dd,t)}var Z2=te({atanh_:Uie});function Bie(e,t,n,r,a="NHWC",s){let i=e[3],o=[...t,i],l=eB(a);return nx(e,o,n,s,r,null,null,l)}function ZU(e,t,n,r,a,s,i="channelsLast"){let[o,l]=ev(t),h;if(i==="channelsLast")h=[o,l,e[3],e[3]];else if(i==="channelsFirst")h=[o,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return nx(e,h,n,r,a,s,!1,i)}function Wie(e,t,n,r,a,s,i="NDHWC"){let[o,l,h]=_E(t),c,p;if(i==="NDHWC")p="channelsLast",c=[o,l,h,e[4],e[4]];else if(i==="NCDHW")p="channelsFirst",c=[o,l,h,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return JU(e,c,n,r,a,!1,p,s)}function nx(e,t,n,r,a,s,i=!1,o="channelsLast"){let[l,h,c,p]=[-1,-1,-1,-1];if(o==="channelsLast")[l,h,c,p]=e;else if(o==="channelsFirst")[l,p,h,c]=e;else throw new Error(`Unknown dataFormat ${o}`);let[m,g,,b]=t,[v,x]=ev(n),[_,I]=ev(r),k=am(m,_),E=am(g,I),{padInfo:R,outHeight:U,outWidth:D}=Gie(a,h,c,v,x,k,E,s,o),C=i?b*p:b,O;return o==="channelsFirst"?O=[l,C,U,D]:o==="channelsLast"&&(O=[l,U,D,C]),{batchSize:l,dataFormat:o,inHeight:h,inWidth:c,inChannels:p,outHeight:U,outWidth:D,outChannels:C,padInfo:R,strideHeight:v,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:k,effectiveFilterWidth:E,dilationHeight:_,dilationWidth:I,inShape:e,outShape:O,filterShape:t}}function JU(e,t,n,r,a,s=!1,i="channelsLast",o){let[l,h,c,p,m]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,h,c,p,m]=e;else if(i==="channelsFirst")[l,m,h,c,p]=e;else throw new Error(`Unknown dataFormat ${i}`);let[g,b,v,,x]=t,[_,I,k]=_E(n),[E,R,U]=_E(r),D=am(g,E),C=am(b,R),O=am(v,U),{padInfo:z,outDepth:M,outHeight:N,outWidth:P}=qie(a,h,c,p,_,I,k,D,C,O,o),Q=s?x*m:x,ee;return i==="channelsFirst"?ee=[l,Q,M,N,P]:i==="channelsLast"&&(ee=[l,M,N,P,Q]),{batchSize:l,dataFormat:i,inDepth:h,inHeight:c,inWidth:p,inChannels:m,outDepth:M,outHeight:N,outWidth:P,outChannels:Q,padInfo:z,strideDepth:_,strideHeight:I,strideWidth:k,filterDepth:g,filterHeight:b,filterWidth:v,effectiveFilterDepth:D,effectiveFilterHeight:C,effectiveFilterWidth:O,dilationDepth:E,dilationHeight:R,dilationWidth:U,inShape:e,outShape:ee,filterShape:t}}function jie(e,t,n,r,a){r==null&&(r=J2(e,t,n));let s=e[0],i=e[1],o=tv((s-t+2*r)/n+1,a),l=tv((i-t+2*r)/n+1,a);return[o,l]}function Hie(e,t,n,r,a,s){a==null&&(a=J2(e,t[0],r[0]));let i=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*a>=t[o]&&(i[o]=tv((e[o]-t[o]+2*a)/r[o]+1,s));return i}function J2(e,t,n,r=1){let a=am(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function ev(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function _E(e){return typeof e=="number"?[e,e,e]:e}function am(e,t){return t<=1?e:e+(e-1)*(t-1)}function Gie(e,t,n,r,a,s,i,o,l){let h,c,p;if(typeof e=="number"){h={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};let m=jie([t,n],s,r,e,o);c=m[0],p=m[1]}else if(e==="same"){c=Math.ceil(t/r),p=Math.ceil(n/a);let m=Math.max(0,(c-1)*r+s-t),g=Math.max(0,(p-1)*a+i-n),b=Math.floor(m/2),v=m-b,x=Math.floor(g/2),_=g-x;h={top:b,bottom:v,left:x,right:_,type:"SAME"}}else if(e==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),p=Math.ceil((n-i+1)/a);else if(typeof e=="object"){let m=l==="channelsLast"?e[1][0]:e[2][0],g=l==="channelsLast"?e[1][1]:e[2][1],b=l==="channelsLast"?e[2][0]:e[3][0],v=l==="channelsLast"?e[2][1]:e[3][1];h={top:m,bottom:g,left:b,right:v,type:m===0&&g===0&&b===0&&v===0?"VALID":"EXPLICIT"},c=tv((t-s+m+g)/r+1,o),p=tv((n-i+b+v)/a+1,o)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outHeight:c,outWidth:p}}function qie(e,t,n,r,a,s,i,o,l,h,c){let p,m,g,b;if(e==="valid"&&(e=0),typeof e=="number"){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};let v=Hie([t,n,r,1],[o,l,h],1,[a,s,i],e,c);m=v[0],g=v[1],b=v[2]}else if(e==="same"){m=Math.ceil(t/a),g=Math.ceil(n/s),b=Math.ceil(r/i);let v=(m-1)*a+o-t,x=(g-1)*s+l-n,_=(b-1)*i+h-r,I=Math.floor(v/2),k=v-I,E=Math.floor(x/2),R=x-E,U=Math.floor(_/2),D=_-U;p={top:E,bottom:R,left:U,right:D,front:I,back:k,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:p,outDepth:m,outHeight:g,outWidth:b}}function tv(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function xc(e){let[t,n,r]=ev(e);return t===1&&n===1&&r===1}function Zo(e,t){return xc(e)||xc(t)}function ud(e){return ev(e).every(t=>t>0)}function eB(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Ka(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")X(pm(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(a=>{X(pm(a),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${a}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}function Kie(e,t){let n={x:W(e,"x","reshape","string_or_numeric")},r={shape:t};return J.runKernel(kg,n,r)}var ie=te({reshape_:Kie});function Xie(e,t,n,r,a){let s=W(e,"x","avgPool","float32"),i=1;X(Zo(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let o=s,l=!1;s.rank===3&&(l=!0,o=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(o.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),Ka("avgPool",r,a);let h={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},p=J.runKernel($d,h,c);return p=ze(p,s.dtype),l?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var eu=te({avgPool_:Xie});function Yie(e,t,n,r,a,s="NDHWC"){let i=W(e,"x","avgPool3d","float32"),o=i,l=!1;i.rank===4&&(l=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(o.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),X(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),X(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ka("avgPool3d",r,a);let h={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},p=J.runKernel(qm,h,c);return p=ze(p,o.dtype),l?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var eC=te({avgPool3d_:Yie});function Qie(e,t=0){X(e.length>=1,()=>"Pass at least one tensor to concat");let n=Zb(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return Uo(n[0]);let r=n,a={axis:t};return J.runKernel(Qm,r,a)}var Sn=te({concat_:Qie});function Zie(e,t,n=!1,r=!1){let a=W(e,"a","matMul"),s=W(t,"b","matMul");[a,s]=tr(a,s);let i={a,b:s},o={transposeA:n,transposeB:r};return J.runKernel(Od,i,o)}var Nt=te({matMul_:Zie});function Jie(e){let t={x:W(e,"x","sigmoid","float32")};return J.runKernel(Op,t)}var Ti=te({sigmoid_:Jie});function eoe(e,t,n){let r=W(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},s={begin:t,size:n};return J.runKernel(Mg,a,s)}var Pt=te({slice_:eoe});function toe(e){let t={x:W(e,"x","tanh","float32")};return J.runKernel(Wp,t)}var wc=te({tanh_:toe});function noe(e,t,n,r,a,s){let i=W(e,"forgetBias","basicLSTMCell"),o=W(t,"lstmKernel","basicLSTMCell"),l=W(n,"lstmBias","basicLSTMCell"),h=W(r,"data","basicLSTMCell"),c=W(a,"c","basicLSTMCell"),p=W(s,"h","basicLSTMCell"),m=Sn([h,p],1),g=Nt(m,o),b=Se(g,l),v=b.shape[0],x=b.shape[1]/4,_=[v,x],I=Pt(b,[0,0],_),k=Pt(b,[0,x],_),E=Pt(b,[0,x*2],_),R=Pt(b,[0,x*3],_),U=Se(re(Ti(I),wc(k)),re(c,Ti(Se(i,E)))),D=re(wc(U),Ti(R));return[U,D]}var tB=te({basicLSTMCell_:noe});function roe(e,t,n){let r=W(e,"x","batchToSpaceND"),a=t.reduce((o,l)=>o*l);X(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),X(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),X(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`);let s={x:r},i={blockShape:t,crops:n};return J.runKernel(Km,s,i)}var rx=te({batchToSpaceND_:roe});function aoe(e){let t;return e.rank===0||e.rank===1?t=ie(e,[1,1,1,e.size]):e.rank===2?t=ie(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}function soe(e,t,n,r,a,s){s==null&&(s=.001);let i=W(e,"x","batchNorm"),o=W(t,"mean","batchNorm"),l=W(n,"variance","batchNorm"),h;a!=null&&(h=W(a,"scale","batchNorm"));let c;r!=null&&(c=W(r,"offset","batchNorm")),X(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),X(c==null||o.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),X(h==null||o.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:aoe(i),scale:h,offset:c,mean:o,variance:l},m={varianceEpsilon:s},g=J.runKernel(Jd,p,m);return ie(g,i.shape)}var jp=te({batchNorm_:soe});function ioe(e,t,n,r,a,s){let i=W(e,"x","batchNorm"),o=W(t,"mean","batchNorm"),l=W(n,"variance","batchNorm"),h;a!=null&&(h=W(a,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),X(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),X(o.rank===2||o.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`),X(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),h!=null&&X(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),c!=null&&X(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),jp(i,o,l,c,h,s)}var tC=te({batchNorm2d_:ioe});function ooe(e,t,n,r,a,s){let i=W(e,"x","batchNorm"),o=W(t,"mean","batchNorm"),l=W(n,"variance","batchNorm"),h;a!=null&&(h=W(a,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),X(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),X(o.rank===3||o.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`),X(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),h!=null&&X(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),c!=null&&X(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),jp(i,o,l,c,h,s)}var nC=te({batchNorm3d_:ooe});function loe(e,t,n,r,a,s){let i=W(e,"x","batchNorm"),o=W(t,"mean","batchNorm"),l=W(n,"variance","batchNorm"),h;a!=null&&(h=W(a,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),X(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),X(o.rank===4||o.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`),X(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),h!=null&&X(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),c!=null&&X(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),jp(i,o,l,c,h,s)}var rC=te({batchNorm4d_:loe});function uoe(e,t,n){let r=W(e,"x","bincount"),a=W(t,"weights","bincount");X(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),X(n>=0,()=>`size must be non-negative, but got ${n}.`),X(a.size===r.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`);let s={x:r,weights:a},i={size:n};return J.runKernel(Xm,s,i)}var aC=te({bincount_:uoe});function coe(e,t){let n=W(e,"x","bitwiseAnd"),r=W(t,"y","bitwiseAnd");if(!Zl(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);let a={a:n,b:r};return J.runKernel(Ym,a)}var nB=te({bitwiseAnd_:coe});function hoe(e,t){let n=W(e,"s0","broadcastArgs","int32"),r=W(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);let a={s0:n,s1:r};return J.runKernel(Dv,a)}var rB=te({broadcastArgs_:hoe});function doe(e,t){let n=W(e,"broadcastTo","x"),r=n.shape;if(Ps(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=ie(n,l)}let a=n.shape,s=Array.from(t);for(let l=t.length-1;l>=0;l--)if(a[l]===t[l])s[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((l,h)=>l>1?h:-1).filter(l=>l>=0).length===0)return Uo(n);let i={x:n},o={reps:s};return J.runKernel(Uc,i,o)}var Wh=te({broadcastTo_:doe});function poe(e){let t={x:W(e,"x","ceil","float32")};return J.runKernel(Pd,t)}var sC=te({ceil_:poe});function Ds(e,t,n){Ps(e),n=n||Cv(t);let r={shape:e,value:t,dtype:n};return J.runKernel(Fv,{},r)}function foe(e,t,n){let r=W(e,"x","clipByValue");if(X(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return Ds(r.shape,t,r.dtype);let a={x:r},s={clipValueMin:t,clipValueMax:n};return J.runKernel(Vc,a,s)}var ka=te({clipByValue_:foe});function moe(e){return Sn(e,0)}var iC=te({concat1d_:moe});function goe(e,t){return Sn(e,t)}var oC=te({concat2d_:goe});function yoe(e,t){return Sn(e,t)}var lC=te({concat3d_:yoe});function boe(e,t){return Sn(e,t)}var uC=te({concat4d_:boe});function voe(e,t,n,r,a="NHWC",s=[1,1],i){let o=W(e,"x","conv2d","float32"),l=W(t,"filter","conv2d","float32"),h=o,c=!1;o.rank===3&&(c=!0,h=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),X(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ka("conv2d",r,i);let p=a==="NHWC"?h.shape[3]:h.shape[1];X(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),X(Zo(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),X(ud(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),X(ud(n),()=>"Error in conv2D: Strides should be larger than 0.");let m={x:h,filter:l},g={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i},b=J.runKernel(Ld,m,g);return c?ie(b,[b.shape[1],b.shape[2],b.shape[3]]):b}var ja=te({conv2d_:voe});function xoe(e,t,n,r,a="NWC",s=1,i){let o=W(e,"x","conv1d"),l=W(t,"filter","conv1d"),h=o,c=!1;o.rank===2&&(c=!0,h=ie(o,[1,o.shape[0],o.shape[1]])),X(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),X(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ka("conv1d",r,i),X(h.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${l.shape[1]}.`),X(Zo(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),X(ud(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),X(ud(n),()=>"Error in conv1D: Stride should be larger than 0."),X(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let p=ie(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=ie(h,[h.shape[0],1,h.shape[1],h.shape[2]]),g=ja(m,p,[1,n],r,"NHWC",[1,s],i);return c?ie(g,[g.shape[2],g.shape[3]]):ie(g,[g.shape[0],g.shape[2],g.shape[3]])}var z1=te({conv1d_:xoe});function woe(e,t,n,r,a,s="NHWC",i){X(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let o=e,l=t,h=!1;t.rank===3&&(h=!0,l=ie(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),X(o.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),X(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),X(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);let c=s==="NHWC"?o[3]:o[1],p=s==="NHWC"?l.shape[3]:l.shape[1];X(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),X(p===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${n.shape[3]}.`),Ka("conv2dDerInput",a,i);let m={dy:l,filter:n},g={strides:r,pad:a,dataFormat:s,dimRoundingMode:i,inputShape:o},b=J.runKernel(zd,m,g);return h?ie(b,[b.shape[1],b.shape[2],b.shape[3]]):b}var cC=te({conv2DBackpropInput_:woe});function _oe(e,t,n,r,a,s){let i=W(e,"x","conv2dTranspose"),o=W(t,"filter","conv2dTranspose");return cC(n,i,o,r,a,"NHWC",s)}var V1=te({conv2dTranspose_:_oe});function Soe(e,t,n,r,a="NDHWC",s=[1,1,1]){let i=W(e,"x","conv3d"),o=W(t,"filter","conv3d"),l=i,h=!1;i.rank===4&&(h=!0,l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),X(o.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),X(l.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`),X(Zo(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),X(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`),X(ud(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),X(ud(n),()=>"Error in conv3D: Strides should be larger than 0.");let c={x:l,filter:o},p={strides:n,pad:r,dataFormat:a,dilations:s},m=J.runKernel(Vd,c,p);return h?ie(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var hC=te({conv3d_:Soe});function Ioe(e,t,n,r,a){X(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,i=t,o=!1;t.rank===4&&(o=!0,i=ie(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);let l=s[4],h=i.shape[4];X(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),X(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),X(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),X(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),X(h===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[4]}.`);let c={dy:i,filter:n},p={pad:a,strides:r,inputShape:s},m=J.runKernel(Jm,c,p);return o?ie(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var aB=te({conv3DBackpropInput_:Ioe});function Toe(e,t,n,r,a){let s=W(e,"x","conv3dTranspose"),i=W(t,"filter","conv3dTranspose");return aB(n,s,i,r,a)}var dC=te({conv3dTranspose_:Toe});function koe(e){let t={x:W(e,"x","cos","float32")};return J.runKernel(Ud,t)}var ax=te({cos_:koe});function Eoe(e){let t={x:W(e,"x","cosh","float32")};return J.runKernel(Bd,t)}var U1=te({cosh_:Eoe});function Noe(e,t=0,n=!1,r=!1){let a={x:W(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:r};return J.runKernel(eg,a,s)}var nv=te({cumprod_:Noe});function Coe(e,t=0,n=!1,r=!1){let a={x:W(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:r};return J.runKernel(Wd,a,s)}var B1=te({cumsum_:Coe});function Aoe(e,t,n,r=!1){let a=W(e,"x","denseBincount"),s=W(t,"weights","denseBincount");X(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),X(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),X(n>=0,()=>`size must be non-negative, but got ${n}.`),X(s.size===a.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${s.shape}.`);let i={x:a,weights:s},o={size:n,binaryOutput:r};return J.runKernel($v,i,o)}var m_=te({denseBincount_:Aoe});function Roe(e,t,n="NHWC"){let r=W(e,"x","depthToSpace","float32"),a=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],i=n==="NHWC"?r.shape[3]:r.shape[1];X(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),X(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t}  for depthToSpace with input shape
    ${r.shape}`),X(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),X(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${r.shape}`);let o={x:r},l={blockSize:t,dataFormat:n};return J.runKernel(ng,o,l)}var pC=te({depthToSpace_:Roe});function Doe(e,t,n,r,a="NHWC",s=[1,1],i){let o=W(e,"x","depthwiseConv2d","float32"),l=W(t,"filter","depthwiseConv2d","float32"),h=o,c=!1;o.rank===3&&(c=!0,h=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),X(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let p=a==="NHWC"?h.shape[3]:h.shape[1];X(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ka("depthwiseConv2d",r,i);let m={x:h,filter:l},g={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i},b=J.runKernel(jd,m,g);return c?ie(b,[b.shape[1],b.shape[2],b.shape[3]]):b}var Hp=te({depthwiseConv2d_:Doe});function Moe(e){let t={x:W(e,"x","diag")};return J.runKernel(Ov,t)}var sB=te({diag_:Moe});function $oe(e,t,n,r,a=[1,1],s="NHWC"){let i=W(e,"x","dilation2d"),o=W(t,"filter","dilation2d");X(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),X(o.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),X(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=i,h=!1;i.rank===3&&(l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]),h=!0),X(l.shape[3]===o.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`);let c={x:l,filter:o},p={strides:n,pad:r,dilations:a},m=J.runKernel(Hd,c,p);return h?ie(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var fC=te({dilation2d_:$oe}),jg={};_t(jg,{assertAndGetBroadcastShape:()=>In,getBroadcastDims:()=>iB,getReductionAxes:()=>Cr});function iB(e,t){let n=e.length,r=[];for(let a=0;a<n;a++){let s=n-1-a,i=e[s]||1;(t[t.length-1-a]||1)>1&&i===1&&r.unshift(s)}return r}function Cr(e,t){let n=[];for(let r=0;r<t.length;r++){let a=e[e.length-r-1],s=t.length-r-1,i=t[s];(a==null||a===1&&i>1)&&n.unshift(s)}return n}function In(e,t){let n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let s=e[e.length-a-1];s==null&&(s=1);let i=t[t.length-a-1];if(i==null&&(i=1),s===1)r[n-a-1]=i;else if(i===1)r[n-a-1]=s;else if(s!==i){let o=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(o)}else r[n-a-1]=s}return r}function Ooe(e,t){let n=W(e,"a","equal","string_or_numeric"),r=W(t,"b","equal","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(ag,a)}var Ms=te({equal_:Ooe});function Foe(e,t,n){let r=W(t,"a","where"),a=W(n,"b","where"),s=W(e,"condition","where","bool"),i=In(In(s.shape,r.shape),a.shape),o=Wh(s,i),l=Wh(r,i),h=Wh(a,i),c={condition:o,t:l,e:h};return J.runKernel(Dg,c)}var ra=te({where_:Foe});function Poe(e){let t={x:W(e,"x","zerosLike")};return J.runKernel(Bg,t)}var Ut=te({zerosLike_:Poe});function Loe(e,t){let n=W(e,"a","div"),r=W(t,"b","div");[n,r]=tr(n,r);let a=Ke(n,r),s=Ut(a),i=Ms(r,s);return ra(i,s,a)}var mC=te({divNoNan_:Loe});function zoe(e,t){let n=W(e,"t1","dot"),r=W(t,"t2","dot");X((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);let a=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(X(a===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${s}.`),n.rank===1&&r.rank===1){let i=ie(n,[1,-1]),o=ie(r,[-1,1]),l=Nt(i,o);return ie(l,[])}else if(n.rank===1&&r.rank===2){let i=ie(n,[1,-1]),o=ie(r,[r.shape[0],r.shape[1]]),l=Nt(i,o);return ie(l,[l.size])}else if(n.rank===2&&r.rank===1){let i=ie(r,[-1,1]),o=Nt(n,i);return ie(o,[o.size])}else{let i=ie(r,[r.shape[0],r.shape[1]]);return Nt(n,i)}}var gC=te({dot_:zoe});function Voe(e,...t){let n=t.map((a,s)=>W(a,`tensors${s}`,"einsum")),r={equation:e};return J.runKernel(k1,n,r)}var Dh=te({einsum_:Voe});function Uoe(e){let t={x:W(e,"x","elu","float32")};return J.runKernel(qd,t)}var Hg=te({elu_:Uoe});function Boe(e,t){let n=W(e,"x","ensureShape","string_or_numeric");if(!cU(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}var oB=te({ensureShape_:Boe});function Woe(e){let t=W(e,"x","erf");X(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=ze(t,"float32"));let n={x:t};return J.runKernel(Kd,n)}var W1=te({erf_:Woe});function yC(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function lB(e,t,n){let r=e.length+t.length,a=[],s=0,i=0;for(let o=0;o<r;o++)n.indexOf(o)===-1?a.push(e[s++]):a.push(t[i++]);return a}function uB(e,t){let n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);let a=t.map(s=>e[s]);return[n,a]}function cd(e,t){let n=t.map(r=>1);return lB(e,n,t)}function joe(e,t,n){X(yC(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function cB(e,t){if(yC(e,t))return null;let n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function bC(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function Hoe(e,t){let n=[];for(let r=t-e;r<t;++r)n.push(r);return n}function Goe(e,t=null,n=!1){let r={x:W(e,"x","max")},a={reductionIndices:t,keepDims:n};return J.runKernel(up,r,a)}var ei=te({max_:Goe});function qoe(e,t=null,n=!1){let r={x:W(e,"x","min")},a={axis:t,keepDims:n};return J.runKernel(pp,r,a)}var ym=te({min_:qoe});function Koe(e,t){let n=W(e,"base","pow"),r=W(t,"exp","pow");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(xp,a)}var qo=te({pow_:Koe});function rt(e,t){if((Jr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Jr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Wc(e,[],[],t)}function Xoe(e){let t={x:W(e,"x","sqrt","float32")};return J.runKernel(Pp,t)}var aa=te({sqrt_:Xoe});function Yoe(e){let t=W(e,"x","square"),n={};return J.runKernel("Square",{x:t},n)}var _n=te({square_:Yoe});function Qoe(e,t=null,n=!1){let r=W(e,"x","sum");r.dtype==="bool"&&(r=ze(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return J.runKernel(Lp,a,s)}var Ye=te({sum_:Qoe});function Zoe(e,t="euclidean",n=null,r=!1){e=W(e,"x","norm");let a=hB(e,t,n),s=a.shape;if(r){let i=Ni(n,e.shape);s=cd(a.shape,i)}return ie(a,s)}function hB(e,t,n=null){if(e.rank===0)return Tr(e);if(e.rank!==1&&n===null)return hB(ie(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return Ye(Tr(e),n);if(t===1/0)return ei(Tr(e),n);if(t===-1/0)return ym(Tr(e),n);if(t==="euclidean"||t===2)return aa(Ye(qo(Tr(e),rt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return ei(Ye(Tr(e),n[0]),n[1]-1);if(t===1/0)return ei(Ye(Tr(e),n[1]),n[0]);if(t===-1/0)return ym(Ye(Tr(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return aa(Ye(_n(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}var Gg=te({norm_:Zoe});function Joe(e,t=null,n=!1){return Gg(e,"euclidean",t,n)}var vC=te({euclideanNorm_:Joe});function ele(e){let t={x:W(e,"x","exp")};return J.runKernel(Xd,t)}var Ea=te({exp_:ele});function tle(e,t=0){let n=W(e,"x","expandDims","string_or_numeric");X(t<=n.rank,()=>"Axis must be <= rank of the tensor");let r={input:n},a={dim:t};return J.runKernel(sg,r,a)}var ea=te({expandDims_:tle});function nle(e){let t={x:W(e,"x","expm1")};return J.runKernel(Yd,t)}var xC=te({expm1_:nle});function rle(e,t){let n=W(e,"x","tile","string_or_numeric");X(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);let r={x:n},a={reps:t};return J.runKernel(Uc,r,a)}var Rs=te({tile_:rle});function ale(e,t,n,r="float32"){t==null&&(t=e);let a=At([e,t],r),s=e<=t?e:t;for(let o=0;o<s;++o)a.set(1,o,o);let i=ie(a.toTensor(),[e,t]);if(n==null)return i;if(n.length===1)return Rs(ea(i,0),[n[0],1,1]);if(n.length===2)return Rs(ea(ea(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return Rs(ea(ea(ea(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}var j1=te({eye_:ale});function sle(e){let t={x:W(e,"x","floor","float32")};return J.runKernel(Qd,t)}var qg=te({floor_:sle});function ile(e,t,n=0,r=0){let a=W(e,"x","gather"),s=W(t,"indices","gather","int32"),i={x:a,indices:s},o={axis:n,batchDims:r};return J.runKernel(og,i,o)}var Kg=te({gather_:ile});function ole(e,t){let n=W(e,"a","greater","string_or_numeric"),r=W(t,"b","greater","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(ug,a)}var Xa=te({greater_:ole});function lle(e,t){let n=W(e,"a","greaterEqual","string_or_numeric"),r=W(t,"b","greaterEqual","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(ep,a)}var tu=te({greaterEqual_:lle});function ule(e){let t={input:W(e,"input","imag")};return J.runKernel(C1,t)}var sx=te({imag_:ule});function cle(e){let t={x:W(e,"x","isFinite")};return J.runKernel(np,t)}var wC=te({isFinite_:cle});function hle(e){let t={x:W(e,"x","isInf")};return J.runKernel(rp,t)}var _C=te({isInf_:hle});function dle(e){let t={x:W(e,"x","isNaN")};return J.runKernel(ap,t)}var SC=te({isNaN_:dle});function ple(e,t=.2){let n={x:W(e,"x","leakyRelu")},r={alpha:t};return J.runKernel(sp,n,r)}var ix=te({leakyRelu_:ple});function fle(e,t){let n=W(e,"a","less","string_or_numeric"),r=W(t,"b","less","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(cg,a)}var bm=te({less_:fle});function mle(e,t){let n=W(e,"a","lessEqual","string_or_numeric"),r=W(t,"b","lessEqual","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(hg,a)}var jc=te({lessEqual_:mle});function dB(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");let r={start:e,stop:t,num:n};return J.runKernel(dg,{},r)}function gle(e,t=5,n=1,r=1,a=.5){let s=W(e,"x","localResponseNormalization");X(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),X(pm(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=s,o=!1;s.rank===3&&(o=!0,i=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let l={x:i},h={depthRadius:t,bias:n,alpha:r,beta:a},c=J.runKernel(lp,l,h);return o?ie(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var IC=te({localResponseNormalization_:gle});function yle(e){let t={x:W(e,"x","log","float32")};return J.runKernel(ip,t)}var $s=te({log_:yle});function ble(e){let t={x:W(e,"x","log1p")};return J.runKernel(op,t)}var ox=te({log1p_:ble});function vle(e){return X(gc(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{let r=W(t,"x","tf.grad","string_or_numeric"),a=n!=null?W(n,"dy","tf.grad"):null;return J.tidy(()=>{let{value:s,grads:i}=J.gradients(()=>e(r),[r],a);return a!=null&&qa(s.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),H1(i),i[0]})}}function xle(e){return X(gc(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{X(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");let r=Zb(t,"args","tf.grads","string_or_numeric"),a=n!=null?W(n,"dy","tf.grads"):null;return J.tidy(()=>{let{value:s,grads:i}=J.gradients(()=>e(...r),r,a);return a!=null&&qa(s.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),H1(i),i})}}function wle(e){return X(gc(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{X(t instanceof Tt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),X(n==null||n instanceof Tt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");let{grads:r,value:a}=J.gradients(()=>e(t),[t],n);return H1(r),{grad:r[0],value:a}}}function _le(e){return X(gc(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{X(Array.isArray(t)&&t.every(a=>a instanceof Tt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),X(n==null||n instanceof Tt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");let r=J.gradients(()=>e(...t),t,n);return n!=null&&qa(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),H1(r.grads),r}}function pB(e,t){X(gc(e),()=>"The f passed in variableGrads(f) must be a function"),X(t==null||Array.isArray(t)&&t.every(h=>h instanceof ad),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let n=t!=null;if(!n){t=[];for(let h in J.registeredVariables)t.push(J.registeredVariables[h])}let r=n?t.filter(h=>!h.trainable):null,a=t.length;t=t.filter(h=>h.trainable),X(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let s=!0,{value:i,grads:o}=J.gradients(e,t,null,s);X(o.some(h=>h!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),X(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let l={};return t.forEach((h,c)=>{o[c]!=null&&(l[h.name]=o[c])}),r?.forEach(h=>l[h.name]=null),{value:i,grads:l}}function Ko(e){return J.customGrad(e)}function H1(e){if(e.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Sle(e){let t={x:W(e,"x","neg")};return J.runKernel(vg,t)}var Mn=te({neg_:Sle});function Ile(e){let t={x:W(e,"x","softplus")};return J.runKernel(Fp,t)}var Gp=te({softplus_:Ile});function Tle(e){let t=W(e,"x","logSigmoid");return Ko(n=>({value:Mn(Gp(Mn(n))),gradFunc:r=>re(r,Ti(Mn(n)))}))(t)}var TC=te({logSigmoid_:Tle});function kle(e,t){let n=W(e,"a","sub"),r=W(t,"b","sub");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(Up,a)}var Ge=te({sub_:kle});function Ele(e,t=-1){let n=W(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Ko((r,a)=>{let s=ei(r,t,!0),i=Ge(r,s),o=Ge(ze(i,"float32"),$s(Ye(Ea(i),t,!0)));return a([o]),{value:o,gradFunc:(l,h)=>{let[c]=h,p=!0,m=Ea(c);return Ge(l,re(Ye(l,t,p),m))}}})(n)}var G1=te({logSoftmax_:Ele});function Nle(e,t=null,n=!1){let r=W(e,"x","logSumExp"),a=Ni(t,r.shape),s=ei(r,a,!0),i=Ge(r,s),o=Ea(i),l=Ye(o,a),h=$s(l),c=Se(ie(s,h.shape),h);if(n){let p=cd(c.shape,a);return ie(c,p)}return c}var lx=te({logSumExp_:Nle});function Cle(e,t){let n=W(e,"a","logicalAnd","bool"),r=W(t,"b","logicalAnd","bool");In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(pg,a)}var Ei=te({logicalAnd_:Cle});function Ale(e){let t={x:W(e,"x","logicalNot","bool")};return J.runKernel(fg,t)}var ux=te({logicalNot_:Ale});function Rle(e,t){let n=W(e,"a","logicalOr","bool"),r=W(t,"b","logicalOr","bool");In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(mg,a)}var q1=te({logicalOr_:Rle});function Dle(e,t){let n=W(e,"a","logicalXor","bool"),r=W(t,"b","logicalXor","bool");return In(n.shape,r.shape),Ei(q1(e,t),ux(Ei(e,t)))}var kC=te({logicalXor_:Dle}),r0=2147483648;function Mle(e,t,n="left"){let r=W(e,"sortedSequence","searchSorted"),a=W(t,"values","searchSorted"),s=r.shape[r.shape.length-1],i=a.shape[a.shape.length-1],o=ie(r,[-1,s]),l=ie(a,[-1,i]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(gn(l.shape)>=r0)throw new Error(`values tensor size must less than ${r0}`);if(o.shape[1]>=r0)throw new Error(`trailing dim_size must less than ${r0} for int32 output type, was ${o.shape[1]}`);let h={sortedSequence:o,values:l},c={side:n};return J.runKernel(Rg,h,c)}var K1=te({searchSorted_:Mle});function fB(e,t){return K1(e,t,"left")}function $le(e,t,n,r,a){let s=W(e,"x","maxPool"),i=1,o=s,l=!1;s.rank===3&&(l=!0,o=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(o.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),X(Zo(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Ka("maxPool",r,a);let h={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},p=J.runKernel(hp,h,c);return l?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Qr=te({maxPool_:$le});function Ole(e,t=[1,1,1],n,r,a,s="NDHWC"){let i=W(e,"x","maxPool3d"),o=i,l=!1;i.rank===4&&(l=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(o.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),X(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Ka("maxPool3d",r,a);let h={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},p=J.runKernel(yg,h,c);return l?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var EC=te({maxPool3d_:Ole});function Fle(e,t,n,r,a=!1){let s={x:W(e,"x","maxPoolWithArgmax")},i={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},o=J.runKernel(zv,s,i);return{result:o[0],indexes:o[1]}}var mB=te({maxPoolWithArgmax_:Fle});function Ple(e,t){let n=W(e,"a","maximum"),r=W(t,"b","maximum");[n,r]=tr(n,r),n.dtype==="bool"&&(n=ze(n,"int32"),r=ze(r,"int32")),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(cp,a)}var Jo=te({maximum_:Ple});function Lle(e,t=null,n=!1){let r={x:W(e,"x","mean")},a={axis:t,keepDims:n};return J.runKernel(dp,r,a)}var Qn=te({mean_:Lle});function Zn(e,t="float32"){if(Ps(e),t==="complex64"){let r=Zn(e,"float32"),a=Zn(e,"float32");return Kl(r,a)}let n=v1(gn(e),t);return J.makeTensor(n,e,t)}function as(e,t="float32"){if(Ps(e),t==="complex64"){let r=as(e,"float32"),a=Zn(e,"float32");return Kl(r,a)}let n=$2(gn(e),t);return J.makeTensor(n,e,t)}function gB(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=W(e,"x","meshgrid",e instanceof Tt?e.dtype:"float32");if(t===void 0)return[r];let a=W(t,"y","meshgrid",t instanceof Tt?t.dtype:"float32"),s=gn(r.shape),i=gn(a.shape);return n==="xy"?(r=ie(r,[1,-1]),a=ie(a,[-1,1]),[Nt(as([i,1],r.dtype),r),Nt(a,as([1,s],a.dtype))]):(r=ie(r,[-1,1]),a=ie(a,[1,-1]),[Nt(r,as([1,i],r.dtype)),Nt(as([s,1],a.dtype),a)])}function zle(e,t){let n=W(e,"a","minimum"),r=W(t,"b","minimum");[n,r]=tr(n,r),n.dtype==="bool"&&(n=ze(n,"int32"),r=ze(r,"int32")),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(fp,a)}var _c=te({minimum_:zle});function Vle(e,t,n){X(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);let r=W(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");X(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let a=n==="reflect"?1:0;for(let o=0;o<r.rank;o++)X(t[o].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),X(t[o][0]>=0&&t[o][0]<=r.shape[o]-a&&t[o][1]>=0&&t[o][1]<=r.shape[o]-a,()=>`Padding in dimension ${o} cannot be greater than or equal to ${r.shape[o]-a} or less than 0 for input of shape ${r.shape}`);let s={paddings:t,mode:n},i={x:r};return J.runKernel(mp,i,s)}var NC=te({mirrorPad_:Vle});function Ule(e,t){let n=W(e,"a","mod"),r=W(t,"b","mod");[n,r]=tr(n,r);let a={a:n,b:r};return J.runKernel(gp,a)}var CC=te({mod_:Ule});function Ble(e,t=null,n=!1){e=W(e,"x","moments");let r=Ni(t,e.shape),a=Qn(e,r,n),s=a.shape;n||(s=cd(a.shape,r));let i=_n(Ge(ze(e,"float32"),ie(a,s))),o=Qn(i,r,n);return{mean:a,variance:o}}var cx=te({moments_:Ble});function Wle(e,t,n,r){let a=W(t,"data","multiRNNCell"),s=Zb(n,"c","multiRNNCell"),i=Zb(r,"h","multiRNNCell"),o=a,l=[];for(let p=0;p<e.length;p++){let m=e[p](o,s[p],i[p]);l.push(m[0]),l.push(m[1]),o=m[1]}let h=[],c=[];for(let p=0;p<l.length;p+=2)h.push(l[p]),c.push(l[p+1]);return[h,c]}var yB=te({multiRNNCell_:Wle});function jle(e,t,n,r=!1){let a=W(e,"logits","multinomial"),s=a.size,i=a.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();let o={logits:i===1?ie(a,[1,-1]):a},l={numSamples:t,seed:n,normalized:r},h=J.runKernel(bg,o,l);return i===1?ie(h,[h.size]):h}var bB=te({multinomial_:jle});function Hle(e,t){let n=W(e,"a","notEqual","string_or_numeric"),r=W(t,"b","notEqual","string_or_numeric");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r};return J.runKernel(xg,a)}var hd=te({notEqual_:Hle});function Gle(e,t,n=1,r=0,a="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:W(e,"indices","oneHot","int32")},i={dtype:a,depth:t,onValue:n,offValue:r};return J.runKernel(bp,s,i)}var vm=te({oneHot_:Gle});function qle(e){let t={x:W(e,"x","onesLike")};return J.runKernel(Ig,t)}var Os=te({onesLike_:qle});function Kle(e,t){let n=W(e,"v1","outerProduct"),r=W(t,"v2","outerProduct");X(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);let a=ie(n,[-1,1]),s=ie(r,[1,-1]);return Nt(a,s)}var vB=te({outerProduct_:Kle});function Xle(e,t,n=0){let r=W(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:t,constantValue:n},s={x:r};return J.runKernel(vp,s,a)}var io=te({pad_:Xle});function Yle(e,t,n=0){return X(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),io(e,[t],n)}var xB=te({pad1d_:Yle});function Qle(e,t,n=0){return X(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),io(e,t,n)}var wB=te({pad2d_:Qle});function Zle(e,t,n=0){return X(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),io(e,t,n)}var _B=te({pad3d_:Zle});function Jle(e,t,n=0){return X(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),io(e,t,n)}var SB=te({pad4d_:Jle});function eue(e,t,n){let r=W(e,"x","spaceToBatchND");X(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),X(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),X(r.shape.reduce((i,o,l)=>l>0&&l<=t.length?i&&(o+n[l-1][0]+n[l-1][1])%t[l-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);let a={x:r},s={blockShape:t,paddings:n};return J.runKernel($g,a,s)}var hx=te({spaceToBatchND_:eue});function tue(e,t,n,r,a,s,i){a==null&&(a=[1,1]),s==null&&(s=1),r===0&&(r="valid");let o=W(e,"x","maxPool"),l=o,h=!1;o.rank===3&&(h=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(Zo(s,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${a}'`);let c=ZU(l.shape,t,s,a,r),p=[c.dilationHeight,c.dilationWidth],m;r==="same"?m=rue([c.filterHeight,c.filterWidth],p):m=[[0,0],[0,0]];let g=p[0]===1&&p[1]===1,[b,v]=nue([c.inHeight,c.inWidth],p,m),x=g?r:"valid",_=g?l:hx(l,p,b),I=(n==="avg"?()=>eu(_,t,s,x,i):()=>Qr(_,t,s,x,i))(),k=g?I:rx(I,p,v);return h?ie(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function nue(e,t,n){let r=n.map(c=>c[0]),a=n.map(c=>c[1]),s=e.concat(r,a),i=t.map((c,p)=>(c-s[p]%c)%c),o=a.map((c,p)=>c+i[p]),l=t.map((c,p)=>[r[p],o[p]]),h=t.map((c,p)=>[0,i[p]]);return[l,h]}function rue(e,t){let n=e.map((s,i)=>s+(s-1)*(t[i]-1)).map(s=>s-1),r=n.map(s=>Math.floor(s/2)),a=n.map((s,i)=>s-r[i]);return n.map((s,i)=>[r[i],a[i]])}var AC=te({pool_:tue});function aue(e,t){let n=W(e,"x","prelu"),r=W(t,"alpha","prelu"),a={x:n,alpha:r};return J.runKernel(wp,a)}var dx=te({prelu_:aue});function sue(e,t=null,n=!1){let r=W(e,"x","prod");r.dtype==="bool"&&(r=ze(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return J.runKernel(_p,a,s)}var RC=te({prod_:sue});function iue(e,t,n,r){let a=e.map((c,p)=>W(c,`tensors${p}`,"raggedGather","int32")),s=W(t,"paramsDenseValues","raggedGather"),i=W(n,"indices","raggedGather","int32"),o={paramsNestedSplits:a,paramsDenseValues:s,indices:i},l={outputRaggedRank:r},h=J.runKernel(A1,o,l);return{outputNestedSplits:h.slice(0,h.length-1),outputDenseValues:h[h.length-1]}}var IB=te({raggedGather_:iue});function oue(e,t,n){let r=W(e,"starts","raggedRange"),a=W(t,"limits","raggedRange",r.dtype),s=W(n,"deltas","raggedRange",r.dtype),i={starts:r,limits:a,deltas:s},o=J.runKernel(R1,i);return{rtNestedSplits:o[0],rtDenseValues:o[1]}}var TB=te({raggedRange_:oue});function lue(e,t,n,r,a){let s=W(e,"shape","raggedTensorToTensor","int32"),i=W(t,"values","raggedTensorToTensor"),o=W(n,"defaultValue","raggedTensorToTensor",i.dtype),l=r.map((p,m)=>W(p,`tensors${m}`,"raggedTensorToTensor","int32")),h={shape:s,values:i,defaultValue:o,rowPartitionTensors:l},c={rowPartitionTypes:a};return J.runKernel(D1,h,c)}var kB=te({raggedTensorToTensor_:lue});function uue(e,t,n){Ps(e);let r=gn(e),a=null;if(n==null||n==="float32")a=new Float32Array(r);else if(n==="int32")a=new Int32Array(r);else if(n==="bool")a=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)a[s]=t();return J.makeTensor(a,e,n)}var EB=te({rand_:uue}),DC=Lc(y1()),NB={};_t(NB,{TEST_EPSILON_FLOAT16:()=>CB,createVideoElement:()=>yue,encodeStrings:()=>AB,expectArrayBuffersEqual:()=>gue,expectArraysClose:()=>hue,expectArraysEqual:()=>pue,expectNumbersClose:()=>fue,expectPromiseToFail:()=>due,expectValuesInRange:()=>mue,play:()=>bue,testEpsilon:()=>MC});var cue=.001,CB=.1;function hue(e,t,n){return n==null&&(n=MC()),SE(e,t,(r,a)=>$C(r,a,n))}function MC(){return J.backend.floatPrecision()===32?cue:CB}function SE(e,t,n){let r=!0;if((Jr(e)||Jr(t))&&(r=!1),Jr(e)&&Jr(t)&&(r=!0),r){let i=e.constructor.name,o=t.constructor.name;if(i!==o)throw new Error(`Arrays are of different type. Actual: ${i}. Expected: ${o}`)}if(Array.isArray(e)&&Array.isArray(t)){let i=Go(e),o=Go(t);if(!Zl(i,o))throw new Error(`Arrays have different shapes. Actual: [${i}]. Expected: [${o}]`)}let a=Jr(e)?e:yc(e),s=Jr(t)?t:yc(t);if(a.length!==s.length)throw new Error(`Arrays have different lengths actual: ${a.length} vs expected: ${s.length}.
Actual:   ${a}.
Expected: ${s}.`);for(let i=0;i<s.length;++i){let o=a[i],l=s[i];if(!n(o,l))throw new Error(`Arrays differ: actual[${i}] = ${o}, expected[${i}] = ${l}.
Actual:   ${a}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function due(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function pue(e,t){let n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return Yu(e)||Yu(e[0])||Yu(t)||Yu(t[0])?SE(e,n,(r,a)=>r==a):SE(e,t,(r,a)=>$C(r,a,0))}function fue(e,t,n){if(n==null&&(n=MC()),!$C(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function $C(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function mue(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function gue(e,t){let n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error(`Expected ArrayBuffer value at ${a} to be ${r[a]} but got ${n[a]} instead`)}function AB(e){for(let t=0;t<e.length;t++){let n=e[t];Array.isArray(n)?AB(n):e[t]=Jv(n)}return e}function yue(e){let t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function bue(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}var OC=class{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=a||Math.random();this.random=DC.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let r=this.nextVal;return this.nextVal=NaN,r}let e,t,n=!1;for(;!n;){let r,a,s;do r=2*this.random()-1,a=2*this.random()-1,s=r*r+a*a;while(s>=1||s===0);let i=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*i,t=this.mean+this.stdDev*a*i,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},vue=class{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;let a=r||Math.random();this.randu=DC.alea(a.toString()),this.randn=new OC(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,s;for(;;){do r=this.randn.nextValue(),s=1+this.c*r;while(s<=0);if(s*=s*s,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-s+Math.log(s)),a=this.randu(),a<t||Math.log(a)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},xue=class{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=DC.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function wue(e,t,n=1,r="float32",a){if(Ps(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);let s=new vue(t,n,r,a),i=At(e,r);for(let o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}var RB=te({randomGamma_:wue});function _ue(e,t=0,n=1,r,a){if(Ps(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let s=new OC(t,n,r,!1,a),i=At(e,r);for(let o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}var X1=te({randomNormal_:_ue});function Sue(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return X1(e,0,1,t,n)}var DB=te({randomStandardNormal_:Sue});function Iue(e,t=0,n=1,r="float32",a){Ps(e);let s=At(e,r),i=new xue(t,n,null,a);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}var Hc=te({randomUniform_:Iue});function Tue(e,t,n,r){return Hc(e,t,n,"int32",r)}var MB=te({randomUniformInt_:Tue});function dd(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");let a={start:e,stop:t,step:n,dtype:r};return J.runKernel(Vv,{},a)}function kue(e){let t={input:W(e,"input","real")};return J.runKernel(M1,t)}var xm=te({real_:kue});function Eue(e){let t={x:W(e,"x","reciprocal")};return J.runKernel(Sp,t)}var FC=te({reciprocal_:Eue});function Nue(e){let t={x:W(e,"x","relu")};return J.runKernel(Ip,t)}var fn=te({relu_:Nue});function Cue(e){let t={x:W(e,"x","relu6")};return J.runKernel(Ep,t)}var Y1=te({relu6_:Cue});function Aue(e,t){let n={x:W(e,"x","reverse")},r={dims:t};return J.runKernel(Np,n,r)}var ri=te({reverse_:Aue});function Rue(e){let t=W(e,"x","reverse");return X(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),ri(t,0)}var $B=te({reverse1d_:Rue});function Due(e,t){let n=W(e,"x","reverse");return X(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),ri(n,t)}var OB=te({reverse2d_:Due});function Mue(e,t){let n=W(e,"x","reverse");return X(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),ri(n,t)}var FB=te({reverse3d_:Mue});function $ue(e,t){let n=W(e,"x","reverse");return X(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),ri(n,t)}var PB=te({reverse4d_:$ue});function Oue(e){let t={x:W(e,"x","round")};return J.runKernel(Cp,t)}var Q1=te({round_:Oue});function Fue(e){let t={x:W(e,"x","rsqrt","float32")};return J.runKernel(Ap,t)}var Z1=te({rsqrt_:Fue});function Pue(e){let t={x:W(e,"x","selu")};return J.runKernel(Rp,t)}var J1=te({selu_:Pue});function Lue(e,t,n,r,a,s=[1,1],i="NHWC"){let o=W(e,"x","separableConv2d"),l=W(t,"depthwiseFilter","separableConv2d"),h=W(n,"pointwiseFilter","separableConv2d"),c=o,p=!1;if(o.rank===3&&(p=!0,c=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),X(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),X(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),X(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),X(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);let m=l.shape[2],g=l.shape[3];X(h.shape[2]===m*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*g}, but got ${h.shape[2]}.`);let b=Hp(c,l,r,a,i,s),v=ja(b,h,1,"valid",i);return p?ie(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Xg=te({separableConv2d_:Lue});async function zue(e,t){let n=W(e,"x","setdiff1d"),r=W(t,"y","setdiff1d");X(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),X(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),X(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);let a=await n.data(),s=await r.data(),i=new Set(s),o=0;for(let c=0;c<a.length;c++)i.has(a[c])||o++;let l=new Er([o],n.dtype),h=new Er([o],"int32");for(let c=0,p=0;c<a.length;c++)i.has(a[c])||(l.values[p]=a[c],h.values[p]=c,p++);return[l.toTensor(),h.toTensor()]}var LB=zue;function Vue(e){let t={x:W(e,"x","sign")};return J.runKernel($p,t)}var PC=te({sign_:Vue});function Uue(e){let t={x:W(e,"x","sin","float32")};return J.runKernel(Dp,t)}var eS=te({sin_:Uue});function Bue(e){let t={x:W(e,"x","sinh")};return J.runKernel(Mp,t)}var tS=te({sinh_:Bue});function Wue(e,t,n){let r=W(e,"x","slice1d");return X(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Pt(r,[t],[n])}var px=te({slice1d_:Wue});function jue(e,t,n){let r=W(e,"x","slice2d");return X(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Pt(r,t,n)}var nS=te({slice2d_:jue});function Hue(e,t,n){let r=W(e,"x","slice3d");return X(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Pt(r,t,n)}var Yg=te({slice3d_:Hue});function Gue(e,t,n){let r=W(e,"x","slice4d");return X(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Pt(r,t,n)}var wm=te({slice4d_:Gue});function que(e,t=-1){let n=W(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let r={logits:n},a={dim:t};return J.runKernel(zp,r,a)}var Gc=te({softmax_:que});function Kue(e){X(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);let t={input:e};return J.runKernel(E1,t)}var fx=te({fft_:Kue});function Xue(e){X(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);let t={input:e};return J.runKernel(N1,t)}var _m=te({ifft_:Xue});function Yue(e){let t=e.shape[e.shape.length-1],n=e.size/t,r;if(t<=2){let a=ie(e,[n,t]);r=_m(a)}else{let a=[n,2*(t-1)],s=ie(xm(e),[n,t]),i=ie(sx(e),[n,t]),o=ri(Pt(s,[0,1],[n,t-2]),1),l=re(ri(Pt(i,[0,1],[n,t-2]),1),rt(-1)),h=Sn([s,o],1),c=Sn([i,l],1),p=ie(Kl(h,c),[a[0],a[1]]);r=_m(p)}if(r=xm(r),e.rank===3&&e.shape[0]!==0){let a=r,s=e.shape[0];r=ie(r,[s,r.shape[0]/s,r.shape[1]]),a.dispose()}return r}var rS=te({irfft_:Yue});function Que(e,t,n=0){let r={x:W(e,"x","split")},a={numOrSizeSplits:t,axis:n};return J.runKernel(Og,r,a)}var is=te({split_:Que});function Zue(e,t){X(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1],r=e.size/n,a;if(t!=null&&t<n){let b=e.shape.map(x=>0),v=e.shape.map(x=>x);v[e.shape.length-1]=t,a=Pt(e,b,v),n=t}else if(t!=null&&t>n){let b=e.shape.map(v=>v);b[e.shape.length-1]=t-n,a=Sn([e,Zn(b)],e.shape.length-1),n=t}else a=e;let s=Ut(a),i=ie(Kl(a,s),[r,n]),o=fx(i),l=Math.floor(n/2)+1,h=xm(o),c=sx(o),p=is(h,[l,n-l],h.shape.length-1),m=is(c,[l,n-l],c.shape.length-1),g=a.shape.slice();return g[a.shape.length-1]=l,ie(Kl(p[0],m[0]),g)}var mx=te({rfft_:Zue});function Jue(e,t){let n=W(e,"a","squaredDifference"),r=W(t,"b","squaredDifference");[n,r]=tr(n,r),In(n.shape,r.shape);let a={a:n,b:r},s={};return J.runKernel(Vp,a,s)}var aS=te({squaredDifference_:Jue});function ece(e,t){let n=W(e,"x","squeeze","string_or_numeric");return ie(n,hU(n.shape,t).newShape)}var qc=te({squeeze_:ece});function tce(e,t=0){let n=Zb(e,"tensors","stack","string_or_numeric");X(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&X(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");let r=n,a={axis:t};return J.runKernel(Tg,r,a)}var Nr=te({stack_:tce});function nce(e,t=0){let n={x:W(e,"x","step")},r={alpha:t};return J.runKernel(Bc,n,r)}var qp=te({step_:nce});function rce(e,t,n,r,a=0,s=0,i=0,o=0,l=0){let h={x:W(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:s,ellipsisMask:i,newAxisMask:o,shrinkAxisMask:l};return J.runKernel(Lg,h,c)}var LC=te({stridedSlice_:rce});function ace(e){let t={x:W(e,"x","tan","float32")};return J.runKernel(Bp,t)}var zC=te({tan_:ace});function dn(e,t){Td(e);let n=Go(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Wc(e,null,n,t)}function Bo(e,t,n){if(Td(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=Go(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Wc(e,t,r,n)}function sS(e,t,n){if(Td(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let r=Go(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Wc(e,t,r,n)}function Sc(e,t,n){if(Td(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let r=Go(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Wc(e,t,r,n)}function zB(e,t,n){if(Td(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let r=Go(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Wc(e,t,r,n)}function VB(e,t,n){if(Td(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let r=Go(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,Wc(e,t,r,n)}var iS={};_t(iS,{calculateShapes:()=>UB,validateInput:()=>oS,validateUpdateShape:()=>VC});function VC(e,t,n){let r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(s+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(s+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(s+` update.rank != ${a+e.length-r}`);for(let i=0;i<a;++i)if(n.shape[i]!==t.shape[i])throw new Error(s+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<n.rank-a;++i)if(n.shape[i+a]!==e[i+r])throw new Error(s+` updates.shape[${i+a}] (${n.shape[i+a]}) != shape[${i+a}] (${e[i+a]})`)}function oS(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}VC(n,t,e)}function UB(e,t,n){let r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length,i=1;for(let p=a;p<s;++p)i*=n[p];let o=a<1?1:a,l=gn(t.shape)/o,h=[...Um(n.slice(0,a)),1],c=gn(n);return{sliceRank:a,numUpdates:l,sliceSize:i,strides:h,outputSize:c}}function sce(e,t,n){let r=W(e,"tensor","tensorScatterupdate"),a=W(t,"indices","tensorScatterupdate","int32"),s=W(n,"updates","tensorScatterupdate");if(oS(s,a,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);let i={tensor:r,indices:a,updates:s},o={};return J.runKernel(Ag,i,o)}var BB=te({tensorScatterUpdate_:sce});function ice(e,t=1,n=!0){let r=W(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);let s={x:r},i={k:t,sorted:n},[o,l]=J.runKernel(zg,s,i);return{values:o,indices:l}}var UC=te({topk_:ice});function oce(e,t=0,n=1,r,a){if(Ps(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new OC(t,n,r,!0,a),i=At(e,r);for(let o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}var lS=te({truncatedNormal_:oce});function lce(e,t=0){let n=W(e,"x","unique","string_or_numeric");X(n.rank>0,()=>"The input tensor must be at least 1D");let r={x:n},a={axis:t},[s,i]=J.runKernel(Xv,r,a);return{values:s,indices:i}}var BC=te({unique_:lce});function uce(e,t,n){let r=W(e,"x","unsortedSegmentSum"),a=W(t,"segmentIds","unsortedSegmentSum","int32");X(pm(n),()=>"numSegments must be of dtype int");let s={x:r,segmentIds:a},i={numSegments:n};return J.runKernel(Yv,s,i)}var uS=te({unsortedSegmentSum_:uce});function cce(e,t=0){let n=W(e,"x","unstack","string_or_numeric");X(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);let r={value:n},a={axis:t};return J.runKernel(Ug,r,a)}var or=te({unstack_:cce});function WB(e,t){return K1(e,t,"right")}function WC(e,t=!0,n,r){return J.makeVariable(e,t,n,r)}function jB(e,t){let n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);let r=At(e,"int32"),a=At([n.length,e.length],"int32");for(let s=0;s<n.length;s++){let i=r.indexToLoc(n[s]),o=s*e.length;a.values.set(i,o)}return a.toTensor()}async function hce(e){let t=W(e,"condition","whereAsync","bool"),n=await t.data(),r=jB(t.shape,n);return e!==t&&t.dispose(),r}var jC=hce;async function dce(e,t,n){let r=W(e,"tensor","boolMask"),a=W(t,"mask","boolMask","bool"),s=n??0,i=a.rank,o=r.shape;X(i>0,()=>"mask cannot be scalar"),qa(o.slice(s,s+i),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let v=s;v<s+i;v++)l*=o[v];let h=o.slice(0,s).concat([l],o.slice(s+i)),c=ie(r,h),p=ie(a,[-1]),m=await jC(p),g=qc(m,[1]),b=Kg(c,g,s);return e!==r&&r.dispose(),t!==a&&a.dispose(),g.dispose(),c.dispose(),p.dispose(),m.dispose(),b}var HB=dce;function pce(e,t,n){let r=W(e,"x","transpose");if(t==null&&(t=r.shape.map((i,o)=>o).reverse()),X(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(i=>{X(i>=0&&i<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();let a={x:r},s={perm:t};return r.dtype==="complex64"?oe(()=>{let i=xm(r),o=sx(r);return i=J.runKernel(Vl,{x:i},s),o=J.runKernel(Vl,{x:o},s),n&&(o=Mn(o)),Kl(i,o)}):J.runKernel(Vl,a,s)}var Ct=te({transpose_:pce});function fce(e,t,n,r,a=!0){let s=W(e,"v","movingAverage"),i=W(t,"x","movingAverage"),o=W(n,"decay","movingAverage");RU(s,i),X(Zl(s.shape,i.shape),()=>"Shape mismatch in v and x");let l=rt(1),h=Ge(l,o),c=re(Ge(i,s),h);if(a){X(r!=null,()=>"When using zeroDebias: true, step is required.");let p=W(r,"step","movingAverage");c=Ke(c,Ge(l,qo(o,p)))}return Se(s,c)}var GB=te({movingAverage_:fce});function mce(e,t,n){Ps(n);let r=W(e,"indices","scatterND","int32"),a=W(t,"updates","scatterND");oS(a,r,n);let s={indices:r,updates:a},i={shape:n};return J.runKernel(Cg,s,i)}var qB=te({scatterND_:mce});function gce(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);let a=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);let i=t.size;if(!(t.rank===0||t.rank===1&&i===a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function yce(e,t,n,r=0){Ps(n);let a=W(e,"sparseIndices","sparseToDense","int32"),s=W(t,"sparseValues","sparseToDense","string_or_numeric"),i=W(r,"defaultValue","sparseToDense",s.dtype);gce(a,s,n,i);let o={sparseIndices:a,sparseValues:s,defaultValue:i},l={outputShape:n};return J.runKernel(Pg,o,l)}var KB=te({sparseToDense_:yce});function bce(e,t){let n=W(t,"indices","gatherND","int32"),r={params:W(e,"x","gatherND","string_or_numeric"),indices:n};return J.runKernel(lg,r)}var XB=te({gatherND_:bce});function vce(e,t){if(t==null)return e.shape.slice();if(Zl(e.shape,t))return t;if(e.shape.length===t.length){let n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}function xce(e,t,n,r){let a=W(e,"x","dropout");if(X(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),X(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof Tt?a.clone():a;let s=vce(a,n),i=1-t,o=Ke(qg(Se(Hc(s,0,1,"float32",r),i)),i);return re(a,o)}var HC=te({dropout_:xce});function GC(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function cS(e,t,n){let r=1-e%2,a=new Float32Array(e);for(let s=0;s<e;++s){let i=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(i)}return dn(a,"float32")}async function wce(e,t,n=1){let r=W(e,"predictions","inTopK"),a=W(t,"targets","inTopK");X(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),X(r.rank-1===a.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${a.rank}`),qa(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=r.shape[r.shape.length-1];X(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);let i=await r.data(),o=await a.data(),[l,h]=[i.length/s,s],c=dU("bool",l);for(let p=0;p<l;p++){let m=p*h,g=i.subarray(m,m+h),b=[];for(let v=0;v<g.length;v++)b.push({value:g[v],index:v});b.sort((v,x)=>x.value-v.value),c[p]=0;for(let v=0;v<n;v++)if(b[v].index===o[p]){c[p]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),Ba(c,a.shape,"bool")}var YB=wce,Sm={};_t(Sm,{conv2d:()=>Ice,depthwiseConv2d:()=>Nce,matMul:()=>Ace});function _ce(e,t,n,r,a,s="NHWC",i){let o=e;e.rank===3&&(o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;l.rank===3&&(l=ie(t,[1,t.shape[0],t.shape[1],t.shape[2]])),X(o.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),X(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),X(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);let h=s==="NHWC"?o.shape[3]:o.shape[1],c=s==="NHWC"?l.shape[3]:l.shape[1];X(h===n[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${n[2]}.`),X(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Ka("conv2dDerFilter",a,i);let p={x:o,dy:l},m={strides:r,pad:a,dataFormat:s,dimRoundingMode:i,filterShape:n};return J.runKernel(_1,p,m)}var qC=te({conv2DBackpropFilter_:_ce});function hS(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return re(e,qp(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function dS(e,t){let n=t,r=Cr(e.shape,t.shape);return r.length>0&&(n=Ye(n,r)),ie(n,e.shape)}function pS(e,t,n,r){if(t==="linear")return e;if(t==="relu")return fn(e);if(t==="elu")return Hg(e);if(t==="relu6")return Y1(e);if(t==="prelu")return dx(e,n);if(t==="leakyrelu")return ix(e,r);if(t==="sigmoid")return Ti(e);throw new Error(`Unknown fused activation ${t}.`)}var fS=(e,t)=>!(e>0)||t==="linear";function Sce({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:o,activation:l="linear",preluActivationWeights:h,leakyreluAlpha:c}){if(l=l||"linear",fS(J.state.gradientDepth,l)===!1){X(a==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let U=ja(e,t,n,r,a,s,i);return o!=null&&(U=Se(U,o)),pS(U,l,h,c)}let p=W(e,"x","conv2d","float32"),m=W(t,"filter","conv2d","float32"),g=p,b=!1;p.rank===3&&(b=!0,g=ie(p,[1,p.shape[0],p.shape[1],p.shape[2]])),X(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),X(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Ka("fused conv2d",r,i);let v=a==="NHWC"?g.shape[3]:g.shape[1];X(m.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${m.shape[2]}.`),X(Zo(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);let x=nx(g.shape,m.shape,n,s,r,i),_;o!=null&&(_=W(o,"bias","fused conv2d"),[_]=tr(_,p),a==="NHWC"?In(x.outShape,_.shape):(X(_.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${_.shape.length}.`),X(_.shape.length===0||_.shape[0]===x.outChannels||_.shape[0]===1,()=>`Error in fused conv2d: bias shape (${_.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let I;if(h!=null){let U=h.shape;if(X(U.length<=1||U.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${U.length}.`),U.length===1)X(U[0]===1||U[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${U}) is not compatible with the number of output channels (${x.outChannels}).`);else if(U.length===3)try{In(U,x.outShape)}catch{let C=`Error in fused conv2d: PReLU activation weights (${U}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(C)}I=W(h,"prelu weights","fused conv2d")}let k=(U,D)=>{X(a==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`);let[C,O,z,M]=D,N=hS(U,z,l);X(xc(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let P=cC(O.shape,N,C,n,r),Q=qC(O,N,C.shape,n,r),ee=[P,Q];if(M!=null){let q=dS(M,N);ee.push(q)}return ee},E={x:g,filter:m,bias:_,preluActivationWeights:I},R={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return o==null?Ko((U,D,C)=>{let O=J.runKernel(nd,E,R);return C([D,U,O]),b&&(O=ie(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:k}})(g,m):Ko((U,D,C,O)=>{let z=J.runKernel(nd,E,R);return O([D,U,z,C]),b&&(z=ie(z,[z.shape[1],z.shape[2],z.shape[3]])),{value:z,gradFunc:k}})(g,m,_)}var Ice=te({fusedConv2d_:Sce});function Tce(e,t,n,r,a,s=[1,1],i){let o=e;e.rank===3&&(o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;l.rank===3&&(l=ie(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let h={x:o,dy:l},c={strides:r,pad:a,dimRoundingMode:i,dilations:s,filterShape:n};return J.runKernel(S1,h,c)}var QB=te({depthwiseConv2dNativeBackpropFilter_:Tce});function kce(e,t,n,r,a,s=[1,1],i){let o=t,l=!1;t.rank===3&&(l=!0,o=ie(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let h={dy:o,filter:n},c={strides:r,pad:a,dimRoundingMode:i,dilations:s,inputShape:e},p=J.runKernel(I1,h,c);return l?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ZB=te({depthwiseConv2dNativeBackpropInput_:kce});function Ece({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:o,activation:l="linear",preluActivationWeights:h,leakyreluAlpha:c}){if(fS(J.state.gradientDepth,l)===!1){let R=Hp(e,t,n,r,a,s,i);return o!=null&&(R=Se(R,o)),pS(R,l,h,c)}let p=W(e,"x","depthwiseConv2d","float32"),m=W(t,"filter","depthwiseConv2d","float32"),g=p,b=!1;p.rank===3&&(b=!0,g=ie(p,[1,p.shape[0],p.shape[1],p.shape[2]])),X(g.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`),X(m.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${m.rank}.`),X(g.shape[3]===m.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${m.shape[2]}.`),s==null&&(s=[1,1]),X(Zo(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Ka("fused depthwiseConv2d",r,i);let v=nx(g.shape,m.shape,n,s,r,i,!0),x;o!=null&&(x=W(o,"bias","fused conv2d"),[x]=tr(x,p),In(v.outShape,x.shape));let _;h!=null&&(_=W(h,"prelu weights","fused depthwiseConv2d"));let I=(R,U)=>{X(xc(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[D,C,O,z]=U,M=hS(R,O,l),N=ZB(C.shape,M,D,n,r,s,i),P=QB(C,M,D.shape,n,r,s,i);if(z!=null){let Q=dS(x,M);return[N,P,Q]}return[N,P]},k={x:g,filter:m,bias:x,preluActivationWeights:_},E={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return o==null?Ko((R,U,D)=>{let C=J.runKernel(rd,k,E);return D([U,R,C]),b&&(C=ie(C,[C.shape[1],C.shape[2],C.shape[3]])),{value:C,gradFunc:I}})(g,m):Ko((R,U,D,C)=>{let O=J.runKernel(rd,k,E);return C([U,R,O,D]),b&&(O=ie(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:I}})(g,m,x)}var Nce=te({fusedDepthwiseConv2d_:Ece});function Cce({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:o=.2}){if(fS(J.state.gradientDepth,s)===!1){let z=Nt(e,t,n,r);return a!=null&&(z=Se(z,a)),pS(z,s,i,o)}let l=W(e,"a","fused matMul"),h=W(t,"b","fused matMul");[l,h]=tr(l,h);let c=n?l.shape[l.rank-2]:l.shape[l.rank-1],p=r?h.shape[h.rank-1]:h.shape[h.rank-2],m=n?l.shape[l.rank-1]:l.shape[l.rank-2],g=r?h.shape[h.rank-2]:h.shape[h.rank-1],b=l.shape.slice(0,-2),v=h.shape.slice(0,-2),x=gn(b),_=gn(v);X(c===p,()=>`Error in fused matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${l.shape} and ${h.shape} and transposeA=${n} and transposeB=${r} must match.`);let I=In(l.shape.slice(0,-2),h.shape.slice(0,-2)).concat([m,g]),k=n?ie(l,[x,c,m]):ie(l,[x,m,c]),E=r?ie(h,[_,g,p]):ie(h,[_,p,g]),R;a!=null&&(R=W(a,"bias","fused matMul"),[R]=tr(R,l),In(I,R.shape));let U;i!=null&&(U=W(i,"prelu weights","fused matMul"));let D=(z,M)=>{let[N,P,Q,ee]=M,q=hS(ie(z,Q.shape),Q,s),Z,ne;if(!n&&!r?(Z=Nt(q,P,!1,!0),ne=Nt(N,q,!0,!1)):!n&&r?(Z=Nt(q,P,!1,!1),ne=Nt(q,N,!0,!1)):n&&!r?(Z=Nt(P,q,!1,!0),ne=Nt(N,q,!1,!1)):(Z=Nt(P,q,!0,!0),ne=Nt(q,N,!0,!0)),a!=null){let me=dS(ee,q);return[Z,ne,me]}else return[Z,ne]},C={a:k,b:E,bias:R,preluActivationWeights:U},O={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:o};return a==null?Ko((z,M,N)=>{let P=J.runKernel(td,C,O);return N([z,M,P]),{value:ie(P,I),gradFunc:D}})(k,E):Ko((z,M,N,P)=>{let Q=J.runKernel(td,C,O);return P([z,M,Q,N]),{value:ie(Q,I),gradFunc:D}})(k,E,R)}var Ace=te({fusedMatMul_:Cce});function Rce(e){return cS(e,.54,.46)}var Dce=te({hammingWindow_:Rce});function Mce(e){return cS(e,.5,.5)}var JB=te({hannWindow_:Mce});function $ce(e,t,n,r=!1,a=0){let s=0,i=[];for(;s+t<=e.size;)i.push(Pt(e,s,t)),s+=n;if(r)for(;s<e.size;){let o=s+t-e.size,l=Sn([Pt(e,s,t-o),Ds([o],a)]);i.push(l),s+=n}return i.length===0?Bo([],[0,t]):ie(Sn(i),[i.length,t])}var e6=te({frame_:$ce});function Oce(e,t,n,r,a=JB){r==null&&(r=GC(t));let s=e6(e,t,n),i=re(s,a(t));return mx(i,r)}var Fce=te({stft_:Oce});function Pce(e,t,n,r,a="bilinear",s=0){let i=W(e,"image","cropAndResize"),o=W(t,"boxes","cropAndResize","float32"),l=W(n,"boxInd","cropAndResize","int32"),h=o.shape[0];X(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),X(o.rank===2&&o.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${o.shape}.`),X(l.rank===1&&l.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${o.shape}.`),X(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),X(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),X(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let c={image:i,boxes:o,boxInd:l},p={method:a,extrapolationValue:s,cropSize:r};return J.runKernel(tg,c,p)}var Lce=te({cropAndResize_:Pce});function zce(e){let t=W(e,"image","flipLeftRight","float32");X(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let n={image:t};return J.runKernel(ig,n,{})}var Vce=te({flipLeftRight_:zce});function Uce(e){let t=W(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];X(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),X(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Rs(t,a)}var Bce=te({grayscaleToRGB_:Uce});function Wce(e){let t=W(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];X(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),X(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);let a=t.dtype,s=ze(t,"float32"),i=dn([.2989,.587,.114]),o;switch(t.rank){case 2:o=Dh("ij,j->i",s,i);break;case 3:o=Dh("ijk,k->ij",s,i);break;case 4:o=Dh("ijkl,l->ijk",s,i);break;case 5:o=Dh("ijklm,m->ijkl",s,i);break;case 6:o=Dh("ijklmn,n->ijklm",s,i);break;default:throw new Error("Not a valid tensor rank.")}return o=ea(o,-1),ze(o,a)}var jce=te({rgbToGrayscale_:Wce});function Hce(e,t,n=0,r=.5){let a=W(e,"image","rotateWithOffset","float32");X(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let s={image:a},i={radians:t,fillValue:n,center:r};return J.runKernel(Wg,s,i)}var Gce=te({rotateWithOffset_:Hce});function Qg(e,t,n,r,a,s){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=e.shape[0];return n=Math.min(n,i),X(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),X(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),X(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),X(t.rank===1,()=>"scores must be a 1D tensor"),X(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),X(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}function qce(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=W(e,"boxes","nonMaxSuppression","float32"),i=W(t,"scores","nonMaxSuppression","float32"),o=Qg(s,i,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;let l={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return J.runKernel(wg,{boxes:s,scores:i},l)}var Kce=te({nonMaxSuppression_:qce});function Xce(e,t,n){let r=Yce(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Yce(e,t,n){return Zce(e,t,n||Qce)}function Qce(e,t){return e>t?1:e<t?-1:0}function Zce(e,t,n){let r=0,a=e.length,s=0,i=!1;for(;r<a;){s=r+(a-r>>>1);let o=n(t,e[s]);o>0?r=s+1:(a=s,i=!o)}return i?r:-r-1}function t6(e,t,n,r,a){return KC(e,t,n,r,a,0)}function n6(e,t,n,r,a,s){return KC(e,t,n,r,a,0,!1,s,!0)}function r6(e,t,n,r,a,s){return KC(e,t,n,r,a,s,!0)}function KC(e,t,n,r,a,s,i=!1,o=!1,l=!1){let h=[];for(let x=0;x<t.length;x++)t[x]>a&&h.push({score:t[x],boxIndex:x,suppressBeginIndex:0});h.sort(_P);let c=s>0?-.5/s:0,p=[],m=[];for(;p.length<n&&h.length>0;){let x=h.pop(),{score:_,boxIndex:I,suppressBeginIndex:k}=x;if(_<a)break;let E=!1;for(let R=p.length-1;R>=k;--R){let U=Jce(e,I,p[R]);if(U>=r){E=!0;break}if(x.score=x.score*ehe(r,c,U),x.score<=a)break}x.suppressBeginIndex=p.length,E||(x.score===_?(p.push(I),m.push(x.score)):x.score>a&&Xce(h,x,_P))}let g=p.length,b=n-g;o&&b>0&&(p.push(...new Array(b).fill(0)),m.push(...new Array(b).fill(0)));let v={selectedIndices:p};return i&&(v.selectedScores=m),l&&(v.validOutputs=g),v}function Jce(e,t,n){let r=e.subarray(t*4,t*4+4),a=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),h=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),m=Math.max(a[1],a[3]),g=(o-s)*(l-i),b=(p-h)*(m-c);if(g<=0||b<=0)return 0;let v=Math.max(s,h),x=Math.max(i,c),_=Math.min(o,p),I=Math.min(l,m),k=Math.max(_-v,0)*Math.max(I-x,0);return k/(g+b-k)}function ehe(e,t,n){let r=Math.exp(t*n*n);return n<=e?r:0}function _P(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}async function the(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=W(e,"boxes","nonMaxSuppressionAsync"),i=W(t,"scores","nonMaxSuppressionAsync"),o=Qg(s,i,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;let l=await Promise.all([s.data(),i.data()]),h=l[0],c=l[1],{selectedIndices:p}=t6(h,c,n,r,a);return s!==e&&s.dispose(),i!==t&&i.dispose(),dn(p,"int32")}var nhe=the;function rhe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let i=W(e,"boxes","nonMaxSuppression"),o=W(t,"scores","nonMaxSuppression"),l=Qg(i,o,n,r,a,s);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,s=l.softNmsSigma;let h={boxes:i,scores:o},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s},p=J.runKernel(Sg,h,c);return{selectedIndices:p[0],selectedScores:p[1]}}var ahe=te({nonMaxSuppressionWithScore_:rhe});async function she(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let i=W(e,"boxes","nonMaxSuppressionAsync"),o=W(t,"scores","nonMaxSuppressionAsync"),l=Qg(i,o,n,r,a,s);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,s=l.softNmsSigma;let h=await Promise.all([i.data(),o.data()]),c=h[0],p=h[1],{selectedIndices:m,selectedScores:g}=r6(c,p,n,r,a,s);return i!==e&&i.dispose(),o!==t&&o.dispose(),{selectedIndices:dn(m,"int32"),selectedScores:dn(g)}}var ihe=she;function ohe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let i=W(e,"boxes","nonMaxSuppression"),o=W(t,"scores","nonMaxSuppression"),l=Qg(i,o,n,r,a,null),h=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,m={boxes:i,scores:o},g={maxOutputSize:h,iouThreshold:c,scoreThreshold:p,padToMaxOutputSize:s},b=J.runKernel(_g,m,g);return{selectedIndices:b[0],validOutputs:b[1]}}var lhe=te({nonMaxSuppressionPadded_:ohe});async function uhe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let i=W(e,"boxes","nonMaxSuppressionAsync"),o=W(t,"scores","nonMaxSuppressionAsync"),l=Qg(i,o,n,r,a,null),h=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,[m,g]=await Promise.all([i.data(),o.data()]),{selectedIndices:b,validOutputs:v}=n6(m,g,h,c,p,s);return i!==e&&i.dispose(),o!==t&&o.dispose(),{selectedIndices:dn(b,"int32"),validOutputs:rt(v,"int32")}}var che=uhe;function hhe(e,t,n=!1,r=!1){let a=W(e,"images","resizeBilinear");X(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),X(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),X(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=a,i=!1;a.rank===3&&(i=!0,s=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let o={images:s},l={alignCorners:n,halfPixelCenters:r,size:t},h=J.runKernel(kp,o,l);return i?ie(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var a6=te({resizeBilinear_:hhe});function dhe(e,t,n=!1,r=!1){let a=W(e,"images","resizeNearestNeighbor");X(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),X(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),X(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),X(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=a,i=!1;a.rank===3&&(i=!0,s=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let o={images:s},l={alignCorners:n,halfPixelCenters:r,size:t},h=J.runKernel(Tp,o,l);return i?ie(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var s6=te({resizeNearestNeighbor_:dhe});function phe(e,t="binary",n=!1,r=.5){let a=W(e,"image","threshold"),s=.2989,i=.587,o=.114,l=a.shape[0]*a.shape[1],h=re(dn([r]),255),c,p,m,g;if(X(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),X(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),X(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),X(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),a.shape[2]===3){[c,p,m]=is(a,[1,1,1],-1);let v=re(c,s),x=re(p,i),_=re(m,o);g=Se(Se(v,x),_)}else g=e;if(t==="otsu"){let v=aC(ze(Q1(g),"int32"),Ba([]),256);h=fhe(v,l)}let b=n?jc(g,h):Xa(g,h);return ze(re(b,255),"int32")}function fhe(e,t){let n=dn([-1]),r=dn([0]),a=dn([0]),s,i,o,l,h,c;for(let p=0;p<e.size-1;p++){s=Pt(e,0,p+1),i=Pt(e,p+1),h=Ke(Ye(s),t),c=Ke(Ye(i),t);let m=Ye(re(s,dd(0,s.size)));o=Ke(m,Ye(s));let g=Ds(i.shape,s.size),b=Se(dd(0,i.size),g),v=re(i,b);l=Ke(Ye(v),Ye(i));let x=Ge(o,l),_=Ge(o,l),I=re(h,c);a=re(re(I,x),_);let k=Xa(a,r);r=ra(k,a,r),n=ra(k,dn([p]),n)}return n}var mhe=te({threshold_:phe});function ghe(e,t,n="nearest",r="constant",a=0,s){let i=W(e,"image","transform","float32"),o=W(t,"transforms","transform","float32");X(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),X(o.rank===2&&(o.shape[0]===i.shape[0]||o.shape[0]===1)&&o.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),X(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let l={image:i,transforms:o},h={interpolation:n,fillMode:r,fillValue:a,outputShape:s};return J.runKernel(Vg,l,h)}var yhe=te({transform_:ghe});function bhe(e,t,n){let r=W(e,"a","bandPart");X(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let a=r.shape,[s,i]=r.shape.slice(-2),o,l;typeof t=="number"?(X(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),X(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),o=W(t<0?s:t,"numLower","bandPart")):(X(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),o=ra(bm(t,0),s,_c(t,s))),typeof n=="number"?(X(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),X(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=W(n<0?i:n,"numUpper","bandPart")):(X(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ra(bm(n,0),i,_c(n,i)));let h=ie(dd(0,s,1,"int32"),[-1,1]),c=dd(0,i,1,"int32"),p=Ge(h,c),m=Ei(jc(p,o),tu(p,Mn(l))),g=Zn([s,i],r.dtype);return ie(Nr(or(ie(r,[-1,s,i])).map(b=>ra(m,b,g))),a)}var vhe=te({bandPart_:bhe});function xhe(e){let t;if(Array.isArray(e)){t=!1,X(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=e[0].shape[0];for(let s=1;s<e.length;++s)X(e[s].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${a})`)}else t=!0,e=is(e,e.shape[0],0).map(a=>qc(a,[0]));X(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);let n=[],r=e;for(let a=0;a<e.length;++a)n.push(J.tidy(()=>{let s=r[a];if(a>0)for(let i=0;i<a;++i){let o=re(Ye(re(n[i],s)),n[i]);s=Ge(s,o)}return Ke(s,Gg(s,"euclidean"))}));return t?Nr(n,0):n}var whe=te({gramSchmidt_:xhe});function _he(e,t=!1){if(X(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return SP(e,t);{let n=e.shape.slice(0,e.shape.length-2).reduce((l,h)=>l*h),r=or(ie(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];r.forEach(l=>{let[h,c]=SP(l,t);a.push(h),s.push(c)});let i=ie(Nr(a,0),e.shape),o=ie(Nr(s,0),e.shape);return[i,o]}}function SP(e,t=!1){return J.tidy(()=>{X(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);let n=e.shape[0],r=e.shape[1],a=j1(n),s=Uo(e),i=Bo([[1]],[1,1]),o=Uo(i),l=n>=r?r:n;for(let h=0;h<l;++h){let c=s,p=o,m=a;[o,s,a]=J.tidy(()=>{let g=Pt(s,[h,h],[n-h,1]),b=Gg(g),v=Pt(s,[h,h],[1,1]),x=ra(Xa(v,0),Bo([[-1]]),Bo([[1]])),_=Ge(v,re(x,b)),I=Ke(g,_);I.shape[0]===1?o=Uo(i):o=Sn([i,Pt(I,[1,0],[I.shape[0]-1,I.shape[1]])],0);let k=Mn(Ke(Nt(x,_),b)),E=Pt(s,[h,0],[n-h,r]),R=re(k,o),U=Ct(o);if(h===0)s=Ge(E,Nt(R,Nt(U,E)));else{let O=Ge(E,Nt(R,Nt(U,E)));s=Sn([Pt(s,[0,0],[h,r]),O],0)}let D=Ct(R),C=Pt(a,[0,h],[n,a.shape[1]-h]);if(h===0)a=Ge(C,Nt(Nt(C,o),D));else{let O=Ge(C,Nt(Nt(C,o),D));a=Sn([Pt(a,[0,0],[n,h]),O],1)}return[o,s,a]}),wt([c,p,m])}return!t&&n>r&&(a=Pt(a,[0,0],[n,r]),s=Pt(s,[0,0],[r,r])),[a,s]})}var She=te({qr_:_he}),Va;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Va||(Va={}));function Ihe(e,t,n=Va.SUM_BY_NONZERO_WEIGHTS){let r=W(e,"losses","computeWeightedLoss"),a=null;t!=null&&(a=W(t,"weights","computeWeightedLoss"));let s=a==null?r:re(r,a);if(n===Va.NONE)return s;if(n===Va.SUM)return Ye(s);if(n===Va.MEAN){if(a==null)return Qn(s);{let i=r.size/a.size,o=Ke(Ye(s),Ye(a));return i>1?Ke(o,rt(i)):o}}if(n===Va.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Ke(Ye(s),rt(r.size));{let i=re(a,as(r.shape)),o=ze(Ye(hd(i,rt(0))),"float32");return Ke(Ye(s),o)}}throw Error(`Unknown reduction: ${n}`)}var nu=te({computeWeightedLoss_:Ihe});function The(e,t,n,r=Va.SUM_BY_NONZERO_WEIGHTS){let a=W(e,"labels","absoluteDifference"),s=W(t,"predictions","absoluteDifference"),i=null;n!=null&&(i=W(n,"weights","absoluteDifference")),qa(a.shape,s.shape,"Error in absoluteDifference: ");let o=Tr(Ge(a,s));return nu(o,i,r)}var khe=te({absoluteDifference_:The});function Ehe(e,t,n,r,a=Va.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"labels","cosineDistance"),i=W(t,"predictions","cosineDistance"),o=null;r!=null&&(o=W(r,"weights","cosineDistance")),qa(s.shape,i.shape,"Error in cosineDistance: ");let l=rt(1),h=Ge(l,Ye(re(s,i),n,!0));return nu(h,o,a)}var Nhe=te({cosineDistance_:Ehe});function Che(e,t,n,r=Va.SUM_BY_NONZERO_WEIGHTS){let a=W(e,"labels","hingeLoss"),s=W(t,"predictions","hingeLoss"),i=null;n!=null&&(i=W(n,"weights","hingeLoss")),qa(a.shape,s.shape,"Error in hingeLoss: ");let o=rt(1);a=Ge(re(rt(2),a),o);let l=fn(Ge(o,re(a,s)));return nu(l,i,r)}var Ahe=te({hingeLoss_:Che});function Rhe(e,t,n,r=1,a=Va.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"labels","huberLoss"),i=W(t,"predictions","huberLoss"),o=null;n!=null&&(o=W(n,"weights","huberLoss")),qa(s.shape,i.shape,"Error in huberLoss: ");let l=rt(r),h=Tr(Ge(i,s)),c=_c(h,l),p=Ge(h,c),m=Se(re(rt(.5),_n(c)),re(l,p));return nu(m,o,a)}var Dhe=te({huberLoss_:Rhe});function Mhe(e,t,n,r=1e-7,a=Va.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"labels","logLoss"),i=W(t,"predictions","logLoss"),o=null;n!=null&&(o=W(n,"weights","logLoss")),qa(s.shape,i.shape,"Error in logLoss: ");let l=rt(1),h=rt(r),c=Mn(re(s,$s(Se(i,h)))),p=re(Ge(l,s),$s(Se(Ge(l,i),h))),m=Ge(c,p);return nu(m,o,a)}var $he=te({logLoss_:Mhe});function Ohe(e,t,n,r=Va.SUM_BY_NONZERO_WEIGHTS){let a=W(e,"labels","meanSquaredError"),s=W(t,"predictions","meanSquaredError"),i=null;n!=null&&(i=W(n,"weights","meanSquaredError")),qa(a.shape,s.shape,"Error in meanSquaredError: ");let o=aS(a,s);return nu(o,i,r)}var Fhe=te({meanSquaredError_:Ohe});function Phe(e,t){let n=W(e,"labels","sigmoidCrossEntropyWithLogits"),r=W(t,"logits","sigmoidCrossEntropyWithLogits");qa(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=fn(r),s=re(r,n),i=ox(Ea(Mn(Tr(r))));return Se(Ge(a,s),i)}function Lhe(e,t,n,r=0,a=Va.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"multiClassLabels","sigmoidCrossEntropy"),i=W(t,"logits","sigmoidCrossEntropy"),o=null;if(n!=null&&(o=W(n,"weights","sigmoidCrossEntropy")),qa(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){let h=rt(r),c=rt(1),p=rt(.5);s=Se(re(s,Ge(c,h)),re(p,h))}let l=Phe(s,i);return nu(l,o,a)}var zhe=te({sigmoidCrossEntropy_:Lhe});function Vhe(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Ko((r,a,s)=>{let i=lx(a,[n],!0),o=Ge(ze(a,"float32"),i);s([r,o]);let l=Mn(re(o,r));return{value:Ye(l,[n]),gradFunc:(h,c)=>{let[p,m]=c,g=cd(h.shape,[n]);return[re(ie(h,g),Ge(ze(p,"float32"),Ea(m))),re(ie(h,g),Ge(Ea(m),ze(p,"float32")))]}}})(e,t)}function Uhe(e,t,n,r=0,a=Va.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"onehotLabels","softmaxCrossEntropy"),i=W(t,"logits","softmaxCrossEntropy"),o=null;if(n!=null&&(o=W(n,"weights","softmaxCrossEntropy")),qa(s.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){let h=rt(r),c=rt(1),p=rt(s.shape[1]);s=Se(re(s,Ge(c,h)),Ke(h,p))}let l=Vhe(s,i);return nu(l,o,a)}var Bhe=te({softmaxCrossEntropy_:Uhe});function Whe(e,t,n,r){let a=W(e,"indices","sparseFillEmptyRows","int32"),s=W(t,"values","sparseFillEmptyRows"),i=W(n,"denseShape","sparseFillEmptyRows","int32"),o=W(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(o.rank!==0)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);let l={indices:a,values:s,denseShape:i,defaultValue:o},h=J.runKernel(Uv,l);return{outputIndices:h[0],outputValues:h[1],emptyRowIndicator:h[2],reverseIndexMap:h[3]}}var jhe=te({sparseFillEmptyRows_:Whe});function Hhe(e,t,n){let r=W(e,"inputIndices","sparseReshape","int32"),a=W(t,"inputShape","sparseReshape","int32"),s=W(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);let i={inputIndices:r,inputShape:a,newShape:s},o=J.runKernel(Fg,i);return{outputIndices:o[0],outputShape:o[1]}}var Ghe=te({sparseReshape_:Hhe});function qhe(e,t,n){let r=W(e,"data","sparseSegmentMean"),a=W(t,"indices","sparseSegmentMean","int32"),s=W(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);let i={data:r,indices:a,segmentIds:s};return J.runKernel(Bv,i)}var Khe=te({sparseSegmentMean_:qhe});function Xhe(e,t,n){let r=W(e,"data","sparseSegmentSum"),a=W(t,"indices","sparseSegmentSum","int32"),s=W(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);let i={data:r,indices:a,segmentIds:s};return J.runKernel(Wv,i)}var Yhe=te({sparseSegmentSum_:Xhe});function Qhe(e,t,n,r,a,s,i,o){let l=W(e,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);let h=W(t,"dataSplits","stringNGrams");if(h.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let c={separator:n,nGramWidths:r,leftPad:a,rightPad:s,padWidth:i,preserveShortSequences:o},p={data:l,dataSplits:h},m=J.runKernel(Gv,p,c);return{nGrams:m[0],nGramsSplits:m[1]}}var Zhe=te({stringNGrams_:Qhe});function Jhe(e,t,n=!0){let r=W(e,"input","stringSplit","string"),a=W(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let s={skipEmpty:n},i={input:r,delimiter:a},o=J.runKernel(qv,i,s);return{indices:o[0],values:o[1],shape:o[2]}}var ede=te({stringSplit_:Jhe});function tde(e,t){let n=W(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let a={input:n};return J.runKernel(Kv,a,r)}var nde=te({stringToHashBucketFast_:tde});function rde(e,t,n,r=!0){let a=W(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return J.runKernel(Hv,{x:a},s)}var ade=te({staticRegexReplace_:rde}),i6={fft:fx,ifft:_m,rfft:mx,irfft:rS},o6={hammingWindow:Dce,hannWindow:JB,frame:e6,stft:Fce},Xs={flipLeftRight:Vce,grayscaleToRGB:Bce,resizeNearestNeighbor:s6,resizeBilinear:a6,rgbToGrayscale:jce,rotateWithOffset:Gce,cropAndResize:Lce,nonMaxSuppression:Kce,nonMaxSuppressionAsync:nhe,nonMaxSuppressionWithScore:ahe,nonMaxSuppressionWithScoreAsync:ihe,nonMaxSuppressionPadded:lhe,nonMaxSuppressionPaddedAsync:che,threshold:mhe,transform:yhe},XC={bandPart:vhe,gramSchmidt:whe,qr:She},l6={absoluteDifference:khe,computeWeightedLoss:nu,cosineDistance:Nhe,hingeLoss:Ahe,huberLoss:Dhe,logLoss:$he,meanSquaredError:Fhe,sigmoidCrossEntropy:zhe,softmaxCrossEntropy:Bhe},u6={sparseFillEmptyRows:jhe,sparseReshape:Ghe,sparseSegmentMean:Khe,sparseSegmentSum:Yhe},c6={stringNGrams:Zhe,stringSplit:ede,stringToHashBucketFast:nde,staticRegexReplace:ade},Re={};_t(Re,{Serializable:()=>h6,SerializationMap:()=>d6,getRegisteredName:()=>ide,registerClass:()=>p6});var sde=new Map,IE=new Map,h6=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},d6=class Yf{constructor(){this.classNameMap={}}static getMap(){return Yf.instance==null&&(Yf.instance=new Yf),Yf.instance}static register(t){Yf.getMap().classNameMap[t.className]=[t,t.fromConfig]}};function p6(e,t,n){X(e.className!=null,()=>"Class being registered does not have the static className property defined."),X(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),X(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);let r=n,a=t+">"+r;return d6.register(e),sde.set(a,e),IE.set(e,a),e}function ide(e){return IE.has(e)?IE.get(e):e.className}var ru=class extends h6{minimize(e,t=!1,n){let{value:r,grads:a}=this.computeGradients(e,n);if(n!=null){let s=n.map(i=>({name:i.name,tensor:a[i.name]}));this.applyGradients(s)}else this.applyGradients(a);return wt(a),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return pB(e,t)}dispose(){this.iterations_!=null&&wt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:rt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(ru,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});var YC=class extends ru{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=J.registeredVariables[t],a=!1;this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:oe(()=>Ut(r).variable(a))}),this.accumulatedUpdates[n]==null&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:oe(()=>Ut(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let i=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;oe(()=>{let l=Se(re(i,this.rho),re(_n(s),1-this.rho)),h=re(Ke(aa(Se(o,this.epsilon)),aa(Se(i,this.epsilon))),s),c=Se(re(o,this.rho),re(_n(h),1-this.rho));i.assign(l),o.assign(c);let p=Se(re(h,-this.learningRate),r);r.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(wt(this.accumulatedGrads.map(e=>e.variable)),wt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}},QC=class extends ru{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=J.registeredVariables[t];this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:oe(()=>Ds(r.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[n].tensor:e[t];if(a==null)return;let s=this.accumulatedGrads[n].variable;oe(()=>{let i=Se(s,_n(a));s.assign(i);let o=Se(re(Ke(a,aa(Se(i,J.backend.epsilon()))),-this.learningRate),r);r.assign(o)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&wt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}},ZC=class extends ru{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],oe(()=>{this.accBeta1=rt(t).variable(),this.accBeta2=rt(n).variable()}),r==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);oe(()=>{let n=Ge(1,this.accBeta1),r=Ge(1,this.accBeta2);t.forEach((a,s)=>{let i=J.registeredVariables[a],o=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:oe(()=>Ut(i).variable(o))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${a}/v`,variable:oe(()=>Ut(i).variable(o))});let l=Array.isArray(e)?e[s].tensor:e[a];if(l==null)return;let h=this.accumulatedFirstMoment[s].variable,c=this.accumulatedSecondMoment[s].variable,p=Se(re(h,this.beta1),re(l,1-this.beta1)),m=Se(re(c,this.beta2),re(_n(l),1-this.beta2)),g=Ke(p,n),b=Ke(m,r);h.assign(p),c.assign(m);let v=Se(re(Ke(g,Se(aa(b),this.epsilon)),-this.learningRate),i);i.assign(v)}),this.accBeta1.assign(re(this.accBeta1,this.beta1)),this.accBeta2.assign(re(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&wt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),oe(()=>{this.accBeta1.assign(qo(this.beta1,this.iterations_+1)),this.accBeta2.assign(qo(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}},JC=class extends ru{static get className(){return"Adamax"}constructor(e,t,n,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],oe(()=>{this.iteration=rt(0).variable(),this.accBeta1=rt(t).variable()}),r==null&&(this.epsilon=J.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);oe(()=>{let n=Ge(1,this.accBeta1),r=Ke(-this.learningRate,Se(re(this.iteration,this.decay),1));t.forEach((a,s)=>{let i=J.registeredVariables[a],o=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:Ut(i).variable(o)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${a}/v`,variable:Ut(i).variable(o)});let l=Array.isArray(e)?e[s].tensor:e[a];if(l==null)return;let h=this.accumulatedFirstMoment[s].variable,c=this.accumulatedWeightedInfNorm[s].variable,p=Se(re(h,this.beta1),re(l,1-this.beta1)),m=re(c,this.beta2),g=Tr(l),b=Jo(m,g);h.assign(p),c.assign(b);let v=Se(re(Ke(r,n),Ke(p,Se(b,this.epsilon))),i);i.assign(v)}),this.iteration.assign(Se(this.iteration,1)),this.accBeta1.assign(re(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&wt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}},mS=class extends ru{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=Array.isArray(e)?e[n].tensor:e[t];if(r==null)return;let a=J.registeredVariables[t];oe(()=>{let s=Se(re(this.c,r),a);a.assign(s)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Br(rt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}},eA=class extends mS{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=rt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=J.registeredVariables[t];this.accumulations[n]==null&&(this.accumulations[n]={originalName:`${t}/momentum`,variable:oe(()=>Ut(r).variable(!1))});let a=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];s!=null&&oe(()=>{let i,o=Se(re(this.m,a),s);this.useNesterov?i=Se(re(this.c,Se(s,re(o,this.m))),r):i=Se(re(this.c,o),r),a.assign(o),r.assign(i)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&wt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}},tA=class extends ru{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,r==null&&(this.epsilon=J.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=J.registeredVariables[t],a=!1;this.accumulatedMeanSquares[n]==null&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:oe(()=>Ut(r).variable(a))}),this.accumulatedMoments[n]==null&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:oe(()=>Ut(r).variable(a))}),this.accumulatedMeanGrads[n]==null&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:oe(()=>Ut(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let i=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;oe(()=>{let l=Se(re(i,this.decay),re(_n(s),1-this.decay));if(this.centered){let h=this.accumulatedMeanGrads[n].variable,c=Se(re(h,this.decay),re(s,1-this.decay)),p=Ke(re(s,this.learningRate),aa(Ge(l,Se(_n(c),this.epsilon)))),m=Se(re(o,this.momentum),p);i.assign(l),h.assign(c),o.assign(m);let g=Ge(r,m);r.assign(g)}else{let h=Se(re(i,this.decay),re(_n(s),1-this.decay)),c=Se(re(o,this.momentum),Ke(re(s,this.learningRate),aa(Se(h,this.epsilon))));i.assign(h),o.assign(c);let p=Ge(r,c);r.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&wt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&wt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&wt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}},ode=[YC,QC,ZC,JC,eA,tA,mS];function lde(){for(let e of ode)p6(e)}var ma={};_t(ma,{CompositeArrayBuffer:()=>Jl,browserFiles:()=>mde,browserHTTPRequest:()=>wde,concatenateArrayBuffers:()=>Xse,copyModel:()=>yie,decodeWeights:()=>zU,decodeWeightsStream:()=>UU,encodeWeights:()=>Wse,fromMemory:()=>Sde,fromMemorySync:()=>b6,getLoadHandlers:()=>rie,getModelArtifactsForJSON:()=>W2,getModelArtifactsForJSONSync:()=>WU,getModelArtifactsInfoForJSON:()=>tx,getSaveHandlers:()=>nie,getWeightSpecs:()=>bE,http:()=>rA,isHTTPScheme:()=>kE,listModels:()=>mie,loadWeights:()=>yde,moveModel:()=>bie,registerLoadRouter:()=>tie,registerSaveRouter:()=>eie,removeModel:()=>gie,weightsLoaderFactory:()=>m6,withSaveHandler:()=>Ide,withSaveHandlerSync:()=>Tde});var ude="model",cde=".json",hde=".weights.bin";function IP(e){return new Promise(t=>setTimeout(t)).then(e)}var g_=class TE{constructor(t){if(!he().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(TE.URL_SCHEME)&&(t=t.slice(TE.URL_SCHEME.length)),(t==null||t.length===0)&&(t=ude),this.modelJsonFileName=t+cde,this.weightDataFileName=t+hde}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=Jl.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=BU(t,a),i=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await IP(()=>o.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await IP(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:tx(t)}}}};g_.URL_SCHEME="downloads://";var dde=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{let n=new FileReader;n.onload=r=>{let a=JSON.parse(r.target.result),s=a.modelTopology;if(s==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:s});return}let i=W2(a,o=>this.loadWeights(o));e(i)},n.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})}loadWeights(e){let t=[],n=[];for(let s of e)t.push(...s.weights),n.push(...s.paths);let r=this.checkManifestAndWeightFiles(e),a=n.map(s=>this.loadWeightsFile(s,r[s]));return Promise.all(a).then(s=>[t,s])}loadWeightsFile(e,t){return new Promise((n,r)=>{let a=new FileReader;a.onload=s=>{let i=s.target.result;n(i)},a.onerror=s=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){let t=[],n=this.weightsFiles.map(a=>wP(a.name)),r={};for(let a of e)a.paths.forEach(s=>{let i=wP(s);if(t.indexOf(i)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(t.push(i),n.indexOf(i)===-1)throw new Error(`Weight file with basename '${i}' is not provided.`);r[s]=this.weightsFiles[n.indexOf(i)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}},pde=e=>he().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(g_.URL_SCHEME)?fde(e.slice(g_.URL_SCHEME.length)):null;ni.registerSaveRouter(pde);function fde(e="model"){return new g_(e)}function mde(e){return new dde(e)}function TP(e,t,n,r){i(e),n=n??0,r=r??1,o(n,r);let a=0,s=l=>(l.then(h=>{let c=n+ ++a/e.length*(r-n);return t(c),h}),l);function i(l){X(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function o(l,h){X(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),X(h>=0&&h<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${h}`),X(h>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${h}`)}return Promise.all(e.map(s))}async function f6(e,t){t==null&&(t={});let n=t.fetchFunc==null?he().platform.fetch:t.fetchFunc,r=e.map(s=>n(s,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?await Promise.all(r):await TP(r,t.onProgress,0,.5)).map(s=>s.arrayBuffer());return t.onProgress==null?await Promise.all(a):await TP(a,t.onProgress,.5,1)}function gde(e,t){var n;let r=t.fetchFunc==null?he().platform.fetch:t.fetchFunc,a=0,s;return(n=t.onProgress)===null||n===void 0||n.call(t,0),new ReadableStream({pull:async i=>{for(var o;a<e.length;){s||(s=(await r(e[a],t.requestInit,{isBinary:!0})).body.getReader());let{done:l,value:h}=await s.read();if(l){a++,s=void 0,(o=t.onProgress)===null||o===void 0||o.call(t,a/e.length);continue}i.enqueue(h);return}i.close()}})}async function yde(e,t="",n,r){return m6(a=>f6(a,{requestInit:r}))(e,t,n)}function m6(e){return async(t,n="",r)=>{let a=t.map(()=>!1),s={},i=r!=null?r.map(()=>!1):[],o=[];if(t.forEach((g,b)=>{let v=0;g.weights.forEach(x=>{let _="quantization"in x?x.quantization.dtype:x.dtype,I=sd[_]*gn(x.shape),k=()=>{a[b]=!0,s[b]==null&&(s[b]=[]),s[b].push({manifestEntry:x,groupOffset:v,sizeBytes:I})};r!=null?r.forEach((E,R)=>{E===x.name&&(k(),i[R]=!0)}):k(),o.push(x.name),v+=I})}),!i.every(g=>g)){let g=r.filter((b,v)=>!i[v]);throw new Error(`Could not find weights in manifest with names: ${g.join(", ")}. 
Manifest JSON has weights with names: ${o.join(", ")}.`)}let l=a.reduce((g,b,v)=>(b&&g.push(v),g),[]),h=[];l.forEach(g=>{t[g].paths.forEach(b=>{let v=n+(n.endsWith("/")?"":"/")+b;h.push(v)})});let c=await e(h),p={},m=0;return l.forEach(g=>{let b=t[g].paths.length,v=new Jl(c.slice(m,m+b));s[g].forEach(x=>{let _=v.slice(x.groupOffset,x.groupOffset+x.sizeBytes),I=zU(_,[x.manifestEntry]);for(let k in I)p[k]=I[k]}),m+=b}),p}}var bde="application/octet-stream",vde="application/json",nA=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(X(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=he().platform.fetch,X(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&X(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=BU(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:vde}),"model.json"),e.weightData!=null){let s=Jl.join(e.weightData);t.body.append("model.weights.bin",new Blob([s],{type:bde}),"model.weights.bin")}let a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:tx(e),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let s=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s)}let n=t.modelTopology,r=t.weightsManifest;if(n==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return W2(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=bE(e.weightsManifest),r=()=>gde(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:r})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=xde(t),a=this.weightPathPrefix||n,s=[],i=[];for(let o of e)for(let l of o.paths)this.weightUrlConverter!=null?i.push(this.weightUrlConverter(l)):s.push(a+l+r);return this.weightUrlConverter&&s.push(...await Promise.all(i)),s}async loadWeights(e){let t=await this.getWeightUrls(e),n=bE(e),r=await f6(t,this.loadOptions);return[n,r]}};nA.URL_SCHEME_REGEX=/^https?:\/\//;function xde(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}function kE(e){return e.match(nA.URL_SCHEME_REGEX)!=null}var g6=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>kE(r)):n=kE(e),n)return rA(e,t)}return null};ni.registerSaveRouter(g6);ni.registerLoadRouter(g6);function rA(e,t){return new nA(e,t)}function wde(e,t){return rA(e,t)}var pk=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},y6=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},_de=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}};function Sde(e,t,n,r){let a=arguments;return new _de(b6(...a))}function b6(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new pk(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new pk({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new pk({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Ide(e){return new y6(e)}function Tde(e){return new y6(e)}var v6={};_t(v6,{confusionMatrix:()=>Ede});function kde(e,t,n){let r=W(e,"labels","confusionMatrix"),a=W(t,"predictions","confusionMatrix");X(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),X(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),X(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),X(r.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),X(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);let s=vm(ze(r,"int32"),n),i=vm(ze(a,"int32"),n),o=Ct(s),l=Nt(o,i);return ze(l,"int32")}var Ede=te({confusionMatrix_:kde}),gx={};_t(gx,{draw:()=>Ode,fromPixels:()=>Fde,fromPixelsAsync:()=>Dde,toPixels:()=>$de});var Th,kP=!1;function x6(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,s=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)o=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(Yb(d_,J.backendName)!=null){let m={pixels:e},g={numChannels:t};return J.runKernel(d_,m,g)}let[l,h]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],c;if(i)c=e.getContext("2d").getImageData(0,0,l,h).data;else if(r||n)c=e.data;else if(s||a||o){if(Th==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Th=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Th=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Th.canvas.width=l,Th.canvas.height=h,Th.drawImage(e,0,0,l,h),c=Th.getImageData(0,0,l,h).data}let p;if(t===4)p=new Int32Array(c);else{let m=l*h;p=new Int32Array(m*t);for(let g=0;g<m;g++)for(let b=0;b<t;++b)p[g*t+b]=c[g*4+b]}return sS(p,[h,l,t],"int32")}function Nde(e){return e!=null&&e.data instanceof Uint8Array}function Cde(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Ade(e){return e!=null&&e.width!==0&&e.height!==0}function Rde(e){return Cde()&&!(e instanceof ImageBitmap)&&Ade(e)&&!Nde(e)}async function Dde(e,t=3){let n=null;if(he().getBool("WRAP_TO_IMAGEBITMAP")&&Rde(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return x6(n,t)}function w6(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function Mde(e){let t=e?.alpha||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function $de(e,t){let n=W(e,"img","toPixels");if(!(e instanceof Tt)){let h=n;n=ze(h,"int32"),h.dispose()}w6(n);let[r,a]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],i=await n.data(),o=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(a*r*4);for(let h=0;h<r*a;++h){let c=[0,0,0,255];for(let m=0;m<s;m++){let g=i[h*s+m];if(n.dtype==="float32"){if(g<0||g>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${g}.`)}else if(n.dtype==="int32"&&(g<0||g>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${g}.`);s===1?(c[0]=g*o,c[1]=g*o,c[2]=g*o):c[m]=g*o}let p=h*4;l[p+0]=Math.round(c[0]),l[p+1]=Math.round(c[1]),l[p+2]=Math.round(c[2]),l[p+3]=Math.round(c[3])}if(t!=null){kP||Yb(T1,J.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),kP=!0),t.width=a,t.height=r;let h=t.getContext("2d"),c=new ImageData(l,a,r);h.putImageData(c,0,0)}return n!==e&&n.dispose(),l}function Ode(e,t,n){let r=W(e,"img","draw");if(!(e instanceof Tt)){let i=r;r=ze(i,"int32"),i.dispose()}w6(r),Mde(n?.imageOptions);let a={image:r},s={canvas:t,options:n};J.runKernel(T1,a,s)}var Fde=te({fromPixels_:x6}),aA={};_t(aA,{prepareAndValidate:()=>_6});function _6(e,t){let n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(gn(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let a=t.shape,s=a[a.length-1],i=1;for(let p=0;p<a.length-1;++p)i*=a[p];let o=e.shape,l=a.slice();l.pop();let h=1;for(let p=s;p<n;++p)h*=o[p],l.push(o[p]);let c=[...Um(e.shape).map(p=>p/h),1].slice(0,s);return[l,i,h,c]}var jr={};_t(jr,{assertParamsValid:()=>Lde,computeFlatOffset:()=>Wde,computeOutShape:()=>Vde,getNormalizedAxes:()=>Ude,isSliceContinous:()=>Bde,maskToAxes:()=>zde,parseSliceParams:()=>R6,sliceInfo:()=>jde,startForAxis:()=>C6,startIndicesWithElidedDims:()=>k6,stopForAxis:()=>A6,stopIndicesWithElidedDims:()=>E6,stridesForAxis:()=>N6,stridesWithElidedDims:()=>S6});var EE=-2,Pde=-1;function Lde(e,t,n){let r=e.shape.length;X(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),X(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let a=0;a<r;++a)X(t[a]+n[a]<=e.shape[a],()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`)}function zde(e){let t=[],n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function Vde(e,t,n){let r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function S6(e,t,n,r){let a=[...e];for(let s=a.length;s<r.length;s++)a.push(1);for(let s=0;s<n;s++)s===0?a[t]=1:(a.splice(t,0,1),a.pop());return a}function I6(e,t,n){return n<=e?n:n-(t-1)}function T6(e,t){let n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function Ude(e,t,n,r,a,s,i,o,l){let h=e.length,c=new Array(h),p=new Array(h),m=new Array(h);if(t.length&&n>0){let g=t[0],b=n+1;c=k6(i,g,b,r,e),p=E6(o,g,b,a,e),m=S6(s,g,b,e)}else for(let g=0;g<h;g++)c[g]=C6(i,r,s,e,g,l),p[g]=A6(o,a,s,e,g,l),m[g]=N6(s,g,l);return{begin:c,end:p,strides:m}}function k6(e,t,n,r,a){let s=[...a],i=T6(n,t);for(let o=0;o<s.length;o++)if(i.indexOf(o)>-1)s[o]=0;else{let l=I6(t,n,o),h=r[l];e&1<<l&&(h=0),s[o]=h}return s}function E6(e,t,n,r,a){let s=[...a],i=T6(n,t);for(let o=0;o<s.length;o++)if(i.indexOf(o)>-1)s[o]=Number.MAX_SAFE_INTEGER;else{let l=I6(t,n,o),h=r[l];e&1<<l&&(h=Number.MAX_SAFE_INTEGER),s[o]=h}for(let o=0;o<s.length;o++){let l=a[o];s[o]<0&&(s[o]+=l),s[o]=Kb(0,s[o],a[o])}return s}function N6(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function C6(e,t,n,r,a,s){let i=t[a],o=n[a]||1;(e&1<<a||s&1<<a||i==null)&&(o>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let l=r[a];return i<0&&(i+=l),i=Kb(0,i,l-1),i}function A6(e,t,n,r,a,s){let i=t[a],o=n[a]||1;(e&1<<a||s&1<<a||i==null)&&(o>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let l=r[a];return i<0&&(i+=l),o>0?i=Kb(0,i,l):i=Kb(-1,i,l-1),i}function Bde(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function Wde(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function R6(e,t,n){let r,a=e.shape.length;typeof t=="number"?r=[t,...new Array(a-1).fill(0)]:t.length<a?r=t.concat(new Array(a-t.length).fill(0)):r=t.slice(),r.forEach(i=>{X(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(a).fill(-1):typeof n=="number"?s=[n,...new Array(a-1).fill(-1)]:n.length<a?s=n.concat(new Array(a-n.length).fill(-1)):s=n,s=s.map((i,o)=>i>=0?i:(X(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${o}.`),e.shape[o]-r[o])),[r,s]}function jde(e,t,n,r,a,s,i,o,l){let h;if(r==null?(h=new Array(t.length),h.fill(1)):h=r,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1,p={dims:h.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:h.slice(),beginMask:a,endMask:s,ellipsisMask:i,newAxisMask:o,shrinkAxisMask:l};for(let I=0;I<p.dims;I++)c&&1<<I&o&&p.numAddAxisAfterEllipsis++,1<<I&i&&(c=!0);c||(p.ellipsisMask|=1<<p.dims,p.dims++);let m={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Hde(p,m);let g=!0,b=!0,v=!0,x=[],_=[];for(let I=0;I<e.length;++I){if(m.strides[I]===0)throw Error(`strides[${I}] must be non-zero`);let k=!!(m.shrinkAxisMask&1<<I),E=e[I];if(E===-1){x.push(k?1:-1);continue}let R=[m.beginMask&1<<I,m.endMask&1<<I],U=[m.strides[I]>0?0:-1,m.strides[I]>0?E:E-1];if(k&&m.strides[I]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&m.strides[I]===1;let D=!!(m.beginMask&1<<I&&m.endMask&1<<I);if(m.beginValid&&m.endValid){if(k){let M=m.begin[I]<0?E+m.begin[I]:m.begin[I];if(m.begin[I]=M,m.end[I]=m.begin[I]+1,M<0||M>=E)throw Error(`slice index ${m.begin[I]} of dimension ${I} out of bounds.`)}else m.begin[I]=EP(m.begin[I],0,m.strides[I],E,R,U),m.end[I]=EP(m.end[I],1,m.strides[I],E,R,U);let z=m.strides[I]===1&&m.begin[I]===0&&m.end[I]===E;g=g&&z,b=b&&(I===0&&m.strides[I]===1||z)}else g=g&&m.strides[I]===1&&D,b=b&&(I===0&&m.strides[I]===1||D);let C,O=!1;if(m.beginValid&&m.endValid?(C=m.end[I]-m.begin[I],O=!0):k?(C=1,O=!0):D&&E>=0&&(m.strides[I]<0?C=-E:C=E,O=!0),O){let z;C===0||C<0!=m.strides[I]<0?z=0:z=Math.trunc(C/m.strides[I])+(C%m.strides[I]!==0?1:0),x.push(z)}else x.push(-1)}for(let I=0;I<m.finalShapeGatherIndices.length;++I){let k=m.finalShapeGatherIndices[I];k>=0?_.push(x[k]):k===EE&&_.push(1)}return{finalShapeSparse:_.filter((I,k)=>m.finalShapeGatherIndices[k]!==EE),finalShape:_,isIdentity:g,sliceDim0:b,isSimpleSlice:v,begin:m.begin,end:m.end,strides:m.strides}}function Hde(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){let a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(EE),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(Pde),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function EP(e,t,n,r,a,s){if(a[t])return n>0?s[t]:s[t+1&1];{let i=e<0?r+e:e;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var Gde="4.22.0",D6=class{static sgd(e){return new mS(e)}static momentum(e,t,n=!1){return new eA(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,a=!1){return new tA(e,t,n,r,a)}static adam(e=.001,t=.9,n=.999,r=null){return new ZC(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new YC(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,a=0){return new JC(e,t,n,r,a)}static adagrad(e,t=.1){return new QC(e,t)}},Ch=D6,qde=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function sA(){return new Promise(e=>qde(()=>e()))}var B={};_t(B,{ERF_A1:()=>lpe,ERF_A2:()=>upe,ERF_A3:()=>cpe,ERF_A4:()=>hpe,ERF_A5:()=>dpe,ERF_P:()=>ope,PARALLELIZE_THRESHOLD:()=>iA,RowPartitionType:()=>Co,SELU_SCALE:()=>$6,SELU_SCALEALPHA:()=>M6,applyActivation:()=>pS,assertAndGetBroadcastShape:()=>In,assertAxesAreInnerMostDims:()=>joe,assertParamsConsistent:()=>Kde,assignToTypedArray:()=>bpe,axesAreInnerMostDims:()=>yC,calculateShapes:()=>UB,checkEinsumDimSizes:()=>Ipe,checkPadOnDimRoundingMode:()=>Ka,combineLocations:()=>lB,combineRaggedTensorToTensorShapes:()=>Yde,complexWithEvenIndex:()=>mpe,complexWithOddIndex:()=>gpe,computeConv2DInfo:()=>nx,computeConv3DInfo:()=>JU,computeDefaultPad:()=>J2,computeDilation2DInfo:()=>Bie,computeOptimalWindowSize:()=>epe,computeOutAndReduceShapes:()=>uB,computeOutShape:()=>Xde,computePool2DInfo:()=>ZU,computePool3DInfo:()=>Wie,convertConv2DDataFormat:()=>eB,decodeEinsumEquation:()=>_pe,eitherStridesOrDilationsAreOne:()=>Zo,expandShapeToKeepDim:()=>cd,exponent:()=>xpe,exponents:()=>vpe,fromStringArrayToUint8:()=>Hpe,fromUint8ToStringArray:()=>jpe,getAxesPermutation:()=>cB,getBroadcastDims:()=>iB,getComplexWithIndex:()=>ype,getEinsumComputePath:()=>Tpe,getEinsumPermutation:()=>Spe,getFusedBiasGradient:()=>dS,getFusedDyActivation:()=>hS,getImageCenter:()=>tpe,getInnerMostAxes:()=>Hoe,getPermuted:()=>rpe,getRaggedRank:()=>Zde,getReductionAxes:()=>Cr,getReshaped:()=>npe,getReshapedPermuted:()=>ape,getRowPartitionTypesHelper:()=>Qde,getSliceBeginCoords:()=>spe,getSliceSize:()=>ipe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>Cpe,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>Ape,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>Rpe,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>$pe,getSparseReshapeInputOutputMismatchErrorMessage:()=>Fpe,getSparseReshapeInputOutputMultipleErrorMessage:()=>Ope,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>Dpe,getSparseReshapeNegativeOutputDimErrorMessage:()=>Mpe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>Vpe,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>Ppe,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Lpe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>zpe,getUndoAxesPermutation:()=>bC,isIdentityPermutation:()=>kpe,log:()=>ese,mergeRealAndImagArrays:()=>ppe,prepareAndValidate:()=>_6,prepareSplitSize:()=>Npe,segment_util:()=>O6,shouldFuse:()=>fS,slice_util:()=>jr,splitRealAndImagArrays:()=>fpe,stridesOrDilationsArePositive:()=>ud,tupleValuesAreOne:()=>xc,upcastType:()=>ti,validateDefaultValueShape:()=>Jde,validateInput:()=>oS,validateUpdateShape:()=>VC,warn:()=>Ku});function Kde(e,t){let n=e[0].length;e.forEach((a,s)=>{X(a.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),X(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);let r=e[0];e.forEach((a,s)=>{for(let i=0;i<n;i++)X(i===t||a[i]===r[i],()=>`Error in concat${n}D: Shape of tensors[${s}] (${a}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function Xde(e,t){let n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var Co;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(Co||(Co={}));function Yde(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let a=1;a<n.length;++a){let s=n[a],i=r[r.length-n.length+a],o=r[i];if(s>=0)if(o>=0){if(o!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${a+e}] = ${s} but shape[${a+e}] = ${o}`)}else r[i]=s}return r}function Qde(e){let t={FIRST_DIM_SIZE:Co.FIRST_DIM_SIZE,VALUE_ROWIDS:Co.VALUE_ROWIDS,ROW_LENGTHS:Co.ROW_LENGTHS,ROW_SPLITS:Co.ROW_SPLITS,ROW_LIMITS:Co.ROW_LIMITS,ROW_STARTS:Co.ROW_STARTS},n=[];for(let r of e)if(r in t)n.push(t[r]);else break;return n}function Zde(e){return e.length===0?0:e[0]===Co.FIRST_DIM_SIZE?e.length-1:e.length}function Jde(e,t){if(e==null||t==null)return;let n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let a=0;a<Math.min(n,r-1);++a){let s=e[a],i=t[a+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${a-e.length}] = ${s} but ragged tensor input.flatValues.shape[${a-e.length}] = ${i}`)}}var iA=30;function epe(e){return e<=iA?e:h_(e,Math.floor(Math.sqrt(e)))}function tpe(e,t,n){let r=n*(typeof e=="number"?e:e[0]),a=t*(typeof e=="number"?e:e[1]);return[r,a]}function npe(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);let s=t.length;for(let i=0;i<s;++i)a=a.concat([e[i+1]/t[i],t[i]]);a=a.concat(e.slice(s+1))}return a}function rpe(e,t,n=!0){let r=[];if(n){r.push(t);for(let a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{let a=[],s=[];for(let i=1;i<e;++i)i>=t*2+1||i%2===1?s.push(i):a.push(i);r.push(...a),r.push(0),r.push(...s)}return r}function ape(e,t,n,r=!0){let a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?a.push(t[s-1]*e[s]):a.push(e[s]/t[s-1]):a.push(e[s]);return a}function spe(e,t){let n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function ipe(e,t,n){let r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var M6=1.7580993408473768,$6=1.0507009873554805,ope=.3275911,lpe=.254829592,upe=-.284496736,cpe=1.421413741,hpe=-1.453152027,dpe=1.061405429;function ppe(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function fpe(e){let t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function mpe(e){let t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function gpe(e){let t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function ype(e,t){let n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function bpe(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function vpe(e,t){let n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){let s=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(s),r[a]=Math.sin(s)}return{real:n,imag:r}}function xpe(e,t,n){let r=(n?2:-2)*Math.PI*(e/t),a=Math.cos(r),s=Math.sin(r);return{real:a,imag:s}}var fk="->",wpe=/->/g,NP=",",CP="...";function _pe(e,t){e=e.replace(/\s/g,"");let n=(e.length-e.replace(wpe,"").length)/fk.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${fk}").`);let[r,a]=e.split(fk);X(r.indexOf(CP)===-1,()=>`The ellipsis notation ("${CP}") is not supported yet.`);let s=r.split(NP),i=s.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let o=[];for(let m=0;m<a.length;++m){let g=a[m];if(!s.some(b=>b.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);o.indexOf(g)===-1&&o.push(g)}for(let m=0;m<r.length;++m){let g=r[m];o.indexOf(g)===-1&&g!==NP&&o.push(g)}let l=new Array(s.length);for(let m=0;m<i;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error(`Found duplicate axes in input component ${s[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let g=0;g<s[m].length;++g)l[m].push(o.indexOf(s[m][g]))}let h=o.length,c=a.length,p=[];for(let m=c;m<h;++m)p.push(m);return{allDims:o,summedDims:p,idDims:l}}function Spe(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;let r=[];for(let a=0;a<e;++a)n[a]===-1&&r.push(a);return n=n.filter(a=>a!==-1),{permutationIndices:n,expandDims:r}}function Ipe(e,t,n){let r=new Array(e);for(let a=0;a<n.length;++a){let s=n[a].shape;for(let i=0;i<t[a].length;++i)r[t[a][i]]===void 0?r[t[a][i]]=s[i]:X(r[t[a][i]]===s[i],()=>`Expected dimension ${r[t[a][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function Tpe(e,t){let n=e,r=[],a=0;e.length===0&&n.push(-1),a=e.length+1;for(let i=0;i<a;++i)r.push([]);let s=[];for(let i=0;i<n.length;++i){let o=n[i],l=Epe(t,o);for(let h of l)s.indexOf(h)===-1&&(r[i].push(h),s.push(h))}return{path:n,steps:r}}function kpe(e){return e.every((t,n)=>t===n)}function Epe(e,t){let n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function Npe(e,t,n=0){let r=[];if(typeof t=="number")X(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{let a=t.reduce((i,o)=>(o===-1&&(i+=1),i),0);X(a<=1,()=>"There should be only one negative value in split array.");let s=t.indexOf(-1);if(s!==-1){let i=t.reduce((o,l)=>l>0?o+l:o);t[s]=e.shape[n]-i}X(e.shape[n]===t.reduce((i,o)=>i+o),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function Cpe(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function Ape(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function Rpe(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function Dpe(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Mpe(e,t){return`size ${e} must be non-negative, not ${t}`}function $pe(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ope(e,t){let n=gn(e),r=gn(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function Fpe(e,t){let n=gn(e),r=gn(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}function Ppe(){return"segment ids must be >= 0"}function Lpe(){return"segment ids are not increasing"}function zpe(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Vpe(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var O6={};_t(O6,{collectGatherOpShapeInfo:()=>Wpe,computeOutShape:()=>Bpe,segOpComputeOptimalWindowSize:()=>Upe});function Upe(e,t){let n=!1,r;for(e<=iA?(r=e,n=!0):r=h_(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=h_(e,r+1);return r}function Bpe(e,t,n){let r=[],a=e.length;for(let s=0;s<a;s++)s!==t?r.push(e[s]):r.push(n);return r}function Wpe(e,t,n,r){let a=t.shape.length,s=e.shape.length;if(r!==0&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let p=0;p<r;++p)if(e.shape[p]!==t.shape[p])throw new Error(`x.shape[${p}]: ${e.shape[p]} should be equal to indices.shape[${p}]: ${t.shape[p]}.`);let i=e.shape[n],o=[],l=1,h=1,c=1;for(let p=0;p<r;++p)o.push(e.shape[p]),l*=e.shape[p];for(let p=r;p<n;p++)o.push(e.shape[p]),h*=e.shape[p];for(let p=r;p<a;p++)o.push(t.shape[p]);for(let p=n+1;p<s;p++)o.push(e.shape[p]),c*=e.shape[p];return{batchSize:l,sliceSize:c,outerSize:h,dimSize:i,outputShape:o}}function jpe(e){try{return e.map(t=>f_(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Hpe(e){return e.map(t=>Jv(t))}var el={};_t(el,{nonMaxSuppressionV3Impl:()=>t6,nonMaxSuppressionV4Impl:()=>n6,nonMaxSuppressionV5Impl:()=>r6,whereImpl:()=>jB});lde();var F6={kernelName:Bm,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,qp(ze(n,"float32"),-1))}}},Gpe={kernelName:kd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=_n(ze(n,"float32")),a=aa(Ge(rt(1),r));return Mn(Ke(e,a))}}}},qpe={kernelName:Ed,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=aa(Ge(_n(ze(n,"float32")),1));return Ke(e,r)}}}},Kpe={kernelName:zc,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=e,i=Cr(n.shape,a);return i.length>0&&(s=Ye(s,i)),ie(s,n.shape)},b:()=>{let s=e,i=Cr(r.shape,a);return i.length>0&&(s=Ye(s,i)),ie(s,r.shape)}}}},Xpe={kernelName:Nd,saveAllInputs:!0,gradFunc:(e,t)=>{let n={};return t.forEach((r,a)=>{n[a]=()=>e.clone()}),n}},Ype={kernelName:Hm,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ut(n)}}},Qpe={kernelName:Gm,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ut(n)}}},Zpe={kernelName:Cd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,aa(Ge(rt(1),_n(ze(n,"float32")))))}}},Jpe={kernelName:Ad,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=aa(Se(rt(1),_n(ze(n,"float32"))));return Ke(e,r)}}}},efe={kernelName:Md,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=Se(_n(n),_n(r)),i=re(e,Ke(r,s)),o=Cr(n.shape,a);return o.length>0&&(i=Ye(i,o)),ie(i,n.shape)},b:()=>{let s=Se(_n(n),_n(r)),i=Mn(re(e,Ke(n,s))),o=Cr(r.shape,a);return o.length>0&&(i=Ye(i,o)),ie(i,r.shape)}}}},tfe={kernelName:Rd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,Se(_n(ze(n,"float32")),1))}}},nfe={kernelName:Dd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,Ge(rt(1),_n(ze(n,"float32"))))}}};function rfe(e,t,n,r,a,s){let i=W(e,"dy","avgPool3dGrad"),o=W(t,"input","avgPool3dGrad"),l=i,h=o,c=!1;o.rank===4&&(c=!0,l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),h=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),X(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),X(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),Ka("avgPool3dGrad",a,s);let p={dy:l,input:h},m={filterSize:n,strides:r,pad:a,dimRoundingMode:s},g=J.runKernel(Rv,p,m);return c?ie(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var afe=te({avgPool3dGrad_:rfe}),sfe={kernelName:qm,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:i,dimRoundingMode:o}=n;return{x:()=>afe(e,r,a,s,i,o)}}};function ife(e,t,n,r,a){let s=W(e,"dy","avgPoolGrad"),i=W(t,"input","avgPoolGrad");X(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let o=i,l=s,h=!1;i.rank===3&&(h=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),X(o.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`);let c={dy:l,input:o},p={filterSize:n,strides:r,pad:a},m=J.runKernel(Av,c,p);return h?ie(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var ofe=te({avgPoolGrad_:ife}),lfe={kernelName:$d,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:i}=n;return{x:()=>ofe(e,r,a,s,i)}}},ufe={kernelName:Od,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{let[r,a]=t,{transposeA:s,transposeB:i}=n;return!s&&!i?{a:()=>Nt(e,a,!1,!0),b:()=>Nt(r,e,!0,!1)}:!s&&i?{a:()=>Nt(e,a,!1,!1),b:()=>Nt(e,r,!0,!1)}:s&&!i?{a:()=>Nt(a,e,!1,!0),b:()=>Nt(r,e,!1,!1)}:{a:()=>Nt(a,e,!0,!0),b:()=>Nt(e,r,!0,!0)}}},cfe={kernelName:Km,gradFunc:(e,t,n)=>{let{blockShape:r,crops:a}=n;return{x:()=>hx(e,r,a)}}},hfe={kernelName:wU,gradFunc:(e,t,n)=>{let r=n,a=r.inputShape,s=r.shape,i=Array.from(s);for(let l=a.length-1;l>=0;l--)if(a[l]===s[l])i[l]=1;else if(a[l]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${s}].`);let o=[];for(let l=0;l<i.length;l++)i[l]>1&&o.push(l);return{x:()=>Ye(e,o,!0)}}},dfe={kernelName:Fd,gradFunc:e=>({x:()=>e.clone()})},pfe={kernelName:Pd,gradFunc:e=>({x:()=>Ut(e)})},ffe={kernelName:Vc,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{clipValueMin:a,clipValueMax:s}=n;return{x:()=>ra(Ei(tu(r,a),jc(r,s)),e,Ut(e))}}},mfe={kernelName:Mv,inputsToSave:["x"],gradFunc:F6.gradFunc},gfe={kernelName:Qm,saveAllInputs:!0,gradFunc:(e,t,n)=>{let r=t.map(o=>o.shape),{axis:a}=n,s=Ni(a,t[0].shape)[0],i=r.map(o=>o[s]);return is(e,i,s).map(o=>()=>o)}},yfe={kernelName:Ld,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{dilations:s,strides:i,pad:o,dataFormat:l}=n;return X(xc(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>cC(r.shape,e,a,i,o,l),filter:()=>qC(r,e,a.shape,i,o,l)}}},bfe={kernelName:zd,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{strides:s,pad:i,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>ja(e,a,s,i,o,1,l),filter:()=>qC(e,r,a.shape,s,i,o,l)}}};function vfe(e,t,n,r,a){let s=e;e.rank===4&&(s=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let i=t;i.rank===4&&(i=ie(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),X(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),X(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),X(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),X(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),X(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);let o={x:s,dy:i},l={strides:r,pad:a,filterShape:n};return J.runKernel(Zm,o,l)}var xfe=te({conv3DBackpropFilter_:vfe}),wfe={kernelName:Vd,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s}=n;X(xc(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[i,o]=t;return{x:()=>aB(i.shape,e,o,a,s),filter:()=>xfe(i,e,o.shape,a,s)}}},_fe={kernelName:Ud,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(Mn(eS(ze(n,"float32"))),e)}}},Sfe={kernelName:Bd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(tS(ze(n,"float32")),e)}}},Ife={kernelName:Wd,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a,exclusive:s,reverse:i}=n;return{x:()=>{let o=cB([a],r.rank),l=B1(e,a,s,!i);return o!=null&&(l=Ct(l,o)),l}}}},Tfe={kernelName:jd,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s,dimRoundingMode:i}=n,o=r??[1,1];X(xc(o),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);let[l,h]=t;return X(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),X(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`),X(l.shape[3]===h.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),X(Zo(a,o),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${o}'.`),Ka("depthwiseConv2d",s,i),{x:()=>ZB(l.shape,e,h,a,s,o,i),filter:()=>QB(l,e,h.shape,a,s,o,i)}}},kfe={kernelName:Hd,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,s={x:r,filter:a,dy:e},i={x:r,filter:a,dy:e};return{x:()=>J.runKernel(fm,s,n),filter:()=>J.runKernel(mm,i,n)}}},Efe={kernelName:qd,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t,r={dy:e,y:n};return{x:()=>J.runKernel(rg,r)}}},Nfe={kernelName:Kd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=re(Ea(Mn(_n(n))),2/Math.sqrt(Math.PI));return{x:()=>re(e,r)}}},Cfe={kernelName:Xd,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,n)}}},Afe={kernelName:sg,inputsToSave:["input"],gradFunc:(e,t)=>{let[n]=t;return{input:()=>ie(e,n.shape)}}},Rfe={kernelName:Yd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,Ea(n))}}},Dfe={kernelName:Qd,gradFunc:e=>({x:()=>Ut(e)})},Mfe={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=Ke(e,ze(r,"float32")),i=Cr(n.shape,a);return i.length>0?ie(Ye(s,i),n.shape):s},b:()=>{let s=re(e,ze(n,"float32")),i=Cr(r.shape,a);i.length>0&&(s=ie(Ye(s,i),r.shape));let o=_n(r);return Mn(Ke(s,ze(o,"float32")))}}}},$fe={kernelName:Jd,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{let{varianceEpsilon:r}=n,[a,s,i,o]=t,l=o??rt(1),h=Cr(s.shape,a.shape),c=[];if(s.rank===1){for(let v=0;v<a.shape.length-1;++v)c.push(a.shape[v]);c.push(1)}let p=Ge(a,s),m=re(e,l),g=Z1(Se(i,rt(r))),b=re(re(re(g,g),g),rt(-.5));return{x:()=>s.rank===1?ie(re(re(e,Rs(ie(g,[1,1,1,s.shape[0]]),c)),l),a.shape):ie(re(re(e,g),l),a.shape),mean:()=>{let v=re(re(g,rt(-1)),m);return s.rank===1&&(v=Ye(v,h)),ie(v,s.shape)},variance:()=>{let v=re(re(b,p),m);return s.rank===1&&(v=Ye(v,h)),ie(v,s.shape)},scale:()=>{let v=re(p,g),x=re(e,v);return s.rank===1&&(x=Ye(x,h)),ie(x,s.shape)},offset:()=>{let v=e;return s.rank===1&&(v=Ye(v,h)),ie(v,s.shape)}}}},Ofe={kernelName:og,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{let[r,a]=t,{axis:s,batchDims:i}=n,o=Ni(s,r.shape)[0],l=(h,c,p)=>()=>{let m=h.shape,g=c.size,b=m.slice(0,o),v=b.length,x=m.slice(s,m.length).slice(1),_=x.length,I=AP(0,v),k=AP(v+1,v+1+_),E=RP([b,[g],x]),R=ie(p,E),U=ie(c,[g]),D=RP([[v],I,k]),C=Ct(R,D),O=uS(C,U,h.shape[o]),z=bC(D);return O=Ct(O,z),O};if(i===1){let h=r.shape[0],c=r.split(h,0);return{x:()=>Nr(c.map((p,m)=>l(p,a.slice(m,1),e.slice(m,1))())).reshape(r.shape),indices:()=>a}}else return{x:l(r,a,e),indices:()=>a}}};function AP(e,t){let n=[];for(let r=e;r<t;++r)n.push(r);return n}function RP(e){let t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ffe={kernelName:ep,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>Ut(n),b:()=>Ut(r)}}},Pfe={kernelName:tp,gradFunc:e=>({x:()=>ze(e,"float32")})},Lfe={kernelName:np,gradFunc:e=>({x:()=>Ut(e)})},zfe={kernelName:rp,gradFunc:e=>({x:()=>Ut(e)})},Vfe={kernelName:ap,gradFunc:e=>({x:()=>Ut(e)})},Ufe={kernelName:sp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{alpha:a}=n,s=Xa(r,0);return{x:()=>ra(s,e,re(e,a))}}},Bfe={kernelName:op,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,Se(n,1))}}},Wfe={kernelName:ip,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,ze(n,"float32"))}}},jfe={kernelName:SU,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n;return{logits:()=>{let s=Ea(r);return Ge(e,re(Ye(e,a,!0),s))}}}};function Hfe(e,t,n,r=5,a=1,s=1,i=.5){let o={x:e,y:t,dy:n},l={depthRadius:r,bias:a,alpha:s,beta:i};return J.runKernel(gg,o,l)}var Gfe=te({localResponseNormalizationBackprop_:Hfe}),qfe={kernelName:lp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{depthRadius:s,bias:i,alpha:o,beta:l}=n;return{x:()=>Gfe(r,a,e,s,i,o,l)}}};function P6(e,t,n,r){return t.rank<n.rank&&(t=ie(t,cd(t.shape,r))),e.rank<n.rank&&(e=ie(e,cd(e.shape,r))),{x:()=>re(e,ze(Ms(n,t),e.dtype))}}var DP={kernelName:up,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{reductionIndices:a}=r,s=t[0],i=t[1],o=Ni(a,s.shape),l=P6(e,i,s,o);return{x:()=>l.x()}}},Kfe={kernelName:cp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>re(e,ze(tu(n,r),"float32")),b:()=>re(e,ze(bm(n,r),"float32"))}}};function Xfe(e,t,n,r,a,s,i){let o=W(e,"dy","maxPool3dGrad"),l=W(t,"input","maxPool3dGrad"),h=W(n,"output","maxPool3dGrad"),c=o,p=l,m=h,g=!1;l.rank===4&&(g=!0,c=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),p=ie(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),m=ie(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),X(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),X(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),X(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Ka("maxPool3dGrad",s,i);let b={dy:c,input:p,output:m},v={filterSize:r,strides:a,pad:s,dimRoundingMode:i},x=J.runKernel(Lv,b,v);return g?ie(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}var Yfe=te({maxPool3dGrad_:Xfe}),Qfe={kernelName:yg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l}=n;return{x:()=>Yfe(e,r,a,s,i,o,l)}}};function Zfe(e,t,n,r,a,s,i){let o=W(e,"dy","maxPoolGrad"),l=W(t,"input","maxPoolGrad"),h=W(n,"output","maxPoolGrad");X(l.rank===o.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`),X(o.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`),X(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ka("maxPoolGrad",s,i);let c={dy:o,input:l,output:h},p={filterSize:r,strides:a,pad:s,dimRoundingMode:i};return J.runKernel(Pv,c,p)}var Jfe=te({maxPoolGrad_:Zfe}),eme={kernelName:hp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:i,pad:o}=n;return{x:()=>Jfe(e,r,a,s,i,o)}}},tme={kernelName:dp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=Ni(a,r.shape),i=uB(r.shape,s)[1],o=gn(i);return{x:()=>{let l=r.shape.slice();s.forEach(c=>{l[c]=1});let h=ie(e,l);return Ke(re(h,as(r.shape,"float32")),o)}}}},nme={kernelName:pp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{axis:a}=r,[s,i]=t,o=Ni(a,s.shape),l=P6(e,i,s,o);return{x:()=>l.x()}}},rme={kernelName:fp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>re(e,ze(jc(n,r),"float32")),b:()=>re(e,ze(Xa(n,r),"float32"))}}},ame={kernelName:mp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(i=>i[0]);return{x:()=>Pt(e,s,r.shape)}}},sme={kernelName:gp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=Cr(n.shape,a);return s.length>0?ie(Ye(e,s),n.shape):e},b:()=>{let s=re(e,Mn(qg(Ke(n,r)))),i=Cr(r.shape,a);return i.length>0?ie(Ye(s,i),r.shape):s}}}},ime={kernelName:yp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=re(e,ze(r,"float32")),i=Cr(n.shape,a);return i.length>0?ie(Ye(s,i),n.shape):s},b:()=>{let s=re(e,ze(n,"float32")),i=Cr(r.shape,a);return i.length>0?ie(Ye(s,i),r.shape):s}}}},ome={kernelName:vg,gradFunc:e=>({x:()=>Mn(e)})},lme={kernelName:bp,inputsToSave:["indices"],gradFunc:(e,t)=>{let n=t[0];return{indices:()=>Zn(n.shape,"float32")}}},ume={kernelName:Ig,gradFunc:e=>({x:()=>Ut(e)})},cme={kernelName:Tg,saveAllInputs:!0,gradFunc:(e,t,n)=>{let{axis:r}=n;return or(e,r).map(a=>()=>a)}},MP={kernelName:vp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(i=>i[0]);return{x:()=>Pt(e,s,r.shape)}}},hme={kernelName:xp,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{let[n,r,a]=t,s=n,i=r,o=In(s.shape,i.shape);return{a:()=>{let l=ze(i,"float32"),h=re(e,re(l,qo(s,Ge(l,rt(1))))),c=Cr(s.shape,o);return c.length>0&&(h=Ye(h,c)),ie(h,s.shape)},b:()=>{let l=Xa(s,0),h=ra(l,$s(s),Ut(s)),c=re(e,re(a,h)),p=Cr(i.shape,o);return p.length>0&&(c=Ye(c,p)),ie(c,i.shape)}}}},dme={kernelName:wp,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{let[n,r]=t,a=Xa(n,0);return{x:()=>ra(a,e,re(e,r)),alpha:()=>{let s=ra(a,Ut(e),re(e,n)),i=Cr(r.shape,e.shape);return i.length>0&&(s=Ye(s,i)),ie(s,r.shape)}}}};function pme(e,t,n){let r=e.shape.slice();r[n]=1;let a=ie(t,r),s=nv(e,n,!0,!1),i=nv(e,n,!0,!0),o=re(s,i);return re(a,o)}function fme(e,t,n){let r=e.shape.length,a=r-n.length,s=B.getAxesPermutation(n,r),i=e;s!=null&&(i=Ct(e,s));let o=i.shape.slice(),l=o.splice(r-n.length,n.length).reduce((p,m)=>p*m,1);o.push(l);let h=i.reshape(o),c=pme(h,t,a);if(c=c.reshape(i.shape),s!=null){let p=B.getUndoAxesPermutation(s);c=Ct(c,p)}return c}var mme={kernelName:_p,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=[];return a==null?s=r.shape.map((i,o)=>o):typeof a=="number"?s=[a]:s=a,{x:()=>fme(r,e,s)}}},gme={kernelName:Gd,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=Ke(e,ze(r,"float32")),i=Cr(n.shape,a);return i.length>0?ie(Ye(s,i),n.shape):s},b:()=>{let s=re(e,ze(n,"float32")),i=Cr(r.shape,a);i.length>0&&(s=ie(Ye(s,i),r.shape));let o=_n(r);return Mn(Ke(s,ze(o,"float32")))}}}},yme={kernelName:Sp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,Mn(_n(n)))}}},bme={kernelName:Ep,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=re(jc(n,6),qp(n));return{x:()=>re(e,ze(r,"float32"))}}},vme={kernelName:Ip,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,ze(qp(n),"float32"))}}},xme={kernelName:kg,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ie(e,n.shape)}}},wme={kernelName:kp,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>J.runKernel(Ng,a,n)}}},_me={kernelName:Tp,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>J.runKernel(Eg,a,n)}}},Sme={kernelName:Np,gradFunc:(e,t,n)=>{let{dims:r}=n,a=Ni(r,e.shape);return{x:()=>ri(e,a)}}},Ime={kernelName:Cp,gradFunc:e=>({x:()=>Ut(e)})},Tme={kernelName:Ap,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Mn(Ke(e,re(qo(n,1.5),2)))}}},kme={kernelName:Dg,inputsToSave:["condition"],gradFunc:(e,t)=>{let[n]=t;return{condition:()=>ze(Ut(n),"float32"),t:()=>re(e,ze(n,e.dtype)),e:()=>re(e,ze(ux(n),e.dtype))}}},Eme={kernelName:Rp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=Xa(n,rt(0)),a=rt(M6),s=rt($6),i=re(e,s),o=re(re(e,a),Ea(ze(n,"float32")));return ra(r,i,o)}}}},Nme={kernelName:Op,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,re(n,Ge(rt(1),n)))}}},Cme={kernelName:$p,gradFunc:e=>({x:()=>Ut(e)})},Ame={kernelName:Dp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(ax(ze(n,"float32")),e)}}},Rme={kernelName:Mp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(U1(ze(n,"float32")),e)}}},Dme={kernelName:Mg,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{begin:a,size:s}=n,i=r.shape,[o,l]=R6(r,a,s),h=[];for(let c=0;c<e.rank;c++)h.push([o[c],i[c]-o[c]-l[c]]);return{x:()=>io(e,h)}}},Mme={kernelName:zp,outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{dim:a}=n,s=!0,i=re(e,r);return{logits:()=>Ge(i,re(Ye(i,[a],s),r))}}},$me={kernelName:Fp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,Ti(n))}}},$P={kernelName:$g,gradFunc:(e,t,n)=>{let{blockShape:r,paddings:a}=n;return{x:()=>rx(e,r,a)}}},OP={kernelName:Og,gradFunc:(e,t,n)=>{let{axis:r}=n;return{x:()=>Sn(e,r)}}},Ome={kernelName:Pp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,re(aa(ze(n,"float32")),2))}}},Fme={kernelName:jv,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,re(ze(n,"float32"),2))}}},Pme={kernelName:Vp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rt(2);return{a:()=>re(e,re(a,Ge(n,r))),b:()=>re(e,re(a,Ge(r,n)))}}},Lme={kernelName:Bc,gradFunc:e=>({x:()=>Ut(e)})},zme={kernelName:Up,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=In(n.shape,r.shape);return{a:()=>{let s=e,i=Cr(n.shape,a);return i.length>0&&(s=Ye(s,i)),ie(s,n.shape)},b:()=>{let s=e,i=Cr(r.shape,a);return i.length>0&&(s=Ye(s,i)),ie(Mn(s),r.shape)}}}},Vme={kernelName:Lp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,a=r.shape.slice(),{axis:s}=n;Ni(s,r.shape).forEach(l=>{a[l]=1});let i=ie(e,a),o=re(i,as(r.shape,"float32"));return{x:()=>o}}},Ume={kernelName:Bp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Ke(e,_n(ax(n)))}}},Bme={kernelName:Wp,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(Ge(rt(1),_n(n)),e)}}},Wme={kernelName:Uc,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{reps:a}=n;return{x:()=>{let s=Ut(r);if(r.rank===1)for(let i=0;i<a[0];++i)s=Se(s,Pt(e,[i*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let i=0;i<a[0];++i)for(let o=0;o<a[1];++o)s=Se(s,Pt(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let i=0;i<a[0];++i)for(let o=0;o<a[1];++o)for(let l=0;l<a[2];++l)s=Se(s,Pt(e,[i*r.shape[0],o*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let i=0;i<a[0];++i)for(let o=0;o<a[1];++o)for(let l=0;l<a[2];++l)for(let h=0;h<a[3];++h)s=Se(s,Pt(e,[i*r.shape[0],o*r.shape[1],l*r.shape[2],h*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}},jme={kernelName:Vl,gradFunc:(e,t,n)=>{let r=n,{perm:a}=r,s=bC(a);return{x:()=>Ct(e,s)}}},Hme={kernelName:Ug,gradFunc:(e,t,n)=>{let r=n,{axis:a}=r;return{value:()=>Nr(e,a)}}},Gme={kernelName:Yv,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>qme(e,n)}}};function qme(e,t){let n=Jo(t,Ut(t)),r=Kg(e,n),a=tu(t,rt(0,"int32")),s=r.rank-a.rank;for(let o=0;o<s;++o)a=ea(a,o+1);a=Ei(a,as(r.shape,"bool"));let i=Ut(r);return ra(a,r,i)}var Kme={kernelName:Bg,gradFunc:e=>({x:()=>Ut(e)})},Xme=[F6,Gpe,qpe,Kpe,Xpe,Ype,Qpe,Zpe,Jpe,efe,tfe,nfe,sfe,lfe,ufe,cfe,hfe,dfe,pfe,ffe,mfe,gfe,bfe,yfe,wfe,_fe,Sfe,Ife,Tfe,kfe,gme,Efe,Nfe,Cfe,Afe,Rfe,Mfe,Dfe,$fe,Ofe,Ffe,Pfe,Lfe,zfe,Vfe,Ufe,Bfe,Wfe,jfe,qfe,DP,DP,Kfe,Qfe,eme,tme,nme,rme,ame,sme,ime,ome,lme,ume,cme,MP,MP,hme,dme,mme,yme,bme,vme,xme,wme,_me,Sme,Ime,Tme,kme,Eme,Nme,Cme,Ame,Rme,Dme,Mme,$me,$P,$P,OP,OP,Ome,Pme,Fme,Lme,zme,Vme,Ume,Bme,Wme,jme,Hme,Gme,Kme];for(let e of Xme)IU(e);ke().prototype.abs=function(){return this.throwIfDisposed(),Tr(this)};ke().prototype.acos=function(){return this.throwIfDisposed(),H2(this)};ke().prototype.acosh=function(){return this.throwIfDisposed(),G2(this)};ke().prototype.add=function(e){return this.throwIfDisposed(),Se(this,e)};ke().prototype.all=function(e,t){return this.throwIfDisposed(),L1(this,e,t)};ke().prototype.any=function(e,t){return this.throwIfDisposed(),Jb(this,e,t)};ke().prototype.argMax=function(e){return this.throwIfDisposed(),ld(this,e)};ke().prototype.argMin=function(e){return this.throwIfDisposed(),q2(this,e)};ke().prototype.asScalar=function(){return this.throwIfDisposed(),X(this.size===1,()=>"The array must have only 1 element."),ie(this,[])};ke().prototype.asType=function(e){return this.throwIfDisposed(),ze(this,e)};ke().prototype.as1D=function(){return this.throwIfDisposed(),ie(this,[this.size])};ke().prototype.as2D=function(e,t){return this.throwIfDisposed(),ie(this,[e,t])};ke().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),ie(this,[e,t,n])};ke().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),ie(this,[e,t,n,r])};ke().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),ie(this,[e,t,n,r,a])};ke().prototype.asin=function(){return this.throwIfDisposed(),K2(this)};ke().prototype.asinh=function(){return this.throwIfDisposed(),X2(this)};ke().prototype.atan=function(){return this.throwIfDisposed(),Y2(this)};ke().prototype.atan2=function(e){return this.throwIfDisposed(),Q2(this,e)};ke().prototype.atanh=function(){return this.throwIfDisposed(),Z2(this)};ke().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),eu(this,e,t,n,r)};ke().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),rx(this,e,t)};ke().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),jp(this,e,t,n,r,a)};ke().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Wh(this,e)};ke().prototype.cast=function(e){return this.throwIfDisposed(),ze(this,e)};ke().prototype.ceil=function(){return this.throwIfDisposed(),sC(this)};ke().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ka(this,e,t)};ke().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Tt&&(e=[e]),Sn([this,...e],t)};ke().prototype.conv1d=function(e,t,n,r,a,s){return this.throwIfDisposed(),z1(this,e,t,n,r,a,s)};ke().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),V1(this,e,t,n,r,a)};ke().prototype.conv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),ja(this,e,t,n,r,a,s)};ke().prototype.cos=function(){return this.throwIfDisposed(),ax(this)};ke().prototype.cosh=function(){return this.throwIfDisposed(),U1(this)};ke().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),nv(this,e,t,n)};ke().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),B1(this,e,t,n)};ke().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),pC(this,e,t)};ke().prototype.depthwiseConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Hp(this,e,t,n,r,a,s)};ke().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),fC(this,e,t,n,r,a)};ke().prototype.divNoNan=function(e){return this.throwIfDisposed(),mC(this,e)};ke().prototype.div=function(e){return this.throwIfDisposed(),Ke(this,e)};ke().prototype.dot=function(e){return this.throwIfDisposed(),gC(this,e)};ke().prototype.elu=function(){return this.throwIfDisposed(),Hg(this)};ke().prototype.equal=function(e){return this.throwIfDisposed(),Ms(this,e)};ke().prototype.erf=function(){return this.throwIfDisposed(),W1(this)};ke().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),vC(this,e,t)};ke().prototype.exp=function(){return this.throwIfDisposed(),Ea(this)};ke().prototype.expandDims=function(e){return this.throwIfDisposed(),ea(this,e)};ke().prototype.expm1=function(){return this.throwIfDisposed(),xC(this)};ke().prototype.fft=function(){return this.throwIfDisposed(),fx(this)};ke().prototype.flatten=function(){return this.throwIfDisposed(),ie(this,[this.size])};ke().prototype.floor=function(){return this.throwIfDisposed(),qg(this)};ke().prototype.floorDiv=function(e){return this.throwIfDisposed(),P1(this,e)};ke().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Kg(this,e,t,n)};ke().prototype.greaterEqual=function(e){return this.throwIfDisposed(),tu(this,e)};ke().prototype.greater=function(e){return this.throwIfDisposed(),Xa(this,e)};ke().prototype.ifft=function(){return this.throwIfDisposed(),_m(this)};ke().prototype.irfft=function(){return this.throwIfDisposed(),rS(this)};ke().prototype.isFinite=function(){return this.throwIfDisposed(),wC(this)};ke().prototype.isInf=function(){return this.throwIfDisposed(),_C(this)};ke().prototype.isNaN=function(){return this.throwIfDisposed(),SC(this)};ke().prototype.leakyRelu=function(e){return this.throwIfDisposed(),ix(this,e)};ke().prototype.lessEqual=function(e){return this.throwIfDisposed(),jc(this,e)};ke().prototype.less=function(e){return this.throwIfDisposed(),bm(this,e)};ke().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),IC(this,e,t,n,r)};ke().prototype.logSigmoid=function(){return this.throwIfDisposed(),TC(this)};ke().prototype.logSoftmax=function(e){return this.throwIfDisposed(),G1(this,e)};ke().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),lx(this,e,t)};ke().prototype.log=function(){return this.throwIfDisposed(),$s(this)};ke().prototype.log1p=function(){return this.throwIfDisposed(),ox(this)};ke().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ei(this,e)};ke().prototype.logicalNot=function(){return this.throwIfDisposed(),ux(this)};ke().prototype.logicalOr=function(e){return this.throwIfDisposed(),q1(this,e)};ke().prototype.logicalXor=function(e){return this.throwIfDisposed(),kC(this,e)};ke().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Nt(this,e,t,n)};ke().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Qr(this,e,t,n,r)};ke().prototype.max=function(e,t){return this.throwIfDisposed(),ei(this,e,t)};ke().prototype.maximum=function(e){return this.throwIfDisposed(),Jo(this,e)};ke().prototype.mean=function(e,t){return this.throwIfDisposed(),Qn(this,e,t)};ke().prototype.min=function(e,t){return this.throwIfDisposed(),ym(this,e,t)};ke().prototype.minimum=function(e){return this.throwIfDisposed(),_c(this,e)};ke().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),NC(this,e,t)};ke().prototype.mod=function(e){return this.throwIfDisposed(),CC(this,e)};ke().prototype.mul=function(e){return this.throwIfDisposed(),re(this,e)};ke().prototype.neg=function(){return this.throwIfDisposed(),Mn(this)};ke().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Gg(this,e,t,n)};ke().prototype.notEqual=function(e){return this.throwIfDisposed(),hd(this,e)};ke().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),vm(this,e,t,n)};ke().prototype.onesLike=function(){return this.throwIfDisposed(),Os(this)};ke().prototype.pad=function(e,t){return this.throwIfDisposed(),io(this,e,t)};ke().prototype.pool=function(e,t,n,r,a,s){return this.throwIfDisposed(),AC(this,e,t,n,r,a,s)};ke().prototype.pow=function(e){return this.throwIfDisposed(),qo(this,e)};ke().prototype.prelu=function(e){return this.throwIfDisposed(),dx(this,e)};ke().prototype.prod=function(e,t){return this.throwIfDisposed(),RC(this,e,t)};ke().prototype.reciprocal=function(){return this.throwIfDisposed(),FC(this)};ke().prototype.relu=function(){return this.throwIfDisposed(),fn(this)};ke().prototype.relu6=function(){return this.throwIfDisposed(),Y1(this)};ke().prototype.reshapeAs=function(e){return this.throwIfDisposed(),ie(this,e.shape)};ke().prototype.reshape=function(e){return this.throwIfDisposed(),ie(this,e)};ke().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),a6(this,e,t,n)};ke().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),s6(this,e,t,n)};ke().prototype.reverse=function(e){return this.throwIfDisposed(),ri(this,e)};ke().prototype.rfft=function(){return this.throwIfDisposed(),mx(this)};ke().prototype.round=function(){return this.throwIfDisposed(),Q1(this)};ke().prototype.rsqrt=function(){return this.throwIfDisposed(),Z1(this)};ke().prototype.selu=function(){return this.throwIfDisposed(),J1(this)};ke().prototype.separableConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Xg(this,e,t,n,r,a,s)};ke().prototype.sigmoid=function(){return this.throwIfDisposed(),Ti(this)};ke().prototype.sign=function(){return this.throwIfDisposed(),PC(this)};ke().prototype.sin=function(){return this.throwIfDisposed(),eS(this)};ke().prototype.sinh=function(){return this.throwIfDisposed(),tS(this)};ke().prototype.slice=function(e,t){return this.throwIfDisposed(),Pt(this,e,t)};ke().prototype.softmax=function(e){return this.throwIfDisposed(),Gc(this,e)};ke().prototype.softplus=function(){return this.throwIfDisposed(),Gp(this)};ke().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),hx(this,e,t)};ke().prototype.split=function(e,t){return this.throwIfDisposed(),is(this,e,t)};ke().prototype.sqrt=function(){return this.throwIfDisposed(),aa(this)};ke().prototype.square=function(){return this.throwIfDisposed(),_n(this)};ke().prototype.squaredDifference=function(e){return this.throwIfDisposed(),aS(this,e)};ke().prototype.squeeze=function(e){return this.throwIfDisposed(),qc(this,e)};ke().prototype.stack=function(e,t){this.throwIfDisposed();let n=e instanceof Tt?[this,e]:[this,...e];return Nr(n,t)};ke().prototype.step=function(e){return this.throwIfDisposed(),qp(this,e)};ke().prototype.stridedSlice=function(e,t,n,r,a,s,i,o){return this.throwIfDisposed(),LC(this,e,t,n,r,a,s,i,o)};ke().prototype.sub=function(e){return this.throwIfDisposed(),Ge(this,e)};ke().prototype.sum=function(e,t){return this.throwIfDisposed(),Ye(this,e,t)};ke().prototype.tan=function(){return this.throwIfDisposed(),zC(this)};ke().prototype.tanh=function(){return this.throwIfDisposed(),wc(this)};ke().prototype.tile=function(e){return this.throwIfDisposed(),Rs(this,e)};ke().prototype.toBool=function(){return this.throwIfDisposed(),ze(this,"bool")};ke().prototype.toFloat=function(){return this.throwIfDisposed(),ze(this,"float32")};ke().prototype.toInt=function(){return this.throwIfDisposed(),ze(this,"int32")};ke().prototype.topk=function(e,t){return this.throwIfDisposed(),UC(this,e,t)};ke().prototype.transpose=function(e){return this.throwIfDisposed(),Ct(this,e)};ke().prototype.unique=function(e){return this.throwIfDisposed(),BC(this,e)};ke().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),uS(this,e,t)};ke().prototype.unstack=function(e){return this.throwIfDisposed(),or(this,e)};ke().prototype.where=function(e,t){return this.throwIfDisposed(),ra(e,this,t)};ke().prototype.zerosLike=function(){return this.throwIfDisposed(),Ut(this)};var Bu=class L6 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,L6.prototype)}},Mo=class z6 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,z6.prototype)}},le=class V6 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,V6.prototype)}},Ot=class U6 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,U6.prototype)}},Yme=class B6 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,B6.prototype)}},W6=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function pd(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{let n=new Array(t);return n.fill(e),n}}function Ao(e,t){if(!e)throw new Yme(t)}function FP(e,t){let n=0;for(let r of e)r===t&&n++;return n}function rs(e){return e.length===1?e[0]:e}function pn(e){return Array.isArray(e)?e:[e]}function Cl(e){let t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Mh(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}var xi={};function oA(e){if(e==null)return null;let t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function NE(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>NE(t));else{let t=Object.keys(e);for(let n of t){let r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:NE(r))}}}function yx(e,t={},n={},r="object",a=!1){if(typeof e=="string"){let s=e,i;if(s in n)i=n[s];else if(s in xi)i=xi[s];else if(i=t[s],i==null)throw new le(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=e;if(s.className==null||s.config==null)throw new le(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,o,l;if(i in n?[o,l]=n[i]:i in xi?[o,l]=xi.className:i in t&&([o,l]=t[i]),o==null)throw new le(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let h={};for(let g of Object.keys(xi))h[g]=xi[g];for(let g of Object.keys(n))h[g]=n[g];let c=s.config;c.customObjects=h;let p=Object.assign({},xi);for(let g of Object.keys(n))xi[g]=n[g];NE(s.config);let m=l(o,s.config,n,a);return xi=Object.assign({},p),m}else{let h=Object.assign({},xi);for(let p of Object.keys(n))xi[p]=n[p];let c=new o(s.config);return xi=Object.assign({},h),c}}}function Qme(e,t){return e<t?-1:e>t?1:0}function a0(e,t){return-1*Qme(e,t)}function sc(e){if(e==null)return e;let t=[];for(let n of e)t.indexOf(n)===-1&&t.push(n);return t}function Zme(e){if(e==null)throw new le(`Invalid value in obj: ${JSON.stringify(e)}`);for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}function Kp(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new le(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function lA(e,t,n=0,r=1/0){return Ao(n>=0),Ao(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(a=>typeof a===t)}function ta(e,t){Array.isArray(e)?($.assert(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>ta(n,`element ${r+1} of ${t}`))):$.assert(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${j6(e)}.`)}function j6(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>j6(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function Jme(e,t,n){let r=n!=null?n():$.now(),a;return(...s)=>{let i=n!=null?n():$.now();return i-r<t||(r=i,a=e(...s)),a}}function H6(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}var ege=0;function G6(){return ege++}var s0={};function gS(e=""){return e in s0||(s0[e]=0),s0[e]+=1,e+s0[e].toString()}var tge=["channelsFirst","channelsLast"],nge=["nearest","bilinear"],rge=["valid","same","causal"],age=["max","avg"],sge=["sum","mul","concat","ave"],zf=new Map;function yr(e){Kp(tge,"DataFormat",e)}function ige(e){Kp(nge,"InterpolationFormat",e)}function ai(e){Kp(rge,"PaddingMode",e)}function q6(e){Kp(age,"PoolMode",e)}var Rb=[],PP="/";function jh(e,t){Rb.push(e);try{let n=t();return Rb.pop(),n}catch(n){throw Rb.pop(),n}}function oge(){return Rb.length===0?"":Rb.join(PP)+PP}function K6(e){if(!Y6(e))throw new Error("Not a valid tensor name: '"+e+"'");return oge()+e}function X6(e){if(!Y6(e))throw new Error("Not a valid tensor name: '"+e+"'");zf.has(e)||zf.set(e,0);let t=zf.get(e);if(zf.set(e,zf.get(e)+1),t>0){let n=`${e}_${t}`;return zf.set(n,1),n}else return e}var lge=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Y6(e){return!!e.match(lge)}function uge(e){return e===parseInt(e.toString(),10)}function ic(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function Im(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r<t&&(t=r)}return t}function Ic(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r>t&&(t=r)}return t}function eo(e,t){if(t<e)throw new le(`end (${t}) < begin (${e}) is forbidden.`);let n=[];for(let r=e;r<t;++r)n.push(r);return n}var mk;function Wr(){return mk==null&&(mk=U2().epsilon()),mk}function to(){return"channelsLast"}function Xl(e,t){return ze(e,t)}function bx(e,t=-1){let n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),ie(e,n)}function cge(e,t){return oe(()=>{if(e.shape.length!==2)throw new le(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);let n=bx(e,1);return CE(n,[1,t,1])})}function hge(e){let t=[ic(e.shape)];return ie(e,t)}function dge(e){if(e.rank<=1)throw new le(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);let t=[e.shape[0],ic(e.shape,1)];return ie(e,t)}function Hh(e,t,n){return oe(()=>{switch(e.rank){case 1:return px(e,t,n);case 2:return nS(e,[t,0],[n,e.shape[1]]);case 3:return Yg(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return wm(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Pt(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Pt(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new le(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function gk(e,t,n){return oe(()=>{switch(e.rank){case 1:return px(e,t,n);case 2:return nS(e,[0,t],[e.shape[0],n]);case 3:return Yg(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return wm(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new le(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function i0(e,t,n,r){return oe(()=>{switch(e.rank){case 1:return px(e,t,n);case 2:switch(r){case 1:return Hh(e,t,n);case 2:return gk(e,t,n);default:throw new le(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Hh(e,t,n);case 2:return Yg(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return gk(e,t,n);default:throw new le(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Hh(e,t,n);case 2:return wm(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return wm(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return gk(e,t,n);default:throw new le(`The axis is not within the rank of the tensor ${r}`)}default:throw new le(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function uA(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),Sn(e,t)}function LP(e,t){switch(e.rank){case 1:return iC([e,t]);case 2:return oC([e,t],0);case 3:return lC([e,t],0);case 4:return uC([e,t],0);default:throw new le(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function CE(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new le(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return Rs(e,t)}function yS(e,t=0,n=1,r,a){return X1(e,t,n,r,a)}function Wo(e,t,n,r){if(e.rank<2||t.rank<2)throw new Ot(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){let a=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(a!==s)throw new Ot(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return Sm.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?AE(e.rank,r,to()):null,activation:n});{let a=e.shape.slice(),s=a.pop();e=ie(e,[-1,s]);let i=t.shape.slice(),o=i.pop(),l=i.pop(),h=[...i,o],c=Array.from({length:t.rank},(m,g)=>g===0?t.rank-2:g<=t.rank-2?g-1:g);t=ie(Ct(t,c),[l,-1]);let p=[...a,...h];return ie(Sm.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?AE(e.rank,r,to()):null,activation:n}),p)}}function Q6(e,t,n){return oe(()=>(Array.isArray(t)?t=dn(t,"int32"):t=ze(t,"int32"),Kg(e,t,n)))}function vx(e){return re(e,e)}function AE(e,t,n){let r=t.shape;if(t.rank!==1&&t.rank!==e)throw new le(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?ie(t,[1,r[0],1,1,1]):ie(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?ie(t,[1,1,1,1,r[0]]):ie(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?ie(t,[1,r[0],1,1]):ie(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?ie(t,[1,1,1,r[0]]):ie(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?ie(t,[1,r[0],1]):ie(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?ie(t,[1,1,r[0]]):ie(t,[1].concat(r))}else if(e<3)return t;throw new le(`Unsupported input rank by biasAdd: ${t.rank}`)}function oo(e,t,n){return oe(()=>(n==null&&(n=to()),yr(n),Se(e,AE(e.rank,t,n))))}function pge(e,t=1){if(t!==1)throw new Ot(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Hg(e)}function fge(e){return oe(()=>Ke(e,Se(Tr(e),1)))}function Z6(e,t,n,r){return oe(()=>HC(e,t,n,r))}function mge(e){return oe(()=>{let t=Se(.5,re(.2,e));return ka(t,0,1)})}function xx(e,t,n=!1){return n?e():t()}var gge=["fanIn","fanOut","fanAvg"],yge=["normal","uniform","truncatedNormal"];function bge(e){Kp(gge,"FanMode",e)}function vge(e){Kp(yge,"Distribution",e)}var Ci=class extends Re.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},cA=class extends Ci{apply(e,t){return Zn(e,t)}};cA.className="Zeros";Re.registerClass(cA);var bS=class extends Ci{apply(e,t){return as(e,t)}};bS.className="Ones";Re.registerClass(bS);var hA=class extends Ci{constructor(e){if(super(),typeof e!="object")throw new le(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new le(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return oe(()=>re(rt(this.value),as(e,t)))}getConfig(){return{value:this.value}}};hA.className="Constant";Re.registerClass(hA);var dA=class extends Ci{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Hc(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}};dA.className="RandomUniform";Re.registerClass(dA);var pA=class extends Ci{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`randomNormal does not support dType ${t}.`);return yS(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};pA.className="RandomNormal";Re.registerClass(pA);var fA=class extends Ci{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`truncatedNormal does not support dType ${t}.`);return lS(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};fA.className="TruncatedNormal";Re.registerClass(fA);var mA=class extends Ci{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return oe(()=>{if(e.length!==2||e[0]!==e[1])throw new le("Identity matrix initializer can only be used for 2D square matrices.");return re(this.gain,j1(e[0]))})}getConfig(){return{gain:this.gain}}};mA.className="Identity";Re.registerClass(mA);function xge(e,t="channelsLast"){let n,r;if(yr(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){let a=ic(e,2);n=e[1]*a,r=e[0]*a}else if(t==="channelsLast"){let a=ic(e,0,e.length-2);n=e[e.length-2]*a,r=e[e.length-1]*a}}else{let a=ic(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}var us=class extends Ci{constructor(e){if(super(),e.scale<0)throw new le(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,bge(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,vge(this.distribution),this.seed=e.seed}apply(e,t){let n=xge(e),r=n[0],a=n[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,r):this.mode==="fanOut"?s/=Math.max(1,a):s/=Math.max(1,(r+a)/2),this.distribution==="normal"){let i=Math.sqrt(s);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`${this.getClassName()} does not support dType ${t}.`);return lS(e,0,i,t,this.seed)}else{let i=Math.sqrt(3*s);return Hc(e,-i,i,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}};us.className="VarianceScaling";Re.registerClass(us);var vS=class extends us{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return us.className}};vS.className="GlorotUniform";Re.registerClass(vS);var xS=class extends us{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return us.className}};xS.className="GlorotNormal";Re.registerClass(xS);var wS=class extends us{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return us.className}};wS.className="HeNormal";Re.registerClass(wS);var _S=class extends us{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return us.className}};_S.className="HeUniform";Re.registerClass(_S);var SS=class extends us{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return us.className}};SS.className="LeCunNormal";Re.registerClass(SS);var IS=class extends us{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return us.className}};IS.className="LeCunUniform";Re.registerClass(IS);var gA=class extends Ci{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return oe(()=>{if(e.length<2)throw new Ot("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;let n=$.sizeFromShape(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);let s=[Math.max(r,n),Math.min(r,n)],i=yS(s,0,1,t,this.seed),o=XC.qr(i,!1),l=o[0],h=o[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return l=re(l,h.sign()),n<r&&(l=l.transpose()),re(rt(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}};gA.className="Orthogonal";Re.registerClass(gA);var zP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function VP(e,t={}){return yx(e,Re.SerializationMap.getMap().classNameMap,t,"initializer")}function Jn(e){return oA(e)}function Wn(e){if(typeof e=="string"){let t=e in zP?zP[e]:e;if(t==="GlorotNormal")return new xS;if(t==="GlorotUniform")return new vS;if(t==="HeNormal")return new wS;if(t==="HeUniform")return new _S;if(t==="LeCunNormal")return new SS;if(t==="LeCunUniform")return new IS;{let n={};return n.className=t,n.config={},VP(n)}}else return e instanceof Ci?e:VP(e)}function RE(e){return Array.isArray(e)&&Array.isArray(e[0])}function y_(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function ft(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new le(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function en(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new le(`Expected exactly 1 Shape; got ${e.length}`)}else return e}function b_(e){let t=0;for(let n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,a)=>r*a);return t}var UP="Variable",J6=class{constructor(e,t="float32",n=UP,r=!0,a=null){this.dtype=t??"float32",this.shape=e.shape,this.id=G6(),n=n??UP,this.originalName=K6(n),this.name=X6(this.originalName),this.trainable_=r,this.constraint=a,this.val=WC(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),wge(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function wge(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function DE(e){return e.map(t=>t.read())}function yA(e){e.forEach(t=>{t[0].write(t[1])})}var kr=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},no=class{constructor(e,t,n,r,a,s,i){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=i,this.id=G6(),s!=null&&(this.originalName=K6(s),this.name=X6(this.originalName)),this.rank=t.length}},_ge=0,TS=class{constructor(e,t){this.callArgs=t,this.id=_ge++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Sge=0,Ft=class extends Re.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Sge++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){let n=this.getClassName();t=Cl(n)+"_"+gS(n)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let a=null;e.batchSize!=null&&(a=e.batchSize),n=[a].concat(e.inputShape)}this.batchInputShape=n;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Mo(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new le(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return rs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return rs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Bu(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Bu(`Layer ${this.name} is not connected, no input to return.`);return rs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Bu(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Bu(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return rs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){let t=pn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;let n=pn(this.inputSpec);if(t.length!==n.length)throw new le(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){let a=t[r],s=n[r];if(s==null)continue;let i=a.rank;if(s.ndim!=null&&i!==s.ndim)throw new le(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${i}`);if(s.maxNDim!=null&&i>s.maxNDim)throw new le(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${i}`);if(s.minNDim!=null&&i<s.minNDim)throw new le(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${i}.`);if(s.dtype!=null&&a.dtype!==s.dtype)throw new le(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${a.dtype}.`);if(s.axes){let o=a.shape;for(let l in s.axes){let h=Number(l),c=s.axes[l],p=h>=0?o[h]:o[o.length+h];if(c!=null&&[c,null].indexOf(p)===-1)throw new le(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${c} but got shape ${o}.`)}}if(s.shape!=null)for(let o=0;o<s.shape.length;++o){let l=s.shape[o],h=a.shape[o];if(l!=null&&h!=null&&l!==h)throw new le(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${a.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();let n=pn(e),r=kge(e),a=Ege(e);if(r===a)throw new le("Arguments to apply() must be all SymbolicTensors or all Tensors");return jh(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let s=[];for(let i of pn(e))s.push(i.shape);this.build(rs(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let s=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,s);let i=pn(s),o=[];for(let l of i)n.indexOf(l)!==-1&&(l=l.clone()),o.push(l);if(s=rs(o),this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=Ige(e),i=this.computeOutputShape(s),o,l=Tge(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?s[0]:s),i!=null&&i.length>0&&Array.isArray(i[0])?o=i.map((h,c)=>new no(l,h,this,pn(e),t,this.name,c)):o=new no(l,i,this,pn(e),t,this.name),this.addInboundNode(e,o,null,null,s,i,t),this._refCount++,this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,r)=>{n!=null&&e[r]!=null&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Bu(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let t of this.inboundNodes){let n=JSON.stringify(t.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Bu(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Mo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return b_(this.weights)}build(e){this.built=!0}getWeights(e=!1){return DE(e?this.trainableWeights:this.weights)}setWeights(e){oe(()=>{let t=this.weights;if(t.length!==e.length)throw new le(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;let n=[],r=DE(t);for(let a=0;a<r.length;++a){let s=r[a],i=t[a],o=e[a];if(!$.arraysEqual(s.shape,o.shape))throw new le(`Layer weight shape ${s.shape} not compatible with provided weight shape ${o.shape}`);n.push([i,o])}yA(n)})}addWeight(e,t,n,r,a,s,i,o){if(this._addedWeightNames.indexOf(e)!==-1)throw new le(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(r=o!=null?o():Wn("zeros"));let l=r.apply(t,n),h=new J6(l,n,e,s,i);return l.dispose(),a!=null&&this.addLoss(()=>a.apply(h.read())),s==null&&(s=!0),s?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;let r=this.computeMask(e,n),a=pn(t),s=pn(r);if(a.length!==s.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let i=0;i<a.length;i++)a[i].kerasMask=s[i]}addInboundNode(e,t,n,r,a,s,i=null){let o=pn(e);t=pn(t),n=pn(n),r=pn(r),a=y_(a),s=y_(s);let l=[],h=[],c=[];for(let p of o)l.push(p.sourceLayer),h.push(p.nodeIndex),c.push(p.tensorIndex);new TS({outboundLayer:this,inboundLayers:l,nodeIndices:h,tensorIndices:c,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:s},i);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function Ige(e){e=pn(e);let t=[];for(let n of e)t.push(n.shape);return rs(t)}function Tge(e){return"float32"}function eW(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{let r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{let a=[];for(let s=0;s<r.inboundLayers.length;s++){let i=r.inputTensors[s],o=r.inboundLayers[s],l=r.nodeIndices[s],h=eW(i,o,l);for(let c of h)a.indexOf(c)===-1&&a.push(c)}return a}}}function kge(e){let t=!0;for(let n of pn(e))if(!(n instanceof no)){t=!1;break}return t}function Ege(e){let t=!0;for(let n of pn(e))if(n instanceof no){t=!1;break}return t}var Zg=class extends Ft{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:gS("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new le("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new le("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new le("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];let r=new no(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new TS({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new le(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}};Zg.className="InputLayer";Re.registerClass(Zg);function tW(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new le("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new Zg({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function Nge(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return ze(t,e.dtype)}catch{throw new le(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}var Qf=class nW{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof nW)for(let n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(let n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=Nge(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new le(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof no){if(this.id2Value[t.id]==null)throw new le(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{let n=this.name2Id[t];if(n==null)throw new le(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof no){if(this.id2Value[t.id]==null)throw new le(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{let n=this.name2Id[t];if(n==null)throw new le(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&wt(this.id2Mask)}},v_=new W6,x_=new W6;function Cge(e){v_?.setMaxEntries(e),x_?.setMaxEntries(e)}function mb(e,t,n,r){let a=n==null?!1:n.training,s=Array.isArray(e),i=s?e:[e],o=i.map(b=>b.name),l=[],h=t.names();for(let b of o)h.indexOf(b)!==-1?l.push(t.getValue(b)):l.push(null);let c=o.join(",")+"|"+t.names().sort().join(","),p=v_.get(c),m;if(p==null){let b=Age(i,t);p=b.sorted,m=b.recipientCounts,v_.put(c,p),x_.put(c,m)}m={},a||Object.assign(m,x_.get(c));let g=new Qf(t);for(let b=0;b<p.length;++b){let v=p[b],x=v.sourceLayer;if(x instanceof Zg)continue;let _=[],I=[],k=[],E=!1;for(let O of v.inputs){let z=g.getValue(O),M=g.getMask(O);_.push(z),I.push(M),M!=null&&(E=!0),a||(m[O.name]--,m[O.name]===0&&!t.hasKey(O)&&o.indexOf(O.name)===-1&&!z.isDisposed&&O.sourceLayer.stateful!==!0&&k.push(z))}E&&(n=n||{},n.mask=I[0]);let R=pn(x.apply(_,n)),U=null;x.supportsMasking&&(U=x.computeMask(_,I));let D=Dge(v),C=Array.isArray(D)?D:[D];for(let O=0;O<C.length;++O){g.hasKey(C[O])||g.add(C[O],R[O],Array.isArray(U)?U[0]:U);let z=o.indexOf(C[O].name);z!==-1&&(l[z]=R[O])}a||wt(k)}return g.disposeMasks(),s?l:l[0]}function Age(e,t){$.assert(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){let a=BP(e[0],t);n=a.sorted,r=a.recipientMap}else{let a=new Set;for(let s of e){let{sorted:i,recipientMap:o}=BP(s,t);for(let l of i)a.has(l.name)||(n.push(l),a.add(l.name));for(let l in o)r[l]==null&&(r[l]=new Set),o[l].forEach(h=>r[l].add(h))}}return{sorted:n,recipientCounts:Rge(r)}}function Rge(e){let t={};for(let n in e)t[n]=e[n].size;return t}function BP(e,t){let n=new Set,r=[],a={};for(let o of t.names())n.add(o);let s=[],i=[];for(s.push(e);s.length>0;){let o=s[s.length-1];if(n.has(o.name)){s.pop();continue}let l=i[i.length-1]===s.length-1;if(o.inputs.length===0||l)s.pop(),r.push(o),n.add(o.name),l&&i.pop();else{i.push(s.length-1);for(let h of o.inputs)a[h.name]==null&&(a[h.name]=new Set),a[h.name].add(o.name),!n.has(h.name)&&s.push(h)}}return{sorted:r,recipientMap:a}}function Dge(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(let a of e.sourceLayer.inboundNodes[r].outputTensors)if(a.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}var Mge=he();Mge.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Cge);var rW={};_t(rW,{maxNorm:()=>$ge,minMaxNorm:()=>Pge,nonNeg:()=>Fge,unitNorm:()=>Oge});function bA(e,t){return oe(()=>aa(Ye(re(e,e),t,!0)))}var wx=class extends Re.Serializable{getConfig(){return{}}},vA=class extends wx{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return oe(()=>{let t=bA(e,this.axis),n=ka(t,0,this.maxValue);return re(e,Ke(n,Se(Wr(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}};vA.className="MaxNorm";Re.registerClass(vA);var xA=class extends wx{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return oe(()=>Ke(e,Se(Wr(),bA(e,this.axis))))}getConfig(){return{axis:this.axis}}};xA.className="UnitNorm";Re.registerClass(xA);var wA=class extends wx{apply(e){return fn(e)}};wA.className="NonNeg";Re.registerClass(wA);var _A=class extends wx{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return oe(()=>{let t=bA(e,this.axis),n=Se(re(this.rate,ka(t,this.minValue,this.maxValue)),re(1-this.rate,t));return re(e,Ke(n,Se(Wr(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}};_A.className="MinMaxNorm";Re.registerClass(_A);var WP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Hr(e){return oA(e)}function jP(e,t={}){return yx(e,Re.SerializationMap.getMap().classNameMap,t,"constraint")}function Gr(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in WP?WP[e]:e,config:{}};return jP(t)}else return e instanceof wx?e:jP(e)}function $ge(e){return new vA(e)}function Oge(e){return new xA(e)}function Fge(){return new wA}function Pge(e){return new _A(e)}var aW={};_t(aW,{constant:()=>Vge,glorotNormal:()=>qge,glorotUniform:()=>Gge,heNormal:()=>Kge,heUniform:()=>Xge,identity:()=>jge,leCunNormal:()=>Yge,leCunUniform:()=>Qge,ones:()=>zge,orthogonal:()=>Zge,randomNormal:()=>Bge,randomUniform:()=>Uge,truncatedNormal:()=>Wge,varianceScaling:()=>Hge,zeros:()=>Lge});function Lge(){return new cA}function zge(){return new bS}function Vge(e){return new hA(e)}function Uge(e){return new dA(e)}function Bge(e){return new pA(e)}function Wge(e){return new fA(e)}function jge(e){return new mA(e)}function Hge(e){return new us(e)}function Gge(e){return new vS(e)}function qge(e){return new xS(e)}function Kge(e){return new wS(e)}function Xge(e){return new _S(e)}function Yge(e){return new SS(e)}function Qge(e){return new IS(e)}function Zge(e){return new gA(e)}var sW={};_t(sW,{Layer:()=>Ft,RNN:()=>au,RNNCell:()=>Sx,activation:()=>Cbe,add:()=>Lbe,alphaDropout:()=>wve,average:()=>zbe,averagePooling1d:()=>$R,averagePooling2d:()=>OR,averagePooling3d:()=>FR,avgPool1d:()=>Kbe,avgPool2d:()=>Ybe,avgPool3d:()=>Zbe,avgPooling1d:()=>Xbe,avgPooling2d:()=>Qbe,avgPooling3d:()=>Jbe,batchNormalization:()=>Hbe,bidirectional:()=>pve,categoryEncoding:()=>kve,centerCrop:()=>Ive,concatenate:()=>Vbe,conv1d:()=>xbe,conv2d:()=>wbe,conv2dTranspose:()=>_be,conv3d:()=>Sbe,conv3dTranspose:()=>Ibe,convLstm2d:()=>uve,convLstm2dCell:()=>cve,cropping2D:()=>kbe,dense:()=>Abe,depthwiseConv2d:()=>Nbe,dot:()=>jbe,dropout:()=>Rbe,elu:()=>fbe,embedding:()=>Pbe,flatten:()=>Mbe,gaussianDropout:()=>xve,gaussianNoise:()=>vve,globalAveragePooling1d:()=>eve,globalAveragePooling2d:()=>tve,globalMaxPool1d:()=>mve,globalMaxPool2d:()=>gve,globalMaxPooling1d:()=>oj,globalMaxPooling2d:()=>lj,gru:()=>rve,gruCell:()=>ave,input:()=>SW,inputLayer:()=>pbe,layerNormalization:()=>Gbe,leakyReLU:()=>gbe,lstm:()=>sve,lstmCell:()=>ive,masking:()=>_ve,maxPool1d:()=>yve,maxPool2d:()=>bve,maxPooling1d:()=>uj,maxPooling2d:()=>cj,maxPooling3d:()=>nve,maximum:()=>Ube,minimum:()=>Bbe,multiply:()=>Wbe,permute:()=>Fbe,prelu:()=>ybe,randomWidth:()=>Eve,reLU:()=>mbe,repeatVector:()=>$be,rescaling:()=>Sve,reshape:()=>Obe,resizing:()=>Tve,rnn:()=>hve,separableConv2d:()=>Tbe,simpleRNN:()=>ove,simpleRNNCell:()=>lve,softmax:()=>bbe,spatialDropout1d:()=>Dbe,stackedRNNCells:()=>dve,thresholdedReLU:()=>vbe,timeDistributed:()=>fve,upSampling2d:()=>Ebe,zeroPadding2d:()=>qbe});async function Vu(e){if(e==null)return;let t=[],n=[],r=[];for(let a in e){let s=e[a];if(typeof s!="number"){let i=s;t.push(i.data()),n.push(a),r.push(i)}}if(t.length>0){let a=await Promise.all(t);for(let s=0;s<a.length;++s)e[n[s]]=a[s][0];wt(r)}}function iW(e){if(e!=null)for(let t in e){let n=e[t];typeof n!="number"&&n.dispose()}}var HP;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(HP||(HP={}));var Jge=125,Tm=class{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}},oW=class{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(let t of this.callbacks)t.setParams(e)}setModel(e){for(let t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainEnd(e)}},eye=class extends Tm{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});let n=t.size==null?0:t.size;this.seen+=n;for(let r in t){let a=t[r];if(typeof a=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+a*n;else{let s;r in this.totals?s=this.totals[r]:this.totals[r]=0;let i=oe(()=>Se(this.totals[r],re(a,n)));this.totals[r]=i,s?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?t[n]=this.totals[n]/this.seen:oe(()=>{let r=re(Ke(1,this.seen),this.totals[n]);t[n]=r,this.totals[n].dispose(),Br(t[n])}))}},lW=class extends Tm{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(let n in t)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){let e=[],t=[],n=[];for(let a in this.history){let s=this.history[a];for(let i=0;i<s.length;++i)if(typeof s[i]!="number"){let o=s[i];e.push(o.data()),t.push(a),n.push(i)}}let r=await Promise.all(e);for(let a=0;a<r.length;++a)this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}},uW=class extends Tm{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||sA,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Jge),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");$.isNumber(this.yieldEvery)&&(this.maybeWait=Jme(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){let r=[];this.yield!=null&&(await Vu(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Vu(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){let n=[];this.epochEnd!=null&&(await Vu(t),n.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Vu(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){let n=[];this.batchEnd!=null&&(await Vu(t),n.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):$.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await Vu(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Vu(e),await this.trainEnd(e))}};function cW(e,t){return e==null&&(e={}),e instanceof Tm?[e]:Array.isArray(e)&&e[0]instanceof Tm?e:pn(e).map(n=>new uW(n,t))}var SA=class To{constructor(){}static registerCallbackConstructor(t,n){$.assert(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),To.checkForDuplicate(n),To.constructors[t]==null&&(To.constructors[t]=[]),To.constructors[t].push(n)}static checkForDuplicate(t){for(let n in To.constructors)To.constructors[+n].forEach(r=>{if(r===t)throw new le("Duplicate callback constructor.")})}static clear(){To.constructors={}}static createCallbacks(t){let n=[];for(let r in To.constructors){let a=+r;t>=a&&n.push(...To.constructors[a])}return n.map(r=>new r)}};SA.constructors={};function hW(e,t,n,r,a,s,i,o,l){let h=new lW,c=[new eye,...SA.createCallbacks(t)];e!=null&&c.push(...e),c.push(h);let p=new oW(c);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:s,batchSize:i,verbose:t,doValidation:o,metrics:l}),{callbackList:p,history:h}}function Yi(e,t={},n=!1){return yx(e,Re.SerializationMap.getMap().classNameMap,t,"layer",n)}function w_(e,t){return oe(()=>{e.dtype!=="float32"&&(e=ze(e,"float32"));let n=Ye(vx(e),t,!0),r=Ds(n.shape,Wr()),a=aa(Jo(n,r));return Ke(e,a)})}function Xp(e,t){return oe(()=>Qn(vx(Ge(t,e)),-1))}function kS(e,t){return oe(()=>Qn(Tr(Ge(t,e)),-1))}function Jg(e,t){return oe(()=>{let n=Ge(e,t),r=ka(Tr(e),Wr(),Number.MAX_VALUE),a=Tr(Ke(n,r));return re(100,Qn(a,-1))})}function tye(e,t){return oe(()=>{let n=ka(t,Wr(),Number.MAX_VALUE),r=$s(Se(1,n)),a=ka(e,Wr(),Number.MAX_VALUE),s=$s(Se(1,a));return Qn(vx(Ge(r,s)),-1)})}function nye(e,t){return oe(()=>{let n=Jo(0,Ge(1,re(e,t)));return Qn(vx(n),-1)})}function rye(e,t){return oe(()=>{let n=Jo(0,Ge(1,re(e,t)));return Qn(n,-1)})}function aye(e,t){return oe(()=>{let n=Ye(re(e,t),-1),r=ei(re(Ge(1,e),t),-1);return Jo(0,Se(1,Ge(r,n)))})}function sye(e,t){return oe(()=>{let n=Math.log(2),r=Ge(t,e),a=Ge(Se(r,Gp(re(-2,r))),n);return Qn(a,-1)})}function rv(e,t,n=!1){return oe(()=>{if(n)t=Gc(t);else{let r=Ye(t,t.shape.length-1,!0);t=Ke(t,r)}return t=ka(t,Wr(),1-Wr()),Mn(Ye(re(ze(e,"float32"),$s(t)),t.shape.length-1))})}function __(e,t,n=!1){return oe(()=>{let r=ze(qg(hge(e)),"int32");t=ka(t,Wr(),1-Wr());let a=t.shape,s=ie(vm(r,a[a.length-1]),a);return rv(s,t,n)})}function iye(e,t){if(!$.arraysEqual(e.shape,t.shape))throw new le(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return oe(()=>{let n=fn(t),r=Mn(Tr(t));return Se(Ge(n,re(t,e)),ox(Ea(r)))})}function ES(e,t){return oe(()=>{let n;return n=ka(t,Wr(),1-Wr()),n=$s(Ke(n,Ge(1,n))),Qn(iye(e,n),-1)})}function oye(e,t){return oe(()=>{let n=ka(e,Wr(),1),r=ka(t,Wr(),1);return Ye(re(e,$s(Ke(n,r))),-1)})}function lye(e,t){return oe(()=>{let n=$s(Se(Wr(),t));return Qn(Ge(t,re(e,n)),-1)})}function IA(e,t){return oe(()=>{let n=w_(e,-1),r=w_(t,-1),a=re(n,r);return Mn(Ye(a,-1))})}var S_={meanSquaredError:Xp,meanAbsoluteError:kS,meanAbsolutePercentageError:Jg,meanSquaredLogarithmicError:tye,squaredHinge:nye,hinge:rye,categoricalHinge:aye,logcosh:sye,categoricalCrossentropy:rv,sparseCategoricalCrossentropy:__,binaryCrossentropy:ES,kullbackLeiblerDivergence:oye,poisson:lye,cosineProximity:IA};function yk(e){if(typeof e=="string"){if(e in S_)return S_[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new le(t)}else return e}function TA(e,t){return oe(()=>{let n=re(.5,Os(t)),r=Xl(Xa(t,n),e.dtype);return Qn(Ms(e,r),-1)})}function kA(e,t){return oe(()=>Xl(Ms(ld(e,-1),ld(t,-1)),"float32"))}function dW(e,t){return oe(()=>ze(Ye(Ei(Ms(e,1),Ms(t,1))),"float32"))}function uye(e,t){return oe(()=>ze(Ye(Ei(Ms(e,1),Ms(t,0))),"float32"))}function cye(e,t){return oe(()=>ze(Ye(Ei(Ms(e,0),Ms(t,1))),"float32"))}function pW(e,t){return oe(()=>{let n=dW(e,t),r=cye(e,t),a=Se(n,r);return ze(ra(Xa(a,0),Ke(n,a),0),"float32")})}function hye(e,t){return oe(()=>{let n=dW(e,t),r=uye(e,t),a=Se(n,r);return ze(ra(Xa(a,0),Ke(n,a),0),"float32")})}function fW(e,t){return ES(e,t)}function mW(e,t){return e.rank===t.rank&&(e=qc(e,[e.rank-1])),t=ld(t,-1),t.dtype!==e.dtype&&(t=ze(t,e.dtype)),ze(Ms(e,t),"float32")}function dye(e,t){return oe(()=>{let n=e.sub(t).square().sum(),r=e.sub(e.mean()).square().sum();return rt(1).sub(n.div(r))})}var pye=Xp,fye=Xp,mye=kS,gye=kS,yye=Jg,bye=Jg,EA=rv,vye=IA,gW=__,I_={binaryAccuracy:TA,categoricalAccuracy:kA,precision:pW,categoricalCrossentropy:EA,sparseCategoricalCrossentropy:gW,mse:pye,MSE:fye,mae:mye,MAE:gye,mape:yye,MAPE:bye,cosine:vye};function xye(e){if(typeof e=="string"&&e in I_)return I_[e];if(typeof e!="string"&&e!=null)return e;throw new le(`Unknown metric ${e}`)}function o0(e){if(Ao(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(let n of Object.keys(S_))if(S_[n]===e){t=n;break}if(t!==void 0)return t;for(let n of Object.keys(I_))if(I_[n]===e){t=n;break}return t!==void 0?t:e.name}}function wye(e){let t={Adagrad:()=>Ch.adagrad(.01),Adadelta:()=>Ch.adadelta(1,.95,Wr()),Adam:()=>Ch.adam(.001,.9,.999,Wr()),Adamax:()=>Ch.adamax(.002,.9,.999,Wr(),0),RMSProp:()=>Ch.rmsprop(.001,.9,0,Wr()),SGD:()=>Ch.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new le(`Unknown Optimizer ${e}`)}function GP(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!ME(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){let r=JSON.stringify(e);r.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function ME(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){let t=Object.keys(e);for(let n of t)if(typeof n!="string"||!ME(e[n]))return!1;return!0}else if(Array.isArray(e)){for(let t of e)if(!ME(t))return!1;return!0}else return!1;else{let t=typeof e;return t==="string"||t==="number"||t==="boolean"}}function _ye(e,t,n,r=console.log){let a=Iye(e),s=["Layer (type)","Input Shape","Output shape","Param #"];a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(t*c)));let i;if(!a){s.push("Receives inputs"),i=[];for(let c in e.nodesByDepth)i.push(...e.nodesByDepth[c])}r("_".repeat(t)),T_(s,n,r),r("=".repeat(t));let o=e.layers;for(let c=0;c<o.length;++c)a?Tye(o[c],n,r):kye(o[c],n,i,r),r((c===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();let l=Sye(e),h=b_(e.nonTrainableWeights);r(`Total params: ${l+h}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${h}`),r("_".repeat(t))}function Sye(e){let t;return e.collectedTrainableWeights!=null?t=b_(e.collectedTrainableWeights):t=b_(e.trainableWeights),t}function Iye(e){let t=!0,n=[],r=[];for(let a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(let a of n){if(a.length>1||a.length===1&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(let a of e.layers){let s=!1;for(let i of a.inboundNodes)if(r.indexOf(i)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function T_(e,t,n=console.log){let r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Tye(e,t,n){let r,a;try{a=e.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{a="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}let s=e.name,i=e.getClassName(),o=[`${s} (${i})`,a,r,e.countParams().toString()];T_(o,t,n)}function kye(e,t,n,r){let a,s;try{s=e.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{s="multiple"}try{a=JSON.stringify(e.outputShape)}catch{a="multiple"}let i=[];for(let p of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(p)===-1))for(let m=0;m<p.inboundLayers.length;++m){let g=p.inboundLayers[m].name,b=p.nodeIndices[m],v=p.tensorIndices[m];i.push(`${g}[${b}][${v}]`)}let o=e.name,l=e.getClassName(),h=i.length===0?"":i[0],c=[`${o} (${l})`,s,a,e.countParams().toString(),h];T_(c,t,r);for(let p=1;p<i.length;++p)T_(["","","","",i[p]],t,r)}function yW(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function av(e,t){if(e===null)return null;if(typeof e=="string")return Mh(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];yW(t,a,s)?n.push(s):n.push(av(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r];if(r==="name"&&typeof a=="string")n[r]=a;else{let s=Mh(r);n[s]=av(a,s)}}return n}}function $E(e,t){if(e==null)return null;if(typeof e=="string")return Cl(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];yW(t,a,s)?n.push(s):n.push($E(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r],s=Cl(r);(r==="name"||r==="className")&&typeof a=="string"?n[s]=a:n[s]=$E(a,r)}return n}}var NA="4.22.0",Eye=e=>{let t=Object.keys(e);if(t.length===0)return!1;let n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))},Nye=class ko extends Ft{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let I=this.getClassName().toLowerCase();this.name=gS(I)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],sc(this.inputs).length!==this.inputs.length)throw new le(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(I=>I.name)}`);sc(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(I=>I.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let I of this.outputs){let k=I.sourceLayer,E=I.nodeIndex,R=I.tensorIndex;this.outputLayers.push(k),this.outputLayersNodeIndices.push(E),this.outputLayersTensorIndices.push(R)}for(let I of this.inputs){let k=I.sourceLayer,E=I.nodeIndex,R=I.tensorIndex;Ao(E===0,"input layer has >1 nodes"),Ao(R===0,"input layer has >1 tensors"),this.inputLayers.push(k),this.inputLayersNodeIndices.push(E),this.inputLayersTensorIndices.push(R)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let I=0;I<this.inputLayers.length;I++){let k=this.inputLayers[I];if(!(k instanceof Zg))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${I} (0-based) originates from layer type ${k.getClassName()}.`);this.inputNames.push(k.name),this.feedInputShapes.push(k.batchInputShape),this.feedInputNames.push(k.name)}for(let I of this.outputLayers)this.outputNames.push(I.name);this.internalInputShapes=this.inputs.map(I=>I.shape),this.internalOutputShapes=this.outputs.map(I=>I.shape);let n={},r={},a={},s={},i={},o=[],l=(I,k,E,R,U,D)=>{(R==null||U==null||D==null)&&(R=I.sourceLayer,U=I.nodeIndex,D=I.tensorIndex);let C=R.inboundNodes[U];if(E.indexOf(C)!==-1)throw new Mo(`The tensor ${I.name} at layer "${R.name}" is part of a cycle.`);if(k.indexOf(C)!==-1)return;this.containerNodes.add(ko.nodeKey(R,U)),R.id in i||(i[R.id]=Object.keys(i).length),E.indexOf(C)===-1&&E.push(C);let O=C.inboundLayers.length;for(let z=0;z<O;z++){let M=C.inputTensors[z],N=C.inboundLayers[z],P=C.nodeIndices[z],Q=C.tensorIndices[z];l(M,k,E,N,P,Q)}for(k.push(C);E.indexOf(C)>=0;)E.splice(E.indexOf(C),1);o.push(C)},h=[],c=[];for(let I of this.outputs)l(I,h,c);let p=o.slice().reverse();for(let I of p){r[I.id]=I,I.id in n||(n[I.id]=0);let k=n[I.id],E=a[I.outboundLayer.id]==null?0:a[I.outboundLayer.id];k=Math.max(k,E),a[I.outboundLayer.id]=k,s[I.outboundLayer.id]=I.outboundLayer,n[I.id]=k;for(let R=0;R<I.inboundLayers.length;R++){let U=I.inboundLayers[R],D=I.nodeIndices[R],C=U.inboundNodes[D],O=n[C.id]==null?0:n[C.id];n[C.id]=Math.max(k+1,O),r[C.id]=C}}let m={};for(let I in n){let k=n[I];k in m||(m[k]=[]),m[k].push(r[I])}let g={};for(let I in a){let k=a[I];k in g||(g[k]=[]),g[k].push(s[I])}let b=Object.keys(g).map(I=>parseInt(I,10)).sort(a0);this.layers=[];for(let I of b){let k=g[I];k.sort((E,R)=>{let U=i[E.id],D=i[R.id];return U<D?-1:U>D?1:0});for(let E of k)E instanceof ko&&this.internalContainerRefs.push(E),this.layers.push(E)}this.layersByDepth=g,b=Object.keys(m).map(I=>parseInt(I,10)).sort(a0);let v=this.inputs.slice(),x=[];for(let I of b)for(let k of m[I]){let E=k.outboundLayer;if(E!=null){for(let R of k.inputTensors)if(v.indexOf(R)===-1)throw new Mo(`Graph disconnected: cannot obtain value for tensor ${R} at layer "${E.name}". The following previous layers were accessed without issue: ${x}`);for(let R of k.outputTensors)v.push(R);x.push(E.name)}}this.nodesByDepth=m;let _=this.layers.map(I=>I.name);for(let I of _){let k=_.filter(E=>E===I).length;if(k!==1)throw new Mo(`The name "${I}" is used ${k} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(_))}this.outboundNodes=[],this.inboundNodes=[],new TS({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(I=>null),outputMasks:this.outputs.map(I=>null),inputShapes:this.inputs.map(I=>I.shape),outputShapes:this.outputs.map(I=>I.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(let n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new le("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){let r={},a=0,s=Eye(t);s&&this.parseWeights(t);for(let o of this.layers)for(let[l,h]of o.weights.entries()){let c=s?`${h.name.split("/").slice(0,-1).join("/")+"/"}${l}`:h.originalName;if(r[c]!=null)throw new le(`Duplicate weight name: ${c}`);r[c]=h,a++}let i=[];for(let o in t){let l=o;if(r[o]==null){let h=o.split("/");l=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(r[l]!=null)i.push([r[l],t[o]]);else if(n)throw new le(`Provided weight data has no target variable: ${o}`);delete r[l]}if(n){let o=[];for(let l in r)o.push(l);if(o.length>0)throw new le(`${o.length} of ${a} weights are not set: ${o}`)}yA(i)}parseWeights(t){for(let n in Object.keys(t)){let r=n.split("/"),a=["vars","layer_checkpoint_dependencies"],s=r.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!a.includes(i)).join("/");s!==n&&(t[s]=t[n],delete t[n])}}updatedConfig(){let t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${NA}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){let r=$E(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return oe(()=>{t=pn(t);let r=new Qf;for(let a=0;a<this.inputs.length;++a)r.add(this.inputs[a],t[a]);return mb(this.outputs,r,n)})}computeMask(t,n){return oe(()=>{t=pn(t);let r;return n==null?r=pd(null,t.length):r=pn(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){let n=y_(t);if(n.length!==this.inputLayers.length)throw new le(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let o=0;o<n.length;o++){let l=this.inputLayers[o],h=n[o],c=l.name+"_0_0";r[c]=h}let a=Object.keys(this.nodesByDepth).map(o=>parseInt(o,10)).sort(a0);if(a.length>1)for(let o of a){let l=this.nodesByDepth[o];for(let h of l){let c=h.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(c.id)!==-1)continue;let p=[];for(let v=0;v<h.inboundLayers.length;v++){let x=h.inboundLayers[v],_=h.nodeIndices[v],I=h.tensorIndices[v],k=`${x.name}_${_}_${I}`,E=r[k];p.push(E)}let m=c.computeOutputShape(rs(p)),g=y_(m),b=c.inboundNodes.indexOf(h);for(let v=0;v<g.length;v++){let x=`${c.name}_${b}_${v}`;r[x]=g[v]}}}let s=[],i=[];for(let o=0;o<this.outputLayers.length;o++){let l=this.outputLayers[o],h=this.outputLayersNodeIndices[o],c=this.outputLayersTensorIndices[o],p=`${l.name}_${h}_${c}`;i.push(p)}for(let o=0;o<i.length;o++){let l=i[o];Ao(l in r),s.push(r[l])}return rs(s)}runInternalGraph(t,n){n==null&&(n=pd(null,t.length));let r={};for(let l=0;l<this.inputs.length;++l){let h=this.inputs[l],c=t[l],p=n[l];r[h.id]=[c,p]}let a=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(a0);for(let l of a){let h=this.nodesByDepth[l];for(let c of h){let p=c.outboundLayer,m=c.inputTensors,g=c.outputTensors,b=new Array;for(let v of m)v.id in r&&b.push(r[v.id]);if(b.length===m.length){let v={},x,_,I,k;if(c.callArgs!=null&&(v=c.callArgs),b.length===1){let[E,R]=b[0];v.mask==null&&(v.mask=R),I=pn(p.call(E,v)),k=pn(p.computeMask(E,R)),x=[E],_=[R]}else x=b.map(E=>E[0]),_=b.map(E=>E[1]),v.mask==null&&(v.mask=_),I=pn(p.call(x,v)),k=pn(p.computeMask(x,_));if(p.activityRegularizer)throw new Ot("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let E=0;E<g.length;++E){let R=g[E],U=I[E],D=k[E];r[R.id]=[U,D]}}}}let s=[],i=[],o=[];for(let l of this.outputs){Ao(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[h,c]=r[l.id];o.push(h.shape),s.push(h),i.push(c)}return[s,i,o]}buildNodeConversionMap(t){let n={},r;for(let a of this.layers){r=a instanceof ko?1:0;for(let s=0;s<a.inboundNodes.length;s++){let i=ko.nodeKey(a,s);this.containerNodes.has(i)&&(n[i]=r,r+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new le("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(let r of this.layers)if(r.name===t)return r;throw new le(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new le(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return oe(()=>{let t=[];for(let n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){let a=ko.nodeKey(n,r);this.containerNodes.has(a)&&t.push(...n.calculateLosses())}return t})}getConfig(){let t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(let i of this.layers){let o=i.getClassName(),l=i.getConfig(),h=[];for(let p=0;p<i.inboundNodes.length;p++){let m=i.inboundNodes[p],g=ko.nodeKey(i,p),b={};if(this.containerNodes.has(g)){if(m.callArgs)try{JSON.stringify(m.callArgs),b=m.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),b={}}if(m.inboundLayers.length>0){let v=[];for(let x=0;x<m.inboundLayers.length;x++){let _=m.inboundLayers[x],I=m.nodeIndices[x],k=m.tensorIndices[x],E=ko.nodeKey(_,I),R=n[E];R==null&&(R=0),v.push([_.name,R,k,b])}h.push(v)}}}let c={};c.name=i.name,c.className=o,c.config=l,c.inboundNodes=h,r.push(c)}t.layers=r;let a=[];for(let i=0;i<this.inputLayers.length;i++){let o=this.inputLayers[i],l=this.inputLayersNodeIndices[i],h=ko.nodeKey(o,l);if(!this.containerNodes.has(h))continue;let c=n[h];c==null&&(c=0);let p=this.inputLayersTensorIndices[i];a.push([o.name,c,p])}t.inputLayers=a;let s=[];for(let i=0;i<this.outputLayers.length;i++){let o=this.outputLayers[i],l=this.outputLayersNodeIndices[i],h=ko.nodeKey(o,l);if(!this.containerNodes.has(h))continue;let c=n[h];c==null&&(c=0);let p=this.outputLayersTensorIndices[i];s.push([o.name,c,p])}return t.outputLayers=s,t}static fromConfig(t,n,r={},a=!1){let s={},i={};function o(x,_){x.name in i?i[x.name].push(_):i[x.name]=[_]}function l(x,_){let I=[],k;for(let E of _){let R=E[0],U=E[1],D=E[2];if(k=E[3]==null?{}:E[3],!(R in s)){o(x,_);return}let C=s[R];if(C.inboundNodes.length<=U){o(x,_);return}let O=C.inboundNodes[U];I.push(O.outputTensors[D])}I.length>0&&x.apply(rs(I),k)}function h(x){let _=x.name,I=Yi(x,n.customObjects!=null?n.customObjects:{});I.setFastWeightInitDuringBuild(a),s[_]=I,x.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new le(`Corrupted configuration, expected array for nodeData: ${k}`);o(I,k)})}let c=n.name,p=n.layers;for(let x of p)h(x);for(;!Zme(i);)for(let x of p){let _=s[x.name];if(_.name in i){let I=i[_.name];delete i[_.name];for(let k of I)l(_,k)}}let m=[],g=[],b=n.inputLayers;for(let x of b){let _=x[0],I=x[1],k=x[2];Ao(_ in s);let E=s[_].inboundNodes[I].outputTensors;m.push(E[k])}let v=n.outputLayers;for(let x of v){let _=x[0],I=x[1],k=x[2];Ao(_ in s);let E=s[_].inboundNodes[I].outputTensors;g.push(E[k])}return new t({inputs:m,outputs:g,name:c})}get stateful(){if(this._stateful)throw new le("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){oe(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}};function Cye(e,t,n){let r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(a=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){let a=[];return t.forEach(s=>{s in e?a.push(e[s]):a.push(null)}),a}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function bW(e,t){return Cye(e,t,"classWeight")}async function vW(e,t,n,r){if(n!=null){let a=oe(()=>{if(e.shape.length===1)return Uo(e);if(e.shape.length===2){if(e.shape[1]>1)return ld(e,1);if(e.shape[1]===1)return ie(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await a.data());wt(a);let i=[];return s.forEach(o=>{if(n[o]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${o} exists in the data but not in classWeight`);i.push(n[o])}),dn(i,"float32")}else return null}function Aye(e,t){return re(e,t)}var Rye=32;function xW(e,t){let n,r,a=t;n=a.xs,r=a.ys,$.assert(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let s=qP("input",e.inputNames,n),i=qP("output",e.outputNames,r),o=s[0].shape[0];$.assert(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),$.assert(i.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let l=0;l<s.length;l++)$.assert(s[l].shape[0]===o,()=>`Batch size mismatch: input ${e.inputNames[l]} has ${s[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);for(let l=0;l<i.length;l++)$.assert(i[l].shape[0]===o,()=>`Batch size mismatch: output ${e.outputNames[l]} has ${i[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);return{xs:s,ys:i}}function qP(e,t,n){if(n instanceof Tt)return[n];if(Array.isArray(n))return $.assert(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{let r=[];for(let a of t){if(n[a]==null)throw new le(`The feature data generated by the dataset lacks the required ${e} key '${a}'.`);r.push(n[a])}return r}}function Dye(e){if(e.length===3)throw new Ot("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function Mye(e,t,n){let r=n.batchesPerEpoch!=null;if($.assert(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),$.assert(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),$.assert(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),$.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),$.assert(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{let a=n.validationData!=null,s,i;if(a)if(KP(n.validationData))$.assert(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{let x=Dye(n.validationData);s=x.xs,i=x.ys}let o=e.makeTrainFunction(),l=e.getDedupedMetricsNames(),h;a?h=l.slice().concat(l.map(x=>"val_"+x)):h=l.slice();let c=cW(n.callbacks,n.yieldEvery),p=n.verbose==null?1:n.verbose,{callbackList:m,history:g}=hW(c,p,n.epochs,null,null,$ye(t,n),null,a,h);m.setModel(e),e.history=g,await m.onTrainBegin(),e.stopTraining_=!1;let b=n.initialEpoch==null?0:n.initialEpoch,v=await t.iterator();for(;b<n.epochs;){let x={};await m.onEpochBegin(b);let _=0,I=0;for(r||(v=await t.iterator());!r||_<n.batchesPerEpoch;){let k=await v.next();if(r&&k.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${_} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(k.value!=null){let{xs:E,ys:R}=xW(e,k.value),U={};U.batch=I,U.size=E[0].shape[0],await m.onBatchBegin(I,U);let D=[];if(n.classWeight!=null){let z=bW(n.classWeight,e.outputNames);for(let M=0;M<z.length;++M)D.push(await vW(R[M],null,z[M]))}let C=E.concat(R).concat(D),O=o(C);wt(C);for(let z=0;z<l.length;++z){let M=l[z],N=O[z];U[M]=N,Br(N)}await m.onBatchEnd(I,U),iW(U),I++,_++}if(r?_>=n.batchesPerEpoch:k.done){if(a){let E;KP(n.validationData)?E=pn(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):E=pn(e.evaluate(s,i,{batchSize:n.validationBatchSize==null?Rye:n.validationBatchSize,verbose:0}));for(let R=0;R<e.metricsNames.length;++R)x[`val_${e.metricsNames[R]}`]=E[R]}break}if(e.stopTraining_)break}if(await m.onEpochEnd(b,x),b++,e.stopTraining_)break}return await m.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function $ye(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function KP(e){return typeof e.iterator=="function"}function Oye(e){return typeof e.next=="function"}async function Fye(e,t,n){n=n||{};let r=n.batches!=null,a=e.testFunction,s=[];if(n.verbose>0)throw new Ot("Verbose mode is not implemented yet.");$.assert(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);let i=Oye(t)?t:await t.iterator(),o=0,l=0;for(;!r||l<n.batches;){let h=await i.next();if(s=oe(()=>{if(h.value){let{xs:c,ys:p}=xW(e,h.value),m=c.concat(p),g=oe(()=>a(m));if(wt(m),l===0)for(let v=0;v<g.length;++v)s.push(rt(0));let b=m[0].shape[0];for(let v=0;v<g.length;++v){let x=g[v],_=s[v];s[v]=oe(()=>Se(s[v],re(b,x))),l>0&&wt(_)}wt(g),o+=b,++l}return s}),h.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let h=0;h<s.length;++h){let c=s[h];s[h]=Ke(s[h],o),wt(c)}return rs(s)}function bk(e){$.assert(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function rb(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>Hh(r,t,n-t)):Hh(e,t,n-t)}function OE(e,t){return oe(()=>e==null?null:Array.isArray(e)?e.map(n=>OE(n,t)):Q6(e,t.dtype==="int32"?t:ze(t,"int32")))}function vk(e,t){let n=[],r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function wW(e){let t=[];e instanceof Tt&&(e=[e]);for(let n=0;n<e.length;++n){let r=e[n];if(r.rank===1)t.push(bx(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Ui(e,t){if(e==null)return;let n=[];if(t instanceof Tt)n.push(t.id);else if(Array.isArray(t))t.forEach(a=>n.push(a.id));else if(t!=null)for(let a in t){let s=t[a];n.push(s.id)}let r=[];if(e instanceof Tt)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(a=>{n.indexOf(a.id)===-1&&r.push(a)});else if(e!=null)for(let a in e){let s=e[a];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(a=>{a.isDisposed||a.dispose()})}function Pye(e){return e instanceof Tt}function FE(e){return Array.isArray(e)}function XP(e){return!Pye(e)&&!FE(e)}function YP(e,t,n,r=!0,a=""){if(t==null||t.length===0){if(e!=null){let i=!1;if(FE(e)&&e.length>0)i=!0;else if(XP(e)){for(let o in e)if(e.hasOwnProperty(o)){i=!0;break}}else i=!0;if(i)throw new le(`Error when checking model ${a} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(i=>null);let s;if(XP(e)){e=e,s=[];for(let i of t){if(e[i]==null)throw new le(`No data provided for "${i}". Need data for each key in: ${t}`);s.push(e[i])}}else if(FE(e)){if(e=e,e.length!==t.length)throw new le(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new le(`The model ${a} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=wW(s),n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;let o=s[i];if(o.shape.length!==n[i].length)throw new le(`Error when checking ${a}: expected ${t[i]} to have ${n[i].length} dimension(s). but got array with shape ${o.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!r)continue;let h=o.shape[l],c=n[i][l];if(c!=null&&c>=0&&h!==c)throw new le(`${a} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${a} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return s}function Lye(e,t,n){let r=sc(e.map(s=>s.shape[0]));r.sort();let a=sc(t.map(s=>s.shape[0]));if(a.sort(),r.length>1)throw new le(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(a.length>1)throw new le(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&a.length>0&&!$.arraysEqual(r,a))throw new le(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${a[0]} target sample(s).`)}function zye(e,t,n){let r=[Xp,ES,rv];for(let a=0;a<e.length;++a){let s=e[a],i=t[a],o=n[a];if(i!=null){if(i===rv&&s.shape[s.shape.length-1]===1)throw new le(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){let l=s.shape.slice(1),h=o.slice(1);for(let c=0;c<l.length;++c){let p=l[c],m=h[c];if(m!=null&&p!==m)throw new le(`A target Tensor with shape ${s.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function QP(e,t,n,r=!0,a=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new le(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new le(`The model expects ${t.length} ${a} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;let o=s[i];if(o.shape.length!==n[i].length)throw new le(`Error when checking ${a}: expected ${t[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!r)continue;let h=o.shape[l],c=n[i][l];if(c!=null&&c!==h)throw new le(`Error when checking ${a}: expected ${t[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}function Vye(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{let r=[];for(let a of t){let s=n.hasOwnProperty(a)?n[a]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}var Uye="layers-model",Ul=class extends Nye{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new le("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");_ye(this,e,t,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=wye(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ru))throw new le("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let s in e.loss)if(this.outputNames.indexOf(s)===-1)throw new le(`Unknown entry in loss dictionary: "${s}". Only expected the following keys: ${this.outputNames}`);for(let s of this.outputNames)e.loss[s]==null&&console.warn(`Output "${s}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${s} during training`),t.push(yk(e.loss[s]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new le(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(s=>yk(s))}else{let s=yk(e.loss);this.outputs.forEach(i=>{t.push(s)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){let i=this.internalOutputShapes[s],o=this.outputNames[s];this.feedOutputNames.push(o),this.feedOutputShapes.push(i),this.feedLossFns.push(this.lossFunctions[s])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],jh("loss",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let i=this.lossFunctions[s];this.outputs.length>1&&(this.metricsTensors.push([i,s]),this.metricsNames.push(this.outputNames[s]+"_loss"))}});let r=Vye(e.metrics,this.outputNames),a=(s,i,o)=>{this.outputNames.length>1&&(i=this.outputNames[s]+"_"+i),this.metricsNames.push(i),this.metricsTensors.push([o,s])};jh("metric",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let i=r[s];(o=>{let l="",h,c,p;for(let m of o){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let b=this.internalOutputShapes[s];b[b.length-1]===1||this.lossFunctions[s]===ES?["accuracy","acc"].indexOf(m)!==-1?c=TA:["crossentropy","ce"].indexOf(m)!==-1&&(c=fW):this.lossFunctions[s]===__?["accuracy","acc"].indexOf(m)!==-1?c=mW:["crossentropy","ce"].indexOf(m)!==-1&&(c=gW):["accuracy","acc"].indexOf(m)!==-1?c=kA:["crossentropy","ce"].indexOf(m)!==-1&&(c=EA);let v;["accuracy","acc"].indexOf(m)!==-1?v="acc":["crossentropy","ce"].indexOf(m)!==-1&&(v="ce"),p=c,h=l+v}else p=xye(m),h=l+o0(m);let g;jh(h,()=>{g=p}),a(s,h,g)}})(i)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){let r=n.batchSize==null?32:n.batchSize;bk(r);let a=this.standardizeUserDataXY(e,t,!0,r);try{let s=a[0].concat(a[1]);this.makeTestFunction();let i=this.testFunction,o=this.testLoop(i,s,r,n.verbose,n.steps);return rs(o)}finally{Ui(a[0],e),Ui(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),Fye(this,e,t)}checkNumSamples(e,t,n,r="steps"){let a;if(n!=null){if(a=null,t!=null)throw new le(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?a=e[0].shape[0]:a=e.shape[0];else throw new le(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return a}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new le("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),s=new Qf;if(e instanceof Tt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new le(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let o=0;o<this.inputs.length;++o)s.add(this.inputs[o],e[o])}else for(let o of this.inputs){let l=e[o.name];if(l==null)throw new le(`No value is provided for the model's input ${o.name}`);s.add(o,l)}let i=mb(a,s);return n?i:i[0]}retrieveSymbolicTensors(e){let t=pd(null,e.length),n=e.length;for(let r of this.layers){let a=Array.isArray(r.output)?r.output:[r.output],s=a.map(i=>i.name);for(let i=0;i<e.length;++i){let o=s.indexOf(e[i]);if(o!==-1&&(t[i]=a[o],n--),n===0)break}if(n===0)break}if(n>0){let r=[];throw t.forEach((a,s)=>{a==null&&r.push(e[s])}),new le(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,n=!1){return oe(()=>{let r=this.checkNumSamples(e);if(n)throw new Ot("Verbose predictLoop() is not implemented yet.");let a=vk(r,t),s=this.outputs.map(i=>[]);for(let i=0;i<a.length;++i)oe(()=>{let o=a[i][0],l=a[i][1],h=rb(e,o,l),c=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)c.push({key:this.inputs[m],value:h[m]});else c.push({key:this.inputs[0],value:h});let p=new Qf(c);return mb(this.outputs,p)}).forEach((o,l)=>s[l].push(o));return rs(s.map(i=>Sn(i,0)))})}predict(e,t={}){let n=wW(e);QP(n,this.inputNames,this.feedInputShapes,!1);try{let r=t.batchSize==null?32:t.batchSize;return bk(r),this.predictLoop(n,r)}finally{Ui(n,e)}}predictOnBatch(e){QP(e,this.inputNames,this.feedInputShapes,!0);let t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(this.optimizer_==null)throw new Mo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let a=[];for(let s=0;s<this.feedOutputShapes.length;++s){let i=this.feedOutputShapes[s];this.feedLossFns[s]===__?a.push(i.slice(0,i.length-1).concat([1])):a.push(i)}if(e=YP(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=YP(t,this.feedOutputNames,a,!1,"target"),Lye(e,t),zye(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new le(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,a=!0,s){let[i,o]=this.standardizeUserDataXY(e,t,a,s);if(n!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){let h=bW(r,this.outputNames);l=[];for(let c=0;c<h.length;++c)l.push(await vW(o[c],null,h[c]))}return[i,o,l]}testLoop(e,t,n,r=0,a){return oe(()=>{let s=this.checkNumSamples(t,n,a,"steps"),i=[];if(r>0)throw new Ot("Verbose mode is not implemented yet.");if(a!=null)throw new Ot("steps mode in testLoop() is not implemented yet");{let o=vk(s,n),l=dn(eo(0,s));for(let h=0;h<o.length;++h){let c=o[h][0],p=o[h][1],m=Hh(l,c,p-c),g=OE(t,m),b=e(g);if(h===0)for(let v=0;v<b.length;++v)i.push(rt(0));for(let v=0;v<b.length;++v){let x=b[v];i[v]=Se(i[v],re(p-c,x))}}for(let h=0;h<i.length;++h)i[h]=Ke(i[h],s)}return i})}getDedupedMetricsNames(){let e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){let r=e[n],a=r;if(FP(e,r)>1){let s=FP(e.slice(0,n),r);a+=`_${s}`}t.push(a)}return t}makeTrainFunction(){return e=>{let t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),s=[],i=()=>{let l=[];for(let m=0;m<this.inputs.length;++m)l.push({key:this.inputs[m],value:n[m]});let h=new Qf(l),c=mb(this.outputs,h,{training:!0}),p;for(let m=0;m<this.lossFunctions.length;++m){let g=this.lossFunctions[m],b=g(r[m],c[m]);a[m]!=null&&(b=Aye(b,a[m]));let v=Qn(b);t.push(v),m===0?p=b:p=Se(p,b)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=t[m];else{let b=this.metricsTensors[m][0],v=this.metricsTensors[m][1];g=Qn(b(r[v],c[v]))}Br(g),s.push(g)}return p=Qn(p),this.calculateLosses().forEach(m=>{p=Se(p,m)}),p},o=this.collectedTrainableWeights.map(l=>l.read());return[this.optimizer_.minimize(i,!0,o)].concat(s)}}makeTestFunction(){this.testFunction=e=>oe(()=>{let t=[],n,r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let l=0;l<this.inputs.length;++l)s.push({key:this.inputs[l],value:r[l]});let i=new Qf(s),o=mb(this.outputs,i);for(let l=0;l<this.lossFunctions.length;++l){let h=this.lossFunctions[l],c=Qn(h(a[l],o[l]));l===0?n=c:n=Se(n,c),t.push(n)}for(let l=0;l<this.metricsTensors.length;++l){let h=this.metricsTensors[l][0],c=this.metricsTensors[l][1],p=Qn(h(a[c],o[c]));t.push(p)}return t})}async fit(e,t,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,a,s,i,o,l,h,c,p;try{let m=n.batchSize==null?32:n.batchSize;bk(m);let g=await this.standardizeUserData(e,t,n.sampleWeight,n.classWeight,!1,m);r=g[0],a=g[1],p=g[2];let b=!1,v;if(n.validationData!=null&&n.validationData.length>0){if(b=!0,n.validationData.length===2)o=n.validationData[0],l=n.validationData[1];else throw n.validationData.length===3?new Ot("validationData including sample weights is not supported yet."):new le(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let U=await this.standardizeUserData(o,l,null,null,!0,m);h=U[0],c=U[1],v=h.concat(c)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){b=!0;let U=Math.floor(r[0].shape[0]*(1-n.validationSplit)),D=r[0].shape[0];h=rb(r,U,D),s=r,r=rb(r,0,U),c=rb(a,U,D),i=a,a=rb(a,0,U),v=h.concat(c)}else n.validationSteps!=null&&(b=!0);let x=r.concat(a).concat(p);this.checkTrainableWeightsConsistency();let _=this.makeTrainFunction(),I=this.getDedupedMetricsNames(),k,E;b?(this.makeTestFunction(),k=this.testFunction,E=I.slice().concat(I.map(U=>"val_"+U))):(k=null,v=[],E=I.slice());let R=cW(n.callbacks,n.yieldEvery);return await this.fitLoop(_,x,I,m,n.epochs,n.verbose,R,k,v,n.shuffle,E,n.initialEpoch,null,null)}finally{this.isTraining=!1,Ui(r,e),Ui(a,t),Ui(s,e),Ui(i,t),Ui(h,o),Ui(c,l),p!=null&&wt(p)}}async fitLoop(e,t,n,r,a,s,i,o,l,h,c,p,m,g){r==null&&(r=32),a==null&&(a=1),h==null&&(h=!0),p==null&&(p=0);let b=!1;if(o!=null&&l!=null&&(b=!0),g!=null&&(b=!0,m==null))throw new le("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let v=this.checkNumSamples(t,r,m,"steps_per_epoch"),x;v!=null&&(x=eo(0,v)),s==null&&(s=1);let{callbackList:_,history:I}=hW(i,s,a,p,v,m,r,b,c);_.setModel(this),this.history=I,await _.onTrainBegin(),this.stopTraining_=!1;for(let k=p;k<a;++k){await _.onEpochBegin(k);let E={};if(m!=null)throw new Ot("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ot("batch shuffling is not implemneted yet");h&&$.shuffle(x);let R=dn(x),U=vk(v,r);for(let D=0;D<U.length;++D){let C={};if(await _.onBatchBegin(D,C),oe(()=>{let O=U[D][0],z=U[D][1],M=Hh(R,O,z-O);C.batch=D,C.size=z-O;let N=OE(t,M),P=e(N);for(let Q=0;Q<n.length;++Q){let ee=n[Q],q=P[Q];C[ee]=q,Br(q)}if(D===U.length-1&&b){let Q=this.testLoop(o,l,r);for(let ee=0;ee<n.length;++ee){let q=n[ee],Z=Q[ee];Br(Z),E["val_"+q]=Z}}}),await _.onBatchEnd(D,C),iW(C),this.stopTraining_)break}R.dispose()}if(await _.onEpochEnd(k,E),this.stopTraining_)break}return await _.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Mye(this,e,t)}async trainOnBatch(e,t){let n=await this.standardizeUserData(e,t),r=n[0],a=n[1],s=this.makeTrainFunction()(r.concat(a)),i=[];for(let o of s){let l=await o.data();i.push(l[0])}return wt(s),Ui(n[0],e),Ui(n[1],t),rs(i)}getNamedWeights(e){let t=[],n=e!=null&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let s=0;s<r.length;++s)n&&!r[s].trainable||t.push({name:r[s].originalName,tensor:a[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let t=yE().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-yE().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Cl(this.loss);else if(Array.isArray(this.loss)){for(let t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Cl(t))}else{let t=Object.keys(this.loss);e={};let n=this.loss;for(let r of t)if(typeof n[r]=="string")e[r]=Cl(n[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Cl(o0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Cl(o0(e)));{let e={};for(let t in this.metrics)e[t]=Cl(o0(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let t=av(e.optimizer_config),n=Yi(t),r;if(typeof e.loss=="string")r=Mh(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(s=>Mh(s));else if(e.loss!=null){r={};for(let s in e.loss)r[s]=Mh(e.loss[s])}let a;if(Array.isArray(e.metrics))a=e.metrics.map(s=>Mh(s));else if(e.metrics!=null){a={};for(let s in e.metrics)a[s]=Mh(e.metrics[s])}this.compile({loss:r,metrics:a,optimizer:n})}async save(e,t){if(typeof e=="string"){let a=ma.getSaveHandlers(e);if(a.length===0)throw new le(`Cannot find any save handlers for URL '${e}'`);if(a.length>1)throw new le(`Found more than one (${a.length}) save handlers for URL '${e}'`);e=a[0]}if(e.save==null)throw new le("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await ma.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:Uye,generatedBy:`TensorFlow.js tfjs-layers v${NA}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){r.trainingConfig=this.getTrainingConfig();let a="optimizer",{data:s,specs:i}=await ma.encodeWeights(await this.optimizer.getWeights(),a);n.specs.push(...i),n.data=ma.concatenateArrayBuffers([n.data,s])}return this.userDefinedMetadata!=null&&(GP(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){GP(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}};Ul.className="Model";Re.registerClass(Ul);var _W=class extends Ul{};_W.className="Functional";Re.registerClass(_W);async function Bye(e,t){"modelTopology"in e||(e={modelTopology:e}),e=e;let n=e.modelTopology;n.model_config!=null&&(n=n.model_config);let r=av(n),a=Yi(r,t);if(e.weightsManifest!=null){let s=await ma.loadWeights(e.weightsManifest,e.pathPrefix,a.weights.map(o=>o.originalName)),i={};for(let o of a.weights)i[o.originalName]=s[o.originalName];a.loadWeights(i),wt(s)}return a}async function Wye(e,t){if(t==null&&(t={}),typeof e=="string"){let n=ma.getLoadHandlers(e,t);if(n.length===0)n.push(ma.browserHTTPRequest(e,t));else if(n.length>1)throw new le(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return jye(e,void 0,t)}async function jye(e,t,n){if(n==null&&(n={}),e.load==null)throw new le("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await e.load(),a=r.modelTopology;a.model_config!=null&&(a=a.model_config);let s=n.strict==null?!0:n.strict,i=r.weightData!=null&&r.weightSpecs!=null&&s,o=Yi(av(a),t,i),l=r.trainingConfig;if(l!=null&&o.loadTrainingConfig(l),r.userDefinedMetadata!=null&&o.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new le("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:h,optimizerWeights:c}=Hye(r.weightData,r.weightSpecs);o.loadWeights(h,s),o.optimizer!=null&&c.length>0&&await o.optimizer.setWeights(c),wt(h),wt(c.map(p=>p.tensor))}return o}function Hye(e,t){let n=ma.decodeWeights(e,t),r={},a=[];return t.forEach(s=>{s.group==="optimizer"?a.push({name:s.name,tensor:n[s.name]}):r[s.name]=n[s.name]}),{modelWeights:r,optimizerWeights:a}}var NS=class PE extends Ul{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:gS("sequential_"),t.layers!=null)for(let n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new le(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){let n=t instanceof PE||t instanceof Ul,r;if(n){if(r=t,r.outputs.length!==1)throw new le("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new le("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new le("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let a=tW({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(a)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new le(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new le("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=eW(this.outputs[0])}this.inboundNodes=[],new TS({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:pd(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(a=>a.shape),outputShapes:this.outputs[0].shape})}else{let a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(en(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ul({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new Mo("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new Mo("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new Mo("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new Mo("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},a=!1){let s,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new le("Legacy serialization format not supported yet.");s=n}else $.assert(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,i=n;let o=new t(i);if(!(o instanceof PE))throw new Ot(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(let l of s){let h=Yi(l,void 0,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}return o}set stopTraining(t){if(this.model==null)throw new le("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new le("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let t=[];for(let n of this.layers){let r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}};NS.className="Sequential";Re.registerClass(NS);function Gye(e){return new Ul(e)}function qye(e){return new NS(e)}function SW(e){return tW(e)}function Kye(e,t){SA.registerCallbackConstructor(e,t)}var Na=class extends Re.Serializable{getConfig(){return{}}},IW=class extends Na{apply(e,t=1){return pge(e,t)}};IW.className="elu";Re.registerClass(IW);var TW=class extends Na{apply(e){return J1(e)}};TW.className="selu";Re.registerClass(TW);var kW=class extends Na{apply(e){return fn(e)}};kW.className="relu";Re.registerClass(kW);var EW=class extends Na{apply(e){return oe(()=>_c(6,fn(e)))}};EW.className="relu6";Re.registerClass(EW);var NW=class extends Na{apply(e){return e}};NW.className="linear";Re.registerClass(NW);var CW=class extends Na{apply(e){return Ti(e)}};CW.className="sigmoid";Re.registerClass(CW);var AW=class extends Na{apply(e){return mge(e)}};AW.className="hardSigmoid";Re.registerClass(AW);var RW=class extends Na{apply(e){return Gp(e)}};RW.className="softplus";Re.registerClass(RW);var DW=class extends Na{apply(e){return fge(e)}};DW.className="softsign";Re.registerClass(DW);var MW=class extends Na{apply(e){return wc(e)}};MW.className="tanh";Re.registerClass(MW);var CA=class extends Na{apply(e,t=-1){return Gc(e,t)}};CA.className="softmax";Re.registerClass(CA);var $W=class extends Na{apply(e,t=-1){return G1(e,t)}};$W.className="logSoftmax";Re.registerClass($W);var OW=class extends Na{apply(e){return oe(()=>oe(()=>{let t=Math.sqrt(2),n=re(.5,Se(1,W1(Ke(e,t))));return re(e,n)}))}};OW.className="gelu";Re.registerClass(OW);var FW=class extends Na{apply(e){return oe(()=>re(.5,re(e,Se(1,wc(re(aa(Ke(2,Math.PI)),Se(e,re(.044715,qo(e,3)))))))))}};FW.className="gelu_new";Re.registerClass(FW);var PW=class extends Na{apply(e){return oe(()=>re(e,wc(Gp(e))))}};PW.className="mish";Re.registerClass(PW);var LW=class extends Na{apply(e,t=1){return oe(()=>re(Ti(re(e,t)),e))}};LW.className="swish";Re.registerClass(LW);function Tc(e){return e.getClassName()}function xk(e,t={}){return yx(e,Re.SerializationMap.getMap().classNameMap,t,"activation")}function kc(e){if(e==null){let t={};return t.className="linear",t.config={},xk(t)}if(typeof e=="string"){let t={};return t.className=e,t.config={},xk(t)}else return e instanceof Na?e:xk(e)}function AA(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}var zW=class extends Re.Serializable{},_x=class extends zW{constructor(e){super(),AA(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return oe(()=>{let t=Zn([1]);return this.hasL1&&(t=Se(t,Ye(re(this.l1,Tr(e))))),this.hasL2&&(t=Se(t,Ye(re(this.l2,vx(e))))),ie(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}};_x.className="L1L2";Re.registerClass(_x);function Xye(e){return AA(e),new _x({l1:e!=null?e.l1:null,l2:0})}function Yye(e){return AA(e),new _x({l2:e!=null?e.l2:null,l1:0})}var ZP={l1l2:"L1L2"};function An(e){return oA(e)}function JP(e,t={}){return yx(e,Re.SerializationMap.getMap().classNameMap,t,"regularizer")}function jn(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in ZP?ZP[e]:e,config:{}};return JP(t)}else return e instanceof zW?e:JP(e)}var RA=class extends Ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=ft(e);let n=fn(e);return this.maxValue!=null&&(n=ka(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}};RA.className="ReLU";Re.registerClass(RA);var DA=class extends Ft{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=ft(e);return ix(n,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};DA.className="LeakyReLU";Re.registerClass(DA);var MA=class extends Ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Wn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=jn(e.alphaRegularizer),this.alphaConstraint=Gr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new le(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=en(e);let t=e.slice(1);if(this.sharedAxes!=null)for(let r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new kr({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=ft(e),dx(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Jn(this.alphaInitializer),alphaRegularizer:An(this.alphaRegularizer),alphaConstraint:Hr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}};MA.className="PReLU";Re.registerClass(MA);var $A=class extends Ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ot(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=ft(e);return Hg(n)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};$A.className="ELU";Re.registerClass($A);var OA=class extends Ft{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){let n=ft(e);return re(n,ze(Xa(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}};OA.className="ThresholdedReLU";Re.registerClass(OA);var FA=class extends Ft{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new CA().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return oe(()=>{let n=ft(e),r=t.mask;if(r!=null){let a=re(Ge(as(n.shape),ze(r,n.dtype)),rt(-1e9));n=Se(n,a)}return this.axis instanceof Array?this.axis.length>1?Ea(Ge(n,lx(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};FA.className="Softmax";Re.registerClass(FA);function sm(e,t,n){if(typeof e=="number")return pd(e,t);if(e.length!==t)throw new le(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){let a=e[r];if(!uge(a))throw new le(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${a}`)}return e}function Qi(e,t,n,r,a=1){if(e==null)return e;let s=t+(t-1)*(a-1),i;return n==="same"?i=e:i=e-s+1,Math.floor((i+r-1)/r)}function Ro(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+Ic([n-t,0]);else if(r==="same")e=e*t;else throw new le(`Unsupport padding mode: ${r}.`);return e}function PA(e,t){return oe(()=>(yr(t),t==="channelsFirst"?Ct(e,[0,2,3,1]):e))}function VW(e,t){return oe(()=>(yr(t),t==="channelsFirst"?Ct(e,[0,2,3,4,1]):e))}function Qye(e,t,n,r=1,a="valid",s,i=1){return oe(()=>{if(s==null&&(s=to()),yr(s),e.shape.length!==3)throw new le(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new le(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new le(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(s==="channelsFirst"&&(e=Ct(e,[0,2,1])),a==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=z1(e,t,r,a==="same"?"same":"valid","NWC",i);return n!=null&&(o=oo(o,n)),o})}function eL(e,t,n,r=[1,1],a="valid",s,i,o=null){return oe(()=>{if(s==null&&(s=to()),yr(s),e.rank!==3&&e.rank!==4)throw new le(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new le(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=PA(e,s);if(a==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Sm.conv2d({x:l,filter:t,strides:r,pad:a==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:o}),s==="channelsFirst"&&(l=Ct(l,[0,3,1,2])),l})}function Zye(e,t,n,r=[1,1,1],a="valid",s,i){return oe(()=>{if(s==null&&(s=to()),yr(s),e.rank!==4&&e.rank!==5)throw new le(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new le(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=VW(e,s);if(a==="causal")throw new Ot("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=hC(o,t,r,a==="same"?"same":"valid","NDHWC",i),n!=null&&(o=oo(o,n)),s==="channelsFirst"&&(o=Ct(o,[0,4,1,2,3])),o})}var UW=class BW extends Ft{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",BW.verifyArgs(n),this.rank=t,ta(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ot(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=sm(n.kernelSize,t,"kernelSize"),this.strides=sm(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,ai(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,yr(this.dataFormat),this.activation=kc(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Wn(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Gr(n.biasConstraint),this.biasRegularizer=jn(n.biasRegularizer),this.activityRegularizer=jn(n.activityRegularizer),this.dilationRate=sm(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new le(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new le(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new le(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Ao("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!lA(t.kernelSize,"number",1,3))throw new le(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Tc(this.activation),useBias:this.useBias,biasInitializer:Jn(this.biasInitializer),biasRegularizer:An(this.biasRegularizer),activityRegularizer:An(this.activityRegularizer),biasConstraint:Hr(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}},CS=class WW extends UW{constructor(t,n){super(t,n),this.kernel=null,WW.verifyArgs(n),this.filters=n.filters,ta(this.filters,"filters"),this.kernelInitializer=Wn(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Gr(n.kernelConstraint),this.kernelRegularizer=jn(n.kernelRegularizer)}build(t){t=en(t);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new le(`The channel dimension of the input should be defined. Found ${t[n]}`);let r=t[n],a=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return oe(()=>{t=ft(t);let r,a=this.bias==null?null:this.bias.read(),s=H6(this.activation.getClassName());if(s!=null&&this.rank===2)r=eL(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=Qye(t,this.kernel.read(),a,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=eL(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=Zye(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ot("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=en(t);let n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){let i=Qi(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(i)}let a=[t[0]];return this.dataFormat==="channelsLast"?(a=a.concat(n),a.push(this.filters)):(a.push(this.filters),a=a.concat(n)),a}getConfig(){let t={filters:this.filters,kernelInitializer:Jn(this.kernelInitializer),kernelRegularizer:An(this.kernelRegularizer),kernelConstraint:Hr(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new le(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}},AS=class jW extends CS{constructor(t){super(2,t),jW.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!lA(t.kernelSize,"number",1,2))throw new le(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}};AS.className="Conv2D";Re.registerClass(AS);var RS=class HW extends CS{constructor(t){super(3,t),HW.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new le(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}};RS.className="Conv3D";Re.registerClass(RS);var LA=class extends AS{constructor(e){if(super(e),this.inputSpec=[new kr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new le(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=en(e),e.length!==4)throw new le("Input should have rank 4; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new le("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kr({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return oe(()=>{let n=ft(e);if(n.shape.length!==4)throw new le(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,i;this.dataFormat==="channelsFirst"?(s=2,i=3):(s=1,i=2);let o=r[s],l=r[i],h=this.kernelSize[0],c=this.kernelSize[1],p=this.strides[0],m=this.strides[1],g=Ro(o,p,h,this.padding),b=Ro(l,m,c,this.padding),v=[a,g,b,this.filters];this.dataFormat!=="channelsLast"&&(n=Ct(n,[0,2,3,1]));let x=V1(n,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Ct(x,[0,3,1,2])),this.bias!=null&&(x=oo(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=en(e);let t=e.slice(),n,r,a;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3):(n=3,r=1,a=2);let s=this.kernelSize[0],i=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=Ro(t[r],o,s,this.padding),t[a]=Ro(t[a],l,i,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};LA.className="Conv2DTranspose";Re.registerClass(LA);var zA=class extends RS{constructor(e){if(super(e),this.inputSpec=[new kr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new le(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=en(e),e.length!==5)throw new le("Input should have rank 5; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new le("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kr({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return oe(()=>{let n=ft(e);if(n.shape.length!==5)throw new le(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,i,o;this.dataFormat==="channelsFirst"?(o=2,s=3,i=4):(o=1,s=2,i=3);let l=r[o],h=r[s],c=r[i],p=this.kernelSize[0],m=this.kernelSize[1],g=this.kernelSize[2],b=this.strides[0],v=this.strides[1],x=this.strides[2],_=Ro(l,b,p,this.padding),I=Ro(h,v,m,this.padding),k=Ro(c,x,g,this.padding),E=[a,_,I,k,this.filters];this.dataFormat!=="channelsLast"&&(n=Ct(n,[0,2,3,4,1]));let R=dC(n,this.kernel.read(),E,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(R=Ct(R,[0,4,1,2,3])),this.bias!==null&&(R=oo(R,this.bias.read(),this.dataFormat)),this.activation!==null&&(R=this.activation.apply(R)),R})}computeOutputShape(e){e=en(e);let t=e.slice(),n,r,a,s;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3,s=4):(n=4,r=1,a=2,s=3);let i=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],h=this.strides[0],c=this.strides[1],p=this.strides[2];return t[n]=this.filters,t[r]=Ro(t[r],h,i,this.padding),t[a]=Ro(t[a],c,o,this.padding),t[s]=Ro(t[s],p,l,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};zA.className="Conv3DTranspose";Re.registerClass(zA);var GW=class extends CS{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new le("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new le("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new le(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Wn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=jn(t.depthwiseRegularizer),this.depthwiseConstraint=Gr(t.depthwiseConstraint),this.pointwiseInitializer=Wn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=jn(t.pointwiseRegularizer),this.pointwiseConstraint=Gr(t.pointwiseConstraint)}build(e){if(e=en(e),e.length<this.rank+2)throw new le(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new le(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);let n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);let s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new kr({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return oe(()=>{e=ft(e);let n;if(this.rank===1)throw new Ot("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ct(e,[0,2,3,1])),n=Xg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=oo(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=Ct(n,[0,3,1,2])),n})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Jn(this.depthwiseInitializer),e.pointwiseInitializer=Jn(this.pointwiseInitializer),e.depthwiseRegularizer=An(this.depthwiseRegularizer),e.pointwiseRegularizer=An(this.pointwiseRegularizer),e.depthwiseConstraint=Hr(this.depthwiseConstraint),e.pointwiseConstraint=Hr(this.pointwiseConstraint),e}};GW.className="SeparableConv";var VA=class extends GW{constructor(e){super(2,e)}};VA.className="SeparableConv2D";Re.registerClass(VA);var UA=class qW extends CS{constructor(t){super(1,t),qW.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){let t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!lA(t.kernelSize,"number",1,1))throw new le(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}};UA.className="Conv1D";Re.registerClass(UA);var BA=class extends Ft{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return oe(()=>{if(e=ft(e),this.dataFormat==="channelsLast"){let n=i0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return i0(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let n=i0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return i0(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};BA.className="Cropping2D";Re.registerClass(BA);var WA=class extends Ft{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,ige(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let t=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,n]}else{let t=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return oe(()=>{let n=ft(e),r=n.shape;if(this.dataFormat==="channelsFirst"){n=Ct(n,[0,2,3,1]);let a=this.size[0]*r[2],s=this.size[1]*r[3],i=this.interpolation==="nearest"?Xs.resizeNearestNeighbor(n,[a,s]):Xs.resizeBilinear(n,[a,s]);return Ct(i,[0,3,1,2])}else{let a=this.size[0]*r[1],s=this.size[1]*r[2];return this.interpolation==="nearest"?Xs.resizeNearestNeighbor(n,[a,s]):Xs.resizeBilinear(n,[a,s])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}};WA.className="UpSampling2D";Re.registerClass(WA);function Jye(e,t,n=[1,1],r="valid",a,s){return oe(()=>{a==null&&(a=to()),yr(a);let i=PA(e,a);if(e.rank!==4)throw new le(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new le(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=Hp(i,t,n,r==="same"?"same":"valid","NHWC",s),a==="channelsFirst"&&(i=Ct(i,[0,3,1,2])),i})}var jA=class extends UW{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Wn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Gr(e.depthwiseConstraint),this.depthwiseRegularizer=jn(e.depthwiseRegularizer)}build(e){if(e=en(e),e.length<4)throw new le(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new le(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);let n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return oe(()=>{e=ft(e);let n=Jye(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=oo(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=en(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=Qi(t,this.kernelSize[0],this.padding,this.strides[0]),s=Qi(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,a,s]:[e[0],a,s,r]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Jn(this.depthwiseInitializer),e.depthwiseRegularizer=An(this.depthwiseRegularizer),e.depthwiseConstraint=Hr(this.depthwiseRegularizer),e}};jA.className="DepthwiseConv2D";Re.registerClass(jA);function KW(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new le("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(s){return s==null||Array.isArray(s)?s:[s]}return t=a(t),n=a(n),{inputs:e,initialState:t,constants:n}}function XW(e,t,n,r=!1,a,s,i=!1,o=!1){return oe(()=>{let l=t.shape.length;if(l<3)throw new le(`Input should be at least 3D, but is ${l}D.`);let h=[1,0].concat(eo(2,l));t=Ct(t,h),s!=null,i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=ze(ze(a,"bool"),"float32"),a.rank===l-1&&(a=ea(a,-1)),a=Ct(a,h)),r&&(t=ri(t,0),a!=null&&(a=ri(a,0)));let c=[],p,m=n,g=t.shape[0],b=or(t),v;a!=null&&(v=or(a));for(let _=0;_<g;++_){let I=b[_],k=oe(()=>e(I,m));if(a==null)p=k[0],m=k[1];else{let E=oe(()=>{let R=v[_],U=Ge(Os(R),R),D=Se(re(k[0],R),re(m[0],U)),C=m.map((O,z)=>Se(re(k[1][z],R),re(O,U)));return{output:D,newStates:C}});p=E.output,m=E.newStates}o&&c.push(p)}let x;return o&&(x=Nr(c,1)),[p,x,m]})}var au=class YW extends Ft{constructor(t){super(t);let n;if(t.cell==null)throw new le("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new $S({cells:t.cell}):n=t.cell,n.stateSize==null)throw new le("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new kr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return eo(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){RE(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let r=n[0],a;if(this.returnSequences?a=[t[0],t[1],r]:a=[t[0],r],this.returnState){let s=[];for(let i of n)s.push([t[0],i]);return[a].concat(s)}else return a}computeMask(t,n){return oe(()=>{Array.isArray(n)&&(n=n[0]);let r=this.returnSequences?n:null;if(this.returnState){let a=this.states.map(s=>null);return[r].concat(a)}else return r})}get states(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Ot("Constants support is not implemented in RNN yet.");RE(t)&&(t=t[0]),t=t;let n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new kr({shape:[n,null,...r]});let a=[t[0]].concat(t.slice(2));this.cell.build(a);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!$.arraysEqual(this.stateSpec.map(i=>i.shape[i.shape.length-1]),s))throw new le(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(i=>new kr({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){oe(()=>{if(!this.stateful)throw new Bu("Cannot call resetStates() on an RNN Layer that is not stateful.");let r=this.inputSpec[0].shape[0];if(r==null)throw new le("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Zn([r,a])):this.states_=[Zn([r,this.cell.stateSize])];else if(t==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Zn([r,a])):this.states_[0]=Zn([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new le(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let a=0;a<this.states_.length;++a){let s=t[a],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[a]:this.cell.stateSize,o=[r,i];if(!$.arraysEqual(s.shape,o))throw new le(`State ${a} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${s.shape}`);this.states_[a]=s}}this.states_=this.states_.map(a=>Br(a.clone()))})}apply(t,n){let r=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});let s=KW(t,r,a,this.numConstants);t=s.inputs,r=s.initialState,a=s.constants;let i=[],o=[];if(r!=null){n.initialState=r,i=i.concat(r),this.stateSpec=[];for(let l of r)this.stateSpec.push(new kr({shape:l.shape}));o=o.concat(this.stateSpec)}if(a!=null&&(n.constants=a,i=i.concat(a),this.numConstants=a.length),i[0]instanceof no){let l=[t].concat(i),h=this.inputSpec.concat(o),c=this.inputSpec;this.inputSpec=h;let p=super.apply(l,n);return this.inputSpec=c,p}else return super.apply(t,n)}call(t,n){return oe(()=>{let r=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;t=ft(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));let i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==i)throw new le(`RNN Layer has ${i} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let o={training:a},l=XW((g,b)=>{let v=this.cell.call([g].concat(b),o);return[v[0],v.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),h=l[0],c=l[1],p=l[2];this.stateful&&this.resetStates(p,a);let m=this.returnSequences?c:h;return this.returnState?[m].concat(p):m})}getInitialState(t){return oe(()=>{let n=Zn(t.shape);return n=Ye(n,[1,2]),n=bx(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?CE(n,[1,r]):n):this.cell.stateSize>1?[CE(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){let t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);let r=this.cell.getConfig();return this.getClassName()===YW.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){let a=n.cell,s=Yi(a,r);return new t(Object.assign(n,{cell:s}))}};au.className="RNN";Re.registerClass(au);var Sx=class extends Ft{},DS=class extends Sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ta(this.units,"units"),this.activation=kc(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Gr(e.kernelConstraint),this.recurrentConstraint=Gr(e.recurrentConstraint),this.biasConstraint=Gr(e.biasConstraint),this.dropout=Im([1,Ic([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Im([1,Ic([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=en(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return oe(()=>{if(e=e,e.length!==2)throw new le(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];let r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ec({ones:()=>Os(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ec({ones:()=>Os(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let a,s=this.dropoutMask,i=this.recurrentDropoutMask;s!=null?a=Wo(re(e,s),this.kernel.read()):a=Wo(e,this.kernel.read()),this.bias!=null&&(a=oo(a,this.bias.read())),i!=null&&(n=re(n,i));let o=Se(a,Wo(n,this.recurrentKernel.read()));return this.activation!=null&&(o=this.activation.apply(o)),[o,o]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Tc(this.activation),useBias:this.useBias,kernelInitializer:Jn(this.kernelInitializer),recurrentInitializer:Jn(this.recurrentInitializer),biasInitializer:Jn(this.biasInitializer),kernelRegularizer:An(this.kernelRegularizer),recurrentRegularizer:An(this.recurrentRegularizer),biasRegularizer:An(this.biasRegularizer),activityRegularizer:An(this.activityRegularizer),kernelConstraint:Hr(this.kernelConstraint),recurrentConstraint:Hr(this.recurrentConstraint),biasConstraint:Hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}};DS.className="SimpleRNNCell";Re.registerClass(DS);var HA=class extends au{constructor(e){e.cell=new DS(e),super(e)}call(e,t){return oe(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}};HA.className="SimpleRNN";Re.registerClass(HA);var MS=class extends Sx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new le("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ta(this.units,"units"),this.activation=kc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=kc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Gr(e.kernelConstraint),this.recurrentConstraint=Gr(e.recurrentConstraint),this.biasConstraint=Gr(e.biasConstraint),this.dropout=Im([1,Ic([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Im([1,Ic([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=en(e);let t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return oe(()=>{if(e=e,e.length!==2)throw new le(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training==null?!1:t.training,r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ec({ones:()=>Os(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ec({ones:()=>Os(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,s=this.recurrentDropoutMask,i,o,l;0<this.dropout&&this.dropout<1&&(e=re(e,a[0]));let h=Wo(e,this.kernel.read());this.useBias&&(h=oo(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=re(r,s[0]));let c=this.recurrentKernel.read(),[p,m]=is(c,[2*this.units,this.units],c.rank-1),g=Wo(r,p),[b,v,x]=is(h,3,h.rank-1),[_,I]=is(g,2,g.rank-1);i=this.recurrentActivation.apply(Se(b,_)),o=this.recurrentActivation.apply(Se(v,I));let k=Wo(re(o,r),m);l=this.activation.apply(Se(x,k));let E=Se(re(i,r),re(Se(1,Mn(i)),l));return[E,E]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Tc(this.activation),recurrentActivation:Tc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jn(this.kernelInitializer),recurrentInitializer:Jn(this.recurrentInitializer),biasInitializer:Jn(this.biasInitializer),kernelRegularizer:An(this.kernelRegularizer),recurrentRegularizer:An(this.recurrentRegularizer),biasRegularizer:An(this.biasRegularizer),activityRegularizer:An(this.activityRegularizer),kernelConstraint:Hr(this.kernelConstraint),recurrentConstraint:Hr(this.recurrentConstraint),biasConstraint:Hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}};MS.className="GRUCell";Re.registerClass(MS);var GA=class extends au{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new MS(e),super(e)}call(e,t){return oe(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};GA.className="GRU";Re.registerClass(GA);var Ix=class extends Sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ta(this.units,"units"),this.activation=kc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=kc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Gr(e.kernelConstraint),this.recurrentConstraint=Gr(e.recurrentConstraint),this.biasConstraint=Gr(e.biasConstraint),this.dropout=Im([1,Ic([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Im([1,Ic([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=en(e);let n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){let a=this.biasInitializer,s=this.units;r=new(t=class extends Ci{apply(i,o){let l=a.apply([s]),h=new bS().apply([s]),c=a.apply([s*2]);return LP(LP(l,h),c)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return oe(()=>{let n=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new le(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1],a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ec({ones:()=>Os(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ec({ones:()=>Os(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,i=this.recurrentDropoutMask,o,l,h,c;0<this.dropout&&this.dropout<1&&(e=re(e,s[0]));let p=Wo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=re(r,i[0])),p=Se(p,Wo(r,this.recurrentKernel.read())),this.useBias&&(p=oo(p,this.bias.read()));let[m,g,b,v]=is(p,4,p.rank-1);o=this.recurrentActivation.apply(m),l=this.recurrentActivation.apply(g),h=Se(re(l,a),re(o,this.activation.apply(b))),c=this.recurrentActivation.apply(v);let x=re(c,this.activation.apply(h));return[x,x,h]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Tc(this.activation),recurrentActivation:Tc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jn(this.kernelInitializer),recurrentInitializer:Jn(this.recurrentInitializer),biasInitializer:Jn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:An(this.kernelRegularizer),recurrentRegularizer:An(this.recurrentRegularizer),biasRegularizer:An(this.biasRegularizer),activityRegularizer:An(this.activityRegularizer),kernelConstraint:Hr(this.kernelConstraint),recurrentConstraint:Hr(this.recurrentConstraint),biasConstraint:Hr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}};Ix.className="LSTMCell";Re.registerClass(Ix);var qA=class extends au{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ix(e),super(e)}call(e,t){return oe(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};qA.className="LSTM";Re.registerClass(qA);var $S=class extends Sx{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return oe(()=>{e=e;let n=e.slice(1),r=[];for(let i of this.cells.slice().reverse())Array.isArray(i.stateSize)?r.push(n.splice(0,i.stateSize.length)):r.push(n.splice(0,1));r.reverse();let a=[],s;for(let i=0;i<this.cells.length;++i){let o=this.cells[i];n=r[i],i===0?s=[e[0]].concat(n):s=[s[0]].concat(n),s=o.call(s,t),a.push(s.slice(1))}n=[];for(let i of a.slice().reverse())n.push(...i);return[s[0]].concat(n)})}build(e){RE(e)&&(e=e[0]),e=e;let t;this.cells.forEach((n,r)=>{jh(`RNNCell_${r}`,()=>{n.build(e),Array.isArray(n.stateSize)?t=n.stateSize[0]:t=n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){let e=super.getConfig(),t=r=>({className:r.getClassName(),config:r.getConfig()}),n={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),n)}static fromConfig(e,t,n={}){let r=[];for(let a of t.cells)r.push(Yi(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let n of this.cells)t.push(...n.trainableWeights);return t.concat(e)}return e}getWeights(){let e=[];for(let t of this.cells)e.push(...t.weights);return DE(e)}setWeights(e){let t=[];for(let n of this.cells){let r=n.weights.length,a=e.splice(r);for(let s=0;s<n.weights.length;++s)t.push([n.weights[s],a[s]])}yA(t)}};$S.className="StackedRNNCells";Re.registerClass($S);function Ec(e){let{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:s}=e,i=()=>s!=null?s(t(),n):Z6(t(),n),o=()=>xx(i,t,r);return!a||a<=1?Br(o().clone()):Array(a).fill(void 0).map(o).map(l=>Br(l.clone()))}var ebe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},QW=class extends au{constructor(e){if(e.unroll)throw new Ot("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ot("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new kr({ndim:5})]}call(e,t){return oe(()=>{if(this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new le("ConvRNN2D cell does not support constants");let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return oe(()=>{let{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)],s=Zn(a);return Array.isArray(t)?Array(t.length).fill(s):[s]})}resetStates(e,t=!1){oe(()=>{if(!this.stateful)throw new Bu("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(n[0]==null)throw new le("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zn(a)):this.states_=[Zn(a)];else if(e==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zn(a)):this.states_[0]=Zn(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new le(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let s=0;s<this.states_.length;++s){let i=e[s],o=a;if(!$.arraysEqual(i.shape,o))throw new le(`State ${s} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Br(s.clone()))})}computeSingleOutputShape(e){let{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:s,dilationRate:i}=this.cell,o=t==="channelsFirst",l=e[o?3:2],h=e[o?4:3],c=Qi(l,r[0],a,s[0],i[0]),p=Qi(h,r[1],a,s[1],i[1]);return[...e.slice(0,2),...o?[n,c,p]:[c,p,n]]}};QW.className="ConvRNN2D";var OS=class extends Ix{constructor(e){let{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:s,dilationRate:i}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,ta(this.filters,"filters"),this.kernelSize=sm(n,2,"kernelSize"),this.kernelSize.forEach(o=>ta(o,"kernelSize")),this.strides=sm(r||1,2,"strides"),this.strides.forEach(o=>ta(o,"strides")),this.padding=a||"valid",ai(this.padding),this.dataFormat=s||"channelsLast",yr(this.dataFormat),this.dilationRate=sm(i||1,2,"dilationRate"),this.dilationRate.forEach(o=>ta(o,"dilationRate"))}build(e){var t;e=en(e);let n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new le(`The channel dimension of the input should be defined. Found ${e[n]}`);let r=e[n],a=4,s=this.kernelSize.concat([r,this.filters*a]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let i=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let o;if(this.unitForgetBias){let l=this.biasInitializer,h=this.filters;o=new(t=class extends Ci{apply(c,p){let m=l.apply([h]),g=as([h]),b=l.apply([h*2]);return uA([m,g,b])}},t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return oe(()=>{if(e.length!==3)throw new le(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training||!1,r=e[0],a=e[1],s=e[2],i=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ec({ones:()=>Os(r),rate:this.dropout,training:n,count:i,dropoutFunc:this.dropoutFunc}));let o=this.dropoutMask,l=(me,xe,H)=>!xe||!xe[H]?me:re(xe[H],me),h=l(r,o,0),c=l(r,o,1),p=l(r,o,2),m=l(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ec({ones:()=>Os(a),rate:this.recurrentDropout,training:n,count:i,dropoutFunc:this.dropoutFunc}));let g=this.recurrentDropoutMask,b=l(a,g,0),v=l(a,g,1),x=l(a,g,2),_=l(a,g,3),I=3,[k,E,R,U]=is(this.kernel.read(),i,I),[D,C,O,z]=this.useBias?is(this.bias.read(),i):[null,null,null,null];h=this.inputConv(h,k,D,this.padding),c=this.inputConv(c,E,C,this.padding),p=this.inputConv(p,R,O,this.padding),m=this.inputConv(m,U,z,this.padding);let[M,N,P,Q]=is(this.recurrentKernel.read(),i,I);b=this.recurrentConv(b,M),v=this.recurrentConv(v,N),x=this.recurrentConv(x,P),_=this.recurrentConv(_,Q);let ee=this.recurrentActivation.apply(Se(h,b)),q=this.recurrentActivation.apply(Se(c,v)),Z=Se(re(q,s),re(ee,this.activation.apply(Se(p,x)))),ne=re(this.recurrentActivation.apply(Se(m,_)),this.activation.apply(Z));return[ne,ne,Z]})}getConfig(){let e=super.getConfig(),{units:t}=e,n=ebe(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){let a=ja(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?oo(a,n,this.dataFormat):a}recurrentConv(e,t){return ja(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}};OS.className="ConvLSTM2DCell";Re.registerClass(OS);var KA=class extends QW{constructor(e){let t=new OS(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}};KA.className="ConvLSTM2D";Re.registerClass(KA);var FS=class extends Ft{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return n}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);if(0<this.rate&&this.rate<1){let r=t.training==null?!1:t.training,a=this.getNoiseShape(n);return xx(()=>Z6(n,this.rate,a,this.seed),()=>n,r)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}};FS.className="Dropout";Re.registerClass(FS);var XA=class extends FS{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let t=e.shape;return[t[0],1,t[2]]}};XA.className="SpatialDropout1D";Re.registerClass(XA);var YA=class extends Ft{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,ta(this.units,"units"),this.activation=kc(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Wn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Wn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Gr(e.kernelConstraint),this.biasConstraint=Gr(e.biasConstraint),this.kernelRegularizer=jn(e.kernelRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.activityRegularizer=jn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=en(e);let t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=en(e);let t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e),r=H6(this.activation.getClassName()),a;return r!=null?a=Wo(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=Wo(n,this.kernel.read()),this.bias!=null&&(a=oo(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){let e={units:this.units,activation:Tc(this.activation),useBias:this.useBias,kernelInitializer:Jn(this.kernelInitializer),biasInitializer:Jn(this.biasInitializer),kernelRegularizer:An(this.kernelRegularizer),biasRegularizer:An(this.biasRegularizer),activityRegularizer:An(this.activityRegularizer),kernelConstraint:Hr(this.kernelConstraint),biasConstraint:Hr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}};YA.className="Dense";Re.registerClass(YA);var QA=class extends Ft{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=en(e);for(let t of e.slice(1))if(t==null)throw new le(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ic(e,1)]}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){let r=[0];for(let a=2;a<n.rank;++a)r.push(a);r.push(1),n=Ct(n,r)}return dge(n)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let t=super.getConfig();return Object.assign(e,t),e}};QA.className="Flatten";Re.registerClass(QA);var ZA=class extends Ft{constructor(e){super(e),this.supportsMasking=!0,this.activation=kc(e.activation)}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);return this.activation.apply(n)})}getConfig(){let e={activation:Tc(this.activation)},t=super.getConfig();return Object.assign(e,t),e}};ZA.className="Activation";Re.registerClass(ZA);var JA=class extends Ft{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return oe(()=>(e=ft(e),cge(e,this.n)))}getConfig(){let e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}};JA.className="RepeatVector";Re.registerClass(JA);var eR=class extends Ft{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){let n="Total size of new array must be unchanged.",r=t.slice(),a=1,s=null;for(let o=0;o<r.length;++o){let l=r[o];if(this.isUnknown(l))if(s===null)s=o;else throw new le("Can only specifiy one unknown dimension.");else a*=l}let i=ic(e);if(s!==null){if(a===0||i%a!==0)throw new le(n);r[s]=i/a}else if(i!==a)throw new le(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ie(n,a)})}getConfig(){let e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}};eR.className="Reshape";Re.registerClass(eR);var tR=class extends Ft{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let t=eo(1,e.dims.length+1);if(!$.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new kr({ndim:this.dims.length+1})]}computeOutputShape(e){e=en(e);let t=e.slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return Ct(ft(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}};tR.className="Permute";Re.registerClass(tR);var nR=class extends Ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){let n=ft(e);return Jb(hd(n,this.maskValue),-1)}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e),r=Jb(hd(n,this.maskValue),-1,!0);return re(n,ze(r,n.dtype))})}};nR.className="Masking";Re.registerClass(nR);var rR=class extends Ft{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(pn(e.inputLength))}this.inputDim=e.inputDim,ta(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ta(this.outputDim,"outputDim"),this.embeddingsInitializer=Wn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=jn(e.embeddingsRegularizer),this.activityRegularizer=jn(e.activityRegularizer),this.embeddingsConstraint=Gr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return oe(()=>this.maskZero?(e=ft(e),hd(e,Ut(e))):null)}computeOutputShape(e){if(e=en(e),this.inputLength==null)return[...e,this.outputDim];let t=pn(this.inputLength);if(t.length!==e.length-1)throw new le(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){let a=t[r],s=e[r+1];if(a!=null&&s!=null&&a!==s)throw new le(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);a==null&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);n.dtype!=="int32"&&(n=Xl(n,"int32"));let r=Q6(this.embeddings.read(),ie(n,[n.size]));return ie(r,en(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Jn(this.embeddingsInitializer),embeddingsRegularizer:An(this.embeddingsRegularizer),activityRegularizer:An(this.activityRegularizer),embeddingsConstraint:Hr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}};rR.className="Embedding";Re.registerClass(rR);var Yp=class extends Ft{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ot}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;let n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){let a=e[e.length-t.length+r],s=t[r];if(a==null||s==null||a<0||s<0)n.push(null);else if(a===1)n.push(s);else if(s===1)n.push(a);else{if(a!==s)throw new le("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[en(e)]),e=e,e.length<2)throw new le(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(let a of e)a!=null&&a[0]!==null&&t.push(a[0]);if(t=sc(t),t.length>1)throw new le(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let a=1;a<e.length;++a){let s=e[a]==null?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=e.map(a=>a.length);e.indexOf(null)===-1&&sc(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return oe(()=>{if(e=e,this.reshapeRequired){let n=[],r=e.map(a=>a.rank);if(r.indexOf(null)===-1){let a=Ic(r);for(let s of e){let i=s.rank;for(let o=0;o<a-i;++o)s=bx(s,1);n.push(s)}return this.mergeFunction(n)}else{let a=!1;for(let o of e){let l=o.rank;if(l==null){let h=o.shape,c=h[0],p=h.slice(1).concat([c]),m=ie(o,[c].concat(ic(h.slice(1))));m=Ct(m,[1,0]),m=ie(m,p),n.push(m),a=!0}else if(l>1){let h=eo(1,l).concat([0]);n.push(Ct(o,h)),a=!0}else n.push(o)}let s=this.mergeFunction(n),i=s.rank;if(a){if(i==null){let o=s.shape,l=o.length,h=o[l-1],c=[h].concat(o.slice(0,o.length-1));s=ie(Ct(ie(s,[-1,h]),[1,0]),c)}else if(i>1){let o=[i-1].concat(eo(0,i-1));s=Ct(s,o)}}return s}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){let a=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,a)}let n=[];for(let r of e)r!=null&&r[0]!==null&&n.push(r[0]);return n=sc(n),n.length===1?t=n.concat(t):t=[null].concat(t),t}computeMask(e,t){return oe(()=>{if(t==null)return null;if(!Array.isArray(t))throw new le("`mask` should be an Array");if(!Array.isArray(e))throw new le("`inputs` should be an Array");if(t.length!==e.length)throw new le(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:ea(r,0));let n=t[0];for(let r=1;r<t.length-1;++r)n=Ei(n,t[r]);return n})}},aR=class extends Yp{constructor(e){super(e)}mergeFunction(e){return oe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Se(t,e[n]);return t})}};aR.className="Add";Re.registerClass(aR);var sR=class extends Yp{constructor(e){super(e)}mergeFunction(e){return oe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=re(t,e[n]);return t})}};sR.className="Multiply";Re.registerClass(sR);var iR=class extends Yp{constructor(e){super(e)}mergeFunction(e){return oe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Se(t,e[n]);return re(1/e.length,t)})}};iR.className="Average";Re.registerClass(iR);var oR=class extends Yp{constructor(e){super(e)}mergeFunction(e){return oe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=Jo(t,e[n]);return t})}};oR.className="Maximum";Re.registerClass(oR);var lR=class extends Yp{constructor(e){super(e)}mergeFunction(e){return oe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=_c(t,e[n]);return t})}};lR.className="Minimum";Re.registerClass(lR);var uR=class extends Yp{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new le("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(let r of e)if(r!=null){t=!1;break}if(t)return;let n=[];for(let r=0;r<e.length;++r){let a=e[r].slice();a.splice(this.axis,1);let s=!1;for(let i of n)if($.arraysEqual(i,a)){s=!0;break}s||n.push(a)}if(n.length>1)throw new le("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return oe(()=>uA(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new le("A `Concatenate` layer should be called on a list of inputs.");let t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(let a of t.slice(1)){if(n[r]==null||a[r]==null){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new le("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new le("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new le(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return oe(()=>{let n=!0;if(t.forEach(s=>{if(s!=null){n=!1;return}}),n)return null;let r=[];for(let s=0;s<e.length;++s)t[s]==null?r.push(ze(Os(e[s]),"bool")):t[s].rank<e[s].rank?r.push(ea(t[s],-1)):r.push(t[s]);let a=Sn(r,this.axis);return L1(a,-1,!1)})}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};uR.className="Concatenate";Re.registerClass(uR);function ab(e,t){for(;e<0;)e+=t;return e}function tbe(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Ot("batchDot is not implemented for tensors of 4D or higher rank yet");if($.assert(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),$.assert(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new Ot("batchDot is not implemented for complex64-type Tensors yet.");let r=e.shape.length,a=t.shape.length;n==null&&(n=[r-1,a-2]);let s=n;return oe(()=>{let i;if(r>a){i=r-a;let l=[];for(let h=0;h<i;++h)l.push(1);t=ie(t,t.shape.concat(l))}else if(a>r){i=a-r;let l=[];for(let h=0;h<i;++h)l.push(1);e=ie(e,e.shape.concat(l))}else i=0;let o;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?o=Ye(re(e,t),s[0]):o=Ye(re(Ct(e,[1,0]),t),s[1]);else{let l=s[0]!==e.shape.length-1,h=s[1]===t.shape.length-1;o=Nt(e,t,l,h)}if(i>0){let l;r>a?l=r+a-3:l=r-1;let h=[];for(let c=l;c<l+i;++c)h.push(c);o=qc(o,h)}return o.shape.length===1&&(o=ea(o,1)),o})}var cR=class extends Yp{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){$.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new le(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new le(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],n=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((a,s)=>ab(a,e[s].shape.length)):r=[ab(this.axes,t.shape.length),ab(this.axes,n.shape.length)],this.normalize&&(t=w_(t,r[0]),n=w_(n,r[1])),tbe(t,n,r)}interpretAxes(e,t){let n;return Array.isArray(this.axes)?n=this.axes:n=[ab(this.axes,e.length),ab(this.axes,t.length)],n}computeOutputShape(e){$.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);let a=t.concat(n);return a.length===1&&a.push(1),a}computeMask(e,t){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}};cR.className="Dot";Re.registerClass(cR);var hR=class extends Ft{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);return xx(()=>Se(yS(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}};hR.className="GaussianNoise";Re.registerClass(hR);var dR=class extends Ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return oe(()=>{this.invokeCallHook(e,t);let n=ft(e);return this.rate>0&&this.rate<1?xx(()=>{let r=Math.sqrt(this.rate/(1-this.rate));return re(n,yS(n.shape,1,r))},()=>n,t.training||!1):n})}};dR.className="GaussianDropout";Re.registerClass(dR);var pR=class extends Ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||ft(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return oe(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return xx(()=>{let r=ft(e),a=-1.6732632423543772*1.0507009873554805,s=tu(Hc(n),this.rate);s=Xl(s,"float32");let i=((1-this.rate)*(1+this.rate*a**2))**-.5,o=-i*a*this.rate,l=Se(re(r,s),re(Se(s,-1),a));return Se(re(l,i),o)},()=>ft(e),t.training||!1)}return e})}};pR.className="AlphaDropout";Re.registerClass(pR);function sv(e,t,n,r,a,s=.001){let i;if(e.rank===2)i=tC(e,t,n,r,a,s);else if(e.rank===3)i=nC(e,t,n,r,a,s);else if(e.rank===4)i=rC(e,t,n,r,a,s);else throw new Ot(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return i}function nbe(e,t,n,r,a=.001){return oe(()=>{let s=cx(e,r),i=s.mean,o=s.variance;return[sv(e,i,o,n,t,a),i,o]})}function rbe(e,t,n,r,a=.001){return oe(()=>{let s=cx(e,r),i=s.mean,o=s.variance,l=[];for(let g of eo(0,e.rank))r.indexOf(g)!==-1?l.push(1):l.push(e.shape[g]);let h=ie(i,l),c=ie(o,l),p=t==null?null:ie(t,l),m=n==null?null:ie(n,l);return[sv(e,h,c,m,p,a),i,o]})}function abe(e,t,n,r,a=.001){return $.arraysEqual(r.slice().sort(),eo(0,e.rank-1))?nbe(e,t,n,r,a):rbe(e,t,n,r,a)}var fR=class extends Ft{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Wn(e.betaInitializer||"zeros"),this.gammaInitializer=Wn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Wn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Wn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Gr(e.betaConstraint),this.gammaConstraint=Gr(e.gammaConstraint),this.betaRegularizer=jn(e.betaRegularizer),this.gammaRegularizer=jn(e.gammaRegularizer)}build(e){e=en(e);let t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(n==null)throw new le(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new kr({ndim:e.length,axes:{[t]:n}})];let r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return oe(()=>{let n=t.training==null?!1:t.training,r=ft(e),a=r.shape,s=a.length,i=eo(0,s),o=this.axis>=0?this.axis:this.axis+s;i.splice(o,1);let l=pd(1,s);l[o]=a[o];let h=i.slice();h.sort();let c=!$.arraysEqual(h,eo(0,s).slice(0,s-1)),p=()=>{if(c){let x=ie(this.movingMean.read(),l),_=ie(this.movingVariance.read(),l),I=this.center?ie(this.beta.read(),l):null,k=this.scale?ie(this.gamma.read(),l):null;return sv(r,x,_,I,k,this.epsilon)}else return sv(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return p();let[m,g,b]=abe(r,this.gamma.read(),this.beta.read(),i,this.epsilon),v=(x,_,I)=>{oe(()=>{let k=1-I,E=x.read(),R=re(Ge(E,_),k);x.write(Ge(E,R))})};return v(this.movingMean,g,this.momentum),v(this.movingVariance,b,this.momentum),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jn(this.betaInitializer),gammaInitializer:Jn(this.gammaInitializer),movingMeanInitializer:Jn(this.movingMeanInitializer),movingVarianceInitializer:Jn(this.movingVarianceInitializer),betaRegularizer:An(this.betaRegularizer),gammaRegularizer:An(this.gammaRegularizer),betaConstraint:Hr(this.betaConstraint),gammaConstraint:Hr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}};fR.className="BatchNormalization";Re.registerClass(fR);var mR=class extends Ft{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Wn(e.betaInitializer||"zeros"),this.gammaInitializer=Wn(e.gammaInitializer||"ones"),this.betaRegularizer=jn(e.betaRegularizer),this.gammaRegularizer=jn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=en(e);let t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(let a of this.axis)if(a<0||a>=t)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==sc(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(a=>e[a]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){let n=ft(e),r=n.shape,a=r.length;return oe(()=>{let{mean:s,variance:i}=cx(n,this.axis,!0),o=pd(1,a);for(let g of this.axis)o[g]=r[g];let l=g=>g!=null&&g.shape.length!==a?ie(g,o):g,h=this.scale?l(this.gamma.read()):null,c=this.center?l(this.beta.read()):null,p=[],m=[];for(let g=0;g<a;++g)this.axis.indexOf(g)!==-1?(p.push(r[g]),m.push(1)):(p.push(1),m.push(r[g]));return s=Rs(s,p),i=Rs(i,p),h!=null&&(h=Rs(h,m)),c!=null&&(c=Rs(c,m)),sv(n,s,i,c,h,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jn(this.betaInitializer),gammaInitializer:Jn(this.gammaInitializer),betaRegularizer:An(this.betaRegularizer),gammaRegularizer:An(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}};mR.className="LayerNormalization";Re.registerClass(mR);function sbe(e,t,n){return oe(()=>{if(e.rank!==4)throw new le(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new le("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=to()),n!=="channelsLast"&&n!=="channelsFirst")throw new le(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],io(e,r)})}var gR=class extends Ft{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?to():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new le(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new le(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new le(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new kr({ndim:4})]}computeOutputShape(e){e=en(e);let t,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],t,n]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],t,n,e[3]])}call(e,t){return oe(()=>sbe(ft(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};gR.className="ZeroPadding2D";Re.registerClass(gR);function PS(e,t,n,r,a,s){return oe(()=>{yr(a),q6(s),ai(r),n==null&&(n=[1,1]),r==null&&(r="valid"),a==null&&(a=to()),s==null&&(s="max"),e=PA(e,a);let i,o=r==="same"?"same":"valid";return s==="max"?i=Qr(e,t,n,o):i=eu(e,t,n,o),a==="channelsFirst"&&(i=Ct(i,[0,3,1,2])),i})}function ZW(e,t,n,r,a,s){return oe(()=>{yr(a),q6(s),ai(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),a==null&&(a=to()),s==null&&(s="max"),e=VW(e,a);let i,o=r==="same"?"same":"valid";return s==="max"?i=EC(e,t,n,o):i=eC(e,t,n,o),a==="channelsFirst"&&(i=Ct(i,[0,4,1,2,3])),i})}var JW=class extends Ft{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new le(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ta(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new le(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ta(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,ai(this.padding),this.inputSpec=[new kr({ndim:3})]}computeOutputShape(e){e=en(e);let t=Qi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return oe(()=>{this.invokeCallHook(e,t),e=bx(ft(e),2);let n=this.poolingFunction(ft(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return qc(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}},yR=class extends JW{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),PS(e,t,n,r,a,"max")}};yR.className="MaxPooling1D";Re.registerClass(yR);var bR=class extends JW{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),PS(e,t,n,r,a,"avg")}};bR.className="AveragePooling1D";Re.registerClass(bR);var ej=class extends Ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new le(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ta(this.poolSize,"poolSize"),ta(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),ai(this.padding),this.inputSpec=[new kr({ndim:4})]}computeOutputShape(e){e=en(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Qi(t,this.poolSize[0],this.padding,this.strides[0]),n=Qi(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return oe(()=>(this.invokeCallHook(e,t),this.poolingFunction(ft(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},vR=class extends ej{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),PS(e,t,n,r,a,"max")}};vR.className="MaxPooling2D";Re.registerClass(vR);var xR=class extends ej{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),PS(e,t,n,r,a,"avg")}};xR.className="AveragePooling2D";Re.registerClass(xR);var tj=class extends Ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new le(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ta(this.poolSize,"poolSize"),ta(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),ai(this.padding),this.inputSpec=[new kr({ndim:5})]}computeOutputShape(e){e=en(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Qi(t,this.poolSize[0],this.padding,this.strides[0]),n=Qi(n,this.poolSize[1],this.padding,this.strides[1]),r=Qi(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return oe(()=>(this.invokeCallHook(e,t),this.poolingFunction(ft(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},wR=class extends tj{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),ZW(e,t,n,r,a,"max")}};wR.className="MaxPooling3D";Re.registerClass(wR);var _R=class extends tj{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return yr(a),ai(r),ZW(e,t,n,r,a,"avg")}};_R.className="AveragePooling3D";Re.registerClass(_R);var nj=class extends Ft{constructor(e){super(e),this.inputSpec=[new kr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Ot}},SR=class extends nj{constructor(e){super(e||{})}call(e,t){return oe(()=>{let n=ft(e);return Qn(n,1)})}};SR.className="GlobalAveragePooling1D";Re.registerClass(SR);var IR=class extends nj{constructor(e){super(e||{})}call(e,t){return oe(()=>{let n=ft(e);return ei(n,1)})}};IR.className="GlobalMaxPooling1D";Re.registerClass(IR);var rj=class extends Ft{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.inputSpec=[new kr({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Ot}getConfig(){let e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},TR=class extends rj{call(e,t){return oe(()=>{let n=ft(e);return this.dataFormat==="channelsLast"?Qn(n,[1,2]):Qn(n,[2,3])})}};TR.className="GlobalAveragePooling2D";Re.registerClass(TR);var kR=class extends rj{call(e,t){return oe(()=>{let n=ft(e);return this.dataFormat==="channelsLast"?ei(n,[1,2]):ei(n,[2,3])})}};kR.className="GlobalMaxPooling2D";Re.registerClass(kR);var aj=class extends Ft{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){let r=t.layer,a=Yi(r,n);delete t.layer;let s={layer:a};return Object.assign(s,t),new e(s)}},ER=class extends aj{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=en(e),e.length<3)throw new le(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=en(e);let t=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return oe(()=>(e=ft(e),XW((n,r)=>[ft(this.layer.call(n,t)),[]],e,[],!1,null,null,!1,!0)[1]))}};ER.className="TimeDistributed";Re.registerClass(ER);function ibe(e){Kp(sge,"BidirectionalMergeMode",e)}var obe="concat",NR=class extends aj{constructor(e){super(e);let t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=Yi(n),t.goBackwards=t.goBackwards!==!0;let r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Yi(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?obe:e.mergeMode,ibe(this.mergeMode),e.weights)throw new Ot("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let n,r,a;return this.returnState&&(a=t.slice(1)),n=t[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,r=[n]):this.mergeMode==null?r=[n,n.slice()]:r=[n],this.returnState?this.mergeMode==null?r.concat(a).concat(a.slice()):[n].concat(a).concat(a.slice()):rs(r)}apply(e,t){let n=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});let a=KW(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&r==null)return super.apply(e,t);let s=[],i=[];if(n!=null){let l=n.length;if(l%2>0)throw new le("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);let h=n.map(c=>new kr({shape:c.shape}));this.forwardLayer.stateSpec=h.slice(0,l/2),this.backwardLayer.stateSpec=h.slice(l/2),i.push(...h)}if(r!=null)throw new Ot("Support for constants in Bidirectional layers is not implemented yet.");let o=s[0]instanceof no;for(let l of s)if(l instanceof no!==o)throw new le("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){let l=[e].concat(s),h=this.inputSpec.concat(i),c=this.inputSpec;this.inputSpec=h;let p=super.apply(l,t);return this.inputSpec=c,p}else return super.apply(e,t)}call(e,t){return oe(()=>{let n=t.initialState,r,a;if(n==null)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{let o=n.slice(0,n.length/2),l=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:o})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let s;this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=ri(a,1));let i;return this.mergeMode==="concat"?i=uA([r,a]):this.mergeMode==="sum"?i=Se(r,a):this.mergeMode==="ave"?i=re(.5,Se(r,a)):this.mergeMode==="mul"?i=re(r,a):this.mergeMode==null&&(i=[r,a]),this.returnState?this.mergeMode==null?i.concat(s):[i].concat(s):i})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){jh(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),jh(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[t,t]:n=t:this.mergeMode==null?n=[null,null]:n=null,this.returnState){let r=this.forwardLayer.states.map(a=>null);return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){let n=Yi(t.layer);if(delete t.layer,t.numConstants!=null)throw new Ot("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let r=t;return r.layer=n,new e(r)}};NR.className="Bidirectional";Re.registerClass(NR);var CR=class extends Ft{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return oe(()=>(e=ft(e),e.dtype!=="float32"&&(e=Xl(e,"float32")),Se(re(e,this.scale),this.offset)))}};CR.className="Rescaling";Re.registerClass(CR);var{resizeBilinear:lbe,cropAndResize:ube}=Xs,AR=class extends Ft{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,s,i,o){return oe(()=>{let l,h=!1,c=t/s,p=n/i,m=(r+t)/s,g=(a+n)/i,b=[c,p,m,g],v=[];e.rank===3?(h=!0,l=Nr([e])):l=e;for(let k=0;k<l.shape[0];k++)v.push(b);let x=Ba(v,[v.length,4]),_=dd(0,v.length,1,"int32"),I=ube(l,x,_,[r,a],"nearest");return Xl(h?ft(or(I)):I,o)})}upsize(e,t,n,r){return oe(()=>{let a=lbe(e,[t,n]);return Xl(a,r)})}call(e,t){return oe(()=>{let n=ft(e),r=n.dtype,a=n.shape,s=a[a.length-3],i=a[a.length-2],o=0;s!==this.height&&(o=Math.floor((s-this.height)/2));let l=0;return i!==this.width&&(l=Math.floor((i-this.width)/2),l===0&&(l=1)),o>=0&&l>=0?this.centerCrop(n,o,l,this.height,this.width,s,i,r):this.upsize(e,this.height,this.width,r)})}getConfig(){let e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=en(e);let t=e.length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}};AR.className="CenterCrop";Re.registerClass(AR);function cbe(e,t,n,r){let a=ft(e);if(a.dtype!=="int32"&&(a=Xl(a,"int32")),t==="int")return a;let s=a.shape;if(a.rank===0&&(a=ea(a,-1)),t==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=ea(a,-1)),a.rank>2)throw new le(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${a.rank}.`);let i=["multiHot","oneHot"].includes(t),o=a,l;if(typeof r<"u"&&t==="count"?l=m_(o,r,n,i):l=m_(o,[],n,i),t!=="tfIdf")return l;if(r)return re(l,r);throw new le("When outputMode is 'tfIdf', weights must be provided.")}var RR=class extends Ft{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=en(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return oe(()=>{e=ft(e),e.dtype!=="int32"&&(e=Xl(e,"int32"));let n;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new le(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);n=ft(t.countWeights)}let r=ei(e),a=ym(e),s=Xa(this.numTokens,r).bufferSync().get(0),i=tu(a,0).bufferSync().get(0);if(!(s&&i))throw new le(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return cbe(e,this.outputMode,this.numTokens,n)})}};RR.className="CategoryEncoding";Re.registerClass(RR);var hbe=["bilinear","nearest"],tL=new Set(hbe),DR=class extends Ft{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(tL.has(e.interpolation))this.interpolation=e.interpolation;else throw new le(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=en(e);let t=e[2];return[this.height,this.width,t]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return oe(()=>{let n=[this.height,this.width];if(this.interpolation==="bilinear")return Xs.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xs.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...tL]} are supported`)})}};DR.className="Resizing";Re.registerClass(DR);var sj=class{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}};sj.className="RandomSeed";var ij=class extends Ft{constructor(e){super(e),this.randomGenerator=new sj(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}};ij.className="BaseRandomLayer";var dbe=["bilinear","nearest"],nL=new Set(dbe),MR=class extends ij{constructor(e){super(e);let{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new le(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new le(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new le(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(n)if(nL.has(n))this.interpolation=n;else throw new le(`Invalid interpolation parameter: ${n} is not implemented`)}getConfig(){let e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=en(e);let t=e[2];return[this.imgHeight,-1,t]}call(e,t){return oe(()=>{let n=ft(e);this.imgHeight=n.shape[n.shape.length-3];let r=n.shape[n.shape.length-2];this.widthFactor=Hc([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*r;a=Math.round(a);let s=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return Xs.resizeBilinear(e,s);case"nearest":return Xs.resizeNearestNeighbor(e,s);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...nL]} are supported`)}})}};MR.className="RandomWidth";Re.registerClass(MR);function pbe(e){return new Zg(e)}function fbe(e){return new $A(e)}function mbe(e){return new RA(e)}function gbe(e){return new DA(e)}function ybe(e){return new MA(e)}function bbe(e){return new FA(e)}function vbe(e){return new OA(e)}function xbe(e){return new UA(e)}function wbe(e){return new AS(e)}function _be(e){return new LA(e)}function Sbe(e){return new RS(e)}function Ibe(e){return new zA(e)}function Tbe(e){return new VA(e)}function kbe(e){return new BA(e)}function Ebe(e){return new WA(e)}function Nbe(e){return new jA(e)}function Cbe(e){return new ZA(e)}function Abe(e){return new YA(e)}function Rbe(e){return new FS(e)}function Dbe(e){return new XA(e)}function Mbe(e){return new QA(e)}function $be(e){return new JA(e)}function Obe(e){return new eR(e)}function Fbe(e){return new tR(e)}function Pbe(e){return new rR(e)}function Lbe(e){return new aR(e)}function zbe(e){return new iR(e)}function Vbe(e){return new uR(e)}function Ube(e){return new oR(e)}function Bbe(e){return new lR(e)}function Wbe(e){return new sR(e)}function jbe(e){return new cR(e)}function Hbe(e){return new fR(e)}function Gbe(e){return new mR(e)}function qbe(e){return new gR(e)}function $R(e){return new bR(e)}function Kbe(e){return $R(e)}function Xbe(e){return $R(e)}function OR(e){return new xR(e)}function Ybe(e){return OR(e)}function Qbe(e){return OR(e)}function FR(e){return new _R(e)}function Zbe(e){return FR(e)}function Jbe(e){return FR(e)}function eve(e){return new SR(e)}function tve(e){return new TR(e)}function oj(e){return new IR(e)}function lj(e){return new kR(e)}function uj(e){return new yR(e)}function cj(e){return new vR(e)}function nve(e){return new wR(e)}function rve(e){return new GA(e)}function ave(e){return new MS(e)}function sve(e){return new qA(e)}function ive(e){return new Ix(e)}function ove(e){return new HA(e)}function lve(e){return new DS(e)}function uve(e){return new KA(e)}function cve(e){return new OS(e)}function hve(e){return new au(e)}function dve(e){return new $S(e)}function pve(e){return new NR(e)}function fve(e){return new ER(e)}var mve=oj,gve=lj,yve=uj,bve=cj;function vve(e){return new hR(e)}function xve(e){return new dR(e)}function wve(e){return new pR(e)}function _ve(e){return new nR(e)}function Sve(e){return new CR(e)}function Ive(e){return new AR(e)}function Tve(e){return new DR(e)}function kve(e){return new RR(e)}function Eve(e){return new MR(e)}var hj={};_t(hj,{MAPE:()=>Lve,MSE:()=>Uve,binaryAccuracy:()=>Nve,binaryCrossentropy:()=>Cve,categoricalAccuracy:()=>Rve,categoricalCrossentropy:()=>Dve,cosineProximity:()=>Ove,mape:()=>zve,meanAbsoluteError:()=>Fve,meanAbsolutePercentageError:()=>Pve,meanSquaredError:()=>Vve,mse:()=>Bve,precision:()=>Mve,r2Score:()=>Wve,recall:()=>$ve,sparseCategoricalAccuracy:()=>Ave});function Nve(e,t){return TA(e,t)}function Cve(e,t){return fW(e,t)}function Ave(e,t){return mW(e,t)}function Rve(e,t){return kA(e,t)}function Dve(e,t){return EA(e,t)}function Mve(e,t){return pW(e,t)}function $ve(e,t){return hye(e,t)}function Ove(e,t){return IA(e,t)}function Fve(e,t){return kS(e,t)}function Pve(e,t){return Jg(e,t)}function Lve(e,t){return Jg(e,t)}function zve(e,t){return Jg(e,t)}function Vve(e,t){return Xp(e,t)}function Uve(e,t){return Xp(e,t)}function Bve(e,t){return Xp(e,t)}function Wve(e,t){return dye(e,t)}var dj={};_t(dj,{modelFromJSON:()=>Bye});var pj={};_t(pj,{l1:()=>Hve,l1l2:()=>jve,l2:()=>Gve});function jve(e){return new _x(e)}function Hve(e){return Xye(e)}function Gve(e){return Yye(e)}var fj=class extends Tm{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof Ul))throw new Error("model must be a LayersModel, not some other Container");this.model=e}};function l0(e,t){return e<t}function rL(e,t){return e>t}var mj=class extends fj{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new Ot("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=l0:this.mode==="max"?this.monitorFunc=rL:this.monitor.indexOf("acc")!==-1?this.monitorFunc=rL:this.monitorFunc=l0,this.monitorFunc===l0&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===l0?1/0:-1/0}async onEpochEnd(e,t){await Vu(t);let n=this.getMonitorValue(t);n!=null&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});let t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}};function qve(e){return new mj(e)}var Kve={earlyStopping:qve},Xve=he();Xve.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Ss;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ss||(Ss={}));var aL;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(aL||(aL={}));var PR={};function Yve(e,t){let n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};PR[e]=n}function gj(e){return PR[e]}function Qve(e){delete PR[e]}function F(e,t,n,r,a){let s=t.inputParams[e];if(s&&s.inputIndexStart!==void 0){let o=s.inputIndexStart,l=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?o+1:s.inputIndexEnd,h=o<0?t.inputNames.length+o:o;if(s.type==="tensor")return pa(t.inputNames[h],n,r,a);if(s.type==="tensors"){let m=t.inputs.slice(o,l);return t.inputNames.slice(o,l).filter((g,b)=>{var v;return((v=m[b])===null||v===void 0?void 0:v.op)!=="NoOp"}).map(g=>pa(g,n,r,a))}let c=pa(t.inputNames[h],n,r,a),p=c.dataSync();return s.type==="number"?p[0]:$.toNestedArray(c.shape,p)}let i=t.attrParams[e];return i&&i.value}function pa(e,t,n,r){let[a,s]=Ts(e,n);if(r!=null){let o=r.getHashTableHandleByName(a);if(o!=null)return o}let i=n.currentContextIds.find(o=>!!t[k_(a,o)]);return i!==void 0?t[k_(a,i)][s]:void 0}function sL(e,t,n){return t[k_(e,n.currentContextId)]}function Al(e,t){let[n,r,a]=Ts(e,t);return[k_(n,t&&t.currentContextId),r,a]}function k_(e,t){return t?`${e}-${t}`:e}function Ts(e,t){if(e==="")return["",0,void 0];let n=t!=null&&t.parseNodeNameCache!=null;if(n){let s=t.parseNodeNameCache.get(e);if(s!=null)return s}let r=e.split(":"),a;if(r.length===1)a=[e,0,void 0];else{let s=r[0],i=r.length===3?r[1]:void 0,o=Number(r[r.length-1]);a=[s,o,i]}return n&&t.parseNodeNameCache.set(e,a),a}function M0(e,t,n){let r=F("pad",e,t,n);if(r==="explicit"){r=F("explicitPaddings",e,t,n);let a=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)a[s][0]=r[s*2],a[s][1]=r[s*2+1];return a}return r}function Rl(e){return e.kept?e:Uo(e)}var yj={};_t(yj,{json:()=>Zve});var Zve=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],bj={};_t(bj,{json:()=>Jve});var Jve=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],vj={};_t(vj,{json:()=>exe});var exe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],xj={};_t(xj,{json:()=>txe});var txe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],wj={};_t(wj,{json:()=>nxe});var nxe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],_j={};_t(_j,{json:()=>rxe});var rxe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Sj={};_t(Sj,{json:()=>axe});var axe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Ij={};_t(Ij,{json:()=>sxe});var sxe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Tj={};_t(Tj,{json:()=>ixe});var ixe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],kj={};_t(kj,{json:()=>oxe});var oxe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Ej={};_t(Ej,{json:()=>lxe});var lxe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Nj={};_t(Nj,{json:()=>uxe});var uxe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Cj={};_t(Cj,{json:()=>cxe});var cxe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Aj={};_t(Aj,{json:()=>hxe});var hxe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Rj={};_t(Rj,{json:()=>dxe});var dxe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Dj={};_t(Dj,{json:()=>pxe});var pxe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Mj={};_t(Mj,{json:()=>fxe});var fxe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],$j={};_t($j,{json:()=>mxe});var mxe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Oj={};_t(Oj,{json:()=>gxe});var gxe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],iL=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let e=[yj,bj,vj,xj,wj,_j,Sj,Ij,Tj,kj,Ej,Nj,Cj,Aj,Rj,Dj,Mj,$j,Oj],t=[].concat(...e.map(n=>n.json));this.opMappers=t.reduce((n,r)=>(n[r.tfOpName]=r,n),{})}transformGraph(e,t={}){let n=e.node,r=[],a=[],s=[],i=n.reduce((b,v)=>(b[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?r.push(b[v.name]):v.op==="Const"?a.push(b[v.name]):(v.input==null||v.input.length===0)&&s.push(b[v.name]),b),{}),o=[],l=[],h={},c={};t!=null&&(h=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));let p=Object.keys(i);p.forEach(b=>{let v=i[b];v.inputNames.forEach((x,_)=>{let[I,,k]=Al(x),E=i[I];if(E.outputs!=null){let R=E.outputs.indexOf(k);if(R!==-1){let U=`${I}:${R}`;v.inputNames[_]=U}}v.inputs.push(E),E.children.push(v)})}),Object.keys(c).length===0?p.forEach(b=>{let v=i[b];v.children.length===0&&l.push(v)}):Object.keys(c).forEach(b=>{let[v]=Al(b),x=i[v];x!=null&&(x.signatureKey=c[b],l.push(x))}),Object.keys(h).length>0?Object.keys(h).forEach(b=>{let[v]=Al(b),x=i[v];x&&(x.signatureKey=h[b],o.push(x))}):o=r;let m={};e.library!=null&&e.library.function!=null&&(m=e.library.function.reduce((b,v)=>(b[v.signature.name]=this.mapFunction(v),b),{}));let g={nodes:i,inputs:o,outputs:l,weights:a,placeholders:r,signature:t,functions:m};return s.length>0&&(g.initNodes=s),g}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){let t=gj(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});let n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce((r,a)=>(r[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},r),{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce((r,a)=>{let s=a.type,i;switch(a.type){case"string":i=LE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=LE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":i=HE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=HE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":i=VE(e.attr,a.tfName,a.defaultValue||0),i===void 0&&a.tfDeprecatedName&&(i=VE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":i=jE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=jE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":i=zE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=zE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":i=qE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=qE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":i=WE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=WE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":i=GE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=GE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":i=UE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=UE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":i=BE(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=BE(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":i=oL(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=oL(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${e.op}`)}return r[a.name]={value:i,type:s},r},{})),n}mapFunction(e){let t=e.nodeDef,n=[],r=[],a={};t!=null&&(a=t.reduce((h,c)=>(h[c.name]=this.mapNode(c),c.op==="Const"&&r.push(h[c.name]),h),{}));let s=[],i=[];e.signature.inputArg.forEach(h=>{let[c]=Al(h.name),p={name:c,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:LR(h.type),type:"dtype"}},children:[]};p.signatureKey=h.name,s.push(p),a[c]=p}),Object.keys(a).forEach(h=>{let c=a[h];c.inputNames.forEach((p,m)=>{let[g,,b]=Al(p),v=a[g];if(v.outputs!=null){let x=v.outputs.indexOf(b);if(x!==-1){let _=`${g}:${x}`;c.inputNames[m]=_}}c.inputs.push(v),v.children.push(c)})});let o=e.ret;e.signature.outputArg.forEach(h=>{let[c,p]=Al(o[h.name]),m=a[c];m!=null&&(m.defaultOutput=p,i.push(m))});let l=this.mapArgsToSignature(e);return{nodes:a,inputs:s,outputs:i,weights:r,placeholders:n,signature:l}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n),t),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}}};function yxe(e){let t=he().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function Fj(e,t){let n=Array.isArray(e)?String.fromCharCode.apply(null,e):yxe(e);return t?n:n.toLowerCase()}function LE(e,t,n,r=!1){let a=e[t];return a!=null?Fj(a.s,r):n}function zE(e,t,n){let r=e[t];return r?r.b:n}function VE(e,t,n){let r=e[t]||{},a=r.i!=null?r.i:r.f!=null?r.f:n;return typeof a=="number"?a:parseInt(a,10)}function LR(e){switch(typeof e=="string"&&(e=Ss[e]),e){case Ss.DT_FLOAT:case Ss.DT_HALF:return"float32";case Ss.DT_INT32:case Ss.DT_INT64:case Ss.DT_INT8:case Ss.DT_UINT8:return"int32";case Ss.DT_BOOL:return"bool";case Ss.DT_DOUBLE:return"float32";case Ss.DT_STRING:return"string";case Ss.DT_COMPLEX64:case Ss.DT_COMPLEX128:return"complex64";default:return null}}function oL(e,t,n){let r=e[t];return r&&r.func?r.func.name:n}function UE(e,t,n){let r=e[t];return r&&r.type?LR(r.type):n}function BE(e,t,n){let r=e[t];return r&&r.list&&r.list.type?r.list.type.map(a=>LR(a)):n}function Pj(e){if(!e.unknownRank)return e.dim!=null?e.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function WE(e,t,n){let r=e[t];return r&&r.shape?Pj(r.shape):n}function jE(e,t,n){let r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(a=>typeof a=="number"?a:parseInt(a,10)):n}function HE(e,t,n,r=!1){let a=e[t];return a&&a.list&&a.list.s?a.list.s.map(s=>Fj(s,r)):n}function GE(e,t,n){let r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(a=>Pj(a)):n}function qE(e,t,n){let r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var bxe=class{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,a)=>(r[a]=this.getAttr(a),r),{}))}getInput(e){return pa(e,this.tensorMap,this.context)}getAttr(e,t){let n=this.node.rawAttrs[e];if(n.tensor!=null)return pa(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return VE(this.node.rawAttrs,e,t);if(n.s!=null)return LE(this.node.rawAttrs,e,t);if(n.b!=null)return zE(this.node.rawAttrs,e,t);if(n.shape!=null)return WE(this.node.rawAttrs,e,t);if(n.type!=null)return UE(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return jE(this.node.rawAttrs,e,t);if(n.list.s!=null)return HE(this.node.rawAttrs,e,t);if(n.list.shape!=null)return GE(this.node.rawAttrs,e,t);if(n.list.b!=null)return qE(this.node.rawAttrs,e,t);if(n.list.type!=null)return BE(this.node.rawAttrs,e,t)}return t}},ia={};_t(ia,{OP_SCOPE_SUFFIX:()=>V2,abs:()=>Tr,acos:()=>H2,acosh:()=>G2,add:()=>Se,addN:()=>QU,all:()=>L1,any:()=>Jb,argMax:()=>ld,argMin:()=>q2,asin:()=>K2,asinh:()=>X2,atan:()=>Y2,atan2:()=>Q2,atanh:()=>Z2,avgPool:()=>eu,avgPool3d:()=>eC,basicLSTMCell:()=>tB,batchNorm:()=>jp,batchNorm2d:()=>tC,batchNorm3d:()=>nC,batchNorm4d:()=>rC,batchToSpaceND:()=>rx,bincount:()=>aC,bitwiseAnd:()=>nB,booleanMaskAsync:()=>HB,broadcastArgs:()=>rB,broadcastTo:()=>Wh,buffer:()=>At,cast:()=>ze,ceil:()=>sC,clipByValue:()=>ka,clone:()=>Uo,complex:()=>Kl,concat:()=>Sn,concat1d:()=>iC,concat2d:()=>oC,concat3d:()=>lC,concat4d:()=>uC,conv1d:()=>z1,conv2d:()=>ja,conv2dTranspose:()=>V1,conv3d:()=>hC,conv3dTranspose:()=>dC,cos:()=>ax,cosh:()=>U1,cosineWindow:()=>cS,cumprod:()=>nv,cumsum:()=>B1,denseBincount:()=>m_,depthToSpace:()=>pC,depthwiseConv2d:()=>Hp,diag:()=>sB,dilation2d:()=>fC,div:()=>Ke,divNoNan:()=>mC,dot:()=>gC,dropout:()=>HC,einsum:()=>Dh,elu:()=>Hg,enclosingPowerOfTwo:()=>GC,ensureShape:()=>oB,equal:()=>Ms,erf:()=>W1,euclideanNorm:()=>vC,exp:()=>Ea,expandDims:()=>ea,expm1:()=>xC,eye:()=>j1,fft:()=>fx,fill:()=>Ds,floor:()=>qg,floorDiv:()=>P1,fused:()=>Sm,gather:()=>Kg,gatherND:()=>XB,greater:()=>Xa,greaterEqual:()=>tu,ifft:()=>_m,imag:()=>sx,image:()=>Xs,inTopKAsync:()=>YB,irfft:()=>rS,isFinite:()=>wC,isInf:()=>_C,isNaN:()=>SC,leakyRelu:()=>ix,less:()=>bm,lessEqual:()=>jc,linalg:()=>XC,linspace:()=>dB,localResponseNormalization:()=>IC,log:()=>$s,log1p:()=>ox,logSigmoid:()=>TC,logSoftmax:()=>G1,logSumExp:()=>lx,logicalAnd:()=>Ei,logicalNot:()=>ux,logicalOr:()=>q1,logicalXor:()=>kC,losses:()=>l6,lowerBound:()=>fB,matMul:()=>Nt,max:()=>ei,maxPool:()=>Qr,maxPool3d:()=>EC,maxPoolWithArgmax:()=>mB,maximum:()=>Jo,mean:()=>Qn,meshgrid:()=>gB,min:()=>ym,minimum:()=>_c,mirrorPad:()=>NC,mod:()=>CC,moments:()=>cx,movingAverage:()=>GB,mul:()=>re,multiRNNCell:()=>yB,multinomial:()=>bB,neg:()=>Mn,norm:()=>Gg,notEqual:()=>hd,oneHot:()=>vm,ones:()=>as,onesLike:()=>Os,op:()=>te,outerProduct:()=>vB,pad:()=>io,pad1d:()=>xB,pad2d:()=>wB,pad3d:()=>_B,pad4d:()=>SB,pool:()=>AC,pow:()=>qo,prelu:()=>dx,print:()=>j2,prod:()=>RC,raggedGather:()=>IB,raggedRange:()=>TB,raggedTensorToTensor:()=>kB,rand:()=>EB,randomGamma:()=>RB,randomNormal:()=>X1,randomStandardNormal:()=>DB,randomUniform:()=>Hc,randomUniformInt:()=>MB,range:()=>dd,real:()=>xm,reciprocal:()=>FC,relu:()=>fn,relu6:()=>Y1,reshape:()=>ie,reverse:()=>ri,reverse1d:()=>$B,reverse2d:()=>OB,reverse3d:()=>FB,reverse4d:()=>PB,rfft:()=>mx,round:()=>Q1,rsqrt:()=>Z1,scalar:()=>rt,scatterND:()=>qB,searchSorted:()=>K1,selu:()=>J1,separableConv2d:()=>Xg,setdiff1dAsync:()=>LB,sigmoid:()=>Ti,sign:()=>PC,signal:()=>o6,sin:()=>eS,sinh:()=>tS,slice:()=>Pt,slice1d:()=>px,slice2d:()=>nS,slice3d:()=>Yg,slice4d:()=>wm,softmax:()=>Gc,softplus:()=>Gp,spaceToBatchND:()=>hx,sparse:()=>u6,sparseToDense:()=>KB,spectral:()=>i6,split:()=>is,sqrt:()=>aa,square:()=>_n,squaredDifference:()=>aS,squeeze:()=>qc,stack:()=>Nr,step:()=>qp,stridedSlice:()=>LC,string:()=>c6,sub:()=>Ge,sum:()=>Ye,tan:()=>zC,tanh:()=>wc,tensor:()=>Ba,tensor1d:()=>dn,tensor2d:()=>Bo,tensor3d:()=>sS,tensor4d:()=>Sc,tensor5d:()=>zB,tensor6d:()=>VB,tensorScatterUpdate:()=>BB,tile:()=>Rs,topk:()=>UC,transpose:()=>Ct,truncatedNormal:()=>lS,unique:()=>BC,unsortedSegmentSum:()=>uS,unstack:()=>or,upperBound:()=>WB,variable:()=>WC,where:()=>ra,whereAsync:()=>jC,zeros:()=>Zn,zerosLike:()=>Ut});var vxe=(e,t,n,r=ia)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(F("a",e,t,n),F("b",e,t,n))];case"AddN":return[r.addN(F("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(F("a",e,t,n),F("b",e,t,n))];case"Mul":return[r.mul(F("a",e,t,n),F("b",e,t,n))];case"RealDiv":case"Div":return[r.div(F("a",e,t,n),F("b",e,t,n))];case"DivNoNan":return[r.divNoNan(F("a",e,t,n),F("b",e,t,n))];case"FloorDiv":return[r.floorDiv(F("a",e,t,n),F("b",e,t,n))];case"Sub":return[r.sub(F("a",e,t,n),F("b",e,t,n))];case"Minimum":return[r.minimum(F("a",e,t,n),F("b",e,t,n))];case"Maximum":return[r.maximum(F("a",e,t,n),F("b",e,t,n))];case"Pow":return[r.pow(F("a",e,t,n),F("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(F("a",e,t,n),F("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},xxe=(e,t,n,r=ia)=>{switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(F("x",e,t,n))];case"Acos":return[r.acos(F("x",e,t,n))];case"Acosh":return[r.acosh(F("x",e,t,n))];case"Asin":return[r.asin(F("x",e,t,n))];case"Asinh":return[r.asinh(F("x",e,t,n))];case"Atan":return[r.atan(F("x",e,t,n))];case"Atan2":return[r.atan2(F("x",e,t,n),F("y",e,t,n))];case"Atanh":return[r.atanh(F("x",e,t,n))];case"Ceil":return[r.ceil(F("x",e,t,n))];case"Complex":return[r.complex(F("real",e,t,n),F("imag",e,t,n))];case"Cos":return[r.cos(F("x",e,t,n))];case"Cosh":return[r.cosh(F("x",e,t,n))];case"Elu":return[r.elu(F("x",e,t,n))];case"Erf":return[r.erf(F("x",e,t,n))];case"Exp":return[r.exp(F("x",e,t,n))];case"Expm1":return[r.expm1(F("x",e,t,n))];case"Floor":return[r.floor(F("x",e,t,n))];case"Log":return[r.log(F("x",e,t,n))];case"Log1p":return[r.log1p(F("x",e,t,n))];case"Imag":return[r.imag(F("x",e,t,n))];case"Neg":return[r.neg(F("x",e,t,n))];case"Reciprocal":return[r.reciprocal(F("x",e,t,n))];case"Real":return[r.real(F("x",e,t,n))];case"Relu":return[r.relu(F("x",e,t,n))];case"Round":return[r.round(F("x",e,t,n))];case"Selu":return[r.selu(F("x",e,t,n))];case"Sigmoid":return[r.sigmoid(F("x",e,t,n))];case"Sin":return[r.sin(F("x",e,t,n))];case"Sign":return[r.sign(F("x",e,t,n))];case"Sinh":return[r.sinh(F("x",e,t,n))];case"Softplus":return[r.softplus(F("x",e,t,n))];case"Sqrt":return[r.sqrt(F("x",e,t,n))];case"Square":return[r.square(F("x",e,t,n))];case"Tanh":return[r.tanh(F("x",e,t,n))];case"Tan":return[r.tan(F("x",e,t,n))];case"ClipByValue":return[r.clipByValue(F("x",e,t,n),F("clipValueMin",e,t,n),F("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(F("x",e,t,n))];case"Rsqrt":return[r.rsqrt(pa(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(F("x",e,t,n),F("alpha",e,t,n))];case"Prelu":return[r.prelu(F("x",e,t,n),F("alpha",e,t,n))];case"IsNan":return[r.isNaN(pa(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(pa(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(pa(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function Si(e,t,n=""){if(!(typeof e=="number"||typeof t=="number")){$.assert(e.length===t.length,()=>n+` Shapes ${e} and ${t} must match`);for(let r=0;r<e.length;r++){let a=e[r],s=t[r];$.assert(a<0||s<0||a===s,()=>n+` Shapes ${e} and ${t} must match`)}}}function lL(e){return!(typeof e=="number"||e.some(t=>t<0))}function sb(e,t,n){let r=KE(e,n),a=!lL(r);if(a&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach(s=>{r=KE(s.shape,r)}),!lL(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function KE(e,t){if(typeof e=="number")return t;if(typeof t=="number")return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);let n=[];for(let r=0;r<e.length;++r){let a=e[r],s=t[r];if(a>=0&&s>=0&&a!==s)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:s}return n}var wxe=class{constructor(e,t,n,r,a,s,i){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=s,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=rt(0),Br(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);let t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Si(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,Br(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((n,r)=>this.write(n,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Ba([],[0].concat(this.elementShape));let n=this.readMany(e);return Si(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Nr(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Ba([],[0].concat(this.elementShape));let t=[];for(let r=0;r<this.size();r++)t.push(r);let n=this.readMany(t);return Si(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Sn(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);let n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,or(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0,r=e.map(o=>(n+=o,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);let a=n===0?0:t.size/n,s=[];oe(()=>{t=ie(t,[1,n,a]);for(let o=0;o<e.length;++o){let l=[0,o===0?0:r[o-1],0],h=[1,e[o],a];s[o]=ie(Pt(t,l,h),this.elementShape)}return s});let i=[];for(let o=0;o<e.length;o++)i[o]=o;this.writeMany(i,s)}},LS=class XE{get id(){return this.idTensor.id}constructor(t,n,r,a=-1){this.tensors=t,this.elementShape=n,this.elementDtype=r,t?.forEach(s=>{if(r!==s.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${s.dtype}`);Si(n,s.shape,"TensorList shape mismatch: "),Br(s)}),this.idTensor=rt(0),this.maxNumElements=a,Br(this.idTensor)}copy(){return new XE([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(n=>{(t==null||!t.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,n,r=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);Si(t,this.elementShape,"TensorList shape mismatch: ");let a=sb(this.elementShape,this.tensors,t);return oe(()=>{let s=this.tensors.map(i=>ie(i,a));return Nr(s,0)})}popBack(t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let r=sb(this.elementShape,this.tensors,t),a=this.tensors.pop();return a.kept=!1,Si(a.shape,t,"TensorList shape mismatch: "),ie(a,r)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Si(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Br(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);let n=new XE([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(let r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}getItem(t,n,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);Si(this.tensors[t].shape,n,"TensorList shape mismatch: ");let a=sb(this.elementShape,this.tensors,n);return ie(this.tensors[t],a)}setItem(t,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Si(this.elementShape,n.shape,"TensorList shape mismatch: "),Br(n),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=n}gather(t,n,r){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Si(this.elementShape,r,"TensorList shape mismatch: "),t=t.slice(0,this.size());let a=sb(this.elementShape,this.tensors,r);return t.length===0?Ba([],[0].concat(a)):oe(()=>{let s=t.map(i=>ie(this.tensors[i],a));return Nr(s,0)})}concat(t,n){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Si(this.elementShape,n,"TensorList shape mismatch: ");let r=sb(this.elementShape,this.tensors,n);return this.size()===0?Ba([],[0].concat(r)):oe(()=>{let a=this.tensors.map(s=>ie(s,r));return Sn(a,0)})}};function _xe(e,t,n){let r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);let a=e.shape.slice(1);Si(a,t,"TensorList shape mismatch: ");let s=or(e);return new LS(s,t,r)}function Sxe(e,t,n,r){return new LS([],e,t,r)}function Ixe(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let a=Math.max(...t);if(r!=null&&r!==-1&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);let s=new LS([],n,e.dtype,r),i=or(e,0);return t.forEach((o,l)=>{s.setItem(o,i[l])}),s}function Txe(e,t,n){let r=0,a=t.map(c=>(r+=c,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${e.shape}`);let s=e.shape.slice(1),i=KE(s,n),o=r===0?0:e.size/r,l=oe(()=>{let c=[];e=ie(e,[1,r,o]);for(let p=0;p<t.length;++p){let m=[0,p===0?0:a[p-1],0],g=[1,t[p],o];c[p]=ie(Pt(e,m,g),i)}return e.dispose(),c}),h=new LS([],n,e.dtype,t.length);for(let c=0;c<l.length;c++)h.setItem(c,l[c]);return h}var kxe=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{let r=F("thenBranch",e,t,n),a=F("elseBranch",e,t,n),s=F("cond",e,t,n),i=F("args",e,t,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{let r=F("body",e,t,n),a=F("cond",e,t,n),s=F("args",e,t,n),i=await n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),o=s.map(c=>c.id),l=await i[0].data();i.forEach(c=>{!c.kept&&o.indexOf(c.id)===-1&&c.dispose()});let h=s;for(;l[0];){let c=h;h=await n.functionMap[r].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);let p=h.map(g=>g.id);c.forEach(g=>{!g.kept&&o.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()});let m=await n.functionMap[a].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);l=await m[0].data(),m.forEach(g=>{!g.kept&&o.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()})}return h}case"LoopCond":{let r=F("pred",e,t,n);return[Rl(r)]}case"Switch":{let r=F("pred",e,t,n),a=F("data",e,t,n);return a.kept||(a=Rl(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{let r=e.inputNames.find(a=>pa(a,t,n)!==void 0);if(r){let a=pa(r,t,n);return[Rl(a)]}return}case"Enter":{let r=F("frameName",e,t,n),a=F("tensor",e,t,n);return n.enterFrame(r),[Rl(a)]}case"Exit":{let r=F("tensor",e,t,n);return n.exitFrame(),[Rl(r)]}case"NextIteration":{let r=F("tensor",e,t,n);return n.nextIteration(),[Rl(r)]}case"TensorArrayV3":{let r=F("size",e,t,n),a=F("dtype",e,t,n),s=F("elementShape",e,t,n),i=F("dynamicSize",e,t,n),o=F("clearAfterRead",e,t,n),l=F("identicalElementShapes",e,t,n),h=F("name",e,t,n),c=new wxe(h,a,r,s,l,i,o);return n.addTensorArray(c),[c.idTensor,rt(1)]}case"TensorArrayWriteV3":{let r=F("tensorArrayId",e,t,n),a=F("index",e,t,n),s=F("tensor",e,t,n),i=n.getTensorArray(r.id);return i.write(a,s),[i.idTensor]}case"TensorArrayReadV3":{let r=F("tensorArrayId",e,t,n),a=F("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{let r=F("tensorArrayId",e,t,n),a=F("indices",e,t,n),s=F("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,s)]}case"TensorArrayScatterV3":{let r=F("tensorArrayId",e,t,n),a=F("indices",e,t,n),s=F("tensor",e,t,n),i=n.getTensorArray(r.id);return i.scatter(a,s),[i.idTensor]}case"TensorArrayConcatV3":{let r=F("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),s=F("dtype",e,t,n);return[a.concat(s)]}case"TensorArraySplitV3":{let r=F("tensorArrayId",e,t,n),a=F("tensor",e,t,n),s=F("lengths",e,t,n),i=n.getTensorArray(r.id);return i.split(s,a),[i.idTensor]}case"TensorArraySizeV3":{let r=F("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return[rt(a.size(),"int32")]}case"TensorArrayCloseV3":{let r=F("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{let r=F("tensorListId",e,t,n),a=F("index",e,t,n),s=F("tensor",e,t,n),i=n.getTensorList(r.id);return i.setItem(a,s),[i.idTensor]}case"TensorListGetItem":{let r=F("tensorListId",e,t,n),a=F("index",e,t,n),s=F("elementShape",e,t,n),i=F("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,s,i)]}case"TensorListScatterV2":case"TensorListScatter":{let r=F("indices",e,t,n),a=F("tensor",e,t,n),s=F("elementShape",e,t,n),i=F("numElements",e,t,n),o=Ixe(a,r,s,i);return n.addTensorList(o),[o.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r=F("elementShape",e,t,n),a=F("elementDType",e,t,n),s;e.op==="TensorListReserve"?s="numElements":s="maxNumElements";let i=F(s,e,t,n),o=e.op==="TensorListReserve"?-1:i,l=Sxe(r,a,i,o);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{let r=F("tensorListId",e,t,n),a=F("indices",e,t,n),s=F("elementShape",e,t,n),i=F("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,i,s)]}case"TensorListStack":{let r=F("tensorListId",e,t,n),a=F("elementShape",e,t,n),s=F("elementDType",e,t,n),i=F("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,s,i)]}case"TensorListFromTensor":{let r=F("tensor",e,t,n),a=F("elementShape",e,t,n),s=F("elementDType",e,t,n),i=_xe(r,a,s);return n.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let r=F("tensorListId",e,t,n),a=n.getTensorList(r.id),s=F("dtype",e,t,n),i=F("elementShape",e,t,n);return[a.concat(s,i)]}case"TensorListPushBack":{let r=F("tensorListId",e,t,n),a=F("tensor",e,t,n),s=n.getTensorList(r.id);return s.pushBack(a),[s.idTensor]}case"TensorListPopBack":{let r=F("tensorListId",e,t,n),a=F("elementShape",e,t,n),s=F("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,s)]}case"TensorListSplit":{let r=F("tensor",e,t,n),a=F("elementShape",e,t,n),s=F("lengths",e,t,n),i=Txe(r,s,a);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{let r=F("tensorListId",e,t,n),a=n.getTensorList(r.id);return[rt(a.size(),"int32")]}case"TensorListResize":{let r=F("tensorListId",e,t,n),a=F("size",e,t,n),s=n.getTensorList(r.id).resize(a);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};function uL(e,t,n){let[r,a]=F("fusedOps",e,t,n),s=r==="biasadd",i=!s,o=a==="prelu",l=r==="fusedbatchnorm",h=F("numArgs",e,t,n);if(s){if(o&&h!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&s&&h!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let c=F("strides",e,t,n),p=M0(e,t,n),m=F("dataFormat",e,t,n).toUpperCase(),g=F("dilations",e,t,n),[b,v]=F("args",e,t,n);i&&(v=b,b=void 0);let x=F("leakyreluAlpha",e,t,n);return{stride:c,pad:p,dataFormat:m,dilations:g,biasArg:b,preluArg:v,activationFunc:a,leakyreluAlpha:x}}var Exe=(e,t,n,r=ia)=>{switch(e.op){case"Conv1D":{let a=F("stride",e,t,n),s=F("pad",e,t,n),i=F("dataFormat",e,t,n).toUpperCase(),o=F("dilation",e,t,n);return[r.conv1d(F("x",e,t,n),F("filter",e,t,n),a,s,i,o)]}case"Conv2D":{let a=F("strides",e,t,n),s=M0(e,t,n),i=F("dataFormat",e,t,n).toUpperCase(),o=F("dilations",e,t,n);return[r.conv2d(F("x",e,t,n),F("filter",e,t,n),[a[1],a[2]],s,i,[o[1],o[2]])]}case"_FusedConv2D":{let{stride:a,pad:s,dataFormat:i,dilations:o,biasArg:l,preluArg:h,activationFunc:c,leakyreluAlpha:p}=uL(e,t,n);return[r.fused.conv2d({x:F("x",e,t,n),filter:F("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:i,dilations:[o[1],o[2]],bias:l,activation:c,preluActivationWeights:h,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{let{stride:a,pad:s,dataFormat:i,dilations:o,biasArg:l,preluArg:h,activationFunc:c,leakyreluAlpha:p}=uL(e,t,n);return[r.fused.depthwiseConv2d({x:F("x",e,t,n),filter:F("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:i,dilations:[o[1],o[2]],bias:l,activation:c,preluActivationWeights:h,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let a=F("outputShape",e,t,n),s=F("strides",e,t,n),i=M0(e,t,n);return[r.conv2dTranspose(F("x",e,t,n),F("filter",e,t,n),a,[s[1],s[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let a=F("strides",e,t,n),s=M0(e,t,n),i=F("dilations",e,t,n),o=F("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(F("input",e,t,n),F("filter",e,t,n),[a[1],a[2]],s,o,[i[1],i[2]])]}case"Conv3D":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("dataFormat",e,t,n).toUpperCase(),o=F("dilations",e,t,n);return[r.conv3d(F("x",e,t,n),F("filter",e,t,n),[a[1],a[2],a[3]],s,i,[o[1],o[2],o[3]])]}case"AvgPool":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("kernelSize",e,t,n);return[r.avgPool(F("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s)]}case"MaxPool":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("kernelSize",e,t,n);return[r.maxPool(F("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s)]}case"MaxPoolWithArgmax":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("kernelSize",e,t,n),o=F("includeBatchInIndex",e,t,n),{result:l,indexes:h}=r.maxPoolWithArgmax(F("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s,o);return[l,h]}case"AvgPool3D":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("kernelSize",e,t,n);return[r.avgPool3d(F("x",e,t,n),[i[1],i[2],i[3]],[a[1],a[2],a[3]],s)]}case"MaxPool3D":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("kernelSize",e,t,n);return[r.maxPool3d(F("x",e,t,n),[i[1],i[2],i[3]],[a[1],a[2],a[3]],s)]}case"Dilation2D":{let a=F("strides",e,t,n),s=F("pad",e,t,n),i=F("dilations",e,t,n),o=a[1],l=a[2],h=i[1],c=i[2];return[r.dilation2d(F("x",e,t,n),F("filter",e,t,n),[o,l],s,[h,c],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Nxe=(e,t,n,r=ia)=>{switch(e.op){case"Fill":{let a=F("shape",e,t,n),s=F("dtype",e,t,n),i=F("value",e,t,n);return[r.fill(a,i,s)]}case"LinSpace":{let a=F("start",e,t,n),s=F("stop",e,t,n),i=F("num",e,t,n);return[r.linspace(a,s,i)]}case"Multinomial":{let a=F("logits",e,t,n),s=F("numSamples",e,t,n),i=F("seed",e,t,n);return[r.multinomial(a,s,i)]}case"OneHot":{let a=F("indices",e,t,n),s=F("depth",e,t,n),i=F("onValue",e,t,n),o=F("offValue",e,t,n),l=F("dtype",e,t,n);return[r.oneHot(a,s,i,o,l)]}case"Ones":return[r.ones(F("shape",e,t,n),F("dtype",e,t,n))];case"OnesLike":return[r.onesLike(F("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(F("shape",e,t,n),F("dtype",e,t,n),F("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(F("shape",e,t,n),F("minval",e,t,n),F("maxval",e,t,n),F("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(F("shape",e,t,n),F("minval",e,t,n),F("maxval",e,t,n),F("seed",e,t,n))];case"Range":{let a=F("start",e,t,n),s=F("stop",e,t,n),i=F("step",e,t,n);return[r.range(a,s,i,F("dtype",e,t,n))]}case"TruncatedNormal":{let a=F("shape",e,t,n),s=F("mean",e,t,n),i=F("stdDev",e,t,n),o=F("seed",e,t,n);return[r.truncatedNormal(a,s,i,F("dtype",e,t,n),o)]}case"Zeros":return[r.zeros(F("shape",e,t,n),F("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(F("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function wk(e,t,n){let r=F("boxes",e,t,n),a=F("scores",e,t,n),s=F("maxOutputSize",e,t,n),i=F("iouThreshold",e,t,n),o=F("scoreThreshold",e,t,n),l=F("softNmsSigma",e,t,n);return{boxes:r,scores:a,maxOutputSize:s,iouThreshold:i,scoreThreshold:o,softNmsSigma:l}}var Cxe=async(e,t,n,r,a=ia)=>{switch(e.op){case"NonMaxSuppressionV5":{let{boxes:s,scores:i,maxOutputSize:o,iouThreshold:l,scoreThreshold:h,softNmsSigma:c}=wk(e,t,n),p=await a.image.nonMaxSuppressionWithScoreAsync(s,i,o,l,h,c);return[p.selectedIndices,p.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:s,scores:i,maxOutputSize:o,iouThreshold:l,scoreThreshold:h}=wk(e,t,n),c=F("padToMaxOutputSize",e,t,n),p=await a.image.nonMaxSuppressionPaddedAsync(s,i,o,l,h,c);return[p.selectedIndices,p.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:s,scores:i,maxOutputSize:o,iouThreshold:l,scoreThreshold:h}=wk(e,t,n);return[await a.image.nonMaxSuppressionAsync(s,i,o,l,h)]}case"Where":{let s=a.cast(F("condition",e,t,n),"bool"),i=[await a.whereAsync(s)];return s.dispose(),i}case"ListDiff":return a.setdiff1dAsync(F("x",e,t,n),F("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}},Axe=(e,t,n,r=ia)=>{switch(e.op){case"LowerBound":{let a=F("sortedSequence",e,t,n),s=F("values",e,t,n);return[r.lowerBound(a,s)]}case"TopKV2":{let a=F("x",e,t,n),s=F("k",e,t,n),i=F("sorted",e,t,n),o=r.topk(a,s,i);return[o.values,o.indices]}case"UpperBound":{let a=F("sortedSequence",e,t,n),s=F("values",e,t,n);return[r.upperBound(a,s)]}case"Unique":{let a=F("x",e,t,n),s=r.unique(a);return[s.values,s.indices]}case"UniqueV2":{let a=F("x",e,t,n),s=F("axis",e,t,n),i=r.unique(a,s);return[i.values,i.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Rxe=(e,t,n,r=ia)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":let a=F("default",e,t,n);return[pa(e.name,t,n)||a];case"Placeholder":return[pa(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let c=F("x",e,t,n);return[Rl(c)]}case"IdentityN":return F("x",e,t,n).map(c=>Rl(c));case"Snapshot":let s=F("x",e,t,n);return[Rl(s)];case"Shape":return[r.tensor1d(F("x",e,t,n).shape,"int32")];case"ShapeN":return F("x",e,t,n).map(c=>r.tensor1d(c.shape));case"Size":return[r.scalar(F("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(F("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":let i=F("x",e,t,n),o=F("data",e,t,n),l=F("message",e,t,n),h=F("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,h));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Dxe=class{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=rt(0),this.tensorMap=new Map,Br(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return rt(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),oe(()=>{let r=or(t),a=n.length,s=r.length;$.assert(a===s,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${s} elements.`);for(let i=0;i<a;i++){let o=n[i],l=r[i];Br(l),this.tensorMap.set(o,l)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return oe(()=>{let r=[];for(let a=0;a<n.length;a++){let s=n[a],i=this.findWithDefault(s,t);r.push(i)}return Nr(r)})}findWithDefault(e,t){let n=this.tensorMap.get(e);return n??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}},Mxe=async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{let a=r.getHashTableHandleByName(e.name);if(a!=null)return[a];{let s=F("keyDType",e,t,n),i=F("valueDType",e,t,n),o=new Dxe(s,i);return r.addHashTable(e.name,o),[o.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let a=F("tableHandle",e,t,n,r),s=F("keys",e,t,n),i=F("values",e,t,n);return[await r.getHashTableById(a.id).import(s,i)]}case"LookupTableFind":case"LookupTableFindV2":{let a=F("tableHandle",e,t,n,r),s=F("keys",e,t,n),i=F("defaultValue",e,t,n);return[await r.getHashTableById(a.id).find(s,i)]}case"LookupTableSize":case"LookupTableSizeV2":{let a=F("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},$xe=(e,t,n,r=ia)=>{switch(e.op){case"ResizeBilinear":{let a=F("images",e,t,n),s=F("size",e,t,n),i=F("alignCorners",e,t,n),o=F("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[s[0],s[1]],i,o)]}case"ResizeNearestNeighbor":{let a=F("images",e,t,n),s=F("size",e,t,n),i=F("alignCorners",e,t,n),o=F("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[s[0],s[1]],i,o)]}case"CropAndResize":{let a=F("image",e,t,n),s=F("boxes",e,t,n),i=F("boxInd",e,t,n),o=F("cropSize",e,t,n),l=F("method",e,t,n),h=F("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,s,i,o,l,h)]}case"ImageProjectiveTransformV3":{let a=F("images",e,t,n),s=F("transforms",e,t,n),i=F("outputShape",e,t,n),o=F("fillValue",e,t,n),l=F("interpolation",e,t,n),h=F("fillMode",e,t,n);return[r.image.transform(a,s,l.toLowerCase(),h.toLowerCase(),o,i)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Oxe=(e,t,n,r=ia)=>{switch(e.op){case"Equal":return[r.equal(F("a",e,t,n),F("b",e,t,n))];case"NotEqual":return[r.notEqual(F("a",e,t,n),F("b",e,t,n))];case"Greater":return[r.greater(F("a",e,t,n),F("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(F("a",e,t,n),F("b",e,t,n))];case"Less":return[r.less(F("a",e,t,n),F("b",e,t,n))];case"LessEqual":return[r.lessEqual(F("a",e,t,n),F("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(F("a",e,t,n),F("b",e,t,n))];case"LogicalNot":return[r.logicalNot(F("a",e,t,n))];case"LogicalOr":return[r.logicalOr(F("a",e,t,n),F("b",e,t,n))];case"Select":case"SelectV2":return[r.where(F("condition",e,t,n),F("a",e,t,n),F("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(F("a",e,t,n),F("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Fxe=(e,t,n,r=ia)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(F("a",e,t,n),F("b",e,t,n),F("transposeA",e,t,n),F("transposeB",e,t,n))];case"Einsum":return[r.einsum(F("equation",e,t,n),...F("tensors",e,t,n))];case"Transpose":return[r.transpose(F("x",e,t,n),F("perm",e,t,n))];case"_FusedMatMul":let[a,s]=F("fusedOps",e,t,n),i=a==="biasadd",o=s==="prelu",l=F("numArgs",e,t,n),h=F("leakyreluAlpha",e,t,n);if(i){if(o&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[c,p]=F("args",e,t,n);return[r.fused.matMul({a:F("a",e,t,n),b:F("b",e,t,n),transposeA:F("transposeA",e,t,n),transposeB:F("transposeB",e,t,n),bias:c,activation:s,preluActivationWeights:p,leakyreluAlpha:h})];case"MatrixBandPart":return[r.linalg.bandPart(F("a",e,t,n),F("numLower",e,t,n),F("numUpper",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Pxe=(e,t,n,r=ia)=>{switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(F("x",e,t,n),F("axis",e,t,n),F("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(F("x",e,t,n),F("mean",e,t,n),F("variance",e,t,n),F("offset",e,t,n),F("scale",e,t,n),F("epsilon",e,t,n))];case"FusedBatchNormV3":return[r.batchNorm(F("x",e,t,n),F("mean",e,t,n),F("variance",e,t,n),F("offset",e,t,n),F("scale",e,t,n),F("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(F("x",e,t,n),F("radius",e,t,n),F("bias",e,t,n),F("alpha",e,t,n),F("beta",e,t,n))];case"Softmax":return[r.softmax(F("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(F("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Lxe=(e,t,n,r=ia)=>{switch(e.op){case"RaggedGather":{let{outputNestedSplits:a,outputDenseValues:s}=r.raggedGather(F("paramsNestedSplits",e,t,n),F("paramsDenseValues",e,t,n),F("indices",e,t,n),F("outputRaggedRank",e,t,n));return a.concat(s)}case"RaggedRange":{let{rtNestedSplits:a,rtDenseValues:s}=r.raggedRange(F("starts",e,t,n),F("limits",e,t,n),F("splits",e,t,n));return[a,s]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(F("shape",e,t,n),F("values",e,t,n),F("defaultValue",e,t,n),F("rowPartitionTensors",e,t,n),F("rowPartitionTypes",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},zxe=(e,t,n,r=ia)=>{switch(e.op){case"Max":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.max(F("x",e,t,n),o,l)]}case"Mean":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.mean(F("x",e,t,n),o,l)]}case"Min":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.min(F("x",e,t,n),o,l)]}case"Sum":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.sum(F("x",e,t,n),o,l)]}case"All":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.all(F("x",e,t,n),o,l)]}case"Any":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.any(F("x",e,t,n),o,l)]}case"ArgMax":{let o=F("axis",e,t,n);return[r.argMax(F("x",e,t,n),o)]}case"ArgMin":{let o=F("axis",e,t,n);return[r.argMin(F("x",e,t,n),o)]}case"Prod":{let o=F("axis",e,t,n),l=F("keepDims",e,t,n);return[r.prod(F("x",e,t,n),o,l)]}case"Cumprod":{let o=F("axis",e,t,n),l=F("exclusive",e,t,n),h=F("reverse",e,t,n);return[r.cumprod(F("x",e,t,n),o,l,h)]}case"Cumsum":{let o=F("axis",e,t,n),l=F("exclusive",e,t,n),h=F("reverse",e,t,n);return[r.cumsum(F("x",e,t,n),o,l,h)]}case"Bincount":let a=F("x",e,t,n),s=F("weights",e,t,n),i=F("size",e,t,n);return[r.bincount(a,s,i)];case"DenseBincount":{let o=F("x",e,t,n),l=F("weights",e,t,n),h=F("size",e,t,n),c=F("binaryOutput",e,t,n);return[r.denseBincount(o,l,h,c)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Vxe=(e,t,n,r=ia)=>{switch(e.op){case"ConcatV2":case"Concat":{let a=F("n",e,t,n),s=F("axis",e,t,n),i=F("tensors",e,t,n);return i=i.slice(0,a),[r.concat(i,s)]}case"Gather":{let a=F("x",e,t,n),s=F("indices",e,t,n);return[r.gather(a,r.cast(s,"int32"),0)]}case"GatherV2":{let a=F("axis",e,t,n),s=F("batchDims",e,t,n),i=F("x",e,t,n),o=F("indices",e,t,n);return[r.gather(i,r.cast(o,"int32"),a,s)]}case"Reverse":{let a=F("dims",e,t,n),s=[];for(let o=0;o<a.length;o++)a[o]&&s.push(o);let i=F("x",e,t,n);return[r.reverse(i,s)]}case"ReverseV2":{let a=F("axis",e,t,n),s=F("x",e,t,n);return[r.reverse(s,a)]}case"Slice":{let a=F("begin",e,t,n),s=F("size",e,t,n);return[r.slice(F("x",e,t,n),a,s)]}case"StridedSlice":{let a=F("begin",e,t,n),s=F("end",e,t,n),i=F("strides",e,t,n),o=F("beginMask",e,t,n),l=F("endMask",e,t,n),h=F("ellipsisMask",e,t,n),c=F("newAxisMask",e,t,n),p=F("shrinkAxisMask",e,t,n),m=F("x",e,t,n);return[r.stridedSlice(m,a,s,i,o,l,h,c,p)]}case"Pack":return oe(()=>{let a=F("axis",e,t,n),s=F("tensors",e,t,n),i=s[0].shape,o=r.squeeze(s[0]).shape,l=s.map(h=>{let c=$.arraysEqual(h.shape,i);if(!c&&!$.arraysEqual(r.squeeze(h).shape,o))throw new Error("the input tensors shape does not match");return c?h:r.reshape(h,i)});return[r.stack(l,a)]});case"Unpack":{let a=F("axis",e,t,n),s=F("tensor",e,t,n);return r.unstack(s,a)}case"Tile":{let a=F("reps",e,t,n);return[r.tile(F("x",e,t,n),a)]}case"Split":case"SplitV":{let a=F("axis",e,t,n),s=F("numOrSizeSplits",e,t,n),i=F("x",e,t,n);return r.split(i,s,a)}case"ScatterNd":{let a=F("indices",e,t,n),s=F("values",e,t,n),i=F("shape",e,t,n);return[r.scatterND(a,s,i)]}case"GatherNd":{let a=F("x",e,t,n),s=F("indices",e,t,n);return[r.gatherND(a,s)]}case"SparseToDense":{let a=F("sparseIndices",e,t,n),s=F("outputShape",e,t,n),i=F("sparseValues",e,t,n),o=F("defaultValue",e,t,n);return[r.sparseToDense(a,i,s,i.dtype===o.dtype?o:r.cast(o,i.dtype))]}case"TensorScatterUpdate":{let a=F("indices",e,t,n),s=F("values",e,t,n),i=F("tensor",e,t,n);return[r.tensorScatterUpdate(i,a,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Uxe=(e,t,n,r=ia)=>{switch(e.op){case"SparseFillEmptyRows":{let{outputIndices:a,outputValues:s,emptyRowIndicator:i,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(F("indices",e,t,n),F("values",e,t,n),F("denseShape",e,t,n),F("defaultValue",e,t,n));return[a,s,i,o]}case"SparseReshape":{let{outputIndices:a,outputShape:s}=r.sparse.sparseReshape(F("inputIndices",e,t,n),F("inputShape",e,t,n),F("newShape",e,t,n));return[a,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(F("data",e,t,n),F("indices",e,t,n),F("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(F("data",e,t,n),F("indices",e,t,n),F("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Bxe=(e,t,n,r=ia)=>{switch(e.op){case"FFT":return[r.fft(F("x",e,t,n))];case"IFFT":return[r.ifft(F("x",e,t,n))];case"RFFT":return[r.rfft(F("x",e,t,n))];case"IRFFT":return[r.irfft(F("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Wxe=(e,t,n,r=ia)=>{switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(F("input",e,t,n),F("pattern",e,t,n),F("rewrite",e,t,n),F("replaceGlobal",e,t,n))];case"StringNGrams":{let{nGrams:a,nGramsSplits:s}=r.string.stringNGrams(F("data",e,t,n),F("dataSplits",e,t,n),F("separator",e,t,n),F("nGramWidths",e,t,n),F("leftPad",e,t,n),F("rightPad",e,t,n),F("padWidth",e,t,n),F("preserveShortSequences",e,t,n));return[a,s]}case"StringSplit":{let{indices:a,values:s,shape:i}=r.string.stringSplit(F("input",e,t,n),F("delimiter",e,t,n),F("skipEmpty",e,t,n));return[a,s,i]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(F("input",e,t,n),F("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},jxe=(e,t,n,r=ia)=>{switch(e.op){case"Cast":return[r.cast(F("x",e,t,n),F("dtype",e,t,n))];case"ExpandDims":{let a=F("axis",e,t,n);return[r.expandDims(F("x",e,t,n),a)]}case"Squeeze":{let a=F("axis",e,t,n);return[r.squeeze(F("x",e,t,n),a)]}case"Reshape":return[r.reshape(F("x",e,t,n),F("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(F("x",e,t,n),F("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(F("x",e,t,n),F("padding",e,t,n),F("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(F("x",e,t,n),F("padding",e,t,n),F("constantValue",e,t,n))];case"SpaceToBatchND":{let a=F("blockShape",e,t,n),s=F("paddings",e,t,n);return[r.spaceToBatchND(F("x",e,t,n),a,s)]}case"BatchToSpaceND":{let a=F("blockShape",e,t,n),s=F("crops",e,t,n);return[r.batchToSpaceND(F("x",e,t,n),a,s)]}case"DepthToSpace":{let a=F("blockSize",e,t,n),s=F("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(F("x",e,t,n),a,s)]}case"BroadcastTo":return[r.broadcastTo(F("x",e,t,n),F("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(F("s0",e,t,n),F("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function cL(e,t,n,r,a=oe){let s=((i,o,l)=>{switch(i.category){case"arithmetic":return a(()=>vxe(i,o,l));case"basic_math":return a(()=>xxe(i,o,l));case"control":return kxe(i,o,l);case"convolution":return a(()=>Exe(i,o,l));case"creation":return a(()=>Nxe(i,o,l));case"dynamic":return Cxe(i,o,l);case"evaluation":return a(()=>Axe(i,o,l));case"image":return a(()=>$xe(i,o,l));case"graph":return a(()=>Rxe(i,o,l));case"logical":return a(()=>Oxe(i,o,l));case"matrices":return a(()=>Fxe(i,o,l));case"normalization":return a(()=>Pxe(i,o,l));case"ragged":return a(()=>Lxe(i,o,l));case"reduction":return a(()=>zxe(i,o,l));case"slice_join":return a(()=>Vxe(i,o,l));case"sparse":return a(()=>Uxe(i,o,l));case"spectral":return a(()=>Bxe(i,o,l));case"string":return a(()=>Wxe(i,o,l));case"transformation":return a(()=>jxe(i,o,l));case"hash_table":return Mxe(i,o,l,r);case"custom":let h=gj(i.op);if(h&&h.customExecutor)return h.customExecutor(new bxe(i,o,l));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return $.isPromise(s)?s.then(i=>[].concat(i)):[].concat(s)}var hL=class{constructor(e={},t={},n={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let e=[];for(let t=0;t<this.contexts.length-1;t++){let n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(let t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(let t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}};function dL(e,t,n,r){let a=new Set,s=[],i=null,o=null,l=new Set,h=new Set(Object.keys(e).map(m=>Ts(m)[0]));r=r||[];let c=new Set(r.map(m=>Ts(m.name)[0])),p=[...t];for(;p.length>0;){let m=p.pop();if(($h(m)||Zxe(m)||Jxe(m))&&i==null&&(i=m,o=i.children.map(g=>g.name).filter(g=>a.has(g))),a.add(m.name),n[m.name]==null&&!h.has(m.name)&&!c.has(m.name)){if(m.inputs.length===0){s.push(m.name);continue}m.inputs.forEach(g=>{l.has(g.name)||(l.add(g.name),p.push(g))})}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:s,dynamicNode:i,syncInputs:o}}function Hxe(e,t){let{usedNodes:n,inputs:r}=t,a=Object.keys(r).map(x=>Ts(x)[0]).map(x=>e.nodes[x]),s=e.initNodes||[],i=x=>n.has(typeof x=="string"?x:x.name);function o(x){return[...new Map(x.map(_=>[_.name,_])).values()]}let l=o([...a,...e.weights,...s]).filter(i),h=o([...l,...Object.values(e.nodes)]).filter(i),c=new Map(h.map(x=>[x.name,x])),p={};for(let x of h){p[x.name]=p[x.name]||0;for(let _ of x.children)i(_)||(p[_.name]=Number.POSITIVE_INFINITY),p[_.name]=(p[_.name]||0)+1}let m=Object.entries(p).filter(([,x])=>x===0).map(([x])=>x),g=[...m];for(;m.length>0;){let x=m.pop(),_=c.get(x);for(let I of _.children.filter(i))--p[I.name]===0&&(g.push(I.name),m.push(I.name))}let b=g.map(x=>c.get(x)),v=Gxe(b,l);return qxe(v,l),v}function Gxe(e,t){let n=new Map(e.map(s=>[s.name,s])),r=t.map(s=>s.name),a=new Set(r);for(;r.length>0;){let s=r.pop(),i=n.get(s);for(let o of i.children)!n.has(o.name)||a.has(o.name)||(a.add(o.name),r.push(o.name))}return e.filter(s=>a.has(s.name))}var u0=class extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}};function qxe(e,t){let n=new Map(e.map((o,l)=>[o.name,l])),r=new Set(t.map(o=>o.name)),a=o=>r.has(typeof o=="string"?o:o.name),s=new Set(e.map(o=>o.name)),i=o=>s.has(typeof o=="string"?o:o.name);for(let o of e){for(let l of o.children.filter(i)){if(!n.has(l.name))throw new u0(`Child ${l.name} of node ${o.name} is unreachable.`);if(n.get(o.name)>n.get(l.name))throw new u0(`Node ${o.name} is scheduled to run after its child ${l.name}.`)}if(!a(o))for(let l of o.inputs){if(!n.has(l.name))throw new u0(`Input ${l.name} of node ${o.name} is unreachable.`);if(n.get(l.name)>n.get(o.name))throw new u0(`Node ${o.name} is scheduled to run before its input ${l.name}.`)}}}function Kxe(e){let t=new Map(e.map((o,l)=>[o.name,l])),n=Number.MAX_SAFE_INTEGER,r=e.map((o,l)=>$h(o)?n:l),a=o=>{let l=r[t.get(o.name)];return l??-1},s=e.map((o,l)=>o.children.map(a).reduce((h,c)=>Math.max(h,c),r[l])),i=new Map;for(let o=0;o<e.length;++o){let l=s[o];if(l===n)continue;let h=e[o],c=e[l];i.has(c.name)||i.set(c.name,[]),i.get(c.name).push(h)}return i}var Xxe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Yxe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Qxe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function $h(e){return Xxe.has(e.op)}function Zxe(e){return Yxe.has(e.op)}function Jxe(e){return Qxe.has(e.op)}var pL=class Lj{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let n=Object.keys(t).map(r=>t[r].map(a=>a.id));this._weightIds=[].concat(...n),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let n=t.signatureKey||t.name;return t.defaultOutput?`${n}:${t.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((t,n)=>(t[n]=this._functions[n].signature,t),{})}constructor(t,n){this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(r=>{this._functionExecutorMap[r]=new Lj(t.functions[r],this)})}getCompilationKey(t,n){let r=t.map(s=>s.name).sort(),a=n.map(s=>s.name).sort();return r.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)}compile(t,n){let r=dL(t,n,this.weightMap,this._initNodes),{missingInputs:a,dynamicNode:s,syncInputs:i}=r;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(a.length>0){let h=n.map(p=>p.name),c=Object.keys(t);throw new Error(`Cannot compute the outputs [${h}] from the provided inputs [${c}]. Missing the following inputs: [${a}]`)}let o=Hxe(this.graph,r),l=Kxe(o);return{orderedNodes:o,nodeLiveUntilMap:l}}cloneAndKeepTensor(t){if(t==null)return null;let n=t.clone();return Br(n),n}cloneTensorList(t){return t?t.map(n=>this.cloneAndKeepTensor(n)):null}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,this.cloneTensorList(r)]))}execute(t,n){this.disposeIntermediateTensors(),t=this.mapInputs(t);let r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n);let a=r.map(m=>this.graph.nodes[Ts(m)[0]]),s=n.map(m=>Ts(m)[0]),i=new Set(s),o=s.map(m=>this.graph.nodes[m]);o.length===0&&(o=this._outputs);let l=this.getCompilationKey(a,o),h=this.compiledMap.get(l);h==null&&(h=this.compile(t,o),this.compiledMap.set(l,h));try{this.keepIntermediateTensors=he().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){this.keepIntermediateTensors=!1,console.warn(m.message)}let c={},p={};return oe(()=>{let m=new hL(this.weightMap,c,p,this.functionExecutorMap,this.parseNodeNameCache),g=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach(_=>{let[I,k]=Ts(_,m),E=[];E[k]=t[_],g[I]=E,this.keepIntermediateTensors&&(this.clonedTensorsMap[I]=this.cloneTensorList(E))});let b=this.getFrozenTensorIds(g),{orderedNodes:v,nodeLiveUntilMap:x}=h;for(let _ of v){if(g[_.name])continue;let I=cL(_,g,m,this._resourceManager);if($.isPromise(I))throw new Error(`The execution of the op '${_.op}' returned a promise. Please use model.executeAsync() instead.`);g[_.name]=I,this.keepIntermediateTensors&&(this.clonedTensorsMap[_.name]=this.cloneTensorList(I)),this.checkTensorForDisposalWithNodeLiveUntilInfo(_,g,m,b,i,x.get(_.name))}return this.parent==null&&m.dispose(b),n.map(_=>pa(_,g,m))})}getFrozenTensorIds(t){let n=[].concat.apply([],Object.keys(t).map(r=>t[r]).map(r=>r.map(a=>a.id)));return new Set(n)}checkTensorForDisposal(t,n,r,a,s,i,o){if(!($h(n)||i.has(t))){for(let l of r[t])l!=null&&(o[l.id]=(o[l.id]||0)+n.children.length);for(let l of n.inputs){if($h(l))continue;let h=sL(l.name,r,a);if(h!=null)for(let c of h){if(!c||c.kept||s.has(c.id))continue;let p=o[c.id];p===1?(c.dispose(),delete o[c.id]):p!=null&&o[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,n,r,a,s,i){function o(l){return $h(l)||s.has(l.name)}if(!($h(t)||i==null))for(let l of i){if(o(l))continue;let h=sL(l.name,n,r);for(let c of h)!c||c.kept||a.has(c.id)||c.dispose()}}async executeAsync(t,n){return this._executeAsync(t,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(t=>{for(let n of t)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(t,n,r=!1,a={},s={}){this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=he().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){this.keepIntermediateTensors=!1,console.warn(m.message)}let i=new hL(this.weightMap,a,s,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let o=await this.executeWithControlFlow(t,i,n,r),l=n.map(m=>pa(m,o,i)),h=l.map(m=>m.id),c=Object.keys(t).map(m=>t[m].id),p=new Set([...h,...c,...this.weightIds]);return Object.values(o).forEach(m=>{m.forEach(g=>{g&&!g.isDisposed&&!p.has(g.id)&&g.dispose()})}),this.parent==null&&i.dispose(p),l}async executeFunctionAsync(t,n,r){let a=t.reduce((s,i,o)=>(s[this.inputs[o].name]=i,s),{});return this._executeAsync(a,this.outputNodes,!0,n,r)}async executeWithControlFlow(t,n,r,a){let s=Object.keys(t),i=s.map(E=>this.graph.nodes[Ts(E)[0]]),o=r.map(E=>Ts(E)[0]),l=new Set(o),h=o.map(E=>this.graph.nodes[E]);h.length===0&&(h=this._outputs);let{usedNodes:c,missingInputs:p,dynamicNode:m,syncInputs:g}=dL(t,h,this.weightMap,this._initNodes),b=[...i,...this.graph.weights,...this._initNodes||[]].map(E=>({node:E,contexts:n.currentContext})),v=Object.assign({},this.weightMap);Object.keys(t).forEach(E=>{let[R,U]=Ts(E),D=[];D[U]=t[E],v[R]=D});let x={},_=this.getFrozenTensorIds(v),I={};for(;b.length>0;){let E=this.processStack(i,b,n,v,I,_,l,x,c);await Promise.all(E)}m==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let k=h.filter(E=>!$h(E)&&!pa(E.name,v,n)).map(E=>E.name);if(k.length>0){let E="";throw m!=null&&(E=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${g}]`),new Error(`Cannot compute the outputs [${k}] from the provided inputs [${s}]. Consider providing the following inputs: [${p}]. ${E}`)}return v}processStack(t,n,r,a,s,i,o,l,h){let c=[];for(;n.length>0;){let p=n.pop();r.currentContext=p.contexts;let m="";if(p.node.op==="Enter"&&F("isConstant",p.node,a,r)&&([m]=Al(p.node.name,r)),a[p.node.name]==null){let g=cL(p.node,a,r,this._resourceManager);m||([m]=Al(p.node.name,r));let b=r.currentContext;$.isPromise(g)?c.push(g.then(v=>(a[m]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[m]=this.cloneTensorList(v)),r.currentContext=b,this.checkTensorForDisposal(m,p.node,a,r,i,o,l),this.processChildNodes(p.node,n,r,a,s,h),v))):(a[m]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[m]=this.cloneTensorList(g)),this.checkTensorForDisposal(m,p.node,a,r,i,o,l),this.processChildNodes(p.node,n,r,a,s,h))}else this.processChildNodes(p.node,n,r,a,s,h)}return c}processChildNodes(t,n,r,a,s,i){t.children.forEach(o=>{let[l]=Al(o.name,r);s[l]||!i.has(o.name)||(o.op==="Merge"?o.inputNames.some(h=>!!pa(h,a,r))&&(s[l]=!0,n.push({contexts:r.currentContext,node:o})):o.inputNames.every(h=>!!pa(h,a,r))&&(s[l]=!0,n.push({contexts:r.currentContext,node:o})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(n=>n.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(n=>{let r=t[n],[a]=Ts(n),s=this.graph.nodes[a];if(s.attrParams.shape&&s.attrParams.shape.value){let i=s.attrParams.shape.value,o=i.length===r.shape.length&&r.shape.every((l,h)=>i[h]===-1||i[h]===l);$.assert(o,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${i}], but was [${r.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&$.assert(r.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(t){var n,r;let a={};for(let s in t){let i=(r=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||r===void 0?void 0:r[s];i!=null?a[i.name]=t[s]:a[s]=t[s]}return a}checkInputs(t){let n=Object.keys(t).filter(r=>{let[a]=Ts(r);return this.graph.nodes[a]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(t){return t.map(n=>{var r,a;let s=(a=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||a===void 0?void 0:a[n];return s!=null?s.name:n},{})}checkOutputs(t){t.forEach(n=>{let[r]=Ts(n);if(!this.graph.nodes[r])throw new Error(`The output '${n}' is not found in the graph`)})}},ewe=class{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(let e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(let e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}},twe="?tfjs-format=file",nwe="model.json",zR=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=ma){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new ewe}findIOHandler(){let e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{let t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let e=this.handler.load();return $.isPromise(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){let t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let t=await UU(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;let n=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}if(this.signature=r,this.version=`${n.versions.producer}.${n.versions.minConsumer}`,this.executor=new pL(iL.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){let a=iL.Instance.transformGraph(e.modelInitializer);this.initializer=new pL(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){let n=this.io.getSaveHandlers(e);if(n.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(n.length>1)throw new Error(`Found more than one (${n.length}) save handlers for URL '${e}'`);e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){let t=e instanceof Tt?[e]:e,n={};return t.forEach((r,a)=>n[this.structuredOutputKeys[a]]=r),n}return e}predict(e,t){let n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){let n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof Tt)&&!Array.isArray(e)){let a=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(a!=null)for(let s in a){let i=a[s];i.resourceId!=null&&(e[s]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];let n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((a,s)=>{var i,o,l;let h=(l=(o=(i=this.signature)===null||i===void 0?void 0:i.inputs)===null||o===void 0?void 0:o[s])===null||l===void 0?void 0:l.resourceId;return h!=null?a[s]=this.resourceIdToCapturedInput[h]:a[s]=e[r++],a},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){let t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){let a=n[r],s=t[a];this.resourceIdToCapturedInput[s.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&wt(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};async function rwe(e,t={},n=ma){if(e==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof e=="string"&&(e=swe(e));let r=new zR(e,t,n);return await r.load(),r}function awe(e){if(e==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let t;if(e instanceof Array){let[r,a]=e;if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");let s=ma.getWeightSpecs(r.weightsManifest),i=ma.getModelArtifactsForJSONSync(r,s,a);t=ma.fromMemorySync(i)}else if("load"in e)t=e;else if("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e)t=ma.fromMemorySync(e);else throw new Error("Unknown model format");let n=new zR(t);return n.load(),n}function swe(e){return e.endsWith("/")||(e=e+"/"),`${e}${nwe}${twe}`}var iwe="4.22.0",zj={};_t(zj,{CSVDataset:()=>Yj,Dataset:()=>ey,FileDataSource:()=>r5,TextLineDataset:()=>Xj,URLDataSource:()=>a5,array:()=>Cwe,csv:()=>Bwe,func:()=>Wwe,generator:()=>jwe,microphone:()=>Gwe,version_data:()=>qwe,webcam:()=>Hwe,zip:()=>Awe});var owe=Lc(y1()),lwe=Lc(y1());function uwe(e,t){return E_(e,t)}function E_(e,t,n=new Map,r=new Set){if(e==null)return null;if(typeof Blob=="function"&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(km(e)){let s=Array.isArray(e)?[]:{};r.add(e);for(let i in e){let o=e[i],l=E_(o,t,n,r);s[i]=l}return r.delete(e),e.__proto__&&(s.__proto__=e.__proto__),s}else throw new Error(`Can't recurse into non-iterable type: ${e}`);else return n.set(e,a.value),a.value}function cwe(e,t=Uj){return Vj(e,t)}function Vj(e,t,n=new Set){let r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(km(r)){let s=Array.isArray(r)?[]:{};n.add(r);for(let i in r){let o=e.map(h=>h[i]),l=Vj(o,t,n);s[i]=l}return n.delete(r),s}else throw new Error(`Can't recurse into non-iterable type: ${r}`);else return a.value}function Uj(e){return e===null?null:km(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function Bj(e,t){let n=new Map;E_(e,t,n);for(let r of Array.from(n.keys())){let a=n.get(r);if($.isPromise(a)){let s=await a;n.set(r,s)}}return E_(e,t,n)}function km(e){let t=!1;if(he().get("IS_BROWSER"))t=e instanceof TextDecoder;else{let{StringDecoder:n}=oU();t=e instanceof n}return e!=null&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||typeof e=="object"&&!(e instanceof Tt)&&!(e instanceof Promise)&&!t)}function hwe(e){return e==null||dwe(e)||Array.isArray(e)||typeof e=="object"&&e instanceof Tt||$.isTypedArray(e)}function dwe(e){return e===null||typeof e!="object"&&typeof e!="function"}function pwe(e){return uwe(e,fwe)}function fwe(e){return e instanceof Tt?{value:e.clone(),recurse:!1}:km(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var Wj=class{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}},jj=class Hj extends Wj{constructor(){super(Hj.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){let t=this.capacity*2,n=new Array(t),r=this.length();for(let a=0;a<r;a++)n[a]=this.get(this.wrap(this.begin+a));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=r}};jj.INITIAL_CAPACITY=32;function Gj(e){return new ywe(e)}function VR(e){return new bwe(e)}function mwe(e,t){return new qj(e,t)}function gwe(e,t=Zu.FAIL){return new Ewe(e,t)}var sa=class{async toArray(){let e=[],t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),t=[],n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new Twe(this,e)}filter(e){return new Swe(this,e)}map(e){return new Iwe(this,e)}mapAsync(e){return new fL(this,e)}serialMapAsync(e){return new fL(this,e).serial()}flatmap(e){return new kwe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new _we(this,e,t)}columnMajorBatch(e,t=!0,n=Uj){return this.rowMajorBatch(e,t).map(r=>cwe(r,n))}concatenate(e,t){return new qj(Gj([this,e]),t)}take(e){return e<0||e==null?this:new wwe(this,e)}skip(e){return e<0||e==null?this:new xwe(this,e)}prefetch(e){return new Kj(this,e)}shuffle(e,t){return new Nwe(this,e,t)}serial(){return new vwe(this)}},ywe=class extends sa{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:pwe(e),done:!1}}},bwe=class extends sa{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}},vwe=class extends sa{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}},xwe=class extends sa{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;wt(e.value)}return this.upstream.next()}},wwe=class extends sa{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}},_we=class extends sa{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}},Swe=class extends sa{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;wt(e.value)}}},Iwe=class extends sa{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=Xi.getTensorsInContainer(e.value),n=this.transform(e.value),r=Xi.getTensorsInContainer(n);for(let a of t)Xi.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},Twe=class extends sa{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}},fL=class extends sa{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=Xi.getTensorsInContainer(e.value),n=await this.transform(e.value),r=Xi.getTensorsInContainer(n);for(let a of t)Xi.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},UR=class extends sa{constructor(){super(),this.outputQueue=new jj,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}},kwe=class extends UR{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let t=Xi.getTensorsInContainer(e.value),n=this.transform(e.value),r=Xi.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(let a of t)Xi.isTensorInList(a,r)||a.dispose();return!0}},qj=class extends sa{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){let n=await this.moreIterators.next();if(n.done)return{value:null,done:!0};this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}},Zu;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(Zu||(Zu={}));var Ewe=class extends sa{constructor(e,t=Zu.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;function r(s){return s instanceof sa?{value:s.next().then(i=>(t++,i.done&&n++,i.value)),recurse:!1}:{value:null,recurse:!0}}let a=await Bj(this.iterators,r);if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case Zu.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case Zu.SHORTEST:return{value:null,done:!0};case Zu.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}},Kj=class extends sa{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new Wj(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}},Nwe=class extends Kj{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=lwe.alea(n||$.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}},ey=class{constructor(){this.size=null}batch(e,t=!0){let n=this;$.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:t?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),Is(async()=>(await n.iterator()).columnMajorBatch(e,t,Rwe),r)}concatenate(e){let t=this,n;return this.size===1/0||e.size===1/0?n=1/0:this.size!=null&&e.size!=null?n=this.size+e.size:n=null,Is(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){let t=this,n;return this.size===1/0?n=1/0:n=null,Is(async()=>(await t.iterator()).filter(r=>oe(()=>e(r))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let t=this;return Is(async()=>(await t.iterator()).map(n=>oe(()=>e(n))),this.size)}mapAsync(e){let t=this;return Is(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let t=this;return Is(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){let t=this,n;return this.size!=null&&e>0?n=this.size*e:e===0?n=0:this.size!=null&&(e===void 0||e<0)?n=1/0:n=null,Is(async()=>{let r=VR(async()=>({value:await t.iterator(),done:!1}));return mwe(r.take(e))},n)}skip(e){let t=this,n;return this.size!=null&&e>=0&&this.size>=e?n=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?n=0:n=null,Is(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t,n=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let r=this,a=owe.alea(t||$.now().toString());return Is(async()=>{let s=a.int32();return n&&(s+=a.int32()),(await r.iterator()).shuffle(e,s.toString())},this.size)}take(e){let t=this,n;return this.size!=null&&this.size>e?n=e:this.size!=null&&this.size<=e?n=this.size:n=null,Is(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}};ey.MAX_BUFFER_SIZE=1e4;function Is(e,t=null){return new class extends ey{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function Cwe(e){return Is(async()=>Gj(e),e.length)}function Awe(e){if(!km(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=t==null?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(let n in e)t=t==null?e[n].size:Math.min(t,e[n].size);return Is(async()=>{let n=await Bj(e,r=>{if(r instanceof ey)return{value:r.iterator(),recurse:!1};if(km(r))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return gwe(n,Zu.SHORTEST)},t)}function Rwe(e){if(e===null)return null;let t=e[0];return hwe(t)?{value:Dwe(e),recurse:!1}:{value:null,recurse:!0}}function Dwe(e){if(e.length===0)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Tt?Nr(e):Ba(e)}var Xj=class extends ey{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e))}},c0='"',ib=Symbol("out"),mL=Symbol("field"),h0=Symbol("quote"),_k=Symbol("quoteafterquote"),gL=Symbol("quoteinquote"),Yj=class extends ey{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){let e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&$.assert(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);let t=this.fullColumnNames.reduce((r,a)=>(r[a]=r[a]+1||1,r),{}),n=Object.keys(t).filter(r=>t[r]>1);if($.assert(n.length===0,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs){for(let r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){let e=await(await this.base.iterator()).next();if(e.done)throw new Error("No data was found for CSV parsing.");let t=e.value;return this.parseRow(t,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new Xj(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?($.assert(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){let t=this.parseRow(e),n={},r={};for(let a=0;a<this.fullColumnNames.length;a++){let s=this.fullColumnNames[a],i=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!i)){let o=t[a],l=null;if(o==="")if(i&&i.default!==void 0)l=i.default;else{if(i&&(i.required||i.isLabel))throw new Error(`Required column ${s} is empty in this line: ${e}`);l=void 0}else{let h=Number(o);if(isNaN(h))i&&i.dtype==="bool"?l=this.getBoolean(o):l=o;else if(!i||!i.dtype)l=h;else switch(i.dtype){case"float32":l=h;break;case"int32":l=Math.floor(h);break;case"bool":l=this.getBoolean(o);break;default:l=h}}i&&i.isLabel?r[s]=l:n[s]=l}}return Object.keys(r).length===0?n:{xs:n,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){let n=[],r=0,a=e.length,s=ib;for(let i=0;i<a;i++)switch(s){case ib:switch(e.charAt(i)){case c0:r=i+1,s=h0;break;case this.delimiter:if(r=i+1,this.delimiter===" "&&this.delimWhitespace)break;n.push(""),s=ib;break;default:s=mL,r=i;break}break;case mL:switch(e.charAt(i)){case this.delimiter:n.push(e.substring(r,i)),s=ib,r=i+1;break}break;case h0:switch(e.charAt(i)){case c0:s=_k;break}break;case _k:switch(e.charAt(i)){case this.delimiter:n.push(e.substring(r,i-1)),s=ib,r=i+1;break;case c0:s=h0;break;default:s=gL;break}break;case gL:switch(e.charAt(i)){case c0:s=h0;break}break}if(s===_k?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}},Mwe=class Qj extends sa{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;let n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=t.includeSpectrogram!==!1,this.includeWaveform=t.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(!he().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");let n=new Qj(t);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(r){throw new Error(`Error thrown while initializing video stream: ${r.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");let t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);let n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,n,r=await this.getAudioData();if(this.includeSpectrogram){let a=this.flattenQueue(r.freqDataQueue);t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){let a=this.flattenQueue(r.timeDataQueue);n=this.getTensorFromAudioDataArray(a,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){let t=[],n=[],r=0;return new Promise(a=>{let s=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&a({freqDataQueue:t,timeDataQueue:n}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++r===this.numFrames&&(clearInterval(s),a({freqDataQueue:t,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){let n=t[0].length,r=new Float32Array(t.length*n);return t.forEach((a,s)=>r.set(a,s*n)),r}getTensorFromAudioDataArray(t,n){let r=new Float32Array($.sizeFromShape(n));return r.set(t,r.length-t.length),Ba(r,n)}},$we=class Zj extends sa{constructor(t,n){if(super(),this.webcamVideoElement=t,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=dn([0],"int32"),this.webcamConfig.centerCrop){let r=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,a=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,s=(1-r)/2,i=(1-a)/2,o=s+r,l=a+i;this.cropBox=Bo([i,s,l,o],[1,4])}else this.cropBox=Bo([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,n={}){if(!he().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}let r=new Zj(t,n);return await r.start(),r}async start(){this.webcamConfig.facingMode&&$.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=gx.fromPixels(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{t.dispose()}else return{value:t,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(t){return oe(()=>{let n=ea(ze(t,"float32"),0),r;r=Xs.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");let a=r.shape;return ie(r,a.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}},Jj=class{},e5=class extends sa{split(e){return new Owe(this,e)}},Owe=class extends e5{constructor(e,t){super(),this.upstream=e,this.impl=new Fwe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},Fwe=class extends UR{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){let e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);let t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(let n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}},Pwe=class extends sa{decodeUTF8(){return new Lwe(this)}},Lwe=class extends e5{constructor(e){super(),this.upstream=e,this.impl=new zwe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},zwe=class extends UR{constructor(e){if(super(),this.upstream=e,he().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:t}=oU();this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){let e=await this.upstream.next(),t;if(e.done)return!1;t=e.value;let n;return he().get("IS_BROWSER")?n=this.decoder.decode(t,{stream:!0}):n=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0}},t5=class extends Pwe{constructor(e,t={}){super(),this.file=e,this.options=t,$.assert(e instanceof Uint8Array||(he().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((e,t)=>{let n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{let r=new FileReader;r.onload=s=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(i)},r.onabort=s=>t(new Error("Aborted")),r.onerror=s=>t(new Error(s.type));let a=this.file.slice(this.offset,n);r.readAsArrayBuffer(a)}this.offset=n}),done:!1}}};async function Vwe(e,t={},n){let r,a;typeof e=="string"?r=e:(r=e.url,a=Uwe(e));let s=await(0,$.fetch)(r,a);if(s.ok){let i=new Uint8Array(await s.arrayBuffer());return new t5(i,t)}else throw new Error(s.statusText)}var Uwe=e=>({method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity});function n5(e){return typeof e=="string"&&e.slice(0,7)==="file://"}var r5=class extends Jj{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(n5(this.input)&&he().get("IS_NODE")){let e=D2();this.input=e.readFileSync(this.input.slice(7))}return new t5(this.input,this.options)}},a5=class extends Jj{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return n5(this.url)?new r5(this.url,this.fileOptions).iterator():Vwe(this.url,this.fileOptions)}};function Bwe(e,t={}){return new Yj(new a5(e),t)}function Wwe(e){let t=VR(e);return Is(async()=>t)}function jwe(e){return Is(async()=>{let t=await e();return VR(()=>t.next())})}async function Hwe(e,t){return $we.create(e,t)}async function Gwe(e){return Mwe.create(e)}var qwe="4.22.0";function et(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&$.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}var Kwe=el.whereImpl,BR=class s5 extends Nv{nextDataId(){return s5.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new b1(this,_i())}write(t,n,r){this.firstUse&&(this.firstUse=!1,he().get("IS_NODE")&&B.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let a={id:this.nextDataId()};return this.data.set(a,{values:t,dtype:r,refCount:1}),a}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&$.isString(r[0])){let s=r.map(i=>$.encodeString(i));a=this.write(s,t,n)}else a=this.write(r,t,n);return{dataId:a,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){let n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){let n=this.data.get(t);n.refCount--}}move(t,n,r,a,s){this.data.set(t,{values:n,dtype:a,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){let{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){let a=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return B.mergeRealAndImagArrays(a,s)}return $.convertBackendValuesAndArrayBuffer(this.data.get(t).values,n)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>$.decodeString(a));return At(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return At(t.shape,t.dtype,n)}makeOutput(t,n,r){return _i().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;let{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){let n=$.now();return t(),{kernelMs:$.now()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){et([t],"where");let n=this.readSync(t.dataId);return Kwe(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};BR.nextDataId=0;var WR={};_t(WR,{addImpl:()=>l5,bincountImpl:()=>HR,bincountReduceImpl:()=>u5,bitwiseAndImpl:()=>c5,castImpl:()=>o5,ceilImpl:()=>h5,concatImpl:()=>GR,equalImpl:()=>d5,expImpl:()=>f5,expm1Impl:()=>g5,floorDivImpl:()=>b5,floorImpl:()=>y5,gatherNdImpl:()=>v5,gatherV2Impl:()=>x5,greaterEqualImpl:()=>_5,greaterImpl:()=>w5,lessEqualImpl:()=>I5,lessImpl:()=>S5,linSpaceImpl:()=>T5,logImpl:()=>k5,maxImpl:()=>E5,maximumImpl:()=>N5,minimumImpl:()=>C5,multiplyImpl:()=>qR,negImpl:()=>A5,notEqualImpl:()=>R5,prodImpl:()=>D5,raggedGatherImpl:()=>M5,raggedRangeImpl:()=>$5,raggedTensorToTensorImpl:()=>O5,rangeImpl:()=>XR,rsqrtImpl:()=>F5,scatterImpl:()=>zh,sigmoidImpl:()=>q0e,simpleAbsImpl:()=>i5,sliceImpl:()=>C_,sparseFillEmptyRowsImpl:()=>L5,sparseReshapeImpl:()=>z5,sparseSegmentReductionImpl:()=>YR,sqrtImpl:()=>Y0e,squaredDifferenceImpl:()=>V5,staticRegexReplaceImpl:()=>U5,stridedSliceImpl:()=>B5,stringNGramsImpl:()=>QR,stringSplitImpl:()=>ZR,stringToHashBucketFastImpl:()=>JR,subImpl:()=>W5,tileImpl:()=>j5,topKImpl:()=>G5,transposeImpl:()=>KR,uniqueImpl:()=>tD});function i5(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var Xwe=e=>{let{x:t}=e.inputs,n=e.backend;et(t,"abs");let r=new Float32Array($.sizeFromShape(t.shape)),a=n.data.get(t.dataId).values;return r=i5(a),n.makeOutput(r,t.shape,t.dtype)},Ywe={kernelName:Bm,backendName:"cpu",kernelFunc:Xwe};function br(e){return(t,n,r,a,s)=>{let i=B.assertAndGetBroadcastShape(t,n),o=i.length,l=$.computeStrides(i),h=$.sizeFromShape(i),c=$.getTypedArrayFromDType(s,h),p=t.length,m=n.length,g=$.computeStrides(t),b=$.computeStrides(n),v=B.getBroadcastDims(t,i),x=B.getBroadcastDims(n,i);if(v.length+x.length===0)for(let _=0;_<c.length;++_)c[_]=e(r[_%r.length],a[_%a.length]);else for(let _=0;_<c.length;++_){let I=$.indexToLoc(_,o,l),k=I.slice(-p);v.forEach(D=>k[D]=0);let E=$.locToIndex(k,p,g),R=I.slice(-m);x.forEach(D=>R[D]=0);let U=$.locToIndex(R,m,b);c[_]=e(r[E],a[U])}return[c,i]}}function As(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,o=n.makeTensorInfo(r.shape,"complex64"),l=n.data.get(o.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(a.shape,"float32",i)},o}var Qwe={kernelName:w1,backendName:"cpu",kernelFunc:As};function N_(e,t,n="float32"){if(n==="complex64"){let a=N_(e,t,"float32"),s=N_(e,t,"float32");return As({inputs:{real:a,imag:s},backend:e})}let r=$.makeZerosTypedArray($.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function Xo(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Zwe={kernelName:tp,backendName:"cpu",kernelFunc:Xo};function fd(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var Jwe={kernelName:M1,backendName:"cpu",kernelFunc:fd};function o5(e,t,n,r){if(r==="int32"){let a=Int32Array.from(e);return[t,"int32",a]}if(r==="bool"){let a=$.toTypedArray([0],n),[s,i]=br((o,l)=>o!==l?1:0)(t,[],e,a,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Nc(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return Xo({inputs:{x:a},backend:n});let c=N_(n,a.shape,a.dtype),p=Nc({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),m=As({inputs:{real:p,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),m}if(a.dtype==="complex64"){let c=fd({inputs:{input:a},backend:n}),p=Nc({inputs:{x:c},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(c),p}if(!$.hasEncodingLoss(a.dtype,s)){let c=Xo({inputs:{x:a},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:s}}let i=n.data.get(a.dataId).values,[o,l,h]=o5(i,a.shape,a.dtype,s);return n.makeTensorInfo(o,l,h)}var e0e={kernelName:Fd,backendName:"cpu",kernelFunc:Nc};function qr(e,t,n,r){return n==null?({inputs:a,backend:s})=>{let{a:i,b:o}=a,l=s;et([i,o],e);let h=l.data.get(i.dataId).values,c=l.data.get(o.dataId).values,p=i.dtype==="string"?B.fromUint8ToStringArray(h):h,m=i.dtype==="string"?B.fromUint8ToStringArray(c):c,g=r||i.dtype,[b,v]=t(i.shape,o.shape,p,m,g);return l.makeTensorInfo(v,g,b)}:({inputs:a,backend:s})=>{let{a:i,b:o}=a,l=s;if(i.dtype==="complex64"||o.dtype==="complex64"){let h=Nc({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(h.dataId),p=c.complexTensorInfos.real,m=c.complexTensorInfos.imag,g=l.data.get(p.dataId).values,b=l.data.get(m.dataId).values,v=Nc({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(v.dataId),_=x.complexTensorInfos.real,I=x.complexTensorInfos.imag,k=l.data.get(_.dataId).values,E=l.data.get(I.dataId).values,[R,U,D]=n(i.shape,o.shape,g,b,k,E),C=l.makeTensorInfo(D,"float32",R),O=l.makeTensorInfo(D,"float32",U),z=As({inputs:{real:C,imag:O},backend:l});return l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo(O),z}else{let h=l.data.get(i.dataId).values,c=l.data.get(o.dataId).values,p=r||i.dtype,[m,g]=t(i.shape,o.shape,h,c,p);return l.makeTensorInfo(g,p,m)}}}function jR(e){return(t,n,r,a,s,i)=>{let o=B.assertAndGetBroadcastShape(t,n),l=$.sizeFromShape(o),h=o.length,c=$.computeStrides(o),p=$.getTypedArrayFromDType("float32",l),m=$.getTypedArrayFromDType("float32",l),g=B.getBroadcastDims(t,o),b=B.getBroadcastDims(n,o),v=B.mergeRealAndImagArrays(r,a),x=B.mergeRealAndImagArrays(s,i),_=t.length,I=$.computeStrides(t),k=n.length,E=$.computeStrides(n);if(g.length+b.length===0)for(let R=0;R<p.length;R++){let U=R%v.length,D=R%x.length,C=e(v[U*2],v[U*2+1],x[D*2],x[D*2+1]);p[R]=C.real,m[R]=C.imag}else for(let R=0;R<p.length;R++){let U=$.indexToLoc(R,h,c),D=U.slice(-_);g.forEach(N=>D[N]=0);let C=$.locToIndex(D,_,I),O=U.slice(-k);b.forEach(N=>O[N]=0);let z=$.locToIndex(O,k,E),M=e(v[C*2],v[C*2+1],x[z*2],x[z*2+1]);p[R]=M.real,m[R]=M.imag}return[p,m,o]}}var l5=br((e,t)=>e+t),t0e=jR((e,t,n,r)=>({real:e+n,imag:t+r})),Em=qr(zc,l5,t0e),n0e={kernelName:zc,backendName:"cpu",kernelFunc:Em};function HR(e,t,n,r,a){let s=$.sizeFromShape(r),i=$.makeZerosTypedArray(a,n);for(let o=0;o<e.length;o++){let l=e[o];if(l<0)throw new Error("Input x must be non-negative!");l>=a||(s>0?i[l]+=t[o]:i[l]+=1)}return i}function u5(e,t,n,r=!1){let a=e.shape[0],s=e.shape[1],i=At([a,n],t.dtype);for(let o=0;o<a;o++)for(let l=0;l<s;l++){let h=e.get(o,l);if(h<0)throw new Error("Input x must be non-negative!");h>=n||(r?i.set(1,o,h):t.size>0?i.set(i.get(o,h)+t.get(o,l),o,h):i.set(i.get(o,h)+1,o,h))}return i}var c5=br((e,t)=>e&t),r0e=qr(Ym,c5),a0e={kernelName:Ym,backendName:"cpu",kernelFunc:r0e};function tl(e){return(t,n,r)=>{let a=$.getArrayFromDType(n,t.length);for(let s=0;s<t.length;++s)a[s]=e(t[s],r);return a}}function yn(e,t,n){let r=tl(t);return Kc(e,r,n)}function Kc(e,t,n){return({inputs:r,attrs:a,backend:s})=>{let{x:i}=r;et(i,e);let o=s,l=o.data.get(i.dataId).values,h;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");h=B.fromUint8ToStringArray(l)}else h=l;let c=n||i.dtype,p=t(h,c,a);return o.makeTensorInfo(i.shape,c,p)}}var h5=tl(e=>Math.ceil(e)),s0e=Kc(Pd,h5),i0e={kernelName:Pd,backendName:"cpu",kernelFunc:s0e};function GR(e,t,n,r){let a=$.getArrayFromDType(n,$.sizeFromShape(t));if(r&&n!=="string"){let s=0;e.forEach(i=>{let o=$.sizeFromShape(i.shape);a.set(i.vals,s),s+=o})}else{let s=0;e.forEach(i=>{let o=n==="string"?B.fromUint8ToStringArray(i.vals):i.vals,l=0;for(let h=0;h<i.shape[0];++h){let c=h*t[1]+s;for(let p=0;p<i.shape[1];++p)a[c+p]=o[l++]}s+=i.shape[1]})}return a}var d5=br((e,t)=>e===t?1:0),p5=qr(ag,d5,null,"bool"),o0e={kernelName:ag,backendName:"cpu",kernelFunc:p5},f5=tl(e=>Math.exp(e)),m5=Kc(Xd,f5,"float32"),l0e={kernelName:Xd,backendName:"cpu",kernelFunc:m5},g5=tl(e=>Math.expm1(e)),u0e=Kc(Yd,g5),c0e={kernelName:Yd,backendName:"cpu",kernelFunc:u0e},y5=tl(e=>Math.floor(e)),h0e=Kc(Qd,y5),d0e={kernelName:Qd,backendName:"cpu",kernelFunc:h0e},b5=br((e,t)=>Math.floor(e/t)),p0e=qr(Zd,b5,null,"int32"),f0e={kernelName:Zd,backendName:"cpu",kernelFunc:p0e};function v5(e,t,n,r,a,s,i,o,l){let h=At([r,s],n);for(let c=0;c<r;c++){let p=[],m=0;for(let g=0;g<a;g++){let b=e[c*a+g];m+=b*i[g],p.push(b)}if(m<0||m>=l/s)throw new Error(`Invalid indices: ${p} does not index into ${o}`);for(let g=0;g<s;g++)h.values[c*s+g]=t.get(...t.indexToLoc(m*s+g))}return h}function x5(e,t,n){let r=At(n,e.dtype);for(let a=0;a<r.size;++a){let s=r.indexToLoc(a).slice(),i=s[0],o=s[2],l=t.locToIndex([i,o]);s[2]=t.values[l];let h=e.locToIndex(s);0<=h&&h<e.values.length&&(r.values[a]=e.values[h])}return r}var w5=br((e,t)=>e>t?1:0),m0e=qr(ug,w5,null,"bool"),g0e={kernelName:ug,backendName:"cpu",kernelFunc:m0e},_5=br((e,t)=>e>=t?1:0),y0e=qr(ep,_5,null,"bool"),b0e={kernelName:ep,backendName:"cpu",kernelFunc:y0e},S5=br((e,t)=>e<t?1:0),v0e=qr(cg,S5,null,"bool"),x0e={kernelName:cg,backendName:"cpu",kernelFunc:v0e},I5=br((e,t)=>e<=t?1:0),w0e=qr(hg,I5,null,"bool"),_0e={kernelName:hg,backendName:"cpu",kernelFunc:w0e};function T5(e,t,n){let r=(t-e)/(n-1),a=$.makeZerosTypedArray(n,"float32");a[0]=e;for(let s=1;s<a.length;s++)a[s]=a[s-1]+r;return a}var k5=tl(e=>Math.log(e)),S0e=Kc(ip,k5),I0e={kernelName:ip,backendName:"cpu",kernelFunc:S0e};function E5(e,t,n,r){let a=$.getTypedArrayFromDType(r,$.sizeFromShape(n));for(let s=0;s<a.length;++s){let i=s*t,o=e[i];for(let l=0;l<t;++l){let h=e[i+l];(Number.isNaN(h)||h>o)&&(o=h)}a[s]=o}return a}var N5=br((e,t)=>Math.max(e,t)),T0e=qr(cp,N5),k0e={kernelName:cp,backendName:"cpu",kernelFunc:T0e},C5=br((e,t)=>Math.min(e,t)),E0e=qr(fp,C5),N0e={kernelName:fp,backendName:"cpu",kernelFunc:E0e},qR=br((e,t)=>e*t),C0e=jR((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),zS=qr(yp,qR,C0e),A0e={kernelName:yp,backendName:"cpu",kernelFunc:zS};function A5(e,t,n){let r=$.createScalarValue(-1,n);return qR([],t,r,e,n)}function R0e(e){let{inputs:t,backend:n}=e,{x:r}=t;et(r,"neg");let a=n.data.get(r.dataId).values,[s,i]=A5(a,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,s)}var D0e={kernelName:vg,backendName:"cpu",kernelFunc:R0e},R5=br((e,t)=>e!==t?1:0),M0e=qr(xg,R5,null,"bool"),$0e={kernelName:xg,backendName:"cpu",kernelFunc:M0e};function KR(e,t,n,r,a){let s=t.length,i=$.sizeFromShape(t),o=$.computeStrides(t),l=$.computeStrides(a),h=$.getTypedArrayFromDType(n,$.sizeFromShape(a));for(let c=0;c<i;++c){let p=$.indexToLoc(c,s,o),m=new Array(p.length);for(let b=0;b<m.length;b++)m[b]=p[r[b]];let g=$.locToIndex(m,s,l);h[g]=e[c]}return h}function cs(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:s}=n;et(a,"transpose");let i=a.shape.length,o=new Array(i);for(let c=0;c<o.length;c++)o[c]=a.shape[s[c]];let l=r.data.get(a.dataId).values,h=KR(l,a.shape,a.dtype,s,o);return{dataId:r.write(h,o,a.dtype),shape:o,dtype:a.dtype}}var O0e={kernelName:Vl,backendName:"cpu",kernelFunc:cs};function D5(e,t,n,r){let[a,s]=B.computeOutAndReduceShapes(e,r),i=ti(t,"int32"),o=$.makeZerosTypedArray($.sizeFromShape(a),i),l=$.sizeFromShape(s);for(let h=0;h<o.length;++h){let c=h*l,p=1;for(let m=0;m<l;++m)p*=n[c+m];o[h]=p}return{outVals:o,outShape:a,outDtype:i}}function F0e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;et(a,"prod");let o=a.shape.length,l=$.parseAxisParam(s,a.shape),h=B.getAxesPermutation(l,o),c=l,p=a,m=[];h!=null&&(p=cs({inputs:{x:a},backend:n,attrs:{perm:h}}),m.push(p),c=B.getInnerMostAxes(c.length,o));let g=n.data.get(p.dataId).values,{outVals:b,outShape:v,outDtype:x}=D5(p.shape,p.dtype,g,c),_=v;return i&&(_=B.expandShapeToKeepDim(v,l)),m.forEach(I=>n.disposeIntermediateTensorInfo(I)),n.makeTensorInfo(_,x,b)}var P0e={kernelName:_p,backendName:"cpu",kernelFunc:F0e};function L0e(e,t,n){e.forEach((r,a)=>{if(r<0||r>=n){let s=$.indexToLoc(a,t.length,$.computeStrides(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function z0e(e,t){for(let n=0;n<e.length;++n){let r=e[n],a=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function V0e(e,t,n,r){let a=[],s=0,i=t.length-1+n.length,o=new Array(i).fill(null).map(()=>[0]);z0e(n,r);let l=1;for(let h=0;h<t.length-1;++h){l*=t[h];let c=t[h+1];for(let p=1;p<l+1;++p)o[h].push(p*c)}for(let h=0;h<e.length;++h){let c=e[h],p=e[h]+1;for(let m=0;m<n.length;++m){let g=n[m],b=m+t.length-1;if(b>=0){let v=o[b],x=v[v.length-1]-g[c];for(let _=c;_<p;++_)o[b].push(g[_+1]+x)}c=g[c],p=g[p]}p!==c&&(a.push([c,p]),s+=p-c)}return{outSplits:o,valueSlices:a,numValues:s}}function U0e(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n].length,a=$.getArrayFromDType("int32",r);t.push(a),e[n].forEach((s,i)=>a[i]=s)}return t}function yL(e,t){let n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function B0e(e,t,n,r,a,s){let i=yL(t,2)[1],o=yL(s,2)[1],l=0;for(let h of n)for(let c=h[0];c<h[1];++c){for(let p=0;p<r;++p)a[l*o+p]=e[c*i+p];++l}}function W0e(e,t,n,r,a){let s=t.slice();s[0]=a;let i=$.getArrayFromDType(n,$.sizeFromShape(s)),o=e.length,l=o===0?0:o/t[0];return B0e(e,t,r,l,i,s),[i,s]}function M5(e,t,n,r,a,s,i,o){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");let l=t[0][0]-1;if(L0e(s,i,l),r.length===0)throw new Error("params.rank must be nonzero");let h=r[0],{outSplits:c,valueSlices:p,numValues:m}=V0e(s,i,e,h),g=U0e(c),b=W0e(n,r,a,p,m);return[g,b[0],b[1]]}var bL=2147483647;function $5(e,t,n,r,a,s,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let o=t.length===0,l=a.length===0,h=i.length===0,c=[];o||c.push(t[0]),l||c.push(a[0]),h||c.push(i[0]);for(let x=1;x<c.length;++x)if(c[x]!==c[x-1])throw new Error("starts, limits, and deltas must have the same shape");let p=c.length===0?1:c[0],m=$.getArrayFromDType("int32",p+1);m[0]=0;for(let x=0;x<p;++x){let _=o?e[0]:e[x],I=l?r[0]:r[x],k=h?s[0]:s[x];if(k===0)throw new Error("Requires delta != 0");let E;if(k>0&&I<_||k<0&&I>_)E=0;else if(E=Math.ceil(Math.abs((I-_)/k)),E>bL)throw new Error(`Requires ((limit - start) / delta) <= ${bL}`);m[x+1]=m[x]+E}let g=m[p],b=$.getArrayFromDType(n,g),v=0;for(let x=0;x<p;++x){let _=m[x+1]-m[x],I=o?e[0]:e[x],k=h?s[0]:s[x];for(let E=0;E<_;++E)b[v++]=I,I+=k}return[m,b]}var wi=B.RowPartitionType,j0e=class YE{constructor(t,n,r,a,s,i,o,l,h,c){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=o,this.rowPartitionValues=l,this.rowPartitionValuesShapes=h,this.rowPartitionTypes=B.getRowPartitionTypesHelper(c),this.raggedRank=B.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===wi.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===wi.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){let n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case wi.VALUE_ROWIDS:return YE.getMaxWidthValueRowID(n);case wi.ROW_SPLITS:return YE.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${wi[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){let n=t.length;if(n===0||n===1)return 0;let r=0;for(let a=0;a<n-1;++a){let s=t[a+1]-t[a];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){let n=t.length;if(n===0)return 0;let r=0,a=t[0],s=0;for(let i=1;i<n;++i){let o=t[i];o!==a&&(a=o,s=Math.max(i-r,s),r=i)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return xL(t,r)}calculateOutputSize(t){let n=this.valuesShape,r=this.defaultValueShape;B.validateDefaultValueShape(r,n);let a=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=B.combineRaggedTensorToTensorShapes(this.raggedRank,a,n);s[0]<0&&(s[0]=t);for(let i=1;i<=this.raggedRank;++i)s[i]<0&&(s[i]=this.getMaxWidth(i));return s}calculateFirstParentOutputIndex(t,n,r){let a=Math.min(t,r),s=[],i=0;for(let o=0;o<a;++o,i+=n)s.push(i);for(let o=a;o<t;++o)s.push(-1);return $.assert(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,a){let s=t.length,i=[];for(let o=0;o<s-1;++o){let l=t[o+1]-t[o],h=Math.min(a,l),c=n[o];c===-1&&(h=0);for(let p=0;p<h;++p)i.push(c),c+=r;for(let p=0;p<l-h;++p)i.push(-1)}if(s>0&&i.length!==t[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,n,r,a){let s=t.length,i=[];if(s===0)return[];let o=0,l=t[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let h=n[l];i.push(h);for(let c=1;c<s;++c){let p=t[c];if(p===l)h>=0&&(++o,o<a?h+=r:h=-1);else{if(o=0,l=p,p>=n.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${n.length}`);h=n[p]}i.push(h)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,n,r,a){let s=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case wi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,a);case wi.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,a);default:throw new Error(`Unsupported partition type: ${wi[i]}`)}}getFirstDimensionSize(){let t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let n=this.rowPartitionTypes[0];switch(n){case wi.FIRST_DIM_SIZE:return t[0];case wi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case wi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${wi[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let i=r.length-2;i>=0;--i)r[i]=r[i+1]*n[i+1];let a=xL(n,!1),s=$.getArrayFromDType(this.valuesDType,$.sizeFromShape(a));if(r[0]*n[0]>0){let i=this.calculateFirstParentOutputIndex(t,r[0],n[0]);for(let o=1;o<=this.raggedRank;++o)i=this.calculateOutputIndex(o-1,i,r[o],n[o]);this.setOutput(this.raggedRank,i,s,a)}return[a,s]}setOutput(t,n,r,a){if(r.length===0)return;let s=this.values,i=r,o=a.slice();o=o.slice(t+1);let l=$.sizeFromShape(o),h=n.length,c=this.defaultValue;if(c.length!==l&&c.length!==1){let b=this.defaultValueShape;oe(()=>{let v=ie(c,b);c=Wh(v,o).dataSync()})}let p=0,m=0,g=0;for(let b=0;b<=h;++b){let v=b<h?n[b]:-1;if(v===g){++g;continue}if(m<g){let x=s.subarray(p*l),_=i.subarray(m*l),I=(g-m)*l;vL(_,x,I)}if(b>=h){let x=r.length;v=Math.floor(x/l)}if(v>g)if(this.defaultValue.length===1)i.subarray(g*l,v*l).fill(this.defaultValue[0]),g=v;else for(;v>g;){let x=i.slice(g*l);vL(x,c,l),++g}v<0?(p=b+1,m=g):(p=b,m=g,g=m+1)}}};function vL(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function xL(e,t){let n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function O5(e,t,n,r,a,s,i,o,l,h){return new j0e(e,t,n,r,a,s,i,o,l,h).compute()}function XR(e,t,n,r){let a=e===t,s=e<t&&n<0,i=t<e&&n>1;if(a||s||i)return $.makeZerosTypedArray(0,r);let o=Math.abs(Math.ceil((t-e)/n)),l=$.makeZerosTypedArray(o,r);t<e&&n===1&&(n=-1),l[0]=e;for(let h=1;h<l.length;h++)l[h]=l[h-1]+n;return l}var F5=tl(e=>1/Math.sqrt(e)),H0e=Kc(Ap,F5),G0e={kernelName:Ap,backendName:"cpu",kernelFunc:H0e};function zh(e,t,n,r,a,s,i,o,l,h){let c=[r/a,a],p=e.values,m=t.values;if(r===0)return At(n,t.dtype);let g=l instanceof Er?l:At(c,t.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let b=0;b<s;b++){let v=[],x=0;for(let _=0;_<i;_++){let I=p[b*i+_];v.push(I),x+=I*o[_]}if(x<0||x>=r/a)throw new Error(`Invalid indices: ${v} does not index into ${n}`);for(let _=0;_<a;_++)h?g.values[x*a+_]+=m[b*a+_]:g.values[x*a+_]=t.rank===0?m[0]:m[b*a+_]}return g}var q0e=tl(e=>1/(1+Math.exp(-e))),P5=yn(Op,e=>1/(1+Math.exp(-e))),K0e={kernelName:Op,backendName:"cpu",kernelFunc:P5};function C_(e,t,n,r,a){let s=jr.isSliceContinous(r,t,n),i=$.sizeFromShape(n),o=$.computeStrides(r);if(s){let p=jr.computeFlatOffset(t,o);return a==="string"?e.slice(p,p+i):e.subarray(p,p+i)}let l=a==="string"?B.fromUint8ToStringArray(e):e,h=At(r,a,l),c=At(n,a);for(let p=0;p<c.size;++p){let m=c.indexToLoc(p),g=m.map((b,v)=>b+t[v]);c.set(h.get(...g),...m)}return a==="string"?B.fromStringArrayToUint8(c.values):c.values}function md(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:i}=r;et(a,"slice");let[o,l]=jr.parseSliceParams(a,s,i);jr.assertParamsValid(a,o,l);let h=n.data.get(a.dataId).values,c=C_(h,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,c)}var X0e={kernelName:Mg,backendName:"cpu",kernelFunc:md};function L5(e,t,n,r,a,s,i){let o=t[0],l=s[0],h=new Array(l),c=new Array(o),p=t[1];if(l===0){if(o!==0)throw new Error(B.getSparseFillEmptyRowsIndicesDenseShapeMismatch(o));let x=$.getArrayFromDType(n,0),_=$.getArrayFromDType(a,0);return[x,[0,p],_,h,c]}let m=!0,g=0,b=new Array(l).fill(0);for(let x=0;x<o;++x){let _=e[x*p];if(_<0)throw new Error(B.getSparseFillEmptyRowsNegativeIndexErrorMessage(x,_));if(_>=l)throw new Error(B.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(x,_,l));++b[_],m=m&&_>=g,g=_}let v=!0;for(let x=0;x<l;++x){let _=b[x]===0;h[x]=_,v=v&&!_,b[x]=Math.max(b[x],1),x>0&&(b[x]+=b[x-1])}if(v&&m){let x=e,_=r;for(let I=0;I<o;++I)c[I]=I;return[x,[o,p],_,h,c]}else{let x=b[l-1],_=$.getArrayFromDType(n,x*p),I=$.getArrayFromDType(a,x),k=new Array(l).fill(0);for(let E=0;E<o;++E){let R=e[E*p],U=k[R],D=(R===0?0:b[R-1])+U;k[R]++;for(let C=0;C<p;++C)_[D*p+C]=e[E*p+C];I[D]=r[E],c[E]=D}for(let E=0;E<l;++E)if(k[E]===0){let R=E===0?0:b[E-1];_[R*p+0]=E;for(let U=1;U<p;++U)_[R*p+U]=0;I[R]=i}return[_,[x,p],I,h,c]}}function z5(e,t,n,r,a){let s=$.sizeFromShape(r),i=t[0],o=a.length,l=[],h=1,c=-1;for(let v=0;v<o;++v){let x=a[v];if(x===-1){if(c!==-1)throw new Error(B.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,v));c=v,l.push(1)}else{if(x<0)throw new Error(B.getSparseReshapeNegativeOutputDimErrorMessage(v,x));h*=x,l.push(x)}}if(c!==-1){if(h<=0)throw new Error(B.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let v=Math.trunc(s/h);if(h*v!==s)throw new Error(B.getSparseReshapeInputOutputMultipleErrorMessage(r,l));l[c]=v}if($.sizeFromShape(l)!==s)throw new Error(B.getSparseReshapeInputOutputMismatchErrorMessage(r,l));let p=r.length,m=[];if(p>0){m[p-1]=1;for(let v=p-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}let g=[];if(o>0){g[o-1]=1;for(let v=o-2;v>=0;--v)g[v]=g[v+1]*l[v+1]}let b=$.getArrayFromDType(n,i*o);for(let v=0;v<i;++v){let x=0;for(let _=0;_<p;++_)x+=e[v*p+_]*m[_];for(let _=0;_<o;++_)b[v*o+_]=Math.trunc(x/g[_]),x%=g[_]}return[b,[i,o],l]}function YR(e,t,n,r,a,s=!1,i=0){let o=r.length,l=[t[0],e.length/t[0]],h=l[1],c=o>0?a[o-1]+1:0;if(c<0)throw new Error(B.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let p=t.slice();p[0]=c;let m=p.reduce((I,k)=>I*k,1),g=$.getArrayFromDType(n,m);if(o===0)return c>0&&g.fill(i),[g,p];if(c<=0)throw new Error(B.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let b=0,v=1,x=0,_=a[b];for(;;){let I=0;if(v<o){if(I=a[v],_===I){++v;continue}if(_>=I)throw new Error(B.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(_<0||_>=c)throw new Error(B.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(_,c));_>x&&g.fill(i,x*h,_*h);for(let k=b;k<v;++k){let E=r[k];if(E<0||E>=l[0])throw new Error(B.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(k,r[k],l[0]));for(let R=0;R<h;R++)g[_*h+R]+=e[E*h+R]}if(s)for(let k=0;k<h;k++)g[_*h+k]/=v-b;if(b=v,++v,x=_+1,_=I,v>o)break}return x<c&&g.fill(i,x*h,c*h),[g,p]}var Y0e=tl(e=>Math.sqrt(e)),Q0e=yn(Pp,e=>Math.sqrt(e)),Z0e={kernelName:Pp,backendName:"cpu",kernelFunc:Q0e},V5=br((e,t)=>{let n=e-t;return n*n}),J0e=qr(Vp,V5),e_e={kernelName:Vp,backendName:"cpu",kernelFunc:J0e},U5=tl((e,t)=>{let{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)}),t_e=Kc(Hv,U5),n_e={kernelName:Hv,backendName:"cpu",kernelFunc:t_e};function B5(e,t,n,r){let a=At(e,t.dtype);for(let s=0;s<a.size;s++){let i=a.indexToLoc(s),o=new Array(i.length);for(let l=0;l<o.length;l++)o[l]=i[l]*n[l]+r[l];a.set(t.get(...o),...i)}return a}var r_e=class{constructor(e,t,n,r,a,s){this.separator=$.encodeString(e),this.nGramWidths=t,this.leftPad=$.encodeString(n),this.rightPad=$.encodeString(r),this.padWidth=a,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){let n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,s){for(let i=0;i<a;++i){let o=this.getPadWidth(s),l=Math.max(0,o-i),h=Math.max(0,o-(a-(i+1))),c=s-(l+h),p=t+(l>0?0:i-o),m=0;m+=l*this.leftPad.length;for(let _=0;_<c;++_)m+=e[p+_].length;m+=h*this.rightPad.length;let g=l+h+c-1;m+=g*this.separator.length,n[r+i]=new Uint8Array(m);let b=n[r+i],v=0,x=_=>_.forEach(I=>b[v++]=I);for(let _=0;_<l;++_)x(this.leftPad),x(this.separator);for(let _=0;_<c-1;++_)x(e[p+_]),x(this.separator);if(c>0){x(e[p+c-1]);for(let _=0;_<h;++_)x(this.separator),x(this.rightPad)}else{for(let _=0;_<h-1;++_)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,t){let n=e.length,r=t.length;if(r>0){let o=t[0];if(o!==0)throw new Error(`First split value must be 0, got ${o}`);for(let l=1;l<r;++l){let h=t[l]>=o;if(h=h&&t[l]<=n,!h)throw new Error(`Invalid split value ${t[l]}, must be in [${o}, ${n}]`);o=t[l]}if(o!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${o}`)}let a=r-1,s=$.getArrayFromDType("int32",r);if(n===0||r===0){let o=new Array(n);for(let l=0;l<=a;++l)s[l]=0;return[o,s]}s[0]=0;for(let o=1;o<=a;++o){let l=t[o]-t[o-1],h=0;this.nGramWidths.forEach(c=>{h+=this.getNumNGrams(l,c)}),this.preserveShort&&l>0&&h===0&&(h=1),s[o]=s[o-1]+h}let i=new Array(s[a]);for(let o=0;o<a;++o){let l=t[o],h=s[o];if(this.nGramWidths.forEach(c=>{let p=t[o+1]-t[o],m=this.getNumNGrams(p,c);this.createNGrams(e,l,i,h,m,c),h+=m}),this.preserveShort&&h===s[o]){let c=t[o+1]-t[o];if(c===0)continue;let p=c+2*this.padWidth;this.createNGrams(e,l,i,h,1,p)}}return[i,s]}};function QR(e,t,n,r,a,s,i,o){return new r_e(n,r,a,s,i,o).compute(e,t)}function a_e(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){let s=t[0],i=e.indexOf(s);for(;i!==-1;){let o=e.subarray(0,i);(!n||o.length!==0)&&r.push(o),e=e.subarray(i+1),i=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let a=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){let i=e.subarray(a,s);(!n||i.length!==0)&&r.push(i),a=s+1}}function ZR(e,t,n){let r=e.length,a=[],s=0,i=0,o=new Array(r);for(let m=0;m<r;++m){let g=a.length;a_e(e[m],t,n,a);let b=a.length-g;o[m]=b,s+=b,i=Math.max(i,b)}let l=$.getArrayFromDType("int32",s*2),h=new Array(s),c=[r,i],p=0;for(let m=0;m<r;++m)for(let g=0;g<o[m];++g)l[p*2]=m,l[p*2+1]=g,h[p]=a[p],++p;return[l,h,c]}function JR(e,t){let n=$.getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=$.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var W5=br((e,t)=>e-t),s_e=jR((e,t,n,r)=>({real:e-n,imag:t-r})),eD=qr(Up,W5,s_e),i_e={kernelName:Up,backendName:"cpu",kernelFunc:eD};function j5(e,t){let n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];let r=At(n,e.dtype);for(let a=0;a<r.values.length;++a){let s=r.indexToLoc(a),i=new Array(e.rank);for(let l=0;l<i.length;l++)i[l]=s[l]%e.shape[l];let o=e.locToIndex(i);r.values[a]=e.values[o]}return r}var gb=(e,t)=>{let n=t.value-e.value;return n===0?e.index-t.index:n};function H5(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){let o=r-n+1,l=t-n+1,h=Math.log(o),c=.5*Math.exp(2*h/3),p=.5*Math.sqrt(h*c*(o-c)/o)*Math.sign(l-o/2),m=Math.max(n,Math.floor(t-l*c/o+p)),g=Math.min(r,Math.floor(t+(o-l)*c/o+p));H5(e,t,m,g)}let a=e[t],s=n,i=r;for($.swap(e,n,t),gb(e[r],a)>0&&$.swap(e,n,r);s<i;){for($.swap(e,s,i),s++,i--;gb(e[s],a)<0;)s=s+1;for(;gb(e[i],a)>0;)i=i-1}gb(e[n],a)===0?$.swap(e,n,i):(i=i+1,$.swap(e,i,r)),i<=t&&(n=i+1),t<=i&&(r=i-1)}}function G5(e,t,n,r,a){let s=t[t.length-1],[i,o]=[e.length/s,s],l=$.getTypedArrayFromDType(n,i*r),h=$.getTypedArrayFromDType("int32",i*r);for(let p=0;p<i;p++){let m=p*o,g=e.subarray(m,m+o),b=new Array(g.length);g.forEach((I,k)=>b[k]={value:I,index:k}),r<b.length&&(H5(b,r),b=b.slice(0,r)),a&&b.sort(gb);let v=p*r,x=l.subarray(v,v+r),_=h.subarray(v,v+r);for(let I=0;I<r;I++)x[I]=b[I].value,_[I]=b[I].index}let c=t.slice();return c[c.length-1]=r,[At(c,n,l),At(c,"int32",h)]}function tD(e,t,n,r){let a=$.parseAxisParam(t,n)[0],s=[1,n[0],1];for(let b=0;b<a;b++)s[0]*=n[b];s[1]=n[a];for(let b=a+1;b<n.length;b++)s[2]*=n[b];let i=new Map,o=new Int32Array(n[a]),l=new Er(s,r,e),h=[],c=s[0]===1&&s[2]===1;for(let b=0;b<n[a];b++){let v;if(c)v=e[b].toString();else{let _=[];for(let I=0;I<s[0];I++)for(let k=0;k<s[2];k++)_.push(l.get(I,b,k));v=_.join(",")}let x=i.get(v);if(x!=null)o[b]=x;else{let _=i.size;i.set(v,_),o[b]=_,h.push(b)}}let p=s.slice();p[1]=i.size;let m=new Er(p,r);h.forEach((b,v)=>{for(let x=0;x<s[0];x++)for(let _=0;_<s[2];_++)m.set(l.get(x,b,_),x,v,_)});let g=n.slice();return g[a]=p[1],{outputValues:m.values,outputShape:g,indices:o}}var o_e="4.22.0";F1("cpu",()=>new BR,1);var q5=yn(qd,e=>e>=0?e:Math.exp(e)-1),l_e={kernelName:qd,backendName:"cpu",kernelFunc:q5};function K5(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r;et([a],"leakyRelu");let i=$.sizeFromShape(a.shape),o=n.data.get(a.dataId).values,l=$.getTypedArrayFromDType("float32",i);for(let h=0;h<o.length;h++)l[h]=o[h]<0?s*o[h]:o[h];return n.makeTensorInfo(a.shape,"float32",l)}var u_e={kernelName:sp,backendName:"cpu",kernelFunc:K5},c_e=br((e,t)=>e<0?t*e:e);function X5(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t;et([r,a],"prelu");let s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,[o,l]=c_e(r.shape,a.shape,s,i,"float32");return n.makeTensorInfo(l,"float32",o)}var h_e={kernelName:wp,backendName:"cpu",kernelFunc:X5},Y5=yn(Ip,e=>Math.max(0,e)),d_e={kernelName:Ip,backendName:"cpu",kernelFunc:Y5},Q5=yn(Ep,e=>Math.min(Math.max(0,e),6)),p_e={kernelName:Ep,backendName:"cpu",kernelFunc:Q5};function A_(e,t,n,r,a){if(n==="linear")return Xo({inputs:{x:t},backend:e});if(n==="relu")return Y5({inputs:{x:t},backend:e});if(n==="elu")return q5({inputs:{x:t},backend:e});if(n==="relu6")return Q5({inputs:{x:t},backend:e});if(n==="prelu")return X5({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return K5({inputs:{x:t},backend:e,attrs:{alpha:a}});if(n==="sigmoid")return P5({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function $n(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,i=$.sizeFromShape(a.shape),o=$.inferFromImplicitShape(s,i),l=$.sizeFromShape(o);$.assert(i===l,()=>`The new shape (${o}) has ${l} elements and the old shape (${a.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(a.dataId);let h=n.data.get(a.dataId);if(h.complexTensorInfos!=null){let c=h.complexTensorInfos.real,p=h.complexTensorInfos.imag;c.shape=o,p.shape=o}return{dataId:a.dataId,shape:o,dtype:a.dtype}}var f_e={kernelName:kg,backendName:"cpu",kernelFunc:$n};function Z5(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:o}=r;et([a,s],"matMul");let l=a.shape.length,h=s.shape.length,c=i?a.shape[l-2]:a.shape[l-1],p=o?s.shape[h-1]:s.shape[h-2],m=i?a.shape[l-1]:a.shape[l-2],g=o?s.shape[h-2]:s.shape[h-1],b=a.shape.slice(0,-2),v=s.shape.slice(0,-2),x=$.sizeFromShape(b),_=$.sizeFromShape(v),I=jg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([m,g]);$.assert(c===p,()=>`Error in matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${i} and transposeB=${o} must match.`);let k=i?[x,c,m]:[x,m,c],E=o?[_,g,p]:[_,p,g],R=$n({inputs:{x:a},backend:n,attrs:{shape:k}}),U=$n({inputs:{x:s},backend:n,attrs:{shape:E}}),D=i?R.shape[1]:R.shape[2],C=i?R.shape[2]:R.shape[1],O=o?U.shape[1]:U.shape[2],z=Math.max(x,_),M=n.data.get(R.dataId).values,N=n.data.get(U.dataId).values,P=$.computeStrides(R.shape),Q=$.computeStrides(U.shape),[ee,q,Z]=i?[P[0],1,P[1]]:[P[0],P[1],1],[ne,me,xe]=o?[1,Q[1],Q[0]]:[Q[1],1,Q[0]],H=C*O,se=At([z,C,O],R.dtype),ue=se.values,ge=n.blockSize;for(let Ee=0;Ee<z;Ee++){let $e=Ee%x,Oe=Ee%_;for(let Fe=0;Fe<C;Fe+=ge){let We=Math.min(Fe+ge,C);for(let at=0;at<O;at+=ge){let pt=Math.min(at+ge,O);for(let bt=0;bt<D;bt+=ge){let Bt=Math.min(bt+ge,D);for(let vt=Fe;vt<We;vt++)for(let Mt=at;Mt<pt;Mt++){let ut=0;for(let Lt=bt;Lt<Bt;Lt++){let nn=M[$e*ee+vt*q+Lt*Z],Xt=N[Lt*ne+Mt*me+Oe*xe];ut+=nn*Xt}ue[Ee*H+(vt*O+Mt)]+=ut}}}}}return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(U),n.makeTensorInfo(I,se.dtype,se.values)}var m_e={kernelName:Od,backendName:"cpu",kernelFunc:Z5};function g_e(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:o}=t,{transposeA:l,transposeB:h,activation:c,leakyreluAlpha:p}=r,m,g,b,v=[];m=Z5({inputs:{a,b:s},attrs:{transposeA:l,transposeB:h},backend:n}),i&&(g=Em({inputs:{a:m,b:i},backend:n}),v.push(m),m=g),c&&(b=A_(n,m,c,o,p),v.push(m),m=b);for(let x of v)n.disposeIntermediateTensorInfo(x);return m}var y_e={kernelName:td,backendName:"cpu",kernelFunc:g_e},b_e=yn(kd,e=>Math.acos(e)),v_e={kernelName:kd,backendName:"cpu",kernelFunc:b_e},x_e=yn(Ed,e=>Math.acosh(e)),w_e={kernelName:Ed,backendName:"cpu",kernelFunc:x_e};function __e(e){let{inputs:t,backend:n}=e,r=t;et(t,"addN");let a=r.map(o=>n.data.get(o.dataId).values),s=At(r[0].shape,r[0].dtype),i=s.values;for(let o=0;o<r.length;o++){let l=a[o];for(let h=0;h<i.length;h++)i[h]+=l[h]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}var S_e={kernelName:Nd,backendName:"cpu",kernelFunc:__e};function I_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;et(a,"all");let o=$.parseAxisParam(s,a.shape),l=o,h=B.getAxesPermutation(l,a.shape.length),c=a;h!=null&&(c=cs({inputs:{x:a},backend:n,attrs:{perm:h}}),l=B.getInnerMostAxes(l.length,a.shape.length)),B.assertAxesAreInnerMostDims("all",l,c.shape.length);let[p,m]=B.computeOutAndReduceShapes(c.shape,l),g=$.sizeFromShape(m),b=$.makeZerosTypedArray($.sizeFromShape(p),c.dtype),v=n.data.get(c.dataId).values;for(let _=0;_<b.length;++_){let I=_*g,k=v[I];for(let E=0;E<g;++E){let R=v[I+E];k=k&&R}b[_]=k}h!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(p,c.dtype,b);if(i){let _=B.expandShapeToKeepDim(p,o),I=$n({inputs:{x},backend:n,attrs:{shape:_}});return n.disposeIntermediateTensorInfo(x),I}return x}var T_e={kernelName:Wm,backendName:"cpu",kernelFunc:I_e};function k_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;et(a,"any");let o=$.parseAxisParam(s,a.shape),l=o,h=B.getAxesPermutation(l,a.shape.length),c=a;h!=null&&(c=cs({inputs:{x:a},backend:n,attrs:{perm:h}}),l=B.getInnerMostAxes(l.length,a.shape.length)),B.assertAxesAreInnerMostDims("any",l,c.shape.length);let[p,m]=B.computeOutAndReduceShapes(c.shape,l),g=$.sizeFromShape(m),b=$.makeZerosTypedArray($.sizeFromShape(p),c.dtype),v=n.data.get(c.dataId).values;for(let _=0;_<b.length;++_){let I=_*g,k=v[I];for(let E=0;E<g;++E){let R=v[I+E];k=k||R}b[_]=k}h!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(p,c.dtype,b);if(i){let _=B.expandShapeToKeepDim(p,o),I=$n({inputs:{x},backend:n,attrs:{shape:_}});return n.disposeIntermediateTensorInfo(x),I}return x}var E_e={kernelName:jm,backendName:"cpu",kernelFunc:k_e};function N_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;et(a,"argMax");let i=$.parseAxisParam(s,a.shape),o=B.getAxesPermutation(i,a.shape.length),l=a,h=[];o!=null&&(l=cs({inputs:{x:a},backend:n,attrs:{perm:o}}),h.push(l),i=B.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],B.assertAxesAreInnerMostDims("argMax",i,l.shape.length);let[c,p]=B.computeOutAndReduceShapes(l.shape,i),m=$.sizeFromShape(c),g=$.makeZerosTypedArray(m,"int32"),b=$.sizeFromShape(p),v=n.data.get(l.dataId).values;for(let x=0;x<g.length;++x){let _=x*b,I=v[_],k=0;for(let E=0;E<b;++E){let R=v[_+E];R>I&&(I=R,k=E)}g[x]=k}return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",g)}var C_e={kernelName:Hm,backendName:"cpu",kernelFunc:N_e};function A_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;et(a,"argMin");let i=$.parseAxisParam(s,a.shape),o=B.getAxesPermutation(i,a.shape.length),l=a,h=[];o!=null&&(l=cs({inputs:{x:a},backend:n,attrs:{perm:o}}),h.push(l),i=B.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],B.assertAxesAreInnerMostDims("argMin",i,l.shape.length);let[c,p]=B.computeOutAndReduceShapes(l.shape,i),m=$.sizeFromShape(c),g=$.makeZerosTypedArray(m,"int32"),b=$.sizeFromShape(p),v=n.data.get(l.dataId).values;for(let x=0;x<g.length;++x){let _=x*b,I=v[_],k=0;for(let E=0;E<b;++E){let R=v[_+E];R<I&&(I=R,k=E)}g[x]=k}return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",g)}var R_e={kernelName:Gm,backendName:"cpu",kernelFunc:A_e},D_e=yn(Cd,e=>Math.asin(e)),M_e={kernelName:Cd,backendName:"cpu",kernelFunc:D_e},$_e=yn(Ad,e=>Math.asinh(e)),O_e={kernelName:Ad,backendName:"cpu",kernelFunc:$_e},F_e=yn(Rd,e=>Math.atan(e)),P_e={kernelName:Rd,backendName:"cpu",kernelFunc:F_e},L_e=br((e,t)=>Math.atan2(e,t)),z_e=qr(Md,L_e),V_e={kernelName:Md,backendName:"cpu",kernelFunc:z_e},U_e=yn(Dd,e=>Math.atanh(e)),B_e={kernelName:Dd,backendName:"cpu",kernelFunc:U_e};function nD(e,t,n,r,a,s){let i=a.strideHeight,o=a.strideWidth,l=a.dilationHeight,h=a.dilationWidth,c=a.effectiveFilterHeight,p=a.effectiveFilterWidth,m=a.padInfo.top,g=a.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=At(a.outShape,n),x=v.values,_=a.outShape[1]*a.outShape[2]*a.outShape[3],I=a.outShape[2]*a.outShape[3],k=a.outShape[3];for(let E=0;E<a.batchSize;++E){let R=E*_,U=E*r[0];for(let D=0;D<a.inChannels;++D)for(let C=0;C<a.outHeight;++C){let O=C*i-m,z=Math.max(0,O),M=Math.min(a.inHeight,c+O),N=R+C*I;for(let P=0;P<a.outWidth;++P){let Q=P*o-g,ee=Math.max(0,Q),q=Math.min(a.inWidth,p+Q),Z=b,ne=0,me=0;for(let H=z;H<M;H+=l){let se=U+H*r[1];for(let ue=ee;ue<q;ue+=h){let ge=se+ue*r[2],Ee=e[ge+D];s==="max"&&Ee>Z?Z=Ee:s==="avg"&&(ne+=Ee,me++)}if(isNaN(Z))break}let xe=N+P*k+D;x[xe]=s==="avg"?ne/me:Z}}}return v}function J5(e,t,n,r,a=!1,s=!1){let i=At(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,h=r.dilationHeight,c=r.dilationWidth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.top,b=r.padInfo.left,v=At(t,n,e);for(let x=0;x<r.batchSize;++x)for(let _=0;_<r.inChannels;++_)for(let I=0;I<r.outHeight;++I){let k=I*o-g,E=k;for(;E<0;)E+=h;let R=Math.min(r.inHeight,p+k);for(let U=0;U<r.outWidth;++U){let D=U*l-b,C=D;for(;C<0;)C+=c;let O=Math.min(r.inWidth,m+D),z=Number.NEGATIVE_INFINITY,M=-1;for(let N=E;N<R;N+=h){let P=N-k;for(let Q=C;Q<O;Q+=c){let ee=Q-D,q=v.get(x,N,Q,_);q>z&&(z=q,a?M=s?((x*r.inHeight+N)*r.inWidth+Q)*r.inChannels+_:(N*r.inWidth+Q)*r.inChannels+_:M=P*m+ee)}}i.set(M,x,I,U,_)}}return i}function eH(e,t,n,r,a,s){let i=a.strideDepth,o=a.strideHeight,l=a.strideWidth,h=a.dilationDepth,c=a.dilationHeight,p=a.dilationWidth,m=a.effectiveFilterDepth,g=a.effectiveFilterHeight,b=a.effectiveFilterWidth,v=a.padInfo.front,x=a.padInfo.top,_=a.padInfo.left,I=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,k=At(a.outShape,n),E=k.values,R=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],U=a.outShape[2]*a.outShape[3]*a.outShape[4],D=a.outShape[3]*a.outShape[4],C=a.outShape[4];for(let O=0;O<a.batchSize;++O){let z=O*R,M=O*r[0];for(let N=0;N<a.inChannels;++N)for(let P=0;P<a.outDepth;++P){let Q=P*i-v,ee=Q;for(;ee<0;)ee+=h;let q=Math.min(a.inDepth,m+Q),Z=z+P*U;for(let ne=0;ne<a.outHeight;++ne){let me=ne*o-x,xe=me;for(;xe<0;)xe+=c;let H=Math.min(a.inHeight,g+me),se=Z+ne*D;for(let ue=0;ue<a.outWidth;++ue){let ge=ue*l-_,Ee=ge;for(;Ee<0;)Ee+=p;let $e=Math.min(a.inWidth,b+ge),Oe=se+ue*C,Fe=I,We=0,at=0;for(let bt=ee;bt<q;bt+=h){let Bt=M+bt*r[1];for(let vt=xe;vt<H;vt+=c){let Mt=Bt+vt*r[2];for(let ut=Ee;ut<$e;ut+=p){let Lt=Mt+ut*r[3],nn=e[Lt+N];if(s==="max"&&nn>Fe?Fe=nn:s==="avg"&&(We+=nn,at++),isNaN(Fe))break}if(isNaN(Fe))break}if(isNaN(Fe))break}let pt=Oe+N;E[pt]=s==="avg"?We/Math.max(at,1):Fe}}}}return k}function W_e(e,t){let n=At(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,s=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,c=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,b=t.padInfo.left;for(let v=0;v<t.batchSize;++v)for(let x=0;x<t.inChannels;++x)for(let _=0;_<t.outDepth;++_){let I=_*r-m,k=I;for(;k<0;)k+=i;let E=Math.min(t.inDepth,h+I);for(let R=0;R<t.outHeight;++R){let U=R*a-g,D=U;for(;D<0;)D+=o;let C=Math.min(t.inHeight,c+U);for(let O=0;O<t.outWidth;++O){let z=O*s-b,M=z;for(;M<0;)M+=l;let N=Math.min(t.inWidth,p+z),P=Number.NEGATIVE_INFINITY,Q=-1;for(let ee=k;ee<E;ee+=i){let q=ee-I;for(let Z=D;Z<C;Z+=o){let ne=Z-U;for(let me=M;me<N;me+=l){let xe=me-z,H=e.get(v,ee,Z,me,x);H>=P&&(P=H,Q=q*c*p+ne*c+xe)}}}n.set(Q,v,_,R,O,x)}}}return n}function j_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;et(a,"avgPool");let{filterSize:s,strides:i,pad:o,dimRoundingMode:l}=r,h=1;$.assert(B.eitherStridesOrDilationsAreOne(i,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let c=B.computePool2DInfo(a.shape,s,i,h,o,l),p;if(c.filterWidth===1&&c.filterHeight===1&&$.arraysEqual(c.inShape,c.outShape))p=Xo({inputs:{x:a},backend:n});else{let m=n.data.get(a.dataId).values,g=$.computeStrides(a.shape),b=nD(m,a.shape,a.dtype,g,c,"avg");p=n.makeTensorInfo(c.outShape,a.dtype,b.values)}return p}var H_e={kernelName:$d,backendName:"cpu",kernelFunc:j_e};function G_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l,dataFormat:h}=r;et(a,"avgPool3d");let c=B.computePool3DInfo(a.shape,s,i,1,o,l,h),p=n.data.get(a.dataId).values,m=eH(p,a.shape,a.dtype,$.computeStrides(a.shape),c,"avg");return n.makeTensorInfo(m.shape,"float32",m.values)}var q_e={kernelName:qm,backendName:"cpu",kernelFunc:G_e};function K_e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=r;et([a,s],"avgPool3DGrad");let c=B.computePool3DInfo(s.shape,i,o,1,l,h),p=c.strideDepth,m=c.strideHeight,g=c.strideWidth,b=c.filterDepth,v=c.filterHeight,x=c.filterWidth,_=c.dilationDepth,I=c.dilationHeight,k=c.dilationWidth,E=c.effectiveFilterDepth,R=c.effectiveFilterHeight,U=c.effectiveFilterWidth,D=E-1-c.padInfo.front,C=U-1-c.padInfo.left,O=R-1-c.padInfo.top,z=At(s.shape,"float32"),M=1/(b*v*x),N=n.bufferSync(a);for(let P=0;P<c.batchSize;++P)for(let Q=0;Q<c.inChannels;++Q)for(let ee=0;ee<c.inDepth;++ee)for(let q=0;q<c.inHeight;++q)for(let Z=0;Z<c.inWidth;++Z){let ne=ee-D,me=q-O,xe=Z-C,H=0;for(let se=0;se<E;se+=_){let ue=(ne+se)/p;if(!(ue<0||ue>=c.outDepth||Math.floor(ue)!==ue))for(let ge=0;ge<R;ge+=I){let Ee=(me+ge)/m;if(!(Ee<0||Ee>=c.outHeight||Math.floor(Ee)!==Ee))for(let $e=0;$e<U;$e+=k){let Oe=(xe+$e)/g;if(Oe<0||Oe>=c.outWidth||Math.floor(Oe)!==Oe)continue;let Fe=N.get(P,ue,Ee,Oe,Q);H+=Fe}}}z.set(H*M,P,ee,q,Z,Q)}return n.makeTensorInfo(z.shape,z.dtype,z.values)}var X_e={kernelName:Rv,backendName:"cpu",kernelFunc:K_e};function Y_e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s;et([a,s],"avgPoolGrad");let{filterSize:o,strides:l,pad:h}=r,c=B.computePool2DInfo(i.shape,o,l,1,h),p=c.strideHeight,m=c.strideWidth,g=c.filterHeight,b=c.filterWidth,v=c.dilationHeight,x=c.dilationWidth,_=c.effectiveFilterHeight,I=c.effectiveFilterWidth,k=I-1-c.padInfo.left,E=_-1-c.padInfo.top,R=At(i.shape,"float32"),U=1/(g*b),D=n.data.get(a.dataId).values,C=At(a.shape,"float32",D);for(let O=0;O<c.batchSize;++O)for(let z=0;z<c.inChannels;++z)for(let M=0;M<c.inHeight;++M)for(let N=0;N<c.inWidth;++N){let P=M-E,Q=N-k,ee=0;for(let q=0;q<_;q+=v){let Z=(P+q)/p;if(!(Z<0||Z>=c.outHeight||Math.floor(Z)!==Z))for(let ne=0;ne<I;ne+=x){let me=(Q+ne)/m;if(me<0||me>=c.outWidth||Math.floor(me)!==me)continue;let xe=C.get(O,Z,me,z);ee+=xe}}R.set(ee*U,O,M,N,z)}return n.makeTensorInfo(R.shape,R.dtype,R.values)}var Q_e={kernelName:Av,backendName:"cpu",kernelFunc:Y_e};function Z_e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,scale:s,offset:i,mean:o,variance:l}=t;$.assert(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),$.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),$.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),et([a,o,l,s,i],"batchNorm");let{varianceEpsilon:h}=r;h==null&&(h=.001);let c=n.data.get(a.dataId).values,p=n.data.get(o.dataId).values,m=n.data.get(l.dataId).values,g=s?n.data.get(s.dataId).values:new Float32Array([1]),b=i?n.data.get(i.dataId).values:new Float32Array([0]),v=new Float32Array(c.length),x=b.length,_=g.length,I=m.length,k=p.length,E=0,R=0,U=0,D=0;for(let C=0;C<c.length;++C)v[C]=b[E++]+(c[C]-p[R++])*g[U++]/Math.sqrt(m[D++]+h),E>=x&&(E=0),R>=k&&(R=0),U>=_&&(U=0),D>=I&&(D=0);return n.makeTensorInfo(a.shape,a.dtype,v)}var J_e={kernelName:Jd,backendName:"cpu",kernelFunc:Z_e};function e1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r;et([a],"batchToSpaceND");let o=s.reduce((_,I)=>_*I),l=B.getReshaped(a.shape,s,o),h=B.getPermuted(l.length,s.length),c=B.getReshapedPermuted(a.shape,s,o),p=B.getSliceBeginCoords(i,s.length),m=B.getSliceSize(c,i,s.length),g=$n({inputs:{x:a},backend:n,attrs:{shape:l}}),b=cs({inputs:{x:g},backend:n,attrs:{perm:h}}),v=$n({inputs:{x:b},backend:n,attrs:{shape:c}}),x=md({inputs:{x:v},backend:n,attrs:{begin:p,size:m}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v),x}var t1e={kernelName:Km,backendName:"cpu",kernelFunc:e1e};function n1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i}=r,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values,h=HR(o,l,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,h)}var r1e={kernelName:Xm,backendName:"cpu",kernelFunc:n1e};function a1e(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,o=B.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}var s1e={kernelName:Dv,backendName:"cpu",kernelFunc:a1e},i1e=yn(Vc,(e,t)=>{let n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),o1e={kernelName:Vc,backendName:"cpu",kernelFunc:i1e},l1e=e=>{let{x:t}=e.inputs,n=e.backend,r=new Float32Array($.sizeFromShape(t.shape)),a=n.data.get(t.dataId),s=a.complexTensorInfos.real,i=a.complexTensorInfos.imag,o=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values;for(let h=0;h<o.length;h++){let c=o[h],p=l[h];r[h]=Math.hypot(c,p)}return n.makeOutput(r,t.shape,"float32")},u1e={kernelName:Mv,backendName:"cpu",kernelFunc:l1e};function Nm(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var c1e={kernelName:C1,backendName:"cpu",kernelFunc:Nm};function Cm(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=$.parseAxisParam(a,t[0].shape)[0],i=t.map(v=>v.shape);B.assertParamsConsistent(i,s);let o=B.computeOutShape(t.map(v=>v.shape),s);if($.sizeFromShape(o)===0)return n.makeTensorInfo(o,t[0].dtype,[]);let l=t.filter(v=>$.sizeFromShape(v.shape)>0);if(l.length===1)return Xo({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){let v=l.map(E=>fd({inputs:{input:E},backend:n})),x=l.map(E=>Nm({inputs:{input:E},backend:n})),_=Cm({inputs:v,backend:n,attrs:{axis:s}}),I=Cm({inputs:x,backend:n,attrs:{axis:s}}),k=As({inputs:{real:_,imag:I},backend:n});return v.forEach(E=>n.disposeIntermediateTensorInfo(E)),x.forEach(E=>n.disposeIntermediateTensorInfo(E)),n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(I),k}let h=l.map(v=>{let x=[-1,$.sizeFromShape(v.shape.slice(s))];return $n({inputs:{x:v},backend:n,attrs:{shape:x}})}),c=h.map(v=>({vals:n.data.get(v.dataId).values,shape:v.shape}));o=B.computeOutShape(h.map(v=>v.shape),1);let p=h[0].shape[0]===1,m=GR(c,o,t[0].dtype,p),g=B.computeOutShape(l.map(v=>v.shape),s),b=n.makeTensorInfo(g,t[0].dtype,m);return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),b}var h1e={kernelName:Qm,backendName:"cpu",kernelFunc:Cm};function tH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dataFormat:l,dilations:h,dimRoundingMode:c}=r;et([a,s],"conv2d");let p=B.convertConv2DDataFormat(l),m=B.computeConv2DInfo(a.shape,s.shape,i,h,o,c,!1,p),g=m.filterHeight,b=m.filterWidth,v=m.dilationHeight,x=m.dilationWidth,_=m.padInfo.left,I=m.padInfo.top,k=m.dataFormat==="channelsLast",E=new Er(m.outShape,a.dtype),R=$.computeStrides(a.shape),U=$.computeStrides(s.shape),D=R[0],C=k?R[1]:R[2],O=k?R[2]:1,z=k?1:R[1],M=E.strides[0],N=k?E.strides[1]:E.strides[2],P=k?E.strides[2]:1,Q=k?1:E.strides[1],ee=n.data.get(a.dataId).values,q=n.data.get(s.dataId).values,Z=E.values;for(let ne=0;ne<m.batchSize;++ne){let me=ne*D,xe=ne*M;for(let H=0;H<m.outHeight;++H){let se=xe+H*N,ue=H*m.strideHeight-I;for(let ge=0;ge<g;++ge){let Ee=ue+ge*v;if(Ee<0||Ee>=m.inHeight)continue;let $e=ge*U[0],Oe=me+Ee*C;for(let Fe=0;Fe<m.outWidth;++Fe){let We=se+Fe*P,at=Fe*m.strideWidth-_;for(let pt=0;pt<b;++pt){let bt=at+pt*x;if(bt<0||bt>=m.inWidth)continue;let Bt=$e+pt*U[1],vt=Oe+bt*O,Mt=Bt;for(let ut=0;ut<m.inChannels;++ut){let Lt=ee[vt+ut*z];for(let nn=0;nn<m.outChannels;++nn)Z[We+nn*Q]+=Lt*q[Mt+nn];Mt+=m.outChannels}}}}}}return n.makeTensorInfo(E.shape,E.dtype,Z)}var d1e={kernelName:Ld,backendName:"cpu",kernelFunc:tH};function p1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:o,dataFormat:l,dimRoundingMode:h,filterShape:c}=r;et([a,s],"conv2dBackpropFilter");let p=B.convertConv2DDataFormat(l),m=B.computeConv2DInfo(a.shape,c,i,1,o,h,!1,p),{strideHeight:g,strideWidth:b,filterHeight:v,filterWidth:x}=m,_=m.dataFormat==="channelsLast",I=new Er(m.filterShape,"float32"),k=m.padInfo.left,E=m.padInfo.top,R=n.data.get(a.dataId).values,U=n.data.get(s.dataId).values,D=new Er(a.shape,a.dtype,R),C=new Er(s.shape,s.dtype,U);for(let O=0;O<v;++O){let z=Math.max(0,Math.ceil((E-O)/g)),M=Math.min(m.outHeight,(m.inHeight+E-O)/g);for(let N=0;N<x;++N){let P=Math.max(0,Math.ceil((k-N)/b)),Q=Math.min(m.outWidth,(m.inWidth+k-N)/b);for(let ee=0;ee<m.inChannels;++ee)for(let q=0;q<m.outChannels;++q){let Z=0;for(let ne=0;ne<m.batchSize;++ne)for(let me=z;me<M;++me){let xe=O+me*g-E;for(let H=P;H<Q;++H){let se=N+H*b-k;_?Z+=D.get(ne,xe,se,ee)*C.get(ne,me,H,q):Z+=D.get(ne,ee,xe,se)*C.get(ne,q,me,H)}}I.set(Z,O,N,ee,q)}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}var f1e={kernelName:_1,backendName:"cpu",kernelFunc:p1e};function m1e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:i,strides:o,pad:l,dataFormat:h,dimRoundingMode:c}=r;et([a,s],"conv2dBackpropInput");let p=$.computeStrides(s.shape),m=$.computeStrides(a.shape),g=B.convertConv2DDataFormat(h),b=B.computeConv2DInfo(i,s.shape,o,1,l,c,!1,g),v=new Er(b.inShape,"float32"),x=v.values,_=n.data.get(a.dataId).values,I=n.data.get(s.dataId).values,[k,E,R]=p,{batchSize:U,filterHeight:D,filterWidth:C,inChannels:O,inHeight:z,inWidth:M,outChannels:N,outHeight:P,outWidth:Q,strideHeight:ee,strideWidth:q}=b;g=b.dataFormat;let Z=D-1-b.padInfo.top,ne=C-1-b.padInfo.left,me=g==="channelsLast",xe=v.strides[0],H=me?v.strides[1]:v.strides[2],se=me?v.strides[2]:1,ue=me?1:v.strides[1],ge=m[0],Ee=me?m[1]:m[2],$e=me?m[2]:1,Oe=me?1:m[1];for(let Fe=0;Fe<U;++Fe)for(let We=0;We<O;++We)for(let at=0;at<z;++at){let pt=at-Z,bt=Math.max(0,Math.ceil(pt/ee)),Bt=Math.min(P,(D+pt)/ee);for(let vt=0;vt<M;++vt){let Mt=vt-ne,ut=Math.max(0,Math.ceil(Mt/q)),Lt=Math.min(Q,(C+Mt)/q),nn=0;for(let Et=bt;Et<Bt;++Et){let Gn=Et*ee-pt;for(let ur=ut;ur<Lt;++ur){let Dr=ur*q-Mt,kn=ge*Fe+Ee*Et+$e*ur,cr=k*(D-1-Gn)+E*(C-1-Dr)+R*We;for(let vr=0;vr<N;++vr){let qn=_[kn+Oe*vr],hr=I[cr+vr];nn+=qn*hr}}}let Xt=xe*Fe+H*at+se*vt+ue*We;x[Xt]=nn}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}var g1e={kernelName:zd,backendName:"cpu",kernelFunc:m1e};function y1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l}=r;et([a,s],"conv3d");let h=B.computeConv3DInfo(a.shape,s.shape,i,l,o),{filterDepth:c,filterHeight:p,filterWidth:m,dilationDepth:g,dilationHeight:b,dilationWidth:v,padInfo:x}=h,_=x.front,I=x.left,k=x.top,E=new Er(h.outShape,a.dtype),R=n.data.get(a.dataId).values,U=n.data.get(s.dataId).values,D=E.values,C=$.computeStrides(a.shape),O=$.computeStrides(s.shape);for(let z=0;z<h.batchSize;++z){let M=z*C[0],N=z*E.strides[0];for(let P=0;P<h.outDepth;++P){let Q=N+P*E.strides[1],ee=P*h.strideDepth-_;for(let q=0;q<c;++q){let Z=ee+q*g;if(Z<0||Z>=h.inDepth)continue;let ne=q*O[0],me=M+Z*C[1];for(let xe=0;xe<h.outHeight;++xe){let H=Q+xe*E.strides[2],se=xe*h.strideHeight-k;for(let ue=0;ue<p;++ue){let ge=se+ue*b;if(ge<0||ge>=h.inHeight)continue;let Ee=ne+ue*O[1],$e=me+ge*C[2];for(let Oe=0;Oe<h.outWidth;++Oe){let Fe=H+Oe*h.outChannels,We=Oe*h.strideWidth-I;for(let at=0;at<m;++at){let pt=We+at*v;if(pt<0||pt>=h.inWidth)continue;let bt=Ee+at*O[2],Bt=$e+pt*h.inChannels,vt=bt;for(let Mt=0;Mt<h.inChannels;++Mt){let ut=R[Bt+Mt];for(let Lt=0;Lt<h.outChannels;++Lt)D[Fe+Lt]+=ut*U[vt+Lt];vt+=h.outChannels}}}}}}}}return n.makeTensorInfo(E.shape,E.dtype,E.values)}var b1e={kernelName:Vd,backendName:"cpu",kernelFunc:y1e};function v1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:o,filterShape:l}=r;et([a,s],"conv3dBackpropFilterV2");let h=$.computeStrides(a.shape),c=$.computeStrides(s.shape),p=B.computeConv3DInfo(a.shape,l,i,1,o),m=p.strideDepth,g=p.strideHeight,b=p.strideWidth,v=p.filterDepth,x=p.filterHeight,_=p.filterWidth,I=new Er(p.filterShape,"float32"),k=I.values,[E,R,U,D]=I.strides,C=n.data.get(s.dataId).values,[O,z,M,N]=c,P=n.data.get(a.dataId).values,[Q,ee,q,Z]=h,ne=p.padInfo.front,me=p.padInfo.left,xe=p.padInfo.top;for(let H=0;H<v;++H){let se=Math.max(0,Math.ceil((ne-H)/m)),ue=Math.min(p.outDepth,(p.inDepth+ne-H)/m),ge=H*E;for(let Ee=0;Ee<x;++Ee){let $e=Math.max(0,Math.ceil((xe-Ee)/g)),Oe=Math.min(p.outHeight,(p.inHeight+xe-Ee)/g),Fe=Ee*R+ge;for(let We=0;We<_;++We){let at=Math.max(0,Math.ceil((me-We)/b)),pt=Math.min(p.outWidth,(p.inWidth+me-We)/b),bt=We*U+Fe;for(let Bt=0;Bt<p.inChannels;++Bt){let vt=Bt*D+bt;for(let Mt=0;Mt<p.outChannels;++Mt){let ut=0;for(let Lt=0;Lt<p.batchSize;++Lt){let nn=Lt*Q,Xt=Lt*O;for(let Et=se;Et<ue;++Et){let Gn=(H+Et*m-ne)*ee+nn,ur=Et*z+Xt;for(let Dr=$e;Dr<Oe;++Dr){let kn=(Ee+Dr*g-xe)*q+Gn,cr=Dr*M+ur;for(let vr=at;vr<pt;++vr){let qn=(We+vr*b-me)*Z+kn,hr=vr*N+cr;ut+=P[qn+Bt]*C[hr+Mt]}}}}k[vt+Mt]=ut}}}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}var x1e={kernelName:Zm,backendName:"cpu",kernelFunc:v1e};function w1e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:o,inputShape:l}=r;et([a],"conv3dBackpropInputV2");let h=$.computeStrides(a.shape),c=$.computeStrides(s.shape),p=B.computeConv3DInfo(l,s.shape,o,1,i),m=new Er(p.inShape,"float32"),g=m.values,[b,v,x,_]=m.strides,I=n.data.get(a.dataId).values,[k,E,R,U]=h,D=n.data.get(s.dataId).values,[C,O,z,M]=c,{batchSize:N,filterDepth:P,filterHeight:Q,filterWidth:ee,inChannels:q,inDepth:Z,inHeight:ne,inWidth:me,outChannels:xe,outDepth:H,outHeight:se,outWidth:ue,strideDepth:ge,strideHeight:Ee,strideWidth:$e}=p,Oe=P-1-p.padInfo.front,Fe=Q-1-p.padInfo.top,We=ee-1-p.padInfo.left;for(let at=0;at<N;++at)for(let pt=0;pt<q;++pt)for(let bt=0;bt<Z;++bt){let Bt=bt-Oe,vt=Math.max(0,Math.ceil(Bt/ge)),Mt=Math.min(H,(P+Bt)/ge);for(let ut=0;ut<ne;++ut){let Lt=ut-Fe,nn=Math.max(0,Math.ceil(Lt/Ee)),Xt=Math.min(se,(Q+Lt)/Ee);for(let Et=0;Et<me;++Et){let Gn=Et-We,ur=Math.max(0,Math.ceil(Gn/$e)),Dr=Math.min(ue,(ee+Gn)/$e),kn=0;for(let cr=vt;cr<Mt;++cr){let vr=cr*ge-Bt;for(let qn=nn;qn<Xt;++qn){let hr=qn*Ee-Lt;for(let si=ur;si<Dr;++si){let lo=si*$e-Gn,ds=k*at+E*cr+R*qn+U*si,uo=C*(P-1-vr)+O*(Q-1-hr)+z*(ee-1-lo)+M*pt;for(let dr=0;dr<xe;++dr){let On=I[ds+dr],ln=D[uo+dr];kn+=On*ln}}}}g[b*at+v*bt+x*ut+_*Et+pt]=kn}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}var _1e={kernelName:Jm,backendName:"cpu",kernelFunc:w1e},S1e=yn(Ud,e=>Math.cos(e)),I1e={kernelName:Ud,backendName:"cpu",kernelFunc:S1e},T1e=yn(Bd,e=>Math.cosh(e)),k1e={kernelName:Bd,backendName:"cpu",kernelFunc:T1e};function E1e(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:i}=t,{cropSize:o,method:l,extrapolationValue:h}=r,[c,p,m,g]=a.shape,b=s.shape[0],[v,x]=o,_=At([b,v,x,g],"float32"),I=n.data.get(s.dataId).values,k=n.data.get(i.dataId).values,E=n.data.get(a.dataId).values,R=$.computeStrides(a.shape),U=$.computeStrides(_.shape);for(let D=0;D<b;D++){let C=D*4,O=I[C],z=I[C+1],M=I[C+2],N=I[C+3],P=k[D];if(P>=c)continue;let Q=v>1?(M-O)*(p-1)/(v-1):0,ee=x>1?(N-z)*(m-1)/(x-1):0;for(let q=0;q<v;q++){let Z=v>1?O*(p-1)+q*Q:.5*(O+M)*(p-1);if(Z<0||Z>p-1){for(let ne=0;ne<x;ne++)for(let me=0;me<g;me++){let xe=me+ne*U[2]+q*U[1]+D*U[0];_.values[xe]=h}continue}if(l==="bilinear"){let ne=Math.floor(Z),me=Math.ceil(Z),xe=Z-ne;for(let H=0;H<x;H++){let se=x>1?z*(m-1)+H*ee:.5*(z+N)*(m-1);if(se<0||se>m-1){for(let $e=0;$e<g;$e++){let Oe=$e+H*U[2]+q*U[1]+D*U[0];_.values[Oe]=h}continue}let ue=Math.floor(se),ge=Math.ceil(se),Ee=se-ue;for(let $e=0;$e<g;$e++){let Oe=$e+ue*R[2]+ne*R[1]+P*R[0],Fe=E[Oe];Oe=$e+ge*R[2]+ne*R[1]+P*R[0];let We=E[Oe];Oe=$e+ue*R[2]+me*R[1]+P*R[0];let at=E[Oe];Oe=$e+ge*R[2]+me*R[1]+P*R[0];let pt=E[Oe],bt=Fe+(We-Fe)*Ee,Bt=at+(pt-at)*Ee;Oe=$e+H*U[2]+q*U[1]+D*U[0],_.values[Oe]=bt+(Bt-bt)*xe}}}else for(let ne=0;ne<x;++ne){let me=x>1?z*(m-1)+ne*ee:.5*(z+N)*(m-1);if(me<0||me>m-1){for(let se=0;se<g;se++){let ue=se+ne*U[2]+q*U[1]+D*U[0];_.values[ue]=h}continue}let xe=Math.round(me),H=Math.round(Z);for(let se=0;se<g;se++){let ue=se+xe*R[2]+H*R[1]+P*R[0],ge=se+ne*U[2]+q*U[1]+D*U[0];_.values[ge]=E[ue]}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}var N1e={kernelName:tg,backendName:"cpu",kernelFunc:E1e};function C1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r;et(a,"cumprod");let l=B.getAxesPermutation([s],a.shape.length),h=a;l!=null&&(h=cs({inputs:{x:a},backend:n,attrs:{perm:l}}));let c=B.getInnerMostAxes(1,a.shape.length)[0];if(c!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${c}`);let p=ti(h.dtype,"int32"),m=$.makeOnesTypedArray($.sizeFromShape(h.shape),p),g=n.data.get(h.dataId).values,b=h.shape[h.shape.length-1],v=o?(_,I)=>_+b-I-1:(_,I)=>_+I;for(let _=0;_<g.length;_+=b)for(let I=0;I<b;I++){let k=v(_,I);if(I===0)m[k]=i?1:g[k];else{let E=v(_,I-1);m[k]=i?g[E]*m[E]:g[k]*m[E]}}let x=n.makeTensorInfo(h.shape,p,m);if(l!=null){let _=B.getUndoAxesPermutation(l),I=cs({inputs:{x},backend:n,attrs:{perm:_}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(h),I}return x}var A1e={kernelName:eg,backendName:"cpu",kernelFunc:C1e};function R1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r;et(a,"cumsum");let l=B.getAxesPermutation([s],a.shape.length),h=a;l!=null&&(h=cs({inputs:{x:a},backend:n,attrs:{perm:l}}));let c=B.getInnerMostAxes(1,a.shape.length)[0];if(c!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${c}`);let p=ti(h.dtype,"int32"),m=$.makeZerosTypedArray($.sizeFromShape(h.shape),p),g=n.data.get(h.dataId).values,b=h.shape[h.shape.length-1],v=o?(_,I)=>_+b-I-1:(_,I)=>_+I;for(let _=0;_<g.length;_+=b)for(let I=0;I<b;I++){let k=v(_,I);if(I===0)m[k]=i?0:g[k];else{let E=v(_,I-1);m[k]=i?g[E]+m[E]:g[k]+m[E]}}let x=n.makeTensorInfo(h.shape,p,m);if(l!=null){let _=B.getUndoAxesPermutation(l),I=cs({inputs:{x},backend:n,attrs:{perm:_}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(h),I}return x}var D1e={kernelName:Wd,backendName:"cpu",kernelFunc:R1e};function M1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i,binaryOutput:o}=r;if(a.shape.length===1){let l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,c=HR(l,h,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,c)}else if(a.shape.length===2){let l=n.bufferSync(a),h=n.bufferSync(s),c=u5(l,h,i,o);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var $1e={kernelName:$v,backendName:"cpu",kernelFunc:M1e};function O1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:i}=r;$.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);let o=a.shape[0],l=a.shape[1],h=a.shape[2],c=a.shape[3],p=l*s,m=h*s,g=c/(s*s),b=n.data.get(a.dataId).values,v=new Float32Array(o*p*m*g),x=0;for(let _=0;_<o;++_)for(let I=0;I<p;++I){let k=Math.floor(I/s),E=I%s;for(let R=0;R<m;++R){let U=Math.floor(R/s),D=R%s,C=(E*s+D)*g;for(let O=0;O<g;++O){let z=O+C+c*(U+h*(k+l*_));v[x++]=b[z]}}}return n.makeTensorInfo([o,p,m,g],a.dtype,v)}var F1e={kernelName:ng,backendName:"cpu",kernelFunc:O1e};function nH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l,dimRoundingMode:h}=r;et([a,s],"depthwiseConv2DNative");let c=$.computeStrides(a.shape),p=$.computeStrides(s.shape),m=l;m==null&&(m=[1,1]),$.assert(B.eitherStridesOrDilationsAreOne(i,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${m}'`);let g=B.computeConv2DInfo(a.shape,s.shape,i,m,o,h,!0),{filterHeight:b,filterWidth:v,dilationHeight:x,dilationWidth:_,padInfo:I}=g,k=I.left,E=I.top,R=g.outChannels/g.inChannels,U=new Er(g.outShape,a.dtype),D=n.data.get(a.dataId).values,C=n.data.get(s.dataId).values,O=U.values;for(let z=0;z<g.batchSize;++z){let M=z*c[0],N=z*U.strides[0];for(let P=0;P<g.outHeight;++P){let Q=N+P*U.strides[1],ee=P*g.strideHeight-E;for(let q=0;q<b;++q){let Z=ee+q*x;if(Z<0||Z>=g.inHeight)continue;let ne=q*p[0],me=M+Z*c[1];for(let xe=0;xe<g.outWidth;++xe){let H=Q+xe*U.strides[2],se=xe*g.strideWidth-k;for(let ue=0;ue<v;++ue){let ge=se+ue*_;if(ge<0||ge>=g.inWidth)continue;let Ee=ne+ue*p[1],$e=me+ge*g.inChannels,Oe=H,Fe=Ee;for(let We=0;We<g.inChannels;++We){let at=D[$e+We];for(let pt=0;pt<R;++pt)O[Oe+pt]+=at*C[Fe+pt];Oe+=R,Fe+=R}}}}}}return n.makeTensorInfo(U.shape,U.dtype,U.values)}var P1e={kernelName:jd,backendName:"cpu",kernelFunc:nH};function L1e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,dilations:o,pad:l,dimRoundingMode:h,filterShape:c}=r;et([a,s],"depthwiseConv2dNativeBackpropFilter");let p=B.computeConv2DInfo(a.shape,c,i,o,l,h,!0),{strideHeight:m,strideWidth:g,filterHeight:b,filterWidth:v}=p,x=new Er(p.filterShape,"float32"),_=p.padInfo.left,I=p.padInfo.top,k=p.outChannels/p.inChannels,E=n.data.get(a.dataId).values,R=new Er(a.shape,a.dtype,E),U=n.data.get(s.dataId).values,D=new Er(s.shape,s.dtype,U);for(let C=0;C<b;++C){let O=Math.max(0,Math.ceil((I-C)/m)),z=Math.min(p.outHeight,(p.inHeight+I-C)/m);for(let M=0;M<v;++M){let N=Math.max(0,Math.ceil((_-M)/g)),P=Math.min(p.outWidth,(p.inWidth+_-M)/g);for(let Q=0;Q<p.outChannels;++Q){let ee=Math.trunc(Q/k),q=Q%k,Z=0;for(let ne=0;ne<p.batchSize;++ne)for(let me=O;me<z;++me){let xe=C+me*m-I;for(let H=N;H<P;++H){let se=M+H*g-_;Z+=R.get(ne,xe,se,ee)*D.get(ne,me,H,Q)}}x.set(Z,C,M,ee,q)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}var z1e={kernelName:S1,backendName:"cpu",kernelFunc:L1e};function V1e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:i,dilations:o,pad:l,dimRoundingMode:h,inputShape:c}=r;et([a,s],"depthwiseConv2DNativeBackpropInput");let p=$.computeStrides(a.shape),m=$.computeStrides(s.shape),g=B.computeConv2DInfo(c,s.shape,i,o,l,h,!0),b=new Er(g.inShape,"float32"),v=b.values,[x,_,I]=b.strides,k=n.data.get(a.dataId).values,[E,R,U]=p,D=n.data.get(s.dataId).values,[C,O,z]=m,{batchSize:M,filterHeight:N,filterWidth:P,inChannels:Q,inHeight:ee,inWidth:q,outChannels:Z,outHeight:ne,outWidth:me,strideHeight:xe,strideWidth:H}=g,se=N-1-g.padInfo.top,ue=P-1-g.padInfo.left,ge=Z/Q;for(let Ee=0;Ee<M;++Ee)for(let $e=0;$e<Q;++$e)for(let Oe=0;Oe<ee;++Oe){let Fe=Oe-se,We=Math.max(0,Math.ceil(Fe/xe)),at=Math.min(ne,(N+Fe)/xe);for(let pt=0;pt<q;++pt){let bt=pt-ue,Bt=Math.max(0,Math.ceil(bt/H)),vt=Math.min(me,(P+bt)/H),Mt=0;for(let ut=We;ut<at;++ut){let Lt=ut*xe-Fe;for(let nn=Bt;nn<vt;++nn){let Xt=nn*H-bt,Et=E*Ee+R*ut+U*nn,Gn=C*(N-1-Lt)+O*(P-1-Xt)+z*$e;for(let ur=0;ur<ge;++ur){let Dr=$e*ge+ur,kn=k[Et+Dr],cr=D[Gn+ur];Mt+=kn*cr}}}v[x*Ee+_*Oe+I*pt+$e]=Mt}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}var U1e={kernelName:I1,backendName:"cpu",kernelFunc:V1e};function B1e(e){let{inputs:t,backend:n}=e,{x:r}=t,a=$.sizeFromShape(r.shape),s=n.data.get(r.dataId).values,i=At([a,a],r.dtype),o=i.values;for(let h=0;h<s.length;h++)o[h*a+h]=s[h];let l=[...r.shape,...r.shape];return n.makeTensorInfo(l,i.dtype,i.values)}var W1e={kernelName:Ov,backendName:"cpu",kernelFunc:B1e},j1e={kernelName:Hd,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a}=e,{strides:s,pad:i,dilations:o}=n,l=t,h=l.data.get(r.dataId).values,c=r.shape.length,p=l.data.get(a.dataId).values,m=a.shape.length,{batchSize:g,inHeight:b,inWidth:v,inChannels:x,outHeight:_,outWidth:I,padInfo:k,strideHeight:E,strideWidth:R,filterHeight:U,filterWidth:D,dilationHeight:C,dilationWidth:O,outShape:z}=B.computeDilation2DInfo(r.shape,a.shape,s,i,"NHWC",o),M=$.sizeFromShape(z),N=z.length,P=$.getArrayFromDType(r.dtype,M);for(let Q=0;Q<g;++Q)for(let ee=0;ee<_;++ee){let q=ee*E-k.top;for(let Z=0;Z<I;++Z){let ne=Z*R-k.left;for(let me=0;me<x;++me){let xe=Number.MIN_SAFE_INTEGER;for(let se=0;se<U;++se){let ue=q+se*C;if(ue>=0&&ue<b)for(let ge=0;ge<D;++ge){let Ee=ne+ge*O;if(Ee>=0&&Ee<v){let $e=$.locToIndex([Q,ue,Ee,me],c,$.computeStrides(r.shape)),Oe=$.locToIndex([se,ge,me],m,$.computeStrides(a.shape)),Fe=h[$e]+p[Oe];Fe>xe&&(xe=Fe)}}}let H=$.locToIndex([Q,ee,Z,me],N,$.computeStrides(z));P[H]=xe}}}return{dataId:l.write($.toTypedArray(P,r.dtype),z,r.dtype),shape:z,dtype:r.dtype}}},H1e={kernelName:mm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:i,pad:o,dilations:l}=n,h=t,c=$.toNestedArray(r.shape,h.data.get(r.dataId).values),p=$.toNestedArray(a.shape,h.data.get(a.dataId).values),{batchSize:m,inHeight:g,inWidth:b,inChannels:v,outHeight:x,outWidth:_,padInfo:I,strideHeight:k,strideWidth:E,filterHeight:R,filterWidth:U,dilationHeight:D,dilationWidth:C,outShape:O}=B.computeDilation2DInfo(r.shape,a.shape,i,o,"NHWC",l);$.assert(s.rank===O.length,()=>`Error in ${mm}, dy must have the same rank as output ${O.length}, but got ${s.rank}`);let z=$.toNestedArray(O,h.data.get(s.dataId).values),M=$.makeZerosNestedTypedArray(a.shape,a.dtype);for(let N=0;N<m;++N)for(let P=0;P<x;++P){let Q=P*k-I.top;for(let ee=0;ee<_;++ee){let q=ee*E-I.left;for(let Z=0;Z<v;++Z){let ne=Number.MIN_SAFE_INTEGER,me=0,xe=0;for(let H=0;H<R;++H){let se=Q+H*D;if(se>=0&&se<g)for(let ue=0;ue<U;++ue){let ge=q+ue*C;if(ge>=0&&ge<b){let Ee=c[N][se][ge][Z]+p[H][ue][Z];Ee>ne&&(ne=Ee,me=H,xe=ue)}}}M[me][xe][Z]+=z[N][P][ee][Z]}}}return{dataId:h.write($.toTypedArray(M,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},G1e={kernelName:fm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:i,pad:o,dilations:l}=n,h=t,c=$.toNestedArray(r.shape,h.data.get(r.dataId).values),p=$.toNestedArray(a.shape,h.data.get(a.dataId).values),{batchSize:m,inHeight:g,inWidth:b,inChannels:v,outHeight:x,outWidth:_,padInfo:I,strideHeight:k,strideWidth:E,filterHeight:R,filterWidth:U,dilationHeight:D,dilationWidth:C,outShape:O}=B.computeDilation2DInfo(r.shape,a.shape,i,o,"NHWC",l);$.assert(s.rank===O.length,()=>`Error in ${fm}, dy must have the same rank as output ${O.length}, but got ${s.rank}`);let z=$.toNestedArray(O,h.data.get(s.dataId).values),M=$.makeZerosNestedTypedArray(r.shape,r.dtype);for(let N=0;N<m;++N)for(let P=0;P<x;++P){let Q=P*k-I.top;for(let ee=0;ee<_;++ee){let q=ee*E-I.left;for(let Z=0;Z<v;++Z){let ne=Number.MIN_SAFE_INTEGER,me=Q<0?0:Q,xe=q<0?0:q;for(let H=0;H<R;++H){let se=Q+H*D;if(se>=0&&se<g)for(let ue=0;ue<U;++ue){let ge=q+ue*C;if(ge>=0&&ge<b){let Ee=c[N][se][ge][Z]+p[H][ue][Z];Ee>ne&&(ne=Ee,me=se,xe=ge)}}}M[N][me][xe][Z]+=z[N][P][ee][Z]}}}return{dataId:h.write($.toTypedArray(M,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function q1e(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:s,options:i}=r,{contextOptions:o,imageOptions:l}=i||{},h=l?.alpha||1,c=o?.contextType||"2d";if(c!=="2d")throw new Error(`Context type ${o.contextType} is not supported by the CPU backend.`);let p=s.getContext(c,o?.contextAttributes||{});if(p==null)throw new Error(`Could not get the context with ${c} type.`);let[m,g]=a.shape.slice(0,2),b=a.shape.length===2?1:a.shape[2],v=n.data.get(a.dataId).values,x=a.dtype==="float32"?255:1,_=new Uint8ClampedArray(g*m*4);for(let k=0;k<m*g;++k){let E=[0,0,0,255*h];for(let U=0;U<b;U++){let D=v[k*b+U];if(a.dtype==="float32"){if(D<0||D>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${D}.`)}else if(a.dtype==="int32"&&(D<0||D>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${D}.`);b===1?(E[0]=D*x,E[1]=D*x,E[2]=D*x):E[U]=D*x}let R=k*4;_[R+0]=Math.round(E[0]),_[R+1]=Math.round(E[1]),_[R+2]=Math.round(E[2]),_[R+3]=Math.round(E[3])}s.width=g,s.height=m;let I=new ImageData(_,g,m);return p.putImageData(I,0,0),a}var K1e={kernelName:T1,backendName:"cpu",kernelFunc:q1e};function Tx(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;et(a,"sum");let o;a.dtype==="bool"?o=Nc({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):o=Xo({inputs:{x:a},backend:n});let l=o.shape.length,h=$.parseAxisParam(s,o.shape),c=B.getAxesPermutation(h,l),p=h,m=o;c!=null&&(m=cs({inputs:{x:o},backend:n,attrs:{perm:c}}),p=B.getInnerMostAxes(p.length,l)),B.assertAxesAreInnerMostDims("sum",p,m.shape.length);let[g,b]=B.computeOutAndReduceShapes(m.shape,p),v=B.upcastType(m.dtype,"int32"),x=N_(n,g,v),_=$.sizeFromShape(b),I=n.data.get(x.dataId).values,k=n.data.get(m.dataId).values;for(let E=0;E<I.length;++E){let R=E*_,U=0;for(let D=0;D<_;++D)U+=k[R+D];I[E]=U}if(i){let E=B.expandShapeToKeepDim(x.shape,h),R=x;x=$n({inputs:{x},backend:n,attrs:{shape:E}}),n.disposeIntermediateTensorInfo(R)}return n.disposeIntermediateTensorInfo(o),c!=null&&n.disposeIntermediateTensorInfo(m),x}var X1e={kernelName:Lp,backendName:"cpu",kernelFunc:Tx};function Y1e(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:i,summedDims:o,idDims:l}=B.decodeEinsumEquation(a,s.length);B.checkEinsumDimSizes(i.length,l,s);let{path:h,steps:c}=B.getEinsumComputePath(o,l),p=c.length,m=null,g=i.length,b=[];for(let v=0;v<p;++v){for(let x of c[v]){let{permutationIndices:_,expandDims:I}=B.getEinsumPermutation(g,l[x]),k;B.isIdentityPermutation(_)?k=s[x]:(k=cs({inputs:{x:s[x]},backend:n,attrs:{perm:_}}),b.push(k));let E=k.shape.slice();for(let R=0;R<I.length;++R)E.splice(I[R],0,1);$.arraysEqual(k.shape,E)||(k=$n({inputs:{x:k},backend:n,attrs:{shape:E}}),b.push(k)),m===null?m=k:(m=zS({inputs:{a:k,b:m},backend:n}),b.push(m))}v<p-1&&(h[v]>=0&&(m=Tx({inputs:{x:m},backend:n,attrs:{axis:h[v]-(i.length-g),keepDims:!1}}),b.push(m)),g--)}for(let v of b)v!==m&&n.disposeIntermediateTensorInfo(v);return m}var Q1e={kernelName:k1,backendName:"cpu",kernelFunc:Y1e};function Z1e(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t;et([r,a],"eluGrad");let s=new Float32Array($.sizeFromShape(a.shape)),i=n.data.get(a.dataId).values,o=n.data.get(r.dataId).values;for(let l=0;l<i.length;++l){let h=i[l];h>=0?s[l]=o[l]:s[l]=o[l]*(h+1)}return n.makeTensorInfo(a.shape,"float32",s)}var J1e={kernelName:rg,backendName:"cpu",kernelFunc:Z1e},eSe=B.ERF_P,tSe=B.ERF_A1,nSe=B.ERF_A2,rSe=B.ERF_A3,aSe=B.ERF_A4,sSe=B.ERF_A5,iSe=yn(Kd,e=>{let t=Math.sign(e),n=Math.abs(e),r=1/(1+eSe*n);return t*(1-((((sSe*r+aSe)*r+rSe)*r+nSe)*r+tSe)*r*Math.exp(-n*n))}),oSe={kernelName:Kd,backendName:"cpu",kernelFunc:iSe};function R_(e){let{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:s}=r,i=a.shape.length,o=a.shape.slice(),l=s;return s<0&&($.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),o.splice(l,0,1),$n({inputs:{x:a},backend:n,attrs:{shape:o}})}var lSe={kernelName:sg,backendName:"cpu",kernelFunc:R_},uSe=br((e,t)=>e/t),rD=qr(Gd,uSe),QE={kernelName:Gd,backendName:"cpu",kernelFunc:rD};function rH(e,t,n){let r=e.shape,a=r[0],s=r[1],i=n.data.get(e.dataId),o=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,h=[a,s],c=$.sizeFromShape(h),p=$.getTypedArrayFromDType("float32",c),m=$.getTypedArrayFromDType("float32",c);for(let x=0;x<a;x++){let _=md({inputs:{x:o},backend:n,attrs:{begin:[x,0],size:[1,s]}}),I=md({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,s]}}),k=As({inputs:{real:_,imag:I},backend:n}),{real:E,imag:R}=cSe(k,t,n),U=B.mergeRealAndImagArrays(E,R);for(let D=0;D<s;D++){let C=B.getComplexWithIndex(U,D);p[x*s+D]=C.real,m[x*s+D]=C.imag}n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(k)}let g=n.makeTensorInfo(h,"float32",p),b=n.makeTensorInfo(h,"float32",m),v=As({inputs:{real:g,imag:b},backend:n});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),v}function cSe(e,t,n){let r=$.sizeFromShape(e.shape),a=n.data.get(e.dataId),s=n.data.get(a.complexTensorInfos.real.dataId).values,i=n.data.get(a.complexTensorInfos.imag.dataId).values;if(hSe(r)){let o=ZE(s,i,r,t,n),l=[e.shape[0],e.shape[1]];if(t){let h=n.makeTensorInfo(l,"float32",o.real),c=n.makeTensorInfo(l,"float32",o.imag),p=n.makeTensorInfo([],"float32",$.createScalarValue(r,"float32")),m=Xo({inputs:{x:p},backend:n}),g=QE.kernelFunc({inputs:{a:h,b:p},backend:n}),b=QE.kernelFunc({inputs:{a:c,b:m},backend:n}),v=n.data.get(g.dataId).values,x=n.data.get(b.dataId).values;return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),{real:v,imag:x}}return o}else{let o=B.mergeRealAndImagArrays(s,i),l=dSe(o,r,t);return B.splitRealAndImagArrays(l)}}function hSe(e){return(e&e-1)===0}function ZE(e,t,n,r,a){if(n===1)return{real:e,imag:t};let s=B.mergeRealAndImagArrays(e,t),i=n/2,o=B.complexWithEvenIndex(s),l=o.real,h=o.imag,c=[l.length],p=a.makeTensorInfo(c,"float32",l),m=a.makeTensorInfo(c,"float32",h),g=As({inputs:{real:p,imag:m},backend:a}),b=B.complexWithOddIndex(s),v=b.real,x=b.imag,_=[v.length],I=a.makeTensorInfo(_,"float32",v),k=a.makeTensorInfo(_,"float32",x),E=As({inputs:{real:I,imag:k},backend:a}),R=ZE(l,h,i,r,a),U=R.real,D=R.imag,C=[U.length],O=a.makeTensorInfo(C,"float32",U),z=a.makeTensorInfo(C,"float32",D),M=As({inputs:{real:O,imag:z},backend:a}),N=ZE(v,x,i,r,a),P=N.real,Q=N.imag,ee=[P.length],q=a.makeTensorInfo(ee,"float32",P),Z=a.makeTensorInfo(ee,"float32",Q),ne=As({inputs:{real:q,imag:Z},backend:a}),me=B.exponents(n,r),xe=[me.real.length],H=a.makeTensorInfo(xe,"float32",me.real),se=a.makeTensorInfo(xe,"float32",me.imag),ue=As({inputs:{real:H,imag:se},backend:a}),ge=zS({inputs:{a:ue,b:ne},backend:a}),Ee=Em({inputs:{a:M,b:ge},backend:a}),$e=eD({inputs:{a:M,b:ge},backend:a}),Oe=fd({inputs:{input:Ee},backend:a}),Fe=fd({inputs:{input:$e},backend:a}),We=Nm({inputs:{input:Ee},backend:a}),at=Nm({inputs:{input:$e},backend:a}),pt=Cm({inputs:[Oe,Fe],backend:a,attrs:{axis:0}}),bt=Cm({inputs:[We,at],backend:a,attrs:{axis:0}}),Bt=a.data.get(pt.dataId).values,vt=a.data.get(bt.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(g),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(k),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(ue),a.disposeIntermediateTensorInfo(ge),a.disposeIntermediateTensorInfo(Ee),a.disposeIntermediateTensorInfo($e),a.disposeIntermediateTensorInfo(Oe),a.disposeIntermediateTensorInfo(We),a.disposeIntermediateTensorInfo(Fe),a.disposeIntermediateTensorInfo(at),a.disposeIntermediateTensorInfo(pt),a.disposeIntermediateTensorInfo(bt),{real:Bt,imag:vt}}function dSe(e,t,n){let r=new Float32Array(t*2);for(let a=0;a<t;a++){let s=0,i=0;for(let o=0;o<t;o++){let l=B.exponent(a*o,t,n),h=B.getComplexWithIndex(e,o);s+=h.real*l.real-h.imag*l.imag,i+=h.real*l.imag+h.imag*l.real}n&&(s/=t,i/=t),B.assignToTypedArray(r,s,i,a)}return r}function pSe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=$.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=a/s,o=$n({inputs:{x:r},backend:n,attrs:{shape:[i,s]}}),l=rH(o,!1,n),h=$n({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),h}var fSe={kernelName:E1,backendName:"cpu",kernelFunc:pSe};function aD(e){let{backend:t,attrs:n}=e,{shape:r,value:a,dtype:s}=n,i=s||$.inferDtype(a),o=$.getArrayFromDType(i,$.sizeFromShape(r));return gSe(o,a),t.makeTensorInfo(r,i,o)}var mSe={kernelName:Fv,backendName:"cpu",kernelFunc:aD};function gSe(e,t,n){e.fill(t)}var ySe={kernelName:ig,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,a=n,s=$.getTypedArrayFromDType(r.dtype,$.sizeFromShape(r.shape)),[i,o,l,h]=r.shape,c=a.data.get(r.dataId).values;for(let p=0;p<i;p++){let m=p*l*o*h;for(let g=0;g<o;g++){let b=g*(l*h);for(let v=0;v<l;v++){let x=v*h;for(let _=0;_<h;_++){let I=Math.round(l-v-1),k=m+b+x+_,E=c[k];if(I>=0&&I<l){let R=I*h,U=m+b+R+_;E=c[U]}s[k]=E}}}}return{dataId:a.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function bSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dataFormat:c,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=r,v=tH({inputs:{x:a,filter:s},backend:n,attrs:{strides:l,pad:h,dataFormat:c,dilations:p,dimRoundingMode:m}});if(i){let x=v;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){let _=$n({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});v=Em({inputs:{a:v,b:_},backend:n}),n.disposeIntermediateTensorInfo(_)}else v=Em({inputs:{a:v,b:i},backend:n});n.disposeIntermediateTensorInfo(x)}if(g){let x=v;if(c==="NCHW"&&g==="prelu"&&o.shape.length===1&&o.shape[0]!==1){let _=$n({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});v=A_(n,v,g,_,b),n.disposeIntermediateTensorInfo(_)}else v=A_(n,v,g,o,b);n.disposeIntermediateTensorInfo(x)}return v}var vSe={kernelName:nd,backendName:"cpu",kernelFunc:bSe};function xSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dataFormat:c,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=r,v=nH({inputs:{x:a,filter:s},backend:n,attrs:{strides:l,pad:h,dataFormat:c,dilations:p,dimRoundingMode:m}});if(i){let x=v;v=Em({inputs:{a:v,b:i},backend:n}),n.disposeIntermediateTensorInfo(x)}if(g){let x=v;v=A_(n,v,g,o,b),n.disposeIntermediateTensorInfo(x)}return v}var wSe={kernelName:rd,backendName:"cpu",kernelFunc:xSe};function _Se(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=$.sizeFromShape(r.shape),i=a.shape,o=i[i.length-1],[l,h,c,p]=B.prepareAndValidate(r,a);if(h===0)return n.makeTensorInfo(l,r.dtype,[]);let m=n.data.get(a.dataId).values,g=n.bufferSync(r),b=v5(m,g,r.dtype,h,o,c,p,r.shape,s);return n.makeTensorInfo(l,r.dtype,b.values)}var SSe={kernelName:lg,backendName:"cpu",kernelFunc:_Se};function ISe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:i,batchDims:o}=r;et([a,s],"gatherV2");let l=$.parseAxisParam(i,a.shape)[0],h=n.data.get(s.dataId).values,c=a.shape[l];for(let E=0;E<h.length;++E){let R=h[E];$.assert(R<=c-1&&R>=0,()=>`GatherV2: the index value ${R} is not in [0, ${c-1}]`)}let p=o;o==null&&(p=0);let m=$.sizeFromShape(s.shape),g=B.segment_util.collectGatherOpShapeInfo(a,s,l,p),b=$n({inputs:{x:a},backend:n,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),v=$n({inputs:{x:s},backend:n,attrs:{shape:[g.batchSize,m/g.batchSize]}}),x=[g.batchSize,g.outerSize,m/g.batchSize,g.sliceSize],_=n.bufferSync(v),I=n.bufferSync(b),k=x5(I,_,x);return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v),n.makeTensorInfo(g.outputShape,k.dtype,k.values)}var TSe={kernelName:og,backendName:"cpu",kernelFunc:ISe};function kSe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=$.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=a/s,o=$n({inputs:{x:r},backend:n,attrs:{shape:[i,s]}}),l=rH(o,!0,n),h=$n({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),h}var ESe={kernelName:N1,backendName:"cpu",kernelFunc:kSe},NSe=yn(np,e=>Number.isFinite(e)?1:0,"bool"),CSe={kernelName:np,backendName:"cpu",kernelFunc:NSe},ASe=yn(rp,e=>Math.abs(e)===1/0?1:0,"bool"),RSe={kernelName:rp,backendName:"cpu",kernelFunc:ASe},DSe=yn(ap,e=>Number.isNaN(e)?1:0,"bool"),MSe={kernelName:ap,backendName:"cpu",kernelFunc:DSe};function $Se(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,i=T5(r,a,s);return t.makeTensorInfo([i.length],"float32",i)}var OSe={kernelName:dg,backendName:"cpu",kernelFunc:$Se},FSe=yn(op,e=>Math.log1p(e)),PSe={kernelName:op,backendName:"cpu",kernelFunc:FSe},LSe=br((e,t)=>e&&t),zSe=qr(pg,LSe,null,"bool"),VSe={kernelName:pg,backendName:"cpu",kernelFunc:zSe},USe=yn(fg,e=>e?0:1,"bool"),BSe={kernelName:fg,backendName:"cpu",kernelFunc:USe},WSe=br((e,t)=>e||t),jSe=qr(mg,WSe,null,"bool"),HSe={kernelName:mg,backendName:"cpu",kernelFunc:jSe};function GSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:o,beta:l}=r;et(a,"LRN");let h=a.shape[3],c=h-1,p=n.data.get(a.dataId).values,m=$.sizeFromShape(a.shape),g=new Float32Array(m);function b(v){let x=v%h,_=v-x+Math.max(0,x-s),I=v-x+Math.min(x+s,c),k=0;for(;_<=I;_++){let E=p[_];k+=E*E}return k}for(let v=0;v<m;v++){let x=b(v),_=p[v]*Math.pow(i+o*x,-l);g[v]=_}return n.makeTensorInfo(a.shape,a.dtype,g)}var qSe={kernelName:lp,backendName:"cpu",kernelFunc:GSe};function KSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:o,bias:l,alpha:h,beta:c}=r;et(i,"LRNGrad");let p=$.sizeFromShape(i.shape),m=i.shape[3],g=n.data.get(i.dataId).values,b=n.data.get(a.dataId).values,v=n.data.get(s.dataId).values,x=new Float32Array(p),_=p;for(let I=0;I<_;I++){let k=I%m,E=I-k+Math.max(0,k-o),R=I-k+Math.min(m,k+o+1),U=0;for(let D=E;D<R;D++)U+=Math.pow(b[D],2);U=h*U+l;for(let D=E;D<R;D++){let C=-2*h*c*b[D]*v[I]/U;I===D&&(C+=Math.pow(U,-c)),C*=g[I],x[D]+=C}}return n.makeTensorInfo(i.shape,a.dtype,x)}var XSe={kernelName:gg,backendName:"cpu",kernelFunc:KSe};function aH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:i}=r,o=n,l=a.shape,h=l.length,c=$.parseAxisParam(s,l),p=c,m=B.getAxesPermutation(p,h),g=o.data.get(a.dataId).values;if(m!=null){let E=new Array(h);for(let R=0;R<E.length;R++)E[R]=l[m[R]];g=KR(g,l,a.dtype,m,E),p=B.getInnerMostAxes(p.length,h),l=E}et(a,"max"),B.assertAxesAreInnerMostDims("max",p,h);let[b,v]=B.computeOutAndReduceShapes(l,p),x=$.sizeFromShape(v),_=E5(g,x,b,a.dtype),I=o.write(_,b,a.dtype),k=b;return i&&(k=B.expandShapeToKeepDim(b,c)),{dataId:I,shape:k,dtype:a.dtype}}var YSe={kernelName:up,backendName:"cpu",kernelFunc:aH};function QSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;et(a,"maxPool");let{filterSize:s,strides:i,pad:o,dimRoundingMode:l}=r,h=1;$.assert(B.eitherStridesOrDilationsAreOne(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let c=B.computePool2DInfo(a.shape,s,i,h,o,l),p;if(c.filterWidth===1&&c.filterHeight===1&&$.arraysEqual(c.inShape,c.outShape))p=Xo({inputs:{x:a},backend:n});else{let m=n.data.get(a.dataId).values,g=$.computeStrides(a.shape),b=nD(m,a.shape,a.dtype,g,c,"max");p=n.makeTensorInfo(c.outShape,a.dtype,b.values)}return p}var ZSe={kernelName:hp,backendName:"cpu",kernelFunc:QSe};function JSe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l,dataFormat:h}=r;et(a,"maxPool3d");let c=B.computePool3DInfo(a.shape,s,i,1,o,l,h),p=n.data.get(a.dataId).values,m=eH(p,a.shape,a.dtype,$.computeStrides(a.shape),c,"max");return n.makeTensorInfo(m.shape,"float32",m.values)}var eIe={kernelName:yg,backendName:"cpu",kernelFunc:JSe};function tIe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=r;et([a,s],"maxPool3DGrad");let c=B.computePool3DInfo(s.shape,i,o,1,l,h),p=n.bufferSync(s),m=W_e(p,c),g=c.strideDepth,b=c.strideHeight,v=c.strideWidth,x=c.dilationDepth,_=c.dilationHeight,I=c.dilationWidth,k=c.effectiveFilterDepth,E=c.effectiveFilterHeight,R=c.effectiveFilterWidth,U=k-1-c.padInfo.front,D=R-1-c.padInfo.left,C=E-1-c.padInfo.top,O=At(s.shape,"float32"),z=n.bufferSync(a);for(let M=0;M<c.batchSize;++M)for(let N=0;N<c.inChannels;++N)for(let P=0;P<c.inDepth;++P)for(let Q=0;Q<c.inHeight;++Q)for(let ee=0;ee<c.inWidth;++ee){let q=P-U,Z=Q-C,ne=ee-D,me=0;for(let xe=0;xe<k;xe+=x){let H=(q+xe)/g;if(!(H<0||H>=c.outDepth||Math.floor(H)!==H))for(let se=0;se<E;se+=_){let ue=(Z+se)/b;if(!(ue<0||ue>=c.outHeight||Math.floor(ue)!==ue))for(let ge=0;ge<R;ge+=I){let Ee=(ne+ge)/v;if(Ee<0||Ee>=c.outWidth||Math.floor(Ee)!==Ee)continue;let $e=k*E*R-1-m.get(M,H,ue,Ee,N),Oe=xe*E*R+se*R+ge,Fe=$e===Oe?1:0;if(Fe===0)continue;let We=z.get(M,H,ue,Ee,N);me+=We*Fe}}}O.set(me,M,P,Q,ee,N)}return n.makeTensorInfo(O.shape,O.dtype,O.values)}var nIe={kernelName:Lv,backendName:"cpu",kernelFunc:tIe};function rIe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:i}=t,o=s;et([s,i],"maxPoolGrad");let{filterSize:l,strides:h,pad:c,dimRoundingMode:p}=r,m=B.computePool2DInfo(o.shape,l,h,1,c,p),g=n.data.get(o.dataId).values,b=At(m.outShape,o.dtype,J5(g,o.shape,o.dtype,m).values),v=m.strideHeight,x=m.strideWidth,_=m.dilationHeight,I=m.dilationWidth,k=m.effectiveFilterHeight,E=m.effectiveFilterWidth,R=E-1-m.padInfo.left,U=k-1-m.padInfo.top,D=At(o.shape,"float32"),C=n.data.get(a.dataId).values,O=At(a.shape,"float32",C);for(let z=0;z<m.batchSize;++z)for(let M=0;M<m.inChannels;++M)for(let N=0;N<m.inHeight;++N)for(let P=0;P<m.inWidth;++P){let Q=N-U,ee=P-R,q=0;for(let Z=0;Z<k;Z+=_){let ne=(Q+Z)/v;if(!(ne<0||ne>=m.outHeight||Math.floor(ne)!==ne))for(let me=0;me<E;me+=I){let xe=(ee+me)/x;if(xe<0||xe>=m.outWidth||Math.floor(xe)!==xe)continue;let H=k*E-1-b.get(z,ne,xe,M),se=Z*E+me,ue=H===se?1:0;if(ue===0)continue;let ge=O.get(z,ne,xe,M);q+=ge*ue}}D.set(q,z,N,P,M)}return n.makeTensorInfo(D.shape,D.dtype,D.values)}var aIe={kernelName:Pv,backendName:"cpu",kernelFunc:rIe};function sIe(e,t,n,r,a){let s=$.computeStrides(t),i=nD(e,t,n,s,a,"max"),o=J5(e,t,n,a,!0,r);return[i.values,o.values]}var iIe={kernelName:zv,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:i,includeBatchInIndex:o}=t,l=n;et(r,"MaxPoolWithArgmax");let h=l.data.get(r.dataId).values,c=B.computePool2DInfo(r.shape,a,s,[1,1],i),[p,m]=sIe(h,r.shape,r.dtype,o,c),g=l.write(p,c.outShape,r.dtype),b=l.write(m,c.outShape,r.dtype);return[{dataId:g,shape:c.outShape,dtype:r.dtype},{dataId:b,shape:c.outShape,dtype:"int32"}]}};function oIe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,o=$.parseAxisParam(s,a.shape),l=B.computeOutAndReduceShapes(a.shape,o)[1],h=$.sizeFromShape(l),c=[],p=n.makeTensorInfo([],"float32",new Float32Array([h]));c.push(p);let m=Nc({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(m);let g=rD({inputs:{a:m,b:p},backend:n});c.push(g);let b=Tx({inputs:{x:g},backend:n,attrs:{axis:s,keepDims:i}});return c.forEach(v=>n.disposeIntermediateTensorInfo(v)),b}var lIe={kernelName:dp,backendName:"cpu",kernelFunc:oIe};function uIe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;et(a,"min");let o=$.parseAxisParam(s,a.shape),l=o,h=B.getAxesPermutation(l,a.shape.length),c=a;h!=null&&(c=cs({inputs:{x:a},backend:n,attrs:{perm:h}}),l=B.getInnerMostAxes(l.length,a.shape.length)),B.assertAxesAreInnerMostDims("min",l,c.shape.length);let[p,m]=B.computeOutAndReduceShapes(c.shape,l),g=$.sizeFromShape(m),b=$.makeZerosTypedArray($.sizeFromShape(p),c.dtype),v=n.data.get(c.dataId).values;for(let _=0;_<b.length;++_){let I=_*g,k=v[I];for(let E=0;E<g;++E){let R=v[I+E];(Number.isNaN(R)||R<k)&&(k=R)}b[_]=k}h!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(p,c.dtype,b);if(i){let _=B.expandShapeToKeepDim(p,o),I=$n({inputs:{x},backend:n,attrs:{shape:_}});return n.disposeIntermediateTensorInfo(x),I}return x}var cIe={kernelName:pp,backendName:"cpu",kernelFunc:uIe};function hIe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,mode:i}=r;et(a,"mirrorPad");let o=s.map((I,k)=>I[0]+a.shape[k]+I[1]),l=s.map(I=>I[0]),h=s.map((I,k)=>I[0]+a.shape[k]),c=i==="reflect"?0:1,p=n.data.get(a.dataId).values,m=a.shape.length,g=$.computeStrides(a.shape),b=$.sizeFromShape(o),v=o.length,x=$.computeStrides(o),_=$.getTypedArrayFromDType(a.dtype,b);for(let I=0;I<b;I++){let k=$.indexToLoc(I,v,x);for(let R=0;R<v;R++)k[R]<l[R]?k[R]=l[R]*2-k[R]-c:k[R]>=h[R]&&(k[R]=(h[R]-1)*2-k[R]+c);k=k.map((R,U)=>R-l[U]);let E=$.locToIndex(k,m,g);_[I]=p[E]}return{dataId:n.write(_,o,a.dtype),shape:o,dtype:a.dtype}}var dIe={kernelName:mp,backendName:"cpu",kernelFunc:hIe},pIe=br((e,t)=>{let n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),fIe=qr(gp,pIe),mIe={kernelName:gp,backendName:"cpu",kernelFunc:fIe},gIe=Lc(y1());function sH(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,i=a.shape.length,o=s;if(o===-1&&(o=i-1),o!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${o}`);let l=$.parseAxisParam([o],a.shape),h=aH({inputs:{x:a},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=B.expandShapeToKeepDim(h.shape,l),p=$n({inputs:{x:h},backend:n,attrs:{shape:c}}),m=eD({inputs:{a,b:p},backend:n}),g=m5({inputs:{x:m},backend:n}),b=Tx({inputs:{x:g},backend:n,attrs:{axis:l,keepDims:!1}}),v=$n({inputs:{x:b},backend:n,attrs:{shape:c}}),x=rD({inputs:{a:g,b:v},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v),x}var yIe={kernelName:zp,backendName:"cpu",kernelFunc:sH};function bIe(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:o}=r;et(a,"multinomial");let l=o?a:sH({inputs:{logits:a},backend:n,attrs:{dim:-1}}),h=l.shape[0],c=l.shape[1],p=n.data.get(l.dataId).values,m=[h,s],g=$.makeZerosTypedArray($.sizeFromShape(m),"int32");for(let b=0;b<h;++b){let v=b*c,x=new Float32Array(c-1);x[0]=p[v];for(let k=1;k<x.length;++k)x[k]=x[k-1]+p[v+k];let _=gIe.alea(i.toString()),I=b*s;for(let k=0;k<s;++k){let E=_();g[I+k]=x.length;for(let R=0;R<x.length;R++)if(E<x[R]){g[I+k]=R;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(m,"int32",g)}var vIe={kernelName:bg,backendName:"cpu",kernelFunc:bIe},xIe=el.nonMaxSuppressionV3Impl;function wIe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l}=r;et(a,"NonMaxSuppression");let h=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:p}=xIe(h,c,i,o,l);return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}var _Ie={kernelName:wg,backendName:"cpu",kernelFunc:wIe},SIe=el.nonMaxSuppressionV4Impl;function IIe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:h}=r;et(a,"NonMaxSuppressionPadded");let c=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,{selectedIndices:m,validOutputs:g}=SIe(c,p,i,o,l,h);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([],"int32",new Int32Array([g]))]}var TIe={kernelName:_g,backendName:"cpu",kernelFunc:IIe},kIe=el.nonMaxSuppressionV5Impl;function EIe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l,softNmsSigma:h}=r;et(a,"NonMaxSuppressionWithScore");let c=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,m=i,g=o,b=l,v=h,{selectedIndices:x,selectedScores:_}=kIe(c,p,m,g,b,v);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([_.length],"float32",new Float32Array(_))]}var NIe={kernelName:Sg,backendName:"cpu",kernelFunc:EIe};function CIe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:o,offValue:l}=r;et(a,"oneHot");let h=$.sizeFromShape(a.shape),c=new Float32Array(h*i);c.fill(l);let p=n.data.get(a.dataId).values;for(let m=0;m<h;++m)p[m]>=0&&p[m]<i&&(c[m*i+p[m]]=o);return n.makeTensorInfo([...a.shape,i],s,c)}var AIe={kernelName:bp,backendName:"cpu",kernelFunc:CIe};function D_(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let a=fd({inputs:{input:r},backend:n}),s=D_({inputs:{x:a},backend:n}),i=Nm({inputs:{input:r},backend:n}),o=D_({inputs:{x:i},backend:n}),l=As({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),l}else return aD({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var RIe={kernelName:Bg,backendName:"cpu",kernelFunc:D_};function iH(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let a=fd({inputs:{input:r},backend:n}),s=iH({inputs:{x:a},backend:n}),i=Nm({inputs:{input:r},backend:n}),o=D_({inputs:{x:i},backend:n}),l=As({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),l}else return aD({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var DIe={kernelName:Ig,backendName:"cpu",kernelFunc:iH};function oH(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return R_({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{$.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),$.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let o=[],l=t.map(c=>{let p=R_({inputs:{input:c},backend:n,attrs:{dim:a}});return o.push(p),p}),h=Cm({inputs:l,backend:n,attrs:{axis:a}});return o.forEach(c=>n.disposeIntermediateTensorInfo(c)),h}var MIe={kernelName:Tg,backendName:"cpu",kernelFunc:oH};function $Ie(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:i}=r;et(a,"pad");let o=s.map((_,I)=>_[0]+a.shape[I]+_[1]),l=s.map(_=>_[0]),h=n.data.get(a.dataId).values,c=$.sizeFromShape(a.shape),p=a.shape.length,m=$.computeStrides(a.shape),g=$.sizeFromShape(o),b=o.length,v=$.computeStrides(o),x=$.getTypedArrayFromDType(a.dtype,g);i!==0&&x.fill(i);for(let _=0;_<c;_++){let I=$.indexToLoc(_,p,m).map((E,R)=>E+l[R]),k=$.locToIndex(I,b,v);x[k]=h[_]}return{dataId:n.write(x,o,a.dtype),shape:o,dtype:a.dtype}}var lH={kernelName:vp,backendName:"cpu",kernelFunc:$Ie},OIe=br((e,t)=>Math.pow(e,t)),FIe=qr(xp,OIe),PIe={kernelName:xp,backendName:"cpu",kernelFunc:FIe};function LIe(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:i}=t,{outputRaggedRank:o}=r,l=a.map(_=>n.data.get(_.dataId).values),h=a.map(_=>_.shape),c=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,[m,g,b]=M5(l,h,c,s.shape,s.dtype,p,i.shape),v=m.map(_=>n.makeTensorInfo([_.length],"int32",_)),x=n.makeTensorInfo(b,s.dtype,g);return v.concat([x])}var zIe={kernelName:A1,backendName:"cpu",kernelFunc:LIe};function VIe(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values,[h,c]=$5(i,r.shape,r.dtype,o,a.shape,l,s.shape),p=n.makeTensorInfo([h.length],"int32",h),m=n.makeTensorInfo([c.length],r.dtype,c);return[p,m]}var UIe={kernelName:R1,backendName:"cpu",kernelFunc:VIe};function BIe(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:i,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,h=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,m=o.map(x=>n.data.get(x.dataId).values),g=o.map(x=>x.shape),[b,v]=O5(h,a.shape,c,s.shape,s.dtype,p,i.shape,m,g,l);return n.makeTensorInfo(b,s.dtype,v)}var WIe={kernelName:D1,backendName:"cpu",kernelFunc:BIe};function jIe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,dtype:s,step:i}=n,o=XR(r,a,i,s);return t.makeTensorInfo([o.length],s,o)}var HIe={kernelName:Vv,backendName:"cpu",kernelFunc:jIe},GIe=yn(Sp,e=>1/e),qIe={kernelName:Sp,backendName:"cpu",kernelFunc:GIe};function KIe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:o}=r;et(a,"resizeBilinear");let l=$.computeStrides(a.shape),[h,c]=o,[p,m,g,b]=a.shape,v=n.data.get(a.dataId).values,x=new Float32Array($.sizeFromShape([p,h,c,b])),_=[s&&h>1?m-1:m,s&&c>1?g-1:g],I=[s&&h>1?h-1:h,s&&c>1?c-1:c],k=0,E=_[0]/I[0],R=_[1]/I[1];for(let U=0;U<p;U++)for(let D=0;D<h;D++){let C;i?C=E*(D+.5)-.5:C=E*D;let O=Math.max(0,Math.floor(C)),z=C-O,M=Math.min(m-1,Math.ceil(C)),N=U*l[0]+O*l[1],P=U*l[0]+M*l[1];for(let Q=0;Q<c;Q++){let ee;i?ee=R*(Q+.5)-.5:ee=R*Q;let q=Math.max(0,Math.floor(ee)),Z=ee-q,ne=Math.min(g-1,Math.ceil(ee)),me=N+q*l[2],xe=P+q*l[2],H=N+ne*l[2],se=P+ne*l[2];for(let ue=0;ue<b;ue++){let ge=v[me+ue],Ee=v[xe+ue],$e=v[H+ue],Oe=v[se+ue],Fe=ge+($e-ge)*Z,We=Ee+(Oe-Ee)*Z,at=Fe+(We-Fe)*z;x[k++]=at}}}return n.makeTensorInfo([p,h,c,b],"float32",x)}var XIe={kernelName:kp,backendName:"cpu",kernelFunc:KIe};function YIe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r;et([s,a],"resizeBilinearGrad");let o=$.computeStrides(a.shape),[l,h,c,p]=a.shape,[,m,g]=s.shape,b=new Float32Array(l*h*c*p),v=[i&&m>1?h-1:h,i&&g>1?c-1:c],x=[i&&m>1?m-1:m,i&&g>1?g-1:g],_=v[0]/x[0],I=v[1]/x[1],k=n.data.get(s.dataId).values,E=0;for(let R=0;R<l;R++){let U=R*o[0];for(let D=0;D<m;D++){let C=D*_,O=Math.floor(C),z=Math.min(Math.ceil(C),h-1),M=U+O*o[1],N=U+z*o[1],P=C-O,Q=1-P;for(let ee=0;ee<g;ee++){let q=ee*I,Z=Math.floor(q),ne=Math.min(Math.ceil(q),c-1),me=q-Z,xe=1-me,H=M+Z*o[2],se=M+ne*o[2],ue=N+Z*o[2],ge=N+ne*o[2],Ee=Q*xe,$e=Q*me,Oe=P*xe,Fe=P*me;for(let We=0;We<p;We++){let at=k[E++];b[H+We]+=at*Ee,b[se+We]+=at*$e,b[ue+We]+=at*Oe,b[ge+We]+=at*Fe}}}}return n.makeTensorInfo([l,c,h,p],"float32",b)}var QIe={kernelName:Ng,backendName:"cpu",kernelFunc:YIe};function ZIe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:o}=r;et(a,"resizeNearestNeighbor");let l=$.computeStrides(a.shape),[h,c]=o,[p,m,g,b]=a.shape,v=n.data.get(a.dataId).values,x=new Float32Array(p*h*c*b),_=[s&&h>1?m-1:m,s&&c>1?g-1:g],I=[s&&h>1?h-1:h,s&&c>1?c-1:c],k=_[0]/I[0],E=_[1]/I[1],R=0;for(let U=0;U<p;U++){let D=U*l[0];for(let C=0;C<h;C++){let O=i?k*(C+.5):k*C,z=Math.min(m-1,s?Math.round(O):Math.floor(O));i&&(z=Math.max(0,z));let M=D+z*l[1];for(let N=0;N<c;N++){let P=i?E*(N+.5):E*N,Q=Math.min(g-1,s?Math.round(P):Math.floor(P));i&&(Q=Math.max(0,Q));let ee=M+Q*l[2];for(let q=0;q<b;q++){let Z=v[ee+q];x[R++]=Z}}}}return n.makeTensorInfo([p,h,c,b],a.dtype,x)}var JIe={kernelName:Tp,backendName:"cpu",kernelFunc:ZIe};function eTe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r;et([s,a],"resizeNearestNeighborGrad");let o=$.computeStrides(a.shape),l=$.computeStrides(s.shape),[h,c,p,m]=a.shape,[,g,b]=s.shape,v=new Float32Array(h*c*p*m),x=n.data.get(s.dataId).values,_=[i&&g>1?c-1:c,i&&b>1?p-1:p],I=[i&&g>1?g-1:g,i&&b>1?b-1:b],k=_[0]/I[0],E=_[1]/I[1],R=1/k,U=1/E,D=Math.ceil(R)*2+2,C=Math.ceil(U)*2+2;for(let O=0;O<h;O++){let z=O*o[0];for(let M=0;M<c;M++){let N=z+M*o[1],P=Math.floor(M*R),Q=Math.floor(P-D/2);for(let ee=0;ee<p;ee++){let q=N+ee*o[2],Z=Math.floor(ee*U),ne=Math.floor(Z-C/2);for(let me=0;me<m;me++){let xe=0;for(let H=0;H<D;H++){let se=H+Q;if(se<0||se>=g)continue;let ue=z+se*l[1],ge=se*k,Ee=Math.min(c-1,i?Math.round(ge):Math.floor(ge));if(M===Ee)for(let $e=0;$e<C;$e++){let Oe=$e+ne;if(Oe<0||Oe>=b)continue;let Fe=ue+Oe*l[2],We=Oe*E,at=Math.min(p-1,i?Math.round(We):Math.floor(We));ee===at&&(xe+=x[Fe+me])}}v[q+me]=xe}}}}return n.makeTensorInfo(a.shape,a.dtype,v)}var tTe={kernelName:Eg,backendName:"cpu",kernelFunc:eTe};function nTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r;et(a,"reverse");let i=a.shape.length,o=$.parseAxisParam(s,a.shape);if(i===0)return Xo({inputs:{x:a},backend:n});let l=new Er(a.shape,a.dtype),h=n.bufferSync(a);for(let c=0;c<l.size;c++){let p=l.indexToLoc(c),m=p.slice();o.forEach(g=>m[g]=a.shape[g]-1-m[g]),l.set(h.get(...m),...p)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}var rTe={kernelName:Np,backendName:"cpu",kernelFunc:nTe},aTe={kernelName:Wg,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:i}=t,o=n,l=$.getTypedArrayFromDType(r.dtype,$.sizeFromShape(r.shape)),[h,c,p,m]=r.shape,[g,b]=B.getImageCenter(i,c,p),v=255,x=Math.sin(a),_=Math.cos(a),I=o.data.get(r.dataId).values;for(let k=0;k<h;k++){let E=k*p*c*m;for(let R=0;R<c;R++){let U=R*(p*m);for(let D=0;D<p;D++){let C=D*m;for(let O=0;O<m;O++){let z=[h,R,D,O],M=z[2],N=z[1],P=(M-g)*_-(N-b)*x,Q=(M-g)*x+(N-b)*_;P=Math.round(P+g),Q=Math.round(Q+b);let ee=s;if(typeof s!="number"&&(O===3?ee=v:ee=s[O]),P>=0&&P<p&&Q>=0&&Q<c){let Z=Q*(p*m),ne=P*m,me=E+Z+ne+O;ee=I[me]}let q=E+U+C+O;l[q]=ee}}}}return{dataId:o.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},sTe=yn(Cp,e=>{let t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),iTe={kernelName:Cp,backendName:"cpu",kernelFunc:sTe};function oTe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:i}=r,{sliceRank:o,numUpdates:l,sliceSize:h,strides:c,outputSize:p}=B.calculateShapes(s,a,i),m=!0,g=n.bufferSync(a),b=n.bufferSync(s),v=zh(g,b,i,p,h,l,o,c,0,m);return n.makeTensorInfo(i,v.dtype,v.values)}var lTe={kernelName:Cg,backendName:"cpu",kernelFunc:oTe};function uTe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function cTe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}function hTe(e,t,n,r,a,s){let i=$.getArrayFromDType("int32",n*a);for(let o=0;o<n;++o){let l=e.slice(o*r,(o+1)*r),h=o*a;for(let c=0;c<a;++c)i[h+c]=s==="left"?uTe(l,t[c+h]):cTe(l,t[c+h])}return i}function dTe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values,h=hTe(o,l,a.shape[0],a.shape[1],s.shape[1],i);return n.makeTensorInfo(s.shape,"int32",h)}var pTe={kernelName:Rg,backendName:"cpu",kernelFunc:dTe};function fTe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t;et([r,a,s],"select");let i=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,c=ti(a.dtype,s.dtype),p=$.makeZerosTypedArray($.sizeFromShape(a.shape),c),m=0,g=i===0||i>1||a.shape.length===1?1:$.sizeFromShape(a.shape.slice(1));for(let b=0;b<o.length;b++)for(let v=0;v<g;v++)o[b]===1?p[m++]=l[b]:p[m++]=h[b];return n.makeTensorInfo(a.shape,c,p)}var mTe={kernelName:Dg,backendName:"cpu",kernelFunc:fTe},gTe=B.SELU_SCALEALPHA,yTe=B.SELU_SCALE,bTe=yn(Rp,e=>e>=0?yTe*e:gTe*(Math.exp(e)-1)),vTe={kernelName:Rp,backendName:"cpu",kernelFunc:bTe},xTe=yn($p,e=>e<0?-1:e>0?1:0),wTe={kernelName:$p,backendName:"cpu",kernelFunc:xTe},_Te=yn(Dp,e=>Math.sin(e)),STe={kernelName:Dp,backendName:"cpu",kernelFunc:_Te},ITe=yn(Mp,e=>Math.sinh(e)),TTe={kernelName:Mp,backendName:"cpu",kernelFunc:ITe},kTe=11920928955078125e-23,wL=Math.log(kTe)+2,ETe=yn(Fp,e=>{let t=e>-wL,n=e<wL,r=Math.exp(e),a;return n?a=r:t?a=e:a=Math.log(1+r),a}),NTe={kernelName:Fp,backendName:"cpu",kernelFunc:ETe};function CTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r;et([a],"spaceToBatchND");let o=$.sizeFromShape(s),l=[[0,0]];l.push(...i);for(let x=1+s.length;x<a.shape.length;++x)l.push([0,0]);let h=lH.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),c=B.getReshaped(h.shape,s,o,!1),p=B.getPermuted(c.length,s.length,!1),m=B.getReshapedPermuted(h.shape,s,o,!1),g=$n({inputs:{x:h},backend:n,attrs:{shape:c}}),b=cs({inputs:{x:g},backend:n,attrs:{perm:p}}),v=$n({inputs:{x:b},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),v}var ATe={kernelName:$g,backendName:"cpu",kernelFunc:CTe};function RTe(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${a.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,c=n.data.get(i.dataId).values[0],[p,m,g,b,v]=L5(o,r.shape,r.dtype,l,a.dtype,h,c);return[n.makeTensorInfo(m,r.dtype,p),n.makeTensorInfo([m[0]],a.dtype,g),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(x=>Number(x)))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}var DTe={kernelName:Uv,backendName:"cpu",kernelFunc:RTe};function MTe(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(n.data.get(a.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[h,c,p]=z5(o,r.shape,r.dtype,i,l);return[n.makeTensorInfo(c,r.dtype,h),n.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var $Te={kernelName:Fg,backendName:"cpu",kernelFunc:MTe};function OTe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values,[h,c]=YR(i,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,h)}var FTe={kernelName:Bv,backendName:"cpu",kernelFunc:OTe};function PTe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values,[h,c]=YR(i,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,h)}var LTe={kernelName:Wv,backendName:"cpu",kernelFunc:PTe};function zTe(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:h,sliceSize:c,strides:p,outputSize:m}=B.calculateShapes(s,a,o),g=!1,b=n.bufferSync(a),v;switch(s.dtype){case"bool":{let x=n.bufferSync(s),_=!!n.data.get(i.dataId).values[0];v=zh(b,x,o,m,c,h,l,p,_,g);break}case"float32":{let x=n.bufferSync(s),_=n.data.get(i.dataId).values[0];v=zh(b,x,o,m,c,h,l,p,_,g);break}case"int32":{let x=n.bufferSync(s),_=n.data.get(i.dataId).values[0];v=zh(b,x,o,m,c,h,l,p,_,g);break}case"string":{let x=n.bufferSync(s),_=$.decodeString(n.data.get(i.dataId).values[0]);v=zh(b,x,o,m,c,h,l,p,_,g);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(o,v.dtype,v.values)}var VTe={kernelName:Pg,backendName:"cpu",kernelFunc:zTe};function UTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=r,o=$.parseAxisParam(i,a.shape)[0],l=B.prepareSplitSize(a,s,o),h=new Array(a.shape.length).fill(0),c=a.shape.slice();return l.map(p=>{let m=[...c];m[o]=p;let g=md({inputs:{x:a},backend:n,attrs:{begin:h,size:m}});return h[o]+=p,g})}var BTe={kernelName:Og,backendName:"cpu",kernelFunc:UTe},WTe={kernelName:jv,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t;et(n,"square");let a=r.data.get(n.dataId).values,s=new Float32Array(a.length);for(let i=0;i<a.length;++i){let o=a[i];s[i]=o*o}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},jTe=yn(Bc,(e,t)=>{let n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),HTe={kernelName:Bc,backendName:"cpu",kernelFunc:jTe};function GTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:i,strides:o,beginMask:l,endMask:h,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:m}=r;et(a,"stridedSlice");let{finalShapeSparse:g,finalShape:b,isIdentity:v,sliceDim0:x,isSimpleSlice:_,begin:I,end:k,strides:E}=jr.sliceInfo(a.shape,s,i,o,l,h,c,p,m),R;if(v)R=$n({inputs:{x:a},backend:n,attrs:{shape:b}});else if(x||_){$.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let U=jr.computeOutShape(I,k,E),D=md({inputs:{x:a},backend:n,attrs:{begin:I,size:U}});R=$n({inputs:{x:D},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(D)}else{let U=n.bufferSync(a),D=B5(g,U,E,I);R=n.makeTensorInfo(b,D.dtype,D.values)}return R}var qTe={kernelName:Lg,backendName:"cpu",kernelFunc:GTe};function KTe(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:i,rightPad:o,padWidth:l,preserveShortSequences:h}=r,{data:c,dataSplits:p}=t,m=n.data.get(c.dataId).values,g=n.data.get(p.dataId).values,[b,v]=QR(m,g,a,s,i,o,l,h);return[n.makeTensorInfo([b.length],"string",b),n.makeTensorInfo(p.shape,"int32",v)]}var XTe={kernelName:Gv,backendName:"cpu",kernelFunc:KTe};function YTe(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:i}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let o=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values[0],[h,c,p]=ZR(o,l,a),m=c.length;return[n.makeTensorInfo([m,2],"int32",h),n.makeTensorInfo([m],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(p))]}var QTe={kernelName:qv,backendName:"cpu",kernelFunc:YTe};function ZTe(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let i=n.data.get(s.dataId).values,o=JR(i,a);return n.makeTensorInfo(s.shape,"int32",o)}var JTe={kernelName:Kv,backendName:"cpu",kernelFunc:ZTe},eke=yn(Bp,e=>Math.tan(e)),tke={kernelName:Bp,backendName:"cpu",kernelFunc:eke},nke=yn(Wp,e=>Math.tanh(e)),rke={kernelName:Wp,backendName:"cpu",kernelFunc:nke};function ake(e){let{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:s}=t,{sliceRank:i,numUpdates:o,sliceSize:l,strides:h,outputSize:c}=B.calculateShapes(s,a,r.shape),p=!1,m=n.bufferSync(a),g=n.bufferSync(s),b=n.bufferSync(r),v=zh(m,g,r.shape,c,l,o,i,h,b,p);return n.makeTensorInfo(r.shape,v.dtype,v.values)}var ske={kernelName:Ag,backendName:"cpu",kernelFunc:ake};function ike(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;et(a,"tile");let i=j5(n.bufferSync(a),s);return n.makeTensorInfo(i.shape,i.dtype,i.values)}var oke={kernelName:Uc,backendName:"cpu",kernelFunc:ike};function lke(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:i}=r;et(a,"topk");let o=n.data.get(a.dataId).values,[l,h]=G5(o,a.shape,a.dtype,s,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(h.shape,h.dtype,h.values)]}var uke={kernelName:zg,backendName:"cpu",kernelFunc:lke};function cke(e){let{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:s}=t,{interpolation:i,fillMode:o,fillValue:l,outputShape:h}=n,[c,p,m,g]=a.shape,[b,v]=h??[p,m],x=[c,b,v,g],_=$.computeStrides(a.shape),I=_[0],k=_[1],E=_[2],R=$.computeStrides(x),U=R[0],D=R[1],C=R[2],O=$.getTypedArrayFromDType(a.dtype,$.sizeFromShape(x));O.fill(l);let z=r.data.get(a.dataId).values,M=r.data.get(s.dataId).values;for(let N=0;N<c;++N){let P=s.shape[0]===1?M:M.subarray(N*8,N*8+8);for(let Q=0;Q<b;++Q)for(let ee=0;ee<v;++ee)for(let q=0;q<g;++q){let Z,ne=P[6]*ee+P[7]*Q+1;if(ne===0)continue;let me=(P[0]*ee+P[1]*Q+P[2])/ne,xe=(P[3]*ee+P[4]*Q+P[5])/ne,H=_L(me,m,o),se=_L(xe,p,o);switch(i){case"nearest":Z=gke(z,p,m,I,k,E,N,se,H,q,l);break;case"bilinear":Z=yke(z,p,m,I,k,E,N,se,H,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}let ue=N*U+Q*D+ee*C+q;O[ue]=Z}return r.makeTensorInfo(x,a.dtype,O)}return{dataId:r.write(O,x,a.dtype),shape:a.shape,dtype:a.dtype}}var hke={kernelName:Vg,backendName:"cpu",kernelFunc:cke};function _L(e,t,n){switch(n){case"reflect":return dke(e,t);case"wrap":return pke(e,t);case"nearest":return mke(e,t);case"constant":default:return fke(e)}}function dke(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{let r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return $.clamp(0,n,t-1)}function pke(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{let r=t-1;n-=t*Math.trunc(n/r)}return $.clamp(0,n,t-1)}function fke(e,t){return e}function mke(e,t){return $.clamp(0,e,t-1)}function yb(e,t,n,r,a,s,i,o,l,h,c){let p=i*r+o*a+l*s+h;return 0<=o&&o<t&&0<=l&&l<n?e[p]:c}function gke(e,t,n,r,a,s,i,o,l,h,c){let p=Math.round(o),m=Math.round(l);return yb(e,t,n,r,a,s,i,p,m,h,c)}function yke(e,t,n,r,a,s,i,o,l,h,c){let p=Math.floor(o),m=Math.floor(l),g=p+1,b=m+1,v=(b-l)*yb(e,t,n,r,a,s,i,p,m,h,c)+(l-m)*yb(e,t,n,r,a,s,i,p,b,h,c),x=(b-l)*yb(e,t,n,r,a,s,i,g,m,h,c)+(l-m)*yb(e,t,n,r,a,s,i,g,b,h,c);return(g-o)*v+(o-p)*x}function bke(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;et(s,"unique");let i=r.data.get(s.dataId).values,{outputValues:o,outputShape:l,indices:h}=tD(i,a,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,o),r.makeTensorInfo([h.length],"int32",h)]}var vke={kernelName:Xv,backendName:"cpu",kernelFunc:bke};function xke(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a.shape.length,o=a.shape[s],l=new Array(i-1),h=0;for(let g=0;g<i;g++)g!==s&&(l[h++]=a.shape[g]);let c=new Array(i).fill(0),p=a.shape.slice();p[s]=1;let m=new Array(o);for(let g=0;g<m.length;g++){c[s]=g;let b=md({inputs:{x:a},backend:n,attrs:{begin:c,size:p}});m[g]=$n({inputs:{x:b},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(b)}return m}var wke={kernelName:Ug,backendName:"cpu",kernelFunc:xke};function _ke(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:i}=r;et(a,"unsortedSegmentSum");let o=a.shape.length,l=s.shape.length,h=[],c=[],p=o-l,m=s;for(let b=0;b<p;++b){let v=R_({inputs:{input:m},backend:n,attrs:{dim:b+1}});m=v,c.push(v)}for(let b=0;b<i;++b){let v=$.createScalarValue(b,"int32"),x=n.makeTensorInfo([],"int32",v),_=p5({inputs:{a:x,b:m},backend:n}),I=Nc({inputs:{x:_},backend:n,attrs:{dtype:"float32"}}),k=zS({inputs:{a:I,b:a},backend:n}),E=Tx({inputs:{x:k},backend:n,attrs:{axis:0,keepDims:!1}});h.push(E),c.push(x),c.push(_),c.push(I),c.push(k),c.push(E)}let g=oH({inputs:h,backend:n,attrs:{axis:0}});return c.forEach(b=>n.disposeIntermediateTensorInfo(b)),g}var Ske={kernelName:Yv,backendName:"cpu",kernelFunc:_ke},Ike=[y_e,Ywe,v_e,w_e,n0e,S_e,T_e,E_e,C_e,R_e,M_e,O_e,P_e,V_e,B_e,H_e,q_e,X_e,Q_e,m_e,J_e,t1e,r1e,a0e,s1e,e0e,i0e,o1e,Qwe,u1e,h1e,d1e,f1e,g1e,b1e,x1e,_1e,I1e,k1e,N1e,A1e,D1e,$1e,F1e,P1e,z1e,U1e,W1e,j1e,H1e,G1e,K1e,Q1e,l_e,J1e,o0e,oSe,l0e,lSe,c0e,fSe,mSe,ySe,d0e,f0e,vSe,wSe,SSe,TSe,g0e,b0e,Zwe,ESe,c1e,CSe,RSe,MSe,u_e,x0e,_0e,OSe,I0e,PSe,VSe,BSe,HSe,qSe,XSe,YSe,k0e,ZSe,eIe,nIe,aIe,iIe,lIe,cIe,N0e,dIe,mIe,vIe,A0e,D0e,_Ie,TIe,NIe,$0e,AIe,DIe,MIe,lH,PIe,h_e,P0e,zIe,UIe,WIe,HIe,Jwe,QE,qIe,d_e,p_e,f_e,XIe,QIe,JIe,tTe,rTe,aTe,iTe,G0e,lTe,pTe,mTe,vTe,K0e,wTe,STe,TTe,X0e,yIe,NTe,ATe,DTe,$Te,FTe,LTe,VTe,BTe,Z0e,WTe,e_e,n_e,HTe,qTe,XTe,QTe,JTe,i_e,X1e,tke,rke,ske,oke,uke,hke,O0e,vke,wke,Ske,RIe];for(let e of Ike)Qv(e);var uH={};_t(uH,{assertNotComplex:()=>ny,bindCanvasToFramebuffer:()=>Oke,bindColorTextureToFramebuffer:()=>O0,bindTextureToProgramUniformSampler:()=>TH,bindTextureUnit:()=>_H,bindVertexBufferToProgramAttribute:()=>JE,callAndCheck:()=>He,canBeRepresented:()=>hH,createFragmentShader:()=>fH,createFramebuffer:()=>wH,createProgram:()=>mH,createStaticIndexBuffer:()=>bH,createStaticVertexBuffer:()=>yH,createTexture:()=>vH,createVertexShader:()=>pH,getBatchDim:()=>gd,getExtensionOrThrow:()=>bb,getFramebufferErrorMessage:()=>kH,getMaxTexturesInShader:()=>AH,getNumChannels:()=>Mke,getProgramUniformLocation:()=>IH,getProgramUniformLocationOrThrow:()=>SH,getRowsCols:()=>yd,getShapeAs3D:()=>xb,getTextureShapeFromLogicalShape:()=>NH,getWebGLDisjointQueryTimerVersion:()=>RH,getWebGLErrorMessage:()=>dH,getWebGLMaxTextureSize:()=>CH,hasExtension:()=>Qs,isCapableOfRenderingToFloatTexture:()=>DH,isDownloadFloatTextureEnabled:()=>MH,isReshapeFree:()=>ov,isWebGLFenceEnabled:()=>$H,isWebGLVersionEnabled:()=>tN,linkProgram:()=>gH,logShaderSourceAndInfoLog:()=>iD,resetMaxTextureSize:()=>Fke,resetMaxTexturesInShader:()=>Pke,unbindColorTextureFromFramebuffer:()=>eN,unbindTextureUnit:()=>$ke,validateFramebuffer:()=>vb,validateProgram:()=>$0,validateTextureSize:()=>xH});var Oh={},d0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function cH(e,t){Oh[e]=t}function ro(e,t){if(!(e in Oh)||t!=null){let r=kke(e,t);if(r!==null)Oh[e]=r;else return console.log("Could not get context for WebGL version",e),null}let n=Oh[e];return n==null||n.isContextLost()?(delete Oh[e],ro(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Oh[e])}function Tke(e){if(!he().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function kke(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=t??Tke(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Oh[e]},!1),he().getBool("SOFTWARE_WEBGL_ENABLED")&&(d0.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",d0)||n.getContext("experimental-webgl",d0):n.getContext("webgl2",d0)}var iv;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(iv||(iv={}));var Ys;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Ys||(Ys={}));var fa;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(fa||(fa={}));function kx(e,t){return[t,e]}function Eke(e,t){return e*t}function p0(e){let t=$.sizeFromShape(e),n=Math.ceil(t/4);return $.sizeToSquarishShape(n)}function ty(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Nke(e,t){let[n,r]=ty(e,t);return n*r*4}function sD(e,t){let n=e,r,a,s,i,o,l,h,c,p,m;return he().getNumber("WEBGL_VERSION")===2?(r=n.R32F,a=n.R16F,s=n.RGBA16F,i=n.RGBA32F,o=n.RED,h=4,c=1,p=n.HALF_FLOAT,m=n.FLOAT,l=n.RGBA8):(r=e.RGBA,a=e.RGBA,s=e.RGBA,i=n.RGBA,o=e.RGBA,h=4,c=4,p=t!=null?t.HALF_FLOAT_OES:null,m=e.FLOAT,l=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:h,defaultNumChannels:c,textureTypeHalfFloat:p,textureTypeFloat:m}}function He(e,t){let n=t();return he().getBool("DEBUG")&&Cke(e),n}function Cke(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+dH(e,t))}var Ake=596e-10,Rke=65504;function hH(e){return!!(he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||Ake<Math.abs(e)&&Math.abs(e)<Rke)}function dH(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function bb(e,t){return su(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function pH(e,t){let n=su(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(He(e,()=>e.shaderSource(n,t)),He(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function fH(e,t){let n=su(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(He(e,()=>e.shaderSource(n,t)),He(e,()=>e.compileShader(n)),he().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw iD(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Dke=/ERROR: [0-9]+:([0-9]+):/g;function iD(e,t){let n=Dke.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}let r=+n[1],a=e.split(`
`),s=a.length.toString().length+2,i=a.map((p,m)=>$.rightPad((m+1).toString(),s)+p),o=0;for(let p=0;p<i.length;p++)o=Math.max(i[p].length,o);let l=i.slice(0,r-1),h=i.slice(r-1,r),c=i.slice(r);console.log(l.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${$.rightPad(h[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function mH(e){return su(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function gH(e,t){if(He(e,()=>e.linkProgram(t)),!he().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function $0(e,t){if(He(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function yH(e,t){let n=su(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return He(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),He(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function bH(e,t){let n=su(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return He(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),He(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function Mke(){return he().getNumber("WEBGL_VERSION")===2?1:4}function vH(e){return su(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function xH(e,t){let n=he().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){let r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){let r=`[${e}x${t}]`,a=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function wH(e){return su(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function JE(e,t,n,r,a,s,i){let o=e.getAttribLocation(t,n);return o===-1?!1:(He(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),He(e,()=>e.vertexAttribPointer(o,a,e.FLOAT,!1,s,i)),He(e,()=>e.enableVertexAttribArray(o)),!0)}function _H(e,t,n){EH(e,n),He(e,()=>e.activeTexture(e.TEXTURE0+n)),He(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function $ke(e,t){EH(e,t),He(e,()=>e.activeTexture(e.TEXTURE0+t)),He(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function SH(e,t,n){return su(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function IH(e,t,n){return e.getUniformLocation(t,n)}function TH(e,t,n,r){He(e,()=>_H(e,t,r)),He(e,()=>e.uniform1i(n,r))}function Oke(e){He(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),He(e,()=>e.viewport(0,0,e.canvas.width,e.canvas.height)),He(e,()=>e.scissor(0,0,e.canvas.width,e.canvas.height))}function O0(e,t,n){He(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),He(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function eN(e,t){He(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),He(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function vb(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+kH(e,t))}function kH(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function su(e,t,n){let r=He(e,()=>t());if(r==null)throw new Error(n);return r}function EH(e,t){let n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){let a=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${a}.`)}}function gd(e,t=2){return $.sizeFromShape(e.slice(0,e.length-t))}function yd(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function xb(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[gd(e),...yd(e)]),t}function NH(e,t=!1){let n=he().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=he().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&he().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((o,l)=>l>=e.length-2?$.nearestLargerEven(e[l]):e[l]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=$.squeezeShape(e).newShape);let a=$.sizeFromShape(e),s=null;e.length<=1&&a<=n?s=[1,a]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);let i=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||i)if(t){let o=gd(e),l=2,h=2;e.length&&([l,h]=yd(e)),a=o*(l/2)*(h/2),s=$.sizeToSquarishShape(a).map(c=>c*2)}else s=$.sizeToSquarishShape(a);return s}function f0(e){return e%2===0}function ov(e,t){if(e=e.slice(-2),t=t.slice(-2),$.arraysEqual(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){let n=e[e.length-1],r=t[t.length-1];if(n===r||f0(n)&&f0(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&f0(e[0])&&f0(t[0])}var F0,P0;function CH(e){if(F0==null){let t=ro(e);F0=t.getParameter(t.MAX_TEXTURE_SIZE)}return F0}function Fke(){F0=null}function Pke(){P0=null}function AH(e){if(P0==null){let t=ro(e);P0=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,P0)}function RH(e){if(e===0)return 0;let t,n=ro(e);return Qs(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:Qs(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function Qs(e,t){return e.getExtension(t)!=null}function tN(e){try{if(ro(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function DH(e){if(e===0)return!1;let t=ro(e);if(e===1){if(!Qs(t,"OES_texture_float"))return!1}else if(!Qs(t,"EXT_color_buffer_float"))return!1;return nN(t)}function MH(e){if(e===0)return!1;let t=ro(e);if(e===1){if(!Qs(t,"OES_texture_float")||!Qs(t,"WEBGL_color_buffer_float"))return!1}else{if(Qs(t,"EXT_color_buffer_float"))return nN(t);let n="EXT_color_buffer_half_float";if(Qs(t,n)){let r=t.getExtension(n);return Lke(t,r)}return!1}return nN(t)}function nN(e){let t=sD(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Lke(e,t){let n=sD(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),s}function $H(e){return e!==2?!1:ro(e).fenceSync!=null}function ny(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&$.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var tt=he();tt.registerFlag("HAS_WEBGL",()=>tt.getNumber("WEBGL_VERSION")>0);tt.registerFlag("WEBGL_VERSION",()=>tN(2)?2:tN(1)?1:0);tt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);tt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>tt.get("WEBGL_VERSION")===2);tt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);tt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);tt.registerFlag("WEBGL_PACK",()=>tt.getBool("HAS_WEBGL"));tt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_CLIP",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_REDUCE",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_LAZILY_UNPACK",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_CONV_IM2COL",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>CH(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>AH(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let e=tt.getNumber("WEBGL_VERSION");return e===0?0:RH(e)});tt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>tt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ex.isMobile());tt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>DH(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>tt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:tt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));tt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>MH(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>$H(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>tt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);tt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});tt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ex.isMobile()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});tt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);tt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);tt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);tt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);tt.registerFlag("WEBGL_EXP_CONV",()=>!1);tt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>tt.getBool("IS_TEST"));tt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);tt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);tt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);tt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Ya(){let e,t,n,r,a,s,i,o,l,h;return he().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",i="out vec4 outputColor;",o=he().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",i="",o=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:i,defineSpecialNaN:o,defineSpecialInf:l,defineRound:h}}function Qp(e,t,n="index"){let r=$.computeStrides(t);return r.map((a,s)=>{let i=`int ${e[s]} = ${n} / ${a}`,o=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${a}`:`index -= ${e[s]} * ${a}`;return`${i}; ${o};`}).join("")}function VS(e,t,n="index"){let r=$.computeStrides(t);return r.map((a,s)=>{let i=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,o=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${i}; ${o};`}).join("")}function zke(e,t){let n=e.length,r=e.map(s=>`${t}[${s}]`),a=new Array(n-1);a[n-2]=r[n-1];for(let s=n-3;s>=0;--s)a[s]=`(${a[s+1]} * ${r[s+1]})`;return a}function Vke(e,t,n="index"){let r=e.map((s,i)=>i),a=zke(r,t);return a.map((s,i)=>{let o=`int ${e[i]} = ${n} / ${a[i]}`,l=i===a.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${a[i]}`:`index -= ${e[i]} * ${a[i]}`;return`${o}; ${l};`}).join("")}function oD(e){let t=$.computeStrides(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function lD(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var OH=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:FH}=B;function Uke(e,t,n){let r=[];if(e.forEach(m=>{let g=$.sizeFromShape(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?r.push(`uniform float ${m.name}${g>1?`[${g}]`:""};`):(r.push(`uniform sampler2D ${m.name};`),r.push(`uniform int offset${m.name};`)),n.enableShapeUniforms){let{uniformShape:b}=uD(n.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(b.length){case 1:r.push(`uniform int ${m.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${m.name}Shape;`);break}r.push(`uniform ivec2 ${m.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(m=>{r.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});let a=r.join(`
`),s=e.map(m=>Bke(m,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=t.texShape,o=Ya(),l=Hke(o),h,c,p=Kke(o);return t.isPacked?(h=Wke(t.logicalShape,i,n.enableShapeUniforms),c=qke(o)):(h=jke(t.logicalShape,i,n.enableShapeUniforms),c=Gke(o)),n.packedInputs&&(p+=Zke),[p,l,c,a,h,s,n.userCode].join(`
`)}function ry(e,t=!1){let n=e.shapeInfo.logicalShape;switch(n.length){case 0:return cEe(e,t);case 1:return dEe(e,t);case 2:return fEe(e,t);case 3:return gEe(e,t);case 4:return bEe(e,t);case 5:return vEe(e);case 6:return xEe(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function PH(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return uEe(e);case 1:return hEe(e,t);case 2:return pEe(e,t);case 3:return mEe(e,t);default:return yEe(e,t)}}function Bke(e,t,n=!1,r){let a="";n?a+=PH(e,r):a+=ry(e,r);let s=e.shapeInfo.logicalShape,i=t.logicalShape;return s.length<=i.length&&(n?a+=wEe(e,t):a+=_Ee(e,t)),a}function Wke(e,t,n){switch(e.length){case 0:return LH();case 1:return Jke(e,t,n);case 2:return oEe(e,t,n);case 3:return tEe(e,t,n);default:return rEe(e,t,n)}}function jke(e,t,n){switch(e.length){case 0:return LH();case 1:return eEe(e,t,n);case 2:return lEe(e,t,n);case 3:return nEe(e,t,n);case 4:return aEe(e,t,n);case 5:return sEe(e,t);case 6:return iEe(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function Hke(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function Gke(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function qke(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function Kke(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Xke}
    ${Yke}
    ${Qke}
  `}var Xke=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yke=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Qke=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Zke=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function LH(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Jke(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function eEe(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function tEe(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),s=a*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec3(b, r, c);
    }
  `}function nEe(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${VS(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;let r=Qp(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function rEe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),s=a*Math.ceil(e[e.length-2]/2),i=s,o="",l="b, r, c";for(let h=2;h<e.length-1;h++)i*=e[e.length-h-1],o=`
      int b${h} = index / ${i};
      index -= b${h} * ${i};
    `+o,l=`b${h}, `+l;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${o}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec${e.length}(${l});
    }
  `}function aEe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${VS(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;let r=Qp(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function sEe(e,t){let n=Qp(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function iEe(e,t){let n=Qp(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function oEe(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if($.arraysEqual(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let a=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec2(r, c);
    }
  `}function lEe(e,t,n){return $.arraysEqual(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function Zp(e){return`offset${e}`}function uEe(e){let t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ya();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function cEe(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;let[a,s]=e.shapeInfo.texShape;if(a===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let i=Zp(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;let[o,l]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${o}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function hEe(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,s=Ya();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;let i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function dEe(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${ay(e)}
      }
    `;let a=e.shapeInfo.texShape,s=a[0],i=a[1];if(i===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let o=Zp(n);return i===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${o});
      return sampleTexture(${n}, uv);
    }
  `}function pEe(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,i=s[0],o=s[1],l=Ya();if(s!=null&&$.arraysEqual(n,s))return t?`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${i}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${a}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let h=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${a}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${h[0]}, ${h[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function fEe(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&$.arraysEqual(n,s)){if(t)return`
      float ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let m=s[0],g=s[1];return`
    float ${a}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:i,keptDims:o}=$.squeezeShape(n),l=i;if(l.length<n.length){let m=sy(e,l),g=["row","col"];return`
      ${ry(m,t)}
      float ${a}(int row, int col) {
        return ${a}(${iy(g,o)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${ay(e)}
      }
    `;let h=s[0],c=s[1],p=Zp(r);return c===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `:h===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${a}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${a}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${p};
    vec2 uv = uvFromFlat(${h}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function mEe(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){let m=n.slice(1),g=[1,2],b=sy(e,m),v=["b","row","col"];return`
        ${PH(b,t)}
        vec4 ${a}(int b, int row, int col) {
          return ${a}(${iy(v,g)});
        }
      `}let o=Ya();if(t)return`
    vec4 ${a}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${o.texture2D}(${r}, uv);
    }
  `;let l=i[0],h=i[1],c=Math.ceil(n[2]/2),p=c*Math.ceil(n[1]/2);return`
    vec4 ${a}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${h}, ${p}, ${c}, b, row, col);
      return ${o.texture2D}(${r}, uv);
    }
  `}function gEe(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],i=n[2],{newShape:o,keptDims:l}=$.squeezeShape(n),h=o;if(h.length<n.length){let v=sy(e,h),x=["row","col","depth"];return`
        ${ry(v,t)}
        float ${a}(int row, int col, int depth) {
          return ${a}(${iy(x,l)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${ay(e)}
      }
    `;let c=e.shapeInfo.texShape,p=c[0],m=c[1],g=e.shapeInfo.flatOffset;if(m===s&&g==null)return t?`
      float ${a}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${a}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${p}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(m===i&&g==null)return t?`
      float ${a}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `;let b=Zp(r);return t?`
    float ${a}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${b};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${a}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${b};
        vec2 uv = uvFromFlat(${p}, ${m}, index);
        return sampleTexture(${r}, uv);
      }
  `}function yEe(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Ya();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);
    }
  `;let s=e.shapeInfo.logicalShape,i=s.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],h=l[0],c=l[1],p=Math.ceil(s[i-1]/2),m=p*Math.ceil(s[i-2]/2),g="int b, int row, int col",b=`b * ${m} + (row / 2) * ${p} + (col / 2)`;for(let v=2;v<i-1;v++)g=`int b${v}, `+g,m*=s[i-v-1],b=`b${v} * ${m} + `+b;return`
    vec4 ${r}(${g}) {
      int index = ${b};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${h});
      return ${a.texture2D}(${n}, uv);
    }
  `}function bEe(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],i=n[2]*s,o=n[1]*i,{newShape:l,keptDims:h}=$.squeezeShape(n);if(l.length<n.length){let I=sy(e,l),k=["row","col","depth","depth2"];return`
      ${ry(I,t)}
      float ${a}(int row, int col, int depth, int depth2) {
        return ${a}(${iy(k,h)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${o}, ${i}, ${s}, 1)));
        ${ay(e)}
      }
    `;let c=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],g=p[1],b=`int stride2 = ${r}Shape[3];`,v=`int stride1 = ${r}Shape[2] * stride2;`,x=`int stride0 = ${r}Shape[1] * stride1;`;if(g===o&&c==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        ${b}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(g===s&&c==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${r}, uv);
      }
    `;let _=Zp(r);return t?`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${b}
      ${v}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${_});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${m}, ${g}, index + ${_});
      return sampleTexture(${r}, uv);
    }
  `}function vEe(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],s=t[3]*a,i=t[2]*s,o=t[1]*i,{newShape:l,keptDims:h}=$.squeezeShape(t);if(l.length<t.length){let v=sy(e,l),x=["row","col","depth","depth2","depth3"];return`
      ${ry(v)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${iy(x,h)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${o}, ${i}, ${s}, ${a})) +
          depth3;
        ${ay(e)}
      }
    `;let c=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],g=p[1];if(g===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(g===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;let b=Zp(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${i} + depth * ${s} +
          depth2 * ${a} + depth3 + ${b};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${n}, uv);
    }
  `}function xEe(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:s}=$.squeezeShape(t);if(a.length<t.length){let x=sy(e,a),_=["row","col","depth","depth2","depth3","depth4"];return`
      ${ry(x)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${iy(_,s)});
      }
    `}let i=t[5],o=t[4]*i,l=t[3]*o,h=t[2]*l,c=t[1]*h;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${h}, ${l}, ${o})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${ay(e)}
      }
    `;let p=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],b=m[1];if(b===c&&p==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${h}, ${l}, ${o}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${b}.0, ${g}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(b===i&&p==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${b}.0, ${g}.0);
        return sampleTexture(${n}, uv);
      }
    `;let v=Zp(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${h} + depth * ${l} +
          depth2 * ${o} + depth3 * ${i} + depth4 + ${v};
      vec2 uv = uvFromFlat(${g}, ${b}, index);
      return sampleTexture(${n}, uv);
    }
  `}function ay(e){let t=e.name,n=$.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function wEe(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,o=FH(e.shapeInfo.logicalShape,t.logicalShape),l=Tn(i),h=i-s,c,p=["x","y","z","w","u","v"];s===0?c="":i<2&&o.length>=1?c="coords = 0;":c=o.map(x=>`coords.${p[x+h]} = 0;`).join(`
`);let m="";i<2&&s>0?m="coords":m=e.shapeInfo.logicalShape.map((x,_)=>`coords.${p[_+h]}`).join(", ");let g="return outputValue;",b=$.sizeFromShape(e.shapeInfo.logicalShape)===1,v=$.sizeFromShape(t.logicalShape)===1;if(s===1&&!b&&!v)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(b&&!v)i===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(o.length){let x=s-2,_=s-1;o.indexOf(x)>-1&&o.indexOf(_)>-1?g="return vec4(outputValue.x);":o.indexOf(x)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(_)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${a}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${m});
      ${g}
    }
  `}function _Ee(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=t.texShape,i=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&e.shapeInfo.flatOffset==null&&$.arraysEqual(i,s))return`
      float ${a}() {
        return sampleTexture(${n}, resultUV);
      }
    `;let h=Tn(l),c=FH(e.shapeInfo.logicalShape,t.logicalShape),p=l-o,m,g=["x","y","z","w","u","v"];o===0?m="":l<2&&c.length>=1?m="coords = 0;":m=c.map(v=>`coords.${g[v+p]} = 0;`).join(`
`);let b="";return l<2&&o>0?b="coords":b=e.shapeInfo.logicalShape.map((v,x)=>`coords.${g[x+p]}`).join(", "),`
    float ${a}() {
      ${h} coords = getOutputCoords();
      ${m}
      return get${r}(${b});
    }
  `}function Tn(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function uD(e,t,n){let{newShape:r,keptDims:a}=$.squeezeShape(t),s=t.length,i=e&&s===3&&t[0]===1,o=i?t.slice(1):r,l=!e&&s>1&&!$.arraysEqual(t,n)&&r.length<s||i;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:a}}function sy(e,t){let n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function iy(e,t){return t.map(n=>e[n]).join(", ")}function SEe(e,t,n,r){let a=n.map((c,p)=>{let m={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(m.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[p],shapeInfo:m}}),s=a.map(c=>c.shapeInfo),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=Uke(a,i,t),l=fH(e.gl,o),h=e.createProgram(l);return he().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:h,inShapeInfos:s,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(h),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:h,inShapeInfos:s,outShapeInfo:i},zH(e,t,h)))}function zH(e,t,n){let r=[],a=[],s,i,o,l=null,h=null;h=e.getUniformLocation(n,"NAN",!1),he().getNumber("WEBGL_VERSION")===1&&(l=e.getUniformLocation(n,"INFINITY",!1));let c=!1;for(let p of t.variableNames){let m={name:p,uniform:e.getUniformLocation(n,p,c),offset:e.getUniformLocation(n,`offset${p}`,c)};t.enableShapeUniforms&&(m.shape=e.getUniformLocation(n,`${p}Shape`,c),m.texShape=e.getUniformLocation(n,`${p}TexShape`,c)),r.push(m)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",c),o=e.getUniformLocation(n,"outShapeStrides",c),i=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(let p of t.customUniforms)a.push(e.getUniformLocation(n,p.name,c));return{variablesLocations:r,customUniformLocations:a,infLoc:l,nanLoc:h,outShapeLocation:s,outShapeStridesLocation:o,outTexShapeLocation:i}}function SL(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{let a=n.logicalShape,s=t[r],i=s.shape;if(!$.arraysEqual(a,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${a} and ${i} must match`);if(n.isUniform&&s.isUniform)return;let o=n.texShape,l=s.isUniform?null:s.texData.texShape;if(!$.arraysEqual(o,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${l} must match`)})}function IEe(e,t,n,r,a){t.program.enableShapeUniforms||(SL(t.inShapeInfos,n),SL([t.outShapeInfo],[r]));let s=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):e.setOutputMatrixTexture(s.texture,i[0],i[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),he().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){let h=n[l],{uniform:c,offset:p,shape:m,texShape:g}=t.variablesLocations[l];if(m){let{uniformShape:b}=uD(t.program.packedInputs,h.shape,h.texData.texShape);switch(b.length){case 1:e.gl.uniform1iv(m,new Int32Array(b));break;case 2:e.gl.uniform2iv(m,new Int32Array(b));break;case 3:e.gl.uniform3iv(m,new Int32Array(b));break;case 4:e.gl.uniform4iv(m,new Int32Array(b));break}}if(g&&e.gl.uniform2i(g,h.texData.texShape[0],h.texData.texShape[1]),c!=null){if(h.isUniform){if($.sizeFromShape(h.shape)<2)e.gl.uniform1f(c,h.uniformValues[0]);else{let b=h.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),e.gl.uniform1fv(c,b)}continue}h.texData.slice!=null&&p!=null&&e.gl.uniform1i(p,h.texData.slice.flatOffset),e.setInputMatrixTexture(h.texData.texture.texture,c,l)}}let o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){let l=$.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(l));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(l));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(l));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let l=0;l<t.program.customUniforms.length;++l){let h=t.program.customUniforms[l],c=t.customUniformLocations[l],p=a[l];if(h.type==="float")e.gl.uniform1fv(c,p);else if(h.type==="vec2")e.gl.uniform2fv(c,p);else if(h.type==="vec3")e.gl.uniform3fv(c,p);else if(h.type==="vec4")e.gl.uniform4fv(c,p);else if(h.type==="int")e.gl.uniform1iv(c,p);else if(h.type==="ivec2")e.gl.uniform2iv(c,p);else if(h.type==="ivec3")e.gl.uniform3iv(c,p);else if(h.type==="ivec4")e.gl.uniform4iv(c,p);else throw Error(`uniform type ${h.type} is not supported yet.`)}e.executeProgram()}function TEe(e,t,n){let r="";t.concat(n).forEach(i=>{let o=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!i.isUniform){let l=i.texData.texShape,{useSqueezeShape:h,uniformShape:c,keptDims:p}=uD(e.packedInputs,i.shape,l),m="",g="",b="";if(c.length===1&&e.packedInputs){let R=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];m=`${R[0]>1}_${R[1]>1}`}else if(c.length===2&&!e.packedInputs)g=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!e.packedInputs){let R=$.computeStrides(c);b=`${R[0]===l[1]}_${R[R.length-1]===l[1]}`}let v=i.shape.length,x=c.length===2&&$.arraysEqual(i.shape,l),_=$.sizeFromShape(i.shape)===1,I=B.getBroadcastDims(i.shape,n.shape),k=!e.packedInputs&&v===n.shape.length&&$.arraysEqual(l,n.texData.texShape),E=e.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${v}_${k}_${h?p:""}_${c.length}_${_}_${I}_${x}_${m}_${g}_${b}_${E}_${o}`}else{let l=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${l}_${o}`}});let a=e.userCode,s=e.constructor.name;return s+="_"+r+"_"+a+`${he().getNumber("WEBGL_VERSION")}`,s}function Ca(e){return he().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var kEe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=iv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=Ya();this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?VS(["r","c","d"],e):Qp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}},EEe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=iv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=Ya();this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?VS(["r","c","d"],e):Qp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}},NEe=class{constructor(e){this.variableNames=["A"],this.outTexUsage=Ys.DOWNLOAD;let t=Ya();this.outputShape=e,this.userCode=`
      ${OH}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}},CEe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ys.DOWNLOAD;let t=Ya();this.outputShape=e,this.userCode=`
      ${OH}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}},AEe={R:0,G:1,B:2,A:3},IL=class{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Ya();this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let s="";for(let i=0;i<n.length;i++){let o=n[i];s+=`
          if(offset == ${i}) {
            result = values[${AEe[o]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?lD():oD(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${s}
        }
        ${r.output} = vec4(${a}, 0., 0., 0.);
      }
    `}},REe=class{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=Ya();this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let o=s*2+i;r+=`
          localCoords = coords;
          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${i};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${o}] = values[0];
            } else if (offset == 1) {
              result[${o}] = values[1];
            } else if (offset == 2) {
              result[${o}] = values[2];
            } else {
              result[${o}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?lD():oD(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${n.output} = ${a};
        }
    `}},VH={};_t(VH,{bindVertexProgramAttributeStreams:()=>XH,createBufferFromOutputTexture:()=>ZH,createFloat16MatrixTexture:()=>HH,createFloat16PackedMatrixTexture:()=>KH,createFloat32MatrixTexture:()=>jH,createIndexBuffer:()=>WH,createPackedMatrixTexture:()=>qH,createUnsignedBytesMatrixTexture:()=>GH,createVertexBuffer:()=>BH,createVertexShader:()=>UH,downloadByteEncodedFloatMatrixFromOutputTexture:()=>eG,downloadFloat32MatrixFromBuffer:()=>JH,downloadMatrixFromPackedOutputTexture:()=>nG,downloadPackedMatrixFromBuffer:()=>tG,getInternalFormatForFloat16MatrixTexture:()=>hD,getInternalFormatForFloat16PackedMatrixTexture:()=>fD,getInternalFormatForFloat32MatrixTexture:()=>cD,getInternalFormatForPackedMatrixTexture:()=>pD,getInternalFormatForUnsignedBytesMatrixTexture:()=>dD,uploadDenseMatrixToTexture:()=>YH,uploadPixelDataToTexture:()=>QH});function UH(e){let t=Ya(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return pH(e,n)}function BH(e){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return yH(e,t)}function WH(e){let t=new Uint16Array([0,1,2,2,1,3]);return bH(e,t)}function Ex(e,t,n,r,a,s){xH(t,n);let i=vH(e),o=e.TEXTURE_2D;return He(e,()=>e.bindTexture(o,i)),He(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),He(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),He(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),He(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),he().getNumber("WEBGL_VERSION")===1?He(e,()=>e.texImage2D(o,0,r,t,n,0,a,s,null)):He(e,()=>e.texStorage2D(o,1,r,t,n)),He(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:i,texShape:[n,t]}}function cD(e){return e.internalFormatFloat}function jH(e,t,n,r){let[a,s]=kx(t,n);return Ex(e,a,s,cD(r),r.textureFormatFloat,e.FLOAT)}function hD(e){return e.internalFormatHalfFloat}function HH(e,t,n,r){let[a,s]=kx(t,n);return Ex(e,a,s,hD(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function dD(e){return e.downloadTextureFormat}function GH(e,t,n,r){let[a,s]=kx(t,n);return Ex(e,a,s,dD(r),e.RGBA,e.UNSIGNED_BYTE)}function pD(e){return e.internalFormatPackedFloat}function qH(e,t,n,r){let[a,s]=ty(t,n);return Ex(e,a,s,pD(r),e.RGBA,e.FLOAT)}function fD(e){return e.internalFormatPackedHalfFloat}function KH(e,t,n,r){let[a,s]=ty(t,n);return Ex(e,a,s,fD(r),e.RGBA,r.textureTypeHalfFloat)}function XH(e,t,n){return He(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),JE(e,t,"clipSpacePos",n,3,20,0)&&JE(e,t,"uv",n,2,20,12)}function YH(e,t,n,r,a,s){He(e,()=>e.bindTexture(e.TEXTURE_2D,t));let i,o,l;a instanceof Uint8Array?(i=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(i=new Float32Array(n*r*4),o=e.FLOAT,l=s.internalFormatPackedFloat),i.set(a),he().getNumber("WEBGL_VERSION")===2?He(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,i)):He(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,i)),He(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function QH(e,t,n){He(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?he().getNumber("WEBGL_VERSION")===2?He(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):He(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):he().getNumber("WEBGL_VERSION")===2?He(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):He(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),He(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function ZH(e,t,n,r){let a=e.createBuffer();He(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a));let s=16*t*n;return He(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ)),He(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),He(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),a}function JH(e,t,n){let r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function eG(e,t,n,r){let[a,s]=kx(t,n),i=4,o=new Uint8Array(Eke(t*n,i));return He(e,()=>e.readPixels(0,0,a,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}function tG(e,t,n,r,a,s,i,o){let l=e,h=new Float32Array(Nke(s,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),h}function nG(e,t,n){let r=new Float32Array(t*n*4);return He(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}var L0=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=he().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,cH(t,e)):this.gl=ro(t),e=this.gl,he().getNumber("WEBGL_VERSION")===2){let a=e;this.createVertexArray=()=>He(a,()=>a.createVertexArray()),this.bindVertexArray=s=>He(a,()=>a.bindVertexArray(s)),this.deleteVertexArray=s=>He(a,()=>a.deleteVertexArray(s)),this.getVertexArray=()=>He(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(e!=null){let a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>He(e,()=>a.createVertexArrayOES()),this.bindVertexArray=s=>He(e,()=>a.bindVertexArrayOES(s)),this.deleteVertexArray=s=>He(e,()=>a.deleteVertexArrayOES(s)),this.getVertexArray=()=>He(e,()=>e.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),he().getNumber("WEBGL_VERSION")===1){let a="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=bb(this.gl,a),Qs(this.gl,s))this.textureHalfFloatExtension=bb(this.gl,s);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Qs(this.gl,r))this.colorBufferHalfFloatExtension=bb(this.gl,r);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Qs(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(Qs(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=BH(this.gl),this.indexBuffer=WH(this.gl),this.framebuffer=wH(this.gl),this.textureConfig=sD(this.gl,this.textureHalfFloatExtension)}get debug(){return he().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;He(e,()=>e.finish()),He(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),He(e,()=>e.deleteFramebuffer(this.framebuffer)),He(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),He(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),He(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),jH(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),HH(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),GH(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),QH(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),YH(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),KH(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),qH(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(eN(this.gl,this.framebuffer),this.outputTexture=null),He(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>eG(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,a,s){return tG(this.gl,e,t,n,r,a,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return JH(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let r=ZH(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(he().getBool("WEBGL_FENCE_API_ENABLED")){let r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let s=r.clientWaitSync(a,0,0);return s===r.ALREADY_SIGNALED||s===r.CONDITION_SATISFIED},t=a}else he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>nG(this.gl,t,n))}createProgram(e){this.throwIfDisposed();let t=this.gl;this.vertexShader==null&&(this.vertexShader=UH(t));let n=mH(t);He(t,()=>t.attachShader(n,this.vertexShader)),He(t,()=>t.attachShader(n,e)),gH(t,n);let r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&$0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;He(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),XH(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(He(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&$0(this.gl,this.program),He(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?SH(this.gl,e,t):IH(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),He(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),TH(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[r,a]=ty(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&$0(this.gl,this.program),vb(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}He(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),He(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=bb(this.gl,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.createQuery();return n.beginQuery(r.TIME_ELAPSED_EXT,a),a}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await $.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),r=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=DEe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:n}=this.itemsToPoll[t];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in he().platform&&(n=he().platform.setTimeoutCustom.bind(he().platform)),$.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),O0(this.gl,e,this.framebuffer),this.debug&&vb(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(O0(this.gl,this.outputTexture,this.framebuffer),this.debug&&vb(this.gl)):eN(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let r=this.gl;O0(r,e,this.framebuffer),this.debug&&vb(r),this.outputTexture=e,He(r,()=>r.viewport(0,0,t,n)),He(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),He(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function DEe(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}var{addImpl:MEe,bincountImpl:rG,bincountReduceImpl:$Ee,bitwiseAndImpl:OEe,castImpl:FEe,ceilImpl:PEe,concatImpl:LEe,equalImpl:zEe,expImpl:VEe,expm1Impl:UEe,floorImpl:BEe,gatherNdImpl:WEe,gatherV2Impl:jEe,greaterImpl:HEe,greaterEqualImpl:GEe,lessImpl:qEe,lessEqualImpl:KEe,linSpaceImpl:XEe,logImpl:YEe,maxImpl:QEe,maximumImpl:ZEe,minimumImpl:JEe,multiplyImpl:eNe,negImpl:tNe,notEqualImpl:nNe,prodImpl:rNe,raggedGatherImpl:aNe,raggedRangeImpl:sNe,raggedTensorToTensorImpl:iNe,rangeImpl:oNe,rsqrtImpl:lNe,scatterImpl:uNe,sigmoidImpl:cNe,simpleAbsImpl:aG,sliceImpl:hNe,sparseFillEmptyRowsImpl:dNe,sparseReshapeImpl:pNe,sparseSegmentReductionImpl:sG,sqrtImpl:fNe,staticRegexReplaceImpl:mNe,stridedSliceImpl:gNe,stringNGramsImpl:yNe,stringSplitImpl:bNe,stringToHashBucketFastImpl:vNe,subImpl:xNe,tileImpl:wNe,topKImpl:_Ne,transposeImpl:mD,uniqueImpl:SNe}=WR;function iG(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function Ua(e,t){return t===1?[e]:iG(e,t)}function INe(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}var TNe=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Ca(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let t=Ua("rc",this.rank),n=Tn(this.rank),r=this.getOutOfBoundsCondition(t),a=this.getSetup(t),s=this.getOutput(t);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${n===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)a=`${e[e.length-1-s]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){let t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}},oG=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length);let n="";for(let r=0;r<4;r++){let a="thisRC = rc;";r%2===1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+=`
        ${a}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${kNe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?lD():oD(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function kNe(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Vke(["r","c","d"],"inputShape"):Qp(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}var ENe=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let r=kL(t,n),a=EL(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);let s=TL(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let o=this.freeTextures[a].pop();return this.usedTextures[a].push(o),o}let i;return r===fa.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===fa.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===fa.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===fa.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===fa.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),i}releaseTexture(e,t,n,r){if(this.freeTextures==null)return;let a=kL(n,r),s=EL(t,a,r);s in this.freeTextures||(this.freeTextures[s]=[]);let i=TL(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=he().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");o!==-1&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=i):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;let l=this.usedTextures[s],h=l&&l.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[h]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function NNe(e,t){let n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function TL(e,t,n,r,a){let s=CNe(t,r),i;if(a){let[l,h]=ty(e[0],e[1]);i=l*h}else{let[l,h]=kx(e[0],e[1]);i=l*h}let o=NNe(n,s);return i*o}function CNe(e,t){switch(e){case fa.PACKED_2X2_FLOAT32:return pD(t);case fa.PACKED_2X2_FLOAT16:return fD(t);case fa.UNPACKED_FLOAT32:return cD(t);case fa.UNPACKED_FLOAT16:return hD(t);case fa.PACKED_4X1_UNSIGNED_BYTE:return dD(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function ANe(e){return he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?fa.PACKED_2X2_FLOAT32:fa.UNPACKED_FLOAT32:e?fa.PACKED_2X2_FLOAT16:fa.UNPACKED_FLOAT16}function kL(e,t){if(e===Ys.UPLOAD)return fa.PACKED_2X2_FLOAT32;if(e===Ys.RENDER||e==null)return ANe(t);if(e===Ys.DOWNLOAD||e===Ys.PIXELS)return fa.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function EL(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}var $o=class{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Ai="if (isnan(x)) return x;",RNe="return x;",NL="return abs(x);",DNe="return (x >= 0.0) ? x : (exp(x) - 1.0);",MNe=Ai+`
  return (x < 0.0) ? 0.0 : x;
`,$Ne=Ai+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wu="return x;",ONe="return 1.0 / (1.0 + exp(-1.0 * x));",FNe="return x;",PNe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,LNe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zNe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,VNe="return 1.0 / (1.0 + exp(-1.0 * x));",Ju=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}},UNe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length);let t=e.length,n=Ua("rc",t),r=Tn(t),a=INe(t,n),s=n.slice(-2),i=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${i}));
      }
    `}},BNe=el.whereImpl,WNe=1e-7,jNe=1e-4,Sk={};function HNe(e){return e in Sk||(Sk[e]={}),Sk[e]}var GNe=he().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),qNe=600;function KNe(){return he().global.screen==null?1024:he().global.screen.height*he().global.screen.width*window.devicePixelRatio*qNe/1024/1024}var gD=class lG extends Nv{nextDataId(){return lG.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!he().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof L0)n=t;else{let r=ro(he().getNumber("WEBGL_VERSION"),t);n=new L0(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let r=ro(he().getNumber("WEBGL_VERSION"));n=new L0(r),this.binaryCache=HNe(he().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new ENe(this.gpgpu),this.numMBBeforeWarning=KNe(),this.texData=new b1(this,_i())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,a,s,i){let o=this.makeTensorInfo(n,r),l=this.texData.get(o.dataId);l.isPacked=!1,l.texture={texture:t,texShape:[a,s]},l.texShape=[a,s];let h=xb(n),c=new IL(h,!1,i),p=this.runWebGLProgram(c,[o],r,[[a,s]]);return p.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(o),p.dataId}write(t,n,r){if((he().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||he().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let a={id:this.nextDataId()};return this.texData.set(a,{shape:n,dtype:r,values:t,usage:Ys.UPLOAD,refCount:1}),a}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){let n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){let n=this.texData.get(t);n.refCount--}}move(t,n,r,a,s){if(he().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:a,values:n,usage:Ys.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){let n=this.texData.get(t),{values:r,dtype:a,complexTensorInfos:s,slice:i,shape:o,isPacked:l}=n;if(i!=null){let m;l?m=new Ju(o,Wu):m=new $o(o,Wu);let g=this.runWebGLProgram(m,[{dataId:t,shape:o,dtype:a}],a),b=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),b}if(r!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return r;let h=this.activeTimers!=null,c;h&&(c=$.now());let p;if(a==="complex64"){let m=this.readSync(s.real.dataId),g=this.readSync(s.imag.dataId);p=B.mergeRealAndImagArrays(m,g)}else p=this.getValuesFromTexture(t);return h&&(this.downloadWaitMs+=$.now()-c),this.convertAndCacheOnCPU(t,p)}async read(t){if(this.pendingRead.has(t)){let b=this.pendingRead.get(t);return new Promise(v=>b.push(v))}let n=this.texData.get(t),{values:r,shape:a,slice:s,dtype:i,complexTensorInfos:o,isPacked:l}=n;if(s!=null){let b;l?b=new Ju(a,Wu):b=new $o(a,Wu);let v=this.runWebGLProgram(b,[{dataId:t,shape:a,dtype:i}],i),x=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),x}if(r!=null)return this.convertAndCacheOnCPU(t);if(he().getBool("DEBUG")&&!he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&he().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let h=null,c;if(i!=="complex64"&&he().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);let b=this.texData.get(c.dataId);h=this.gpgpu.createBufferFromTexture(b.texture.texture,...p0(a))}this.pendingRead.set(t,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(i==="complex64"){let b=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]),v=b[0],x=b[1];p=B.mergeRealAndImagArrays(v,x)}else if(h==null)p=this.getValuesFromTexture(t);else{let b=$.sizeFromShape(a);p=this.gpgpu.downloadFloat32MatrixFromBuffer(h,b)}if(c!=null&&this.disposeIntermediateTensorInfo(c),h!=null){let b=this.gpgpu.gl;He(b,()=>b.deleteBuffer(h))}let m=this.convertAndCacheOnCPU(t,p),g=this.pendingRead.get(t);return this.pendingRead.delete(t),g.forEach(b=>b(m)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&_i().removeDataId(t,this),this.pendingDeletes--),m}readToGPU(t,n={}){let r=this.texData.get(t),{values:a,shape:s,slice:i,dtype:o,isPacked:l,texture:h}=r;if(o==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let g;l?g=new Ju(s,Wu):g=new $o(s,Wu);let b=this.runWebGLProgram(g,[{dataId:t,shape:s,dtype:o}],o),v=this.readToGPU(b,n);return this.disposeIntermediateTensorInfo(b),v}if(h==null)throw a!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let c=this.decode(t,n.customTexShape),p=_i().makeTensorFromTensorInfo(c),m=this.texData.get(c.dataId);return Object.assign({tensorRef:p},m.texture)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>$.decodeString(a));return At(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return At(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){let r=t[n];if(!hH(r))throw he().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:n,dtype:r,isPacked:a}=this.texData.get(t),s=$.sizeFromShape(n);if(he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let m=this.decode(t),g=this.texData.get(m.dataId),b=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...p0(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(m),b}let i=he().getBool("WEBGL_PACK")&&a===!0,o=i?xb(n):n,l=i?new CEe(o):new NEe(o),h=this.runWebGLProgram(l,[{shape:o,dtype:r,dataId:t}],"float32"),c=this.texData.get(h.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(h),p}timerAvailable(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){let n=this.activeTimers,r=[],a=!1;this.programTimersStack==null?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t();let s=$.flatten(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=$.flatten(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,a&&(this.programTimersStack=null);let o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let l=await Promise.all(s);o.kernelMs=$.sum(l),o.getExtraProfileInfo=()=>l.map((h,c)=>({name:i[c],ms:h})).map(h=>`${h.name}: ${h.ms}`).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$.now(),endMs:null}}endTimer(t){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=$.now(),t)}async getQueryTime(t){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);let{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){let{texture:n,dtype:r,texShape:a,usage:s,isPacked:i,slice:o}=this.texData.get(t),l=o&&o.origDataId||t,h=this.dataRefCount.get(l);h>1?this.dataRefCount.set(l,h-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,s,i)));let c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=GNe){return he().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&$.sizeFromShape(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){B.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=t.dataSync();return BNe(t.shape,n)}packedUnaryOp(t,n,r){let a=new Ju(t.shape,n),s=this.compileAndRun(a,[t],r);return _i().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let a=aG(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,a)}if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,NL,t.dtype);let n=new $o(t.shape,NL),r=this.compileAndRun(n,[t]);return _i().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&$.isString(r[0])){let s=r.map(i=>$.encodeString(i));a=this.write(s,t,n)}else a=this.write(r,t,n);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:n}}makeOutput(t,n,r){return _i().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){let n=new UNe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){let n=new TNe(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){let r=[gd(t.shape),...yd(t.shape)],a={dtype:t.dtype,shape:r,dataId:t.dataId},s=[gd(n),...yd(n)],i=new oG(s,r),o=!0,l=[r],h=this.runWebGLProgram(i,[a],t.dtype,l,o);return{dataId:h.dataId,shape:n,dtype:h.dtype}}decode(t,n){let r=this.texData.get(t),{isPacked:a,shape:s,dtype:i}=r;if(n!=null){let m=$.sizeFromShape(s),g=n[0]*n[1]*4;$.assert(m<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let o=xb(s),l;a?l=new EEe(o):l=new kEe(o);let h=!0,c=[n??p0(o)],p=this.runWebGLProgram(l,[{shape:o,dtype:i,dataId:t}],i,c,h,n);return{dtype:i,shape:s,dataId:p.dataId}}runWebGLProgram(t,n,r,a,s=!1,i){let o=this.makeTensorInfo(t.outputShape,r),l=this.texData.get(o.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===iv.DENSE){let _=i??p0(t.outputShape);l.texShape=_.map(I=>I*2)}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),$.sizeFromShape(o.shape)===0)return l.values=$.getTypedArrayFromDType(o.dtype,0),o;let h=[],c=n.map(_=>{if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let I=this.texData.get(_.dataId);if(I.texture==null){if(!t.packedInputs&&$.sizeFromShape(_.shape)<=he().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:I.values};t.packedInputs&&(I.isPacked=!0,I.shape=_.shape)}if(this.uploadToGPU(_.dataId),!!I.isPacked!=!!t.packedInputs)_=I.isPacked?this.unpackTensor(_):this.packTensor(_),h.push(_),I=this.texData.get(_.dataId);else if(I.isPacked&&!ov(I.shape,_.shape)){let k=_,E=_.shape;_.shape=I.shape,_=this.packedReshape(_,E),h.push(_),I=this.texData.get(_.dataId),k.shape=E}return{shape:_.shape,texData:I,isUniform:!1}});this.uploadToGPU(o.dataId);let p={shape:o.shape,texData:l,isUniform:!1},m=TEe(t,c,p),g=this.getAndSaveBinary(m,()=>SEe(this.gpgpu,t,c,p)),b=this.activeTimers!=null,v;b&&(v=this.startTimer()),he().get("ENGINE_COMPILE_ONLY")||IEe(this.gpgpu,g,c,p,a),h.forEach(_=>this.disposeIntermediateTensorInfo(_)),b&&(v=this.endTimer(v),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(v)}));let x=he().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){let _=$.now();_-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=_)}if(!he().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let _=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),_}return o}compileAndRun(t,n,r,a,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,a,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(he().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=oe(()=>{if(!he().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=he().getBool("DEBUG");he().set("DEBUG",!1);let n=this.abs(rt(1e-8)).dataSync()[0];if(he().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?WNe:jNe}uploadToGPU(t){let n=this.texData.get(t),{shape:r,dtype:a,values:s,texture:i,usage:o,isPacked:l}=n;if(i!=null)return;let h=this.activeTimers!=null,c;h&&(c=$.now());let p=n.texShape;if(p==null&&(p=NH(r,l),n.texShape=p),s!=null){let m=xb(r),g,b=p[1],v=p[0],x=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!x)&&([b,v]=ty(p[0],p[1])),l?g=new REe(m,x):g=new IL(m,x);let _=x?[v,b]:p,I=this.makeTensorInfo(_,a),k=this.texData.get(I.dataId);x?k.usage=Ys.PIXELS:k.usage=Ys.UPLOAD,k.texShape=_,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(I.dataId),b,v,s);let E=[[v,b]],R=this.runWebGLProgram(g,[I],a,E,!0),U=this.texData.get(R.dataId);n.texShape=U.texShape,n.isPacked=U.isPacked,n.usage=U.usage,he().get("ENGINE_COMPILE_ONLY")?this.disposeData(R.dataId):(n.texture=U.texture,n.values=null,this.texData.delete(R.dataId)),this.disposeIntermediateTensorInfo(I),h&&(this.uploadWaitMs+=$.now()-c)}else{let m=this.acquireTexture(p,o,a,l);n.texture=m}}convertAndCacheOnCPU(t,n){let r=this.texData.get(t),{dtype:a}=r;return n!=null&&(r.values=XNe(n,a)),r.values}acquireTexture(t,n,r,a){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,a)}computeBytes(t,n){return t[0]*t[1]*$.bytesPerElement(n)}checkCompileCompletion(){for(let[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){let t=[];if(this.gpgpu.parallelCompilationExtension){for(let[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(let[,n]of Object.entries(this.binaryCache)){let r=new Promise(a=>{try{this.checkCompletion_(n),a(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await sA(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(iD(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);let{variablesLocations:n,customUniformLocations:r,infLoc:a,nanLoc:s,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:l}=zH(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=a,t.nanLoc=s,t.outShapeLocation=i,t.outShapeStridesLocation=o,t.outTexShapeLocation=l}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";let{texture:a,height:s,width:i,channels:o}=t,l=_i().backend;if(!l.gpgpu.gl.isTexture(a))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let h=l.writeTexture(a,n,r,s,i,o);return _i().makeTensorFromDataId(h,n,r,l)}};gD.nextDataId=0;function XNe(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){let n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}var YNe="4.22.0";function uG(){he().set("WEBGL_FORCE_F16_TEXTURES",!0)}ex.isBrowser()&&F1("webgl",()=>new gD,2);var QNe={forceHalfFloat:uG},yD=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,bd=class{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=B.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Ca(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}},Jp=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,oy=class{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=B.assertAndGetBroadcastShape(t,n);let a=this.outputShape.length;this.enableShapeUniforms=Ca(a);let s="";if(r)if(a===0||$.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${Tn(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let i=Ua("coords",a);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${i[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${i[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${i[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${i[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function Fs(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var ZNe={kernelName:tp,backendName:"webgl",kernelFunc:Fs};function Xc(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.makeTensorInfo(r.shape,"complex64"),i=n.texData.get(s.dataId),o=Fs({inputs:{x:r},backend:n}),l=Fs({inputs:{x:a},backend:n});return i.complexTensorInfos={real:o,imag:l},s}var JNe={kernelName:w1,backendName:"webgl",kernelFunc:Xc},cG="return (a < 0.) ? b * a : a;",hG=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function e2e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r,i=n.makeTensorInfo([],"float32",$.createScalarValue(s,"float32")),o=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oy(hG,a.shape,i.shape):new bd(cG,a.shape,i.shape),l=n.runWebGLProgram(o,[a,i],"float32");return n.disposeIntermediateTensorInfo(i),l}var t2e={kernelName:sp,backendName:"webgl",kernelFunc:e2e},dG="return (a < 0.) ? b * a : a;",pG=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function n2e(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oy(pG,r.shape,a.shape):new bd(dG,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],"float32")}var r2e={kernelName:wp,backendName:"webgl",kernelFunc:n2e},ly="if (isnan(x)) return x;";function Zt({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:s})=>{let{x:i}=a,o=s,l=r||i.dtype;if(o.shouldExecuteOnCPU([i])&&n!=null){let p=o.texData.get(i.dataId),m=n(p.values,l);return o.makeTensorInfo(i.shape,l,m)}let h=he().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,c;return h?c=new Ju(i.shape,t):c=new $o(i.shape,e),o.runWebGLProgram(c,[i],l)}}function ga({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:s}){return({inputs:i,backend:o})=>{let{a:l,b:h}=i,c=o;if(r&&l.dtype==="complex64"){let b=c.texData.get(l.dataId),v=c.texData.get(h.dataId),[x,_]=[[b.complexTensorInfos.real,v.complexTensorInfos.real],[b.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(k=>{let[E,R]=k,U={dataId:E.dataId,dtype:E.dtype,shape:l.shape},D={dataId:R.dataId,dtype:R.dtype,shape:h.shape},C=new bd(e,l.shape,h.shape);return c.runWebGLProgram(C,[U,D],ti(E.dtype,R.dtype))}),I=Xc({inputs:{real:x,imag:_},backend:c});return c.disposeIntermediateTensorInfo(x),c.disposeIntermediateTensorInfo(_),I}let p=s||ti(l.dtype,h.dtype);if((l.dtype==="string"||h.dtype==="string"||c.shouldExecuteOnCPU([l,h]))&&a!=null){let b=c.texData.get(l.dataId).values,v=c.texData.get(h.dataId).values,x=l.dtype==="string"?B.fromUint8ToStringArray(b):b,_=l.dtype==="string"?B.fromUint8ToStringArray(v):v,[I,k]=a(l.shape,h.shape,x,_,p),E=c.makeTensorInfo(k,p),R=c.texData.get(E.dataId);return R.values=I,E}let m=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,g;return m?g=new oy(t,l.shape,h.shape,n):g=new bd(e,l.shape,h.shape),c.runWebGLProgram(g,[l,h],p)}}function lv(e,t=!1){if(e==="linear")return t?FNe:RNe;if(e==="relu")return t?LNe:MNe;if(e==="elu")return t?PNe:DNe;if(e==="relu6")return t?zNe:$Ne;if(e==="prelu")return t?pG:dG;if(e==="leakyrelu")return t?hG:cG;if(e==="sigmoid")return t?VNe:ONe;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}var fG=class{constructor(e,t,n,r=!1,a=!1,s=!1,i=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Ca(this.outputShape.length);let h=r?e[1]:e[2],c=Math.ceil(h/2),p=r?"i * 2, rc.y":"rc.y, i * 2",m=a?"rc.z, i * 2":"i * 2, rc.z",g=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],b=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",x="";i&&(o?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:l?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:v=`vec4 activation(vec4 x) {
          ${i}
        }`,x="result = activation(result);");let _=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let I="rc.x",k="rc.x";e[0]<t[0]?I=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${c}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${I};
        int batchB = ${k};
        for (int i = 0; i < ${c}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${b[0]});
          result += (${g[1]} * ${b[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${_}

        ${x}

        setOutput(result);
      }
    `}},CL={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},AL=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=B.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}},RL="return a * b;";function bD(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=B.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){let o=n.texData.get(r.dataId),l=n.texData.get(a.dataId),h=new AL(CL.REAL,r.shape,a.shape),c=new AL(CL.IMAG,r.shape,a.shape),p=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:r.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:a.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:a.shape}],m=n.runWebGLProgram(h,p,"float32"),g=n.runWebGLProgram(c,p,"float32"),b=Xc({inputs:{real:m,imag:g},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),b}if(n.shouldExecuteOnCPU([r,a])){let o=n.texData.get(r.dataId),l=n.texData.get(a.dataId),[h,c]=eNe(r.shape,a.shape,o.values,l.values,s),p=n.makeTensorInfo(c,s),m=n.texData.get(p.dataId);return m.values=h,p}let i;return he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new oy(RL,r.shape,a.shape):i=new bd(RL,r.shape,a.shape),n.runWebGLProgram(i,[r,a],s)}var a2e={kernelName:yp,backendName:"webgl",kernelFunc:bD};function s2e(e,t,n){let r=[gd(e.shape),...yd(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},s=[gd(t),...yd(t)],i=new oG(s,r),o=!0,l=[r],h=n.runWebGLProgram(i,[a],e.dtype,l,o);return{dataId:h.dataId,shape:t,dtype:h.dtype}}function je(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,i=n,o=$.sizeFromShape(a.shape),l=$.inferFromImplicitShape(s,o),h=$.sizeFromShape(l);$.assert(o===h,()=>`The new shape (${l}) has ${h} elements and the old shape (${a.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`);let c=i.texData.get(a.dataId);return c.isPacked&&!ov(a.shape,l)&&!(c.texture!==null&&ov(c.shape,l))?s2e(a,l,i):(i.incRef(a.dataId),{dataId:a.dataId,shape:l,dtype:a.dtype})}var i2e={kernelName:kg,backendName:"webgl",kernelFunc:je},DL=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let i=Math.floor(n/4)*4,o=n%4,l="sumValue += dot(values, ones);";if(t!=null){let c=1/t;l=`sumValue += dot(values * ${$.isInt(c)?c.toPrecision(2):c}, ones);`}let h="";a%n>0&&(h=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${i}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${i};
        if (${o===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${o===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${o===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}},o2e=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let i="0.0",o="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",o="min"):t==="max"&&(i="-1.0 / 1e-20",o="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");let h=Math.floor(n/4)*4,c=n%4,p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${o}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${o}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";t==="all"?(i="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):t==="any"&&(i="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let g="";a%n>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${i};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${i});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${c===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${c===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${c===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${l});
      }
    `}};function l2e(e){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let n=t.length?t[t.length-1].outSize:e[1],r=B.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function ef(e,t,n,r){let a=l2e(e.shape),s=e;for(let i=0;i<a.length;i++){let{inSize:o,windowSize:l,outSize:h}=a[i],c,p;n==="mean"?c=i===0?new DL({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:h},o):new DL({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:h}):c=new o2e({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:h},n),p=s,s=r.runWebGLProgram(c,[s],t),p.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(p)}return s}var u2e=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[t[s]];this.outputShape=n,this.rank=n.length;let r=Tn(this.rank),a=c2e(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}};function c2e(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}var h2e=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let h=0;h<n.length;h++)n[h]=e[t[h]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let r=Tn(this.rank),a=iG("rc",this.rank),s=new Array(this.rank);for(let h=0;h<t.length;h++)s[t[h]]=a[h];let i=`vec2(${s.slice(-2).join()})`,o=`++${a[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${i})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${o}) {
        result[1] = ${l};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${l};
        if(${o}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}};function US(e,t,n){let r=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new h2e(e.shape,t):new u2e(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function d2e(e,t,n,r){let a=t,s=e.shape.length,i=$.parseAxisParam(a,e.shape),o=i,l=B.getAxesPermutation(o,s),h=l!=null,c=e;h&&(c=US(e,l,r),o=B.getInnerMostAxes(o.length,s)),B.assertAxesAreInnerMostDims("sum",o,s);let[p,m]=B.computeOutAndReduceShapes(c.shape,o),g=p;n&&(g=B.expandShapeToKeepDim(p,i));let b=$.sizeFromShape(m),v=$.sizeFromShape(e.shape)/b,x=je({inputs:{x:c},attrs:{shape:[v,b]},backend:r}),_=O1(e.dtype),I=ef(x,_,"sum",r),k=je({inputs:{x:I},attrs:{shape:g},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(I),h&&r.disposeIntermediateTensorInfo(c),k}function BS(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;return d2e(a,s,i,n)}var p2e={kernelName:Lp,backendName:"webgl",kernelFunc:BS};function Ha(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:s}=r,i=n,o=a.shape.length,l=new Array(o);for(let c=0;c<l.length;c++)l[c]=a.shape[s[c]];let h;if(i.shouldExecuteOnCPU([a])){let c=i.texData.get(a.dataId).values,p=mD(c,a.shape,a.dtype,s,l);h=i.makeTensorInfo(l,a.dtype);let m=i.texData.get(h.dataId);m.values=p}else h=US(a,s,i);return h}var f2e={kernelName:Vl,backendName:"webgl",kernelFunc:Ha},mG=1e3;function M_({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:l=null}){let h=e.shape.length,c=t.shape.length,p=n?e.shape[h-2]:e.shape[h-1],m=r?t.shape[c-1]:t.shape[c-2],g=n?e.shape[h-1]:e.shape[h-2],b=r?t.shape[c-2]:t.shape[c-1],v=e.shape.slice(0,-2),x=t.shape.slice(0,-2),_=$.sizeFromShape(v),I=$.sizeFromShape(x),k=jg.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([g,b]);$.assert(p===m,()=>`Error in matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);let E=n?[_,p,g]:[_,g,p],R=r?[I,b,m]:[I,m,b],U=je({inputs:{x:e},backend:a,attrs:{shape:E}}),D=je({inputs:{x:t},backend:a,attrs:{shape:R}}),C=[U,D],O=Math.max(_,I),z=n?U.shape[1]:U.shape[2],M=s!=null,N=i!=null,P=l==="leakyrelu",Q=l!=null?lv(l,!0):null,ee=M||N||P||Q!=null,q;if((g===1||b===1)&&z>mG&&ee===!1){let ne=U,me=D;n&&(ne=Ha({inputs:{x:U},backend:a,attrs:{perm:[0,2,1]}}),C.push(ne)),r&&(me=Ha({inputs:{x:D},backend:a,attrs:{perm:[0,2,1]}}),C.push(me));let xe=b!==1,H=b===1,se=ne;xe&&(se=je({inputs:{x:ne},backend:a,attrs:{shape:[O,z,1]}}),C.push(se));let ue=b===1?2:1,ge=me;H&&(ge=je({inputs:{x:me},backend:a,attrs:{shape:[O,1,z]}}),C.push(ge));let Ee=bD({inputs:{a:se,b:ge},backend:a});q=BS({inputs:{x:Ee},backend:a,attrs:{axis:ue,keepDims:!0}}),C.push(Ee)}else{let ne=ti(e.dtype,t.dtype),me=new fG(E,R,[O,g,b],n,r,M,Q,N,P),xe=[U,D];if(s!=null&&xe.push(s),N&&xe.push(i),P){let H=a.makeTensorInfo([],"float32",$.createScalarValue(o,"float32"));xe.push(H),C.push(H)}q=a.runWebGLProgram(me,xe,ne)}let Z=je({inputs:{x:q},backend:a,attrs:{shape:k}});C.push(q);for(let ne of C)a.disposeIntermediateTensorInfo(ne);return Z}function m2e(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:o}=t,{transposeA:l,transposeB:h,activation:c,leakyreluAlpha:p}=r;return M_({a,b:s,transposeA:l,transposeB:h,backend:n,bias:i,preluActivationWeights:o,leakyreluAlpha:p,activation:c})}var g2e={kernelName:td,backendName:"webgl",kernelFunc:m2e},ML="return abs(x);";function y2e(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let s=n.texData.get(r.dataId),i=aG(s.values);return n.makeTensorInfo(r.shape,r.dtype,i)}let a;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Ju(r.shape,ML):a=new $o(r.shape,ML),n.runWebGLProgram(a,[r],r.dtype)}var b2e={kernelName:Bm,backendName:"webgl",kernelFunc:y2e},v2e=Ai+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,x2e=Zt({opSnippet:v2e}),w2e={kernelName:kd,backendName:"webgl",kernelFunc:x2e},_2e=Ai+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,S2e=Zt({opSnippet:_2e}),I2e={kernelName:Ed,backendName:"webgl",kernelFunc:S2e},$L="return a + b;",T2e=ga({opSnippet:$L,packedOpSnippet:$L,supportsComplex:!0,cpuKernelImpl:MEe}),k2e={kernelName:zc,backendName:"webgl",kernelFunc:T2e},E2e=class{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`float v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}},N2e=class{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`vec4 v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}};function z0(e){let{inputs:t,backend:n}=e,r=t;if(r.length===1)return Fs({inputs:{x:r[0]},backend:n});if(r.length>he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let o=Math.floor(r.length/2),l=z0({inputs:r.slice(0,o),backend:n}),h=z0({inputs:r.slice(o),backend:n});return z0({inputs:[l,h],backend:n})}let a=r.map(o=>o.dtype).reduce((o,l)=>ti(o,l)),s=r.map(o=>o.shape),i=he().getBool("WEBGL_PACK")?new N2e(r[0].shape,s):new E2e(r[0].shape,s);return n.runWebGLProgram(i,r,a)}var C2e={kernelName:Nd,backendName:"webgl",kernelFunc:z0};function A2e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,o=a.shape.length,l=$.parseAxisParam(s,a.shape),h=l,c=B.getAxesPermutation(h,o),p=a;c!=null&&(p=Ha({inputs:{x:a},backend:n,attrs:{perm:c}}),h=B.getInnerMostAxes(h.length,o)),B.assertAxesAreInnerMostDims("all",h,o);let[m,g]=B.computeOutAndReduceShapes(p.shape,h),b=$.sizeFromShape(g),v=je({inputs:{x:p},backend:n,attrs:{shape:[-1,b]}}),x=ef(v,v.dtype,"all",n),_;if(i){let I=B.expandShapeToKeepDim(m,l);_=je({inputs:{x},backend:n,attrs:{shape:I}})}else _=je({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(p),_}var R2e={kernelName:Wm,backendName:"webgl",kernelFunc:A2e};function D2e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,o=a.shape.length,l=$.parseAxisParam(s,a.shape),h=l,c=B.getAxesPermutation(h,o),p=a;c!=null&&(p=Ha({inputs:{x:a},backend:n,attrs:{perm:c}}),h=B.getInnerMostAxes(h.length,o)),B.assertAxesAreInnerMostDims("any",h,o);let[m,g]=B.computeOutAndReduceShapes(p.shape,h),b=$.sizeFromShape(g),v=je({inputs:{x:p},backend:n,attrs:{shape:[-1,b]}}),x=ef(v,v.dtype,"any",n),_;if(i){let I=B.expandShapeToKeepDim(m,l);_=je({inputs:{x},backend:n,attrs:{shape:I}})}else _=je({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(p),_}var M2e={kernelName:jm,backendName:"webgl",kernelFunc:D2e},$2e=class{constructor(e,t,n){this.variableNames=["A"];let{windowSize:r,batchSize:a,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];let i=t==="max"?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${o};
          float candidate = getA(batch, inIdx);
          if (candidate ${i} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}},O2e=class{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,$.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");let i=this.outputShape,o=i.length,l=Tn(o),h=Ua("coords",o),c,p;if(s===1){p=o+1;let D=Tn(p);c=`
        ${D} sourceLocR = ${D}(${h.join()}, 0);
        ++${h[o-1]};
        ${D} sourceLocG = ${D}(${h.join()}, 0);
        ++${h[o-2]};
        ${D} sourceLocA = ${D}(${h.join()}, 0);
        --${h[o-1]};
        ${D} sourceLocB = ${D}(${h.join()}, 0);
        --${h[o-2]};`}else p=o,c=`
        ${l} sourceLocR = coords;
        ++${h[o-1]};
        ${l} sourceLocG = coords;
        ++${h[o-2]};
        ${l} sourceLocA = coords;
        --${h[o-1]};
        ${l} sourceLocB = coords;
        --${h[o-2]};`;let m=["x","y","z","w","u","v"].slice(0,p),g="."+m[p-1],b=m.map(D=>"int "+D),v=Ua("sourceLocR",p-1).concat("inIdx.r"),x=Ua("sourceLocG",p-1).concat("inIdx.g"),_=Ua("sourceLocB",p-1).concat("inIdx.b"),I=Ua("sourceLocA",p-1).concat("inIdx.a"),k=n==="max"?"greaterThan":"lessThan",E=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${_.join()}),
                             getBestIndicesAChannel(${I.join()})));`,R=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${_.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,U=r?"":`
      float getBestIndicesAChannel(${b.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${b.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${U}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${h[o-1]} < ${i[o-1]-1};
        bool hasNextRow = ${h[o-2]} < ${i[o-2]-1};
        ${c}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${R};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${E}
          vec4 candidate = ${R};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function gG(e,t,n,r=null){let a=t.shape[0],s=t.shape[1];r!=null&&(a=r.shape[0],s=r.shape[1]);let i=B.computeOptimalWindowSize(s),o={windowSize:i,inSize:s,batchSize:a,outSize:Math.ceil(s/i)},l=new $2e(o,n,r==null),h=[t];r!=null&&h.push(r);let c=e.runWebGLProgram(l,h,"int32");if(c.shape[1]===1)return c;let p=gG(e,t,n,c);return e.disposeIntermediateTensorInfo(c),p}function yG(e,t,n,r=null){let a=r!=null?r.shape:t.shape,s=a[a.length-1],i=B.computeOptimalWindowSize(s),o=new O2e(a,i,n,r==null),l=r==null?[t]:[t,r],h=e.runWebGLProgram(o,l,"int32");if(h.shape.length===t.shape.length){let c=yG(e,t,n,h);return e.disposeIntermediateTensorInfo(h),c}return h}function bG(e,t,n,r){let a=[n];if(B.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!he().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let s=[],i=e.texData.get(t.dataId),o=i!==null&&i.isPacked,l=t;o&&(l=e.unpackTensor(t),s.push(l));let[h,c]=B.computeOutAndReduceShapes(l.shape,a),p=$.sizeFromShape(c),m=je({inputs:{x:l},backend:e,attrs:{shape:[-1,p]}});s.push(m);let g=gG(e,m,r);s.push(g);let b=je({inputs:{x:g},backend:e,attrs:{shape:h}});return s.forEach(v=>e.disposeIntermediateTensorInfo(v)),b}return yG(e,t,r)}function F2e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,i=$.parseAxisParam(s,a.shape),o=B.getAxesPermutation(i,a.shape.length),l=a,h=[];o!=null&&(l=Ha({inputs:{x:a},backend:n,attrs:{perm:o}}),h.push(l),i=B.getInnerMostAxes(i.length,l.shape.length)),B.assertAxesAreInnerMostDims("argMax",[i[0]],l.shape.length);let c=bG(n,l,i[0],"max");return h.forEach(p=>n.disposeIntermediateTensorInfo(p)),c}var P2e={kernelName:Hm,backendName:"webgl",kernelFunc:F2e};function L2e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,i=$.parseAxisParam(s,a.shape),o=B.getAxesPermutation(i,a.shape.length),l=a,h=[];o!=null&&(l=Ha({inputs:{x:a},backend:n,attrs:{perm:o}}),h.push(l),i=B.getInnerMostAxes(i.length,l.shape.length)),B.assertAxesAreInnerMostDims("argMin",[i[0]],l.shape.length);let c=bG(n,l,i[0],"min");return h.forEach(p=>n.disposeIntermediateTensorInfo(p)),c}var z2e={kernelName:Gm,backendName:"webgl",kernelFunc:L2e},V2e=Ai+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,U2e=Zt({opSnippet:V2e}),B2e={kernelName:Cd,backendName:"webgl",kernelFunc:U2e},W2e=Ai+"return log(x + sqrt(x * x + 1.0));",j2e=Zt({opSnippet:W2e}),H2e={kernelName:Ad,backendName:"webgl",kernelFunc:j2e},G2e=Ai+`
  return atan(x);
`,q2e=Zt({opSnippet:G2e}),K2e={kernelName:Rd,backendName:"webgl",kernelFunc:q2e},X2e=yD+`
  return atan(a, b);
`,Y2e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jp+`
  return result;
`,Q2e=ga({opSnippet:X2e,packedOpSnippet:Y2e}),Z2e={kernelName:Md,backendName:"webgl",kernelFunc:Q2e},J2e=Ai+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,eCe=Zt({opSnippet:J2e}),tCe={kernelName:Dd,backendName:"webgl",kernelFunc:eCe},uv=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,i=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,h=e.dilationWidth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;let b=t==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,_="0.0";if(b||(_="-1.0 / 1e-20"),n){let D=">=";this.userCode=`
        const ivec2 strides = ivec2(${i}, ${o});
        const ivec2 pads = ivec2(${m}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${c};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${D} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?a?v:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let I="max",k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");let E=Math.floor(s/4)*4,R=s%4,U=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${m}, ${g});
      const float initializationValue = ${_};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${_});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${c};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${E}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${U}
          }

          int xC = xCCorner + ${E};
          if (${R===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${U}
          } else if (${R===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${U}
          } else if (${R===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${U}
          }
        }
        setOutput(${k});
      }
    `}},vD=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,l=e.strideWidth,h=e.dilationDepth,c=e.dilationHeight,p=e.dilationWidth,m=e.effectiveFilterDepth,g=e.effectiveFilterHeight,b=e.effectiveFilterWidth,v=e.padInfo.front,x=e.padInfo.top,_=e.padInfo.left;this.outputShape=e.outShape;let I=t==="avg",k="0.0";if(I||(k="-1.0 / 1e-20"),n){let O=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${i}, ${o}, ${l});
        const ivec3 pads = ivec3(${v}, ${x}, ${_});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${c}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${b};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${O} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${g} * ${b} +
                      wR * ${b} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let E="max",R=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(R="avgValue / max(count, 1.0)");let U=Math.floor(s/4)*4,D=s%4,C=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${E}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${i}, ${o}, ${l});
      const ivec3 pads = ivec3(${v}, ${x}, ${_});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${U}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${C}
            }

            int xC = xCCorner + ${U};
            if (${D===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${C}
            } else if (${D===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${C}
            } else if (${D===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${C}
            }
          }
        }
        setOutput(${R});
      }
    `}};function nCe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;ny(a,"avgPool");let{filterSize:s,strides:i,pad:o,dimRoundingMode:l}=r,h=1;$.assert(B.eitherStridesOrDilationsAreOne(i,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let c=B.computePool2DInfo(a.shape,s,i,h,o,l);if(c.filterWidth===1&&c.filterHeight===1&&$.arraysEqual(c.inShape,c.outShape))return Fs({inputs:{x:a},backend:n});let p=new uv(c,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}var rCe={kernelName:$d,backendName:"webgl",kernelFunc:nCe};function aCe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l,dataFormat:h}=r,c=[1,1,1],p=B.computePool3DInfo(a.shape,s,i,c,o,l,h),m=new vD(p,"avg",!1);return n.runWebGLProgram(m,[a],"float32")}var sCe={kernelName:qm,backendName:"webgl",kernelFunc:aCe},iCe=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,i=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,h=o-1-e.padInfo.top,c=l-1-e.padInfo.left,p=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${c});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${i}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},oCe=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,h=e.dilationWidth,c=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=c-1-e.padInfo.front,b=p-1-e.padInfo.top,v=m-1-e.padInfo.left,x=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${b}, ${v});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
            wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function lCe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s,{filterSize:o,strides:l,pad:h,dimRoundingMode:c}=r,p=[1,1,1],m=B.computePool3DInfo(i.shape,o,l,p,h,c),g=new oCe(m);return n.runWebGLProgram(g,[a],i.dtype)}var uCe={kernelName:Rv,backendName:"webgl",kernelFunc:lCe};function cCe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s;ny([a,s],"avgPoolGrad");let{filterSize:o,strides:l,pad:h}=r,c=B.computePool2DInfo(i.shape,o,l,1,h),p=new iCe(c);return n.runWebGLProgram(p,[a],i.dtype)}var hCe={kernelName:Av,backendName:"webgl",kernelFunc:cCe};function dCe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:o}=r;return M_({a,b:s,transposeA:i,transposeB:o,backend:n})}var pCe={kernelName:Od,backendName:"webgl",kernelFunc:dCe},fCe=class{constructor(e,t,n,r,a,s){this.outputShape=[],this.variableNames=["x","mean","variance"],B.assertAndGetBroadcastShape(e,t),B.assertAndGetBroadcastShape(e,n);let i="0.0";r!=null&&(B.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let o="1.0";a!=null&&(B.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${i};
        float scale = ${o};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}},mCe=class{constructor(e,t,n,r,a,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],B.assertAndGetBroadcastShape(e,t),B.assertAndGetBroadcastShape(e,n);let i="vec4(0.0)";r!=null&&(B.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let o="vec4(1.0)";a!=null&&(B.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${i};
        vec4 scale = ${o};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}},gCe=({inputs:e,backend:t,attrs:n})=>{let{x:r,mean:a,variance:s,offset:i,scale:o}=e;$.assert(a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),$.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),$.assert(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);let h=[r,a,s],c=null;i!=null&&(c=i.shape,h.push(i));let p=null;o!=null&&(p=o.shape,h.push(o));let m=he().getBool("WEBGL_PACK_NORMALIZATION")?new mCe(r.shape,a.shape,s.shape,c,p,l):new fCe(r.shape,a.shape,s.shape,c,p,l);return t.runWebGLProgram(m,h,h[0].dtype)},yCe={kernelName:Jd,backendName:"webgl",kernelFunc:gCe},bCe=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let t=Tn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=vCe(this.rank),r,a=e.map((s,i)=>`sourceLoc.${rN[i]} = start[${i}] + coords.${rN[i]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${n}));
      }
    `}},rN=["x","y","z","w","u","v"];function vCe(e){if(e===1)return"sourceLoc";if(e<=6)return rN.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}var xCe=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=Tn(this.rank),n=Ua("coords",this.rank),r=Ua("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${a})`,i=`
      result.x = ${s};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${s};
        --${r[this.rank-1]};
      }
    `,o=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${s};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${s};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,c)=>`start[${c}]`).join()});`:e.map((h,c)=>`${r[c]} = ${n[c]} + start[${c}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${i}
        ${o}
        setOutput(result);
      }
    `}};function wCe(e,t,n,r){let a=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),i=r.texData.get(s.dataId);Object.assign(i,a),i.refCount=1,i.shape=n,i.dtype=e.dtype;let o=jr.computeFlatOffset(t,$.computeStrides(e.shape));a.slice&&(o+=a.slice.flatOffset),i.slice={flatOffset:o,origDataId:a.slice&&a.slice.origDataId||e.dataId};let l=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,l+1),s}function uy(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:i}=r,[o,l]=jr.parseSliceParams(a,s,i);if(jr.assertParamsValid(a,o,l),$.sizeFromShape(l)===0)return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||a.dtype==="string"){let p=n.texData.get(a.dataId),m=hNe(p.values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,m)}let{isPacked:h}=n.texData.get(a.dataId),c=jr.isSliceContinous(a.shape,o,l);if(h||!c){let p=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xCe(l):new bCe(l),m=[o];return n.runWebGLProgram(p,[a],a.dtype,m)}return n.uploadToGPU(a.dataId),wCe(a,o,l,n)}var _Ce={kernelName:Mg,backendName:"webgl",kernelFunc:uy},SCe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r;$.assert(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let o=s.reduce((I,k)=>I*k),l=B.getReshaped(a.shape,s,o),h=B.getPermuted(l.length,s.length),c=B.getReshapedPermuted(a.shape,s,o),p=B.getSliceBeginCoords(i,s.length),m=B.getSliceSize(c,i,s.length),g=[],b=je({inputs:{x:a},backend:n,attrs:{shape:l}}),v=Ha({inputs:{x:b},backend:n,attrs:{perm:h}}),x=je({inputs:{x:v},backend:n,attrs:{shape:c}}),_=uy({inputs:{x},backend:n,attrs:{begin:p,size:m}});return g.push(b),g.push(v),g.push(x),g.forEach(I=>n.disposeIntermediateTensorInfo(I)),_},ICe={kernelName:Km,backendName:"webgl",kernelFunc:SCe};function TCe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i}=r,o=n.readSync(a.dataId),l=n.readSync(s.dataId),h=rG(o,l,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,h)}var kCe={kernelName:Xm,backendName:"webgl",kernelFunc:TCe},ECe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,NCe=`
  return float(int(a.r) & int(b.r));
`;function CCe(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=he().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=he().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||i===1){let l=n.texData.get(r.dataId).values,h=n.texData.get(a.dataId).values,[c,p]=OEe(r.shape,a.shape,l,h,r.dtype),m=n.makeTensorInfo(p,r.dtype),g=n.texData.get(m.dataId);return g.values=c,m}let o;return s?o=new oy(ECe,r.shape,a.shape,!1):o=new bd(NCe,r.shape,a.shape),n.runWebGLProgram(o,[r,a],r.dtype)}var ACe={kernelName:Ym,backendName:"webgl",kernelFunc:CCe};function RCe(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.readSync(r.dataId),i=n.readSync(a.dataId),o=B.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}var DCe={kernelName:Dv,backendName:"webgl",kernelFunc:RCe},MCe="return float(a != b);",vG=ga({opSnippet:MCe,cpuKernelImpl:nNe,dtype:"bool"}),$Ce={kernelName:xg,backendName:"webgl",kernelFunc:vG};function Nx(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Fs({inputs:{x:a.complexTensorInfos.real},backend:n})}var OCe={kernelName:M1,backendName:"webgl",kernelFunc:Nx},FCe="return float(int(x));";function PCe(e,t){let n=new $o(e.shape,FCe),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function aN(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return Fs({inputs:{x:a},backend:n});let i=Zn(a.shape),o=aN({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),l=Xc({inputs:{real:o,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(o),l}if(a.dtype==="complex64"){let i=Nx({inputs:{input:a},backend:n}),o=aN({inputs:{x:i},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(i),o}if(!$.hasEncodingLoss(a.dtype,s)){let i=Fs({inputs:{x:a},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(n.shouldExecuteOnCPU([a])){let i=n.texData.get(a.dataId).values,[o,l,h]=FEe(i,a.shape,a.dtype,s);return n.makeTensorInfo(o,l,h)}if(s==="int32")return PCe(a,n);if(s==="bool"){let i=n.makeTensorInfo([],"bool",$.getTypedArrayFromDType("bool",1)),o=vG({inputs:{a,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),o}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${s}`)}var LCe={kernelName:Fd,backendName:"webgl",kernelFunc:aN},OL="return ceil(x);",zCe=Zt({opSnippet:OL,packedOpSnippet:OL,cpuKernelImpl:PEe}),VCe={kernelName:Pd,backendName:"webgl",kernelFunc:zCe},UCe=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}},BCe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function WCe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:i}=r,o;he().getBool("WEBGL_PACK_CLIP")?o=new BCe(a.shape):o=new UCe(a.shape);let l=[[s],[i]];return n.runWebGLProgram(o,[a],a.dtype,l)}var jCe={kernelName:Vc,backendName:"webgl",kernelFunc:WCe},HCe=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function FL(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function GCe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),s=new HCe(r.shape),i=[FL(r,a.complexTensorInfos.real),FL(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(s,i,i[0].dtype)}var qCe={kernelName:Mv,backendName:"webgl",kernelFunc:GCe},KCe=class{constructor(e){this.outputShape=[],this.outputShape=B.computeOutShape(e,1),this.variableNames=e.map((s,i)=>`T${i}`);let t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<t.length;s++){let i=t[s-1];n.push(`else if (yC < ${t[s]}) setOutput(getT${s}(yR, yC-${i}));`)}let r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}},XCe=class{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=B.computeOutShape(e,t);let n=this.outputShape,r=n.length,a=Tn(r),s=Ua("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((b,v)=>`T${v}`);let o=new Array(e.length-1);o[0]=e[0][t];for(let b=1;b<o.length;b++)o[b]=o[b-1]+e[b][t];let l=i[t],h=i.slice(-2),c=i.join(),p=`if (${l} < ${o[0]}) {
        return getChannel(
            getT0(${c}), vec2(${h.join()}));
        }`;for(let b=1;b<o.length;b++){let v=o[b-1];p+=`
        if (${l} < ${o[b]}  && ${l} >= ${o[b-1]}) {
          return getChannel(
            getT${b}(${m0(i,l,v)}),
            vec2(${m0(h,l,v)}));
        }`}let m=o.length,g=o[o.length-1];p+=`
        return getChannel(
          getT${m}(${m0(i,l,g)}),
          vec2(${m0(h,l,g)}));`,this.userCode=`
      float getValue(${i.map(b=>"int "+b)}) {
        ${p}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[r-1]} = ${s[r-1]} + 1;
        if (${s[r-1]} < ${n[r-1]}) {
          result.g = getValue(${s});
        }

        ${s[r-2]} = ${s[r-2]} + 1;
        if (${s[r-2]} < ${n[r-2]}) {
          result.a = getValue(${s});
        }

        ${s[r-1]} = ${s[r-1]} - 1;
        if (${s[r-2]} < ${n[r-2]} &&
            ${s[r-1]} < ${n[r-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function m0(e,t,n){let r=e.indexOf(t);return e.map((a,s)=>s===r?`${a} - ${n}`:a).join()}function WS(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Fs({inputs:{x:a.complexTensorInfos.imag},backend:n})}var YCe={kernelName:C1,backendName:"webgl",kernelFunc:WS};function wb(e,t,n){let r=e[0].dtype;if(r==="complex64"){let g=e.map(I=>Nx({inputs:{input:I},backend:n})),b=e.map(I=>WS({inputs:{input:I},backend:n})),v=wb(g,t,n),x=wb(b,t,n),_=Xc({inputs:{real:v,imag:x},backend:n});return g.forEach(I=>n.disposeIntermediateTensorInfo(I)),b.forEach(I=>n.disposeIntermediateTensorInfo(I)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),_}let a=n.shouldExecuteOnCPU(e);if(r==="string"&&(a=!0),a){let g=e.map(E=>{let R=[-1,$.sizeFromShape(E.shape.slice(t))];return je({inputs:{x:E},backend:n,attrs:{shape:R}})}),b=g.map(E=>({vals:n.readSync(E.dataId),shape:E.shape})),v=B.computeOutShape(g.map(E=>E.shape),1),x=g[0].shape[0]===1,_=LEe(b,v,r,x),I=B.computeOutShape(e.map(E=>E.shape),t),k=n.makeTensorInfo(I,r,_);return g.forEach(E=>n.disposeIntermediateTensorInfo(E)),k}let s=e.filter(g=>$.sizeFromShape(g.shape)>0),i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let g=i?new $o(e[0].shape,Wu):new Ju(e[0].shape,Wu);return n.runWebGLProgram(g,e,r)}let o=he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>o){let g=[];for(let v=0;v<s.length;v+=o){let x=s.slice(v,v+o);g.push(wb(x,t,n))}let b=wb(g,t,n);for(let v of g)n.disposeIntermediateTensorInfo(v);return b}if(i){let g=new XCe(s.map(b=>b.shape),t);return n.runWebGLProgram(g,s,r)}let{tensors2D:l,outShape:h}=QCe(s,t,n),c=new KCe(l.map(g=>g.shape)),p=n.runWebGLProgram(c,l,r);l.forEach(g=>n.disposeIntermediateTensorInfo(g));let m=je({inputs:{x:p},attrs:{shape:h},backend:n});return n.disposeIntermediateTensorInfo(p),m}function QCe(e,t,n){let r=B.computeOutShape(e.map(a=>a.shape),t);return{tensors2D:e.map(a=>je({inputs:{x:a},attrs:{shape:[-1,$.sizeFromShape(a.shape.slice(t))]},backend:n})),outShape:r}}function xG(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=$.parseAxisParam(a,t[0].shape)[0],i=t.map(h=>h.shape);B.assertParamsConsistent(i,s);let o=B.computeOutShape(t.map(h=>h.shape),s);if($.sizeFromShape(o)===0)return n.makeTensorInfo(o,t[0].dtype,[]);let l=t.filter(h=>$.sizeFromShape(h.shape)>0);return l.length===1?Fs({inputs:{x:l[0]},backend:n}):wb(l,s,n)}var ZCe={kernelName:Qm,backendName:"webgl",kernelFunc:xG},wG=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let s=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,h=e.dilationHeight,c=e.dilationWidth,p=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,b=e.inChannels%4,v=e.dataFormat==="channelsLast",x=v?1:2,_=v?2:3,I=v?3:1,k="",E="";n&&(r?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:k=`
          float activation(float x) {
            ${n}
          }
        `,E="result = activation(result);");let R=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${o}, ${l});
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${_}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${c};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${b===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${b===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${b===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${R}
        ${E}
        setOutput(result);
      }
    `}},JCe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,h=e.dilationWidth,c=e.filterDepth,p=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,b=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${s}, ${i});
      const ivec3 pads = ivec3(${t}, ${n}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${c}; wF++) {
          int xF = xFCorner + wF * ${o};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${b===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${b===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${b===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},_G=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ca(this.outputShape.length);let s=e.padInfo.left,i=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,h=e.filterWidth,c=h,p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<h;v++)p+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;p+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<h;v++)p+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(c+1)/2;v++){let x=v*2;if(p+=`
           xC = xCCorner + ${x*o};
           `,i===1){if(x<h&&(s%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,o===1&&x>0?p+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<h)){let _=s%2===0?$.nearestLargerEven(o):o;o%2===0&&s%2===1||o%2!==0&&s%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${_};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,o>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:p+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):_===1?p+=`
                     xC${x+1} = xTexelC${x};
                     `:p+=`
                     xCOffset = xC + ${_};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<h&&(s%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<h&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<h&&(p+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<h&&(p+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<h&&(p+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let m="",g="";n&&(r?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:a?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:m=`vec4 activation(vec4 x) {
           ${n}
         }`,g="result = activation(result);");let b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${b}
         ${g}
         setOutput(result);
       }
     `}},eAe=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Ca(this.outputShape.length);let{dataFormat:n}=t,r=Ya(),a=n==="channelsLast",s=a?1:2,i=a?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,l="";for(let h=0;h<=1;h++)for(let c=0;c<=1;c++)l+=`
          blockIndex = rc.z + ${c};
          pos = rc.y + ${h};

          ${o}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${i}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+c}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+c}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}};function $_(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function SG({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:o=null}){let l=e.shape,h=r.texData.get(e.dataId),c=n.inChannels,p=l[0]*l[1]*l[2],m=n.outChannels,g=n.dataFormat==="channelsLast",b=!1,v=!1,x,_=[];if(s!=null){let I=$_(s.shape,g);I!=null&&(s=je({inputs:{x:s},backend:r,attrs:{shape:I}}),_.push(s))}if(a!=null){let I=$_(a.shape,g);I!=null&&(a=je({inputs:{x:a},backend:r,attrs:{shape:I}}),_.push(a))}if(!((p===1||m===1)&&c>mG)&&h.isPacked&&g&&h.texture!=null&&l[2]%2!==0&&$.arraysEqual(h.shape.slice(-3),l.slice(-3))){let I=l[0]*l[1]*(l[2]+1),k={dataId:e.dataId,shape:[1,I,n.inChannels],dtype:e.dtype},E=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,$.assert(ov(h.shape,k.shape),()=>`packed reshape ${h.shape} to ${k.shape} isn't free`);let R=je({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});_.push(R);let U=M_({a:k,b:R,backend:r,transposeA:b,transposeB:v,bias:a,activation:o,preluActivationWeights:s,leakyreluAlpha:i}),D=r.texData.get(U.dataId);$.assert(D.isPacked,()=>"batchMatMul result is expected to be packed"),h.shape=E,D.shape=n.outShape,x=Fs({inputs:{x:U},backend:r}),x.shape=n.outShape,_.push(U)}else{let I=n.outHeight*n.outWidth,k=je({inputs:{x:e},backend:r,attrs:{shape:g?[n.batchSize,I,n.inChannels]:[n.batchSize,n.inChannels,I]}}),E=je({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),R=M_({a:g?k:E,b:g?E:k,transposeA:!g,transposeB:v,backend:r,bias:a,activation:o,preluActivationWeights:s,leakyreluAlpha:i});x=je({inputs:{x:R},backend:r,attrs:{shape:n.outShape}}),_.push(k),_.push(E),_.push(R)}for(let I of _)r.disposeIntermediateTensorInfo(I);return x}function IG({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:o=null}){let{filterWidth:l,filterHeight:h,inChannels:c,outWidth:p,outHeight:m,dataFormat:g}=n,b=g==="channelsLast",v=l*h*c,x=m*p,_=[n.batchSize,v,x],I=!0,k=!1,E=[];if(s!=null){let ne=$_(s.shape,b);ne!=null&&(s=je({inputs:{x:s},backend:r,attrs:{shape:ne}}),E.push(s))}if(a!=null){let ne=$_(a.shape,b);ne!=null&&(a=je({inputs:{x:a},backend:r,attrs:{shape:ne}}),E.push(a))}let R=je({inputs:{x:t},backend:r,attrs:{shape:[1,v,$.sizeFromShape(t.shape)/v]}});E.push(R);let U=new eAe(_,n),D=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],C=r.runWebGLProgram(U,[e],"float32",D),O=je({inputs:{x:C},backend:r,attrs:{shape:_}});E.push(C),E.push(O);let z=a!=null,M=s!=null,N=o==="leakyrelu",P=o?lv(o,!0):null,Q=new fG(b?O.shape:R.shape,b?R.shape:O.shape,b?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],I,k,z,P,M,N),ee=b?[O,R]:[R,O];if(a&&ee.push(a),M&&ee.push(s),N){let ne=r.makeTensorInfo([],"float32",$.createScalarValue(i,"float32"));ee.push(ne),E.push(ne)}let q=r.runWebGLProgram(Q,ee,"float32"),Z=je({inputs:{x:q},backend:r,attrs:{shape:n.outShape}});E.push(q);for(let ne of E)r.disposeIntermediateTensorInfo(ne);return Z}function tAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dataFormat:l,dilations:h,dimRoundingMode:c}=r,p=B.convertConv2DDataFormat(l),m=B.computeConv2DInfo(a.shape,s.shape,i,h,o,c,!1,p),g;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=SG({x:a,filter:s,convInfo:m,backend:n});else if(m.strideWidth<=2&&p==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){let v=new _G(m),x=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];g=n.runWebGLProgram(v,[a,s],"float32",x)}else if(he().getBool("WEBGL_CONV_IM2COL"))g=IG({x:a,filter:s,convInfo:m,backend:n});else{let v=new wG(m);g=n.runWebGLProgram(v,[a,s],"float32")}let b=je({inputs:{x:g},backend:n,attrs:{shape:m.outShape}});return n.disposeIntermediateTensorInfo(g),b}var nAe={kernelName:Ld,backendName:"webgl",kernelFunc:tAe},rAe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},aAe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dataFormat==="channelsLast",i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=s?1:2,h=s?2:3,c=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${c}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},sAe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${a};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${i};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},iAe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${o}, ${l}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function oAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:o,dataFormat:l,dimRoundingMode:h,filterShape:c}=r,p=B.convertConv2DDataFormat(l),m=B.computeConv2DInfo(a.shape,c,i,1,o,h,!1,p),g=new rAe(m);return n.runWebGLProgram(g,[a,s],"float32")}var lAe={kernelName:_1,backendName:"webgl",kernelFunc:oAe},uAe=class{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Ca(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function cAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:i,strides:o,pad:l,dataFormat:h,dimRoundingMode:c}=r,p=B.convertConv2DDataFormat(h),m=B.computeConv2DInfo(i,s.shape,o,1,l,c,!1,p);if(he().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){let g=[[m.strideHeight,m.strideWidth]],b=new uAe(m);return n.runWebGLProgram(b,[a,s],"float32",g)}else{let g=new aAe(m);return n.runWebGLProgram(g,[a,s],"float32")}}var hAe={kernelName:zd,backendName:"webgl",kernelFunc:cAe};function dAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l}=r,h=B.computeConv3DInfo(a.shape,s.shape,i,l,o),c=new JCe(h);return n.runWebGLProgram(c,[a,s],"float32")}var pAe={kernelName:Vd,backendName:"webgl",kernelFunc:dAe};function fAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:o,filterShape:l}=r,h=B.computeConv3DInfo(a.shape,l,i,1,o),c=new sAe(h);return n.runWebGLProgram(c,[a,s],"float32")}var mAe={kernelName:Zm,backendName:"webgl",kernelFunc:fAe};function gAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:o,inputShape:l}=r,h=B.computeConv3DInfo(l,s.shape,o,1,i),c=new iAe(h);return n.runWebGLProgram(c,[a,s],"float32")}var yAe={kernelName:Jm,backendName:"webgl",kernelFunc:gAe},bAe=ly+`
  return cos(x);
`,vAe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Jp}
  return result;
`,xAe=Zt({opSnippet:bAe,packedOpSnippet:vAe}),wAe={kernelName:Ud,backendName:"webgl",kernelFunc:xAe},_Ae=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,SAe=Zt({opSnippet:_Ae}),IAe={kernelName:Bd,backendName:"webgl",kernelFunc:SAe},TAe=class{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,i,o,l]=e,[h]=t,[c,p]=n;this.outputShape=[h,c,p,l];let m=r==="bilinear"?1:0,[g,b]=[`${i-1}.0`,`${o-1}.0`],[v,x,_]=c>1?[`${(i-1)/(c-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[I,k,E]=p>1?[`${(o-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${b} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${b}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${k};

        float in_y = ${_};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${E};
        if( in_x < 0.0 || in_x > ${b} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}},kAe=e=>{let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:i}=t,{cropSize:o,method:l,extrapolationValue:h}=r,c=new TAe(a.shape,s.shape,o,l,h);return n.runWebGLProgram(c,[a,s,i],"float32")},EAe={kernelName:tg,backendName:"webgl",kernelFunc:kAe},cv;(function(e){e.Prod="*",e.Sum="+"})(cv||(cv={}));var PL=class{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let a=this.outputShape.length,s=this.op===cv.Prod?"1.0":"0.0",i=n?s:`getX(${LL(a,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1],l="",h="";n?(l=r?`end != ${o-1}`:"end != 0",h=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${o}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Tn(a)} coords = getOutputCoords();
        int end = ${zL(a,"coords",this.op)};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${h};
          ${zL(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${LL(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function LL(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function zL(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function TG(e,t,n,r,a,s){let i=t.shape.length,o=B.getAxesPermutation([r],i),l=t;o!=null&&(l=Ha({inputs:{x:t},backend:n,attrs:{perm:o}}));let h=B.getInnerMostAxes(1,i)[0];if(h!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let c=l.shape[h],p=Fs({inputs:{x:l},backend:n});for(let m=0;m<=Math.ceil(Math.log2(c))-1;m++){let g=new PL(e,l.shape,!1,s),b=[[m]],v=p;p=n.runWebGLProgram(g,[p],p.dtype,b),n.disposeIntermediateTensorInfo(v)}if(a){let m=new PL(e,l.shape,a,s),g=p;p=n.runWebGLProgram(m,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(o!=null){let m=B.getUndoAxesPermutation(o),g=Ha({inputs:{x:p},backend:n,attrs:{perm:m}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(l),g}return p}function NAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r;return TG(cv.Prod,a,n,s,i,o)}var CAe={kernelName:eg,backendName:"webgl",kernelFunc:NAe};function AAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r;return TG(cv.Sum,a,n,s,i,o)}var RAe={kernelName:Wd,backendName:"webgl",kernelFunc:AAe};function DAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i,binaryOutput:o}=r;if(a.shape.length===1){let l=n.readSync(a.dataId),h=n.readSync(s.dataId),c=rG(l,h,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,c)}else if(a.shape.length===2){let l=n.bufferSync(a),h=n.bufferSync(s),c=$Ee(l,h,i,o);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var MAe={kernelName:$v,backendName:"webgl",kernelFunc:DAe},$Ae=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function OAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:i}=r,o=a.shape[0],l=i==="NHWC"?a.shape[1]:a.shape[2],h=i==="NHWC"?a.shape[2]:a.shape[3],c=i==="NHWC"?a.shape[3]:a.shape[1],p=l*s,m=h*s,g=c/(s*s),b=i==="NHWC"?[o,p,m,g]:[o,g,p,m],v=new $Ae(b,s,i);return n.runWebGLProgram(v,[a],a.dtype)}var FAe={kernelName:ng,backendName:"webgl",kernelFunc:OAe},kG=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ca(this.outputShape.length);let s=e.filterHeight,i=e.filterWidth,o=e.outChannels/e.inChannels,l="",h="";n&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:l=`
          float activation(float x) {
            ${n}
          }
        `,h="result = activation(result);");let c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${i}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${c}
        ${h}
        setOutput(result);
      }
    `}},EG=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ca(this.outputShape.length);let s=e.outChannels/e.inChannels,i=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,h=e.filterHeight,c=e.filterWidth,p=c,m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<c;x++)m+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;m+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let x=0;x<c;x++)m+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(p+1)/2;x++){let _=x*2;if(m+=`
          xC = xCCorner + ${_*l};
          `,o===1){if(_<c&&(i%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_}Ready == 0) {
                  xTexelC${_} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${_}.zw = vec2(0.0);
                  }
                  xTexelC${_}Ready = 1;
                }
              `,l===1&&_>0?m+=`
                xC${_} = vec4(xTexelC${_-2}.zw, xTexelC${_}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${_} = vec4(previous.zw, xTexelC${_}.xy);
                  } else {
                    xC${_} = vec4(0.0, 0.0, xTexelC${_}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${_}Ready == 0) {
                  xTexelC${_} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${_}.zw = vec2(0.0);
                  }
                  xTexelC${_}Ready = 1;
                }

                xC${_} = xTexelC${_};
                `,_+1<c)){let I=i%2===0?$.nearestLargerEven(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${I};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                    xTexelC${_+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${_+1}.zw = vec2(0.0);
                    }
                    xTexelC${_+1}Ready = 1;
                  }
                  `,l>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${_+1} = vec4(previous.zw, xTexelC${_+1}.xy);
                    } else {
                     xC${_+1} = vec4(0.0, 0.0, xTexelC${_+1}.xy);
                    }
                    `:m+=`
                    xC${_+1} = vec4(xTexelC${_}.zw, xTexelC${_+1}.xy);
                    `):I===1?m+=`
                    xC${_+1} = xTexelC${_};
                    `:m+=`
                    xCOffset = xC + ${I};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                      xTexelC${_+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${_+1}.zw = vec2(0.0);
                      }
                      xTexelC${_+1}Ready = 1;
                    }

                    xC${_+1} = xTexelC${_+1};
                    `}}else _<c&&(i%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_}Ready == 0) {
                  xTexelC${_} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${_}.zw = vec2(0.0);
                  }
                  xTexelC${_}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${_+1}Ready == 0) {
                  xTexelC${_+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${_+1}.zw = vec2(0.0);
                  }
                  xTexelC${_+1}Ready = 1;
                }

                xC${_} = vec4(xTexelC${_}.zw, xTexelC${_+1}.zw);
              `,_+1<c&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${_+1} = vec4(xTexelC${_+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${_}Ready == 0) {
                  xTexelC${_} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${_}.zw = vec2(0.0);
                  }
                  xTexelC${_}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                  xTexelC${_+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${_+1}.zw = vec2(0.);
                  }
                  xTexelC${_+1}Ready = 1;
                }

                xC${_} = vec4(
                  xTexelC${_}.xy, xTexelC${_+1}.xy);
              `,_+1<c&&(m+=`
                  xC${_+1} = vec4(xTexelC${_}.zw, xTexelC${_+1}.zw);
                `)));_<c&&(m+=`
            wTexel = getW(r, ${_}, d1, q);
            dotProd += xC${_} * vec4(wTexel.xz, wTexel.xz);
          `,_+1<c&&(m+=`
              wTexel = getW(r, ${_+1}, d1, q);
              dotProd += xC${_+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let g="",b="";n&&(r?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:g=`vec4 activation(vec4 x) {
          ${n}
        }`,b="result = activation(result);");let v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${b}
        setOutput(result);
      }
    `}};function PAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l,dimRoundingMode:h}=r,c=l;c==null&&(c=[1,1]),$.assert(B.eitherStridesOrDilationsAreOne(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let p=B.computeConv2DInfo(a.shape,s.shape,i,c,o,h,!0),m;he().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?m=new EG(p):m=new kG(p);let g=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return n.runWebGLProgram(m,[a,s],"float32",g)}var LAe={kernelName:jd,backendName:"webgl",kernelFunc:PAe},zAe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},VAe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${o}; dm++) {
              int d2 = d1 * ${o} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function UAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,dilations:o,pad:l,dimRoundingMode:h,filterShape:c}=r,p=B.computeConv2DInfo(a.shape,c,i,o,l,h,!0),m=new zAe(p);return n.runWebGLProgram(m,[a,s],"float32")}var BAe={kernelName:S1,backendName:"webgl",kernelFunc:UAe};function WAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:i,dilations:o,pad:l,dimRoundingMode:h,inputShape:c}=r,p=B.computeConv2DInfo(c,s.shape,i,o,l,h,!0),m=new VAe(p);return n.runWebGLProgram(m,[a,s],"float32")}var jAe={kernelName:I1,backendName:"webgl",kernelFunc:WAe},HAe=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function GAe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],s=$.sizeFromShape(r.shape),i=je({inputs:{x:r},backend:n,attrs:{shape:[s]}}),o=new HAe(s),l=n.runWebGLProgram(o,[i],i.dtype),h=je({inputs:{x:l},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),h}var qAe={kernelName:Ov,backendName:"webgl",kernelFunc:GAe},KAe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:s,filterHeight:i,filterWidth:o,dilationHeight:l,dilationWidth:h}=e,{top:c,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${s});
      const ivec2 pads = ivec2(${c}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${i}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${o}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function XAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l}=r,h=B.computeDilation2DInfo(a.shape,s.shape,i,o,"NHWC",l),c,p=new KAe(h);c=n.runWebGLProgram(p,[a,s],"float32");let m=je({inputs:{x:c},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(c),m}var YAe={kernelName:Hd,backendName:"webgl",kernelFunc:XAe};function QAe(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:i,summedDims:o,idDims:l}=B.decodeEinsumEquation(a,s.length);B.checkEinsumDimSizes(i.length,l,s);let{path:h,steps:c}=B.getEinsumComputePath(o,l),p=c.length,m=null,g=i.length,b=[];for(let v=0;v<p;++v){for(let x of c[v]){let{permutationIndices:_,expandDims:I}=B.getEinsumPermutation(g,l[x]),k;B.isIdentityPermutation(_)?k=s[x]:(k=Ha({inputs:{x:s[x]},backend:n,attrs:{perm:_}}),b.push(k));let E=k.shape.slice();for(let R=0;R<I.length;++R)E.splice(I[R],0,1);$.arraysEqual(k.shape,E)||(k=je({inputs:{x:k},backend:n,attrs:{shape:E}}),b.push(k)),m===null?m=k:(m=bD({inputs:{a:k,b:m},backend:n}),b.push(m))}v<p-1&&(h[v]>=0&&(m=BS({inputs:{x:m},backend:n,attrs:{axis:h[v]-(i.length-g),keepDims:!1}}),b.push(m)),g--)}for(let v of b)v!==m&&n.disposeIntermediateTensorInfo(v);return m}var ZAe={kernelName:k1,backendName:"webgl",kernelFunc:QAe},JAe="return (x >= 0.0) ? x : (exp(x) - 1.0);",eRe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,tRe=Zt({opSnippet:JAe,packedOpSnippet:eRe}),nRe={kernelName:qd,backendName:"webgl",kernelFunc:tRe},rRe="return (b >= 0.0) ? a : a * (b + 1.0);",aRe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,sRe=e=>{let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oy(aRe,r.shape,a.shape):new bd(rRe,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],r.dtype)},iRe={kernelName:rg,backendName:"webgl",kernelFunc:sRe},oRe=`
  return vec4(equal(a, b));
`,lRe="return float(a == b);",uRe=ga({opSnippet:lRe,packedOpSnippet:oRe,dtype:"bool",cpuKernelImpl:zEe}),cRe={kernelName:ag,backendName:"webgl",kernelFunc:uRe},hRe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${B.ERF_P};
  float a1 = ${B.ERF_A1};
  float a2 = ${B.ERF_A2};
  float a3 = ${B.ERF_A3};
  float a4 = ${B.ERF_A4};
  float a5 = ${B.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,dRe=Zt({opSnippet:hRe}),pRe={kernelName:Kd,backendName:"webgl",kernelFunc:dRe},fRe=ly+`
  return exp(x);
`,mRe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,NG=Zt({opSnippet:fRe,packedOpSnippet:mRe,cpuKernelImpl:VEe,dtype:"float32"}),gRe={kernelName:Xd,backendName:"webgl",kernelFunc:NG};function sN(e){let{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:s}=t,i=s.shape.length,o=s.shape.slice(),l=a;return a<0&&($.assert(-(i+1)<=a,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+a+1),o.splice(l,0,1),je({inputs:{x:s},backend:r,attrs:{shape:o}})}var yRe={kernelName:sg,backendName:"webgl",kernelFunc:sN},VL="return exp(x) - 1.0;",bRe=Zt({opSnippet:VL,packedOpSnippet:VL,cpuKernelImpl:UEe}),vRe={kernelName:Yd,backendName:"webgl",kernelFunc:bRe},UL=class{constructor(e,t,n){this.variableNames=["real","imag"];let r=t[1];this.outputShape=t;let a=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0",i;if(e==="real")i="return real * expR - imag * expI;";else if(e==="imag")i="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${i}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function CG(e,t,n){let r=n.texData.get(e.dataId),a=$.sizeFromShape(e.shape),s=e.shape[e.shape.length-1],i=a/s,o=je({inputs:{x:e},backend:n,attrs:{shape:[i,s]}}),l=o.shape,h=new UL("real",l,t),c=new UL("imag",l,t),p=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],m=n.runWebGLProgram(h,p,"float32"),g=n.runWebGLProgram(c,p,"float32"),b=Xc({inputs:{real:m,imag:g},backend:n});n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g);let v=je({inputs:{x:b},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(b),v}function xRe(e){let{inputs:t,backend:n}=e,{input:r}=t;return CG(r,!1,n)}var wRe={kernelName:E1,backendName:"webgl",kernelFunc:xRe},_Re=class{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function Cx(e){let{backend:t,attrs:n}=e,{shape:r,value:a}=n,{dtype:s}=n;if(s=s||$.inferDtype(a),s==="string"){let i=$.getArrayFromDType(s,$.sizeFromShape(r));return i.fill(a),t.makeTensorInfo(r,s,i)}else{let i=new _Re(r,a),o=[[a]];return t.runWebGLProgram(i,[],s,o)}}var SRe={kernelName:Fv,backendName:"webgl",kernelFunc:Cx},IRe=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}},TRe={kernelName:ig,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,a=new IRe(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},BL="return floor(x);",kRe=Zt({opSnippet:BL,packedOpSnippet:BL,cpuKernelImpl:BEe}),ERe={kernelName:Qd,backendName:"webgl",kernelFunc:kRe},NRe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,CRe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,ARe=ga({opSnippet:NRe,packedOpSnippet:CRe,dtype:"int32"}),RRe={kernelName:Zd,backendName:"webgl",kernelFunc:ARe},DRe=class{constructor(e){this.variableNames=["A"];let t=Ya(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}},MRe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=Ya(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${n}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}},$Re={kernelName:d_,backendName:"webgl",kernelFunc:ORe},Vf,Ik=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function ORe(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:a}=t,{numChannels:s}=r,i=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,o=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,[l,h]=i?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=[h,l],p=[h,l,s];if(o||i){let v=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Vf==null||v!==Ik)&&(Ik=v,Vf=document.createElement("canvas").getContext("2d",{willReadFrequently:Ik})),Vf.canvas.width=l,Vf.canvas.height=h,Vf.drawImage(a,0,0,l,h),a=Vf.canvas}let m=n.makeTensorInfo(c,"int32");n.texData.get(m.dataId).usage=Ys.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(m.dataId),a);let g=he().getBool("WEBGL_PACK")?new MRe(p):new DRe(p),b=n.runWebGLProgram(g,[m],"int32");return n.disposeData(m.dataId),b}function FRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dataFormat:c,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=r,v=B.convertConv2DDataFormat(c),x=B.computeConv2DInfo(a.shape,s.shape,l,p,h,m,!1,v),_,I=[],k=i!=null,E=o!=null,R=g==="leakyrelu",U=()=>{let C=[a,s],O=(z,M)=>{if(M==="NCHW"&&z.shape.length===1&&z.shape[0]!==1){let N=je({inputs:{x:z},backend:n,attrs:{shape:[z.shape[0],1,1]}});return I.push(N),N}return z};if(k&&C.push(O(i,c)),E&&C.push(O(o,c)),R){let z=n.makeTensorInfo([],"float32",$.createScalarValue(b,"float32"));C.push(z),I.push(z)}return C};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))_=SG({x:a,filter:s,convInfo:x,backend:n,bias:i,activation:g,preluActivationWeights:o,leakyreluAlpha:b});else if(x.strideWidth<=2&&v==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){let C=g?lv(g,!0):null,O=new _G(x,k,C,E,R),z=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],M=U();_=n.runWebGLProgram(O,M,"float32",z)}else if(he().getBool("WEBGL_CONV_IM2COL"))_=IG({x:a,filter:s,convInfo:x,backend:n,bias:i,activation:g,preluActivationWeights:o,leakyreluAlpha:b});else{let C=g?lv(g,!1):null,O=new wG(x,k,C,E,R),z=U();_=n.runWebGLProgram(O,z,"float32")}let D=je({inputs:{x:_},backend:n,attrs:{shape:x.outShape}});return I.push(_),I.forEach(C=>n.disposeIntermediateTensorInfo(C)),D}var PRe={kernelName:nd,backendName:"webgl",kernelFunc:FRe};function LRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dilations:c,dimRoundingMode:p,activation:m,leakyreluAlpha:g}=r,b=[],v=c;v==null&&(v=[1,1]),$.assert(B.eitherStridesOrDilationsAreOne(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);let x=B.computeConv2DInfo(a.shape,s.shape,l,v,h,p,!0),_=he().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,I=m?lv(m,_):null,k=[a,s],E=i!=null,R=o!=null,U=m==="leakyrelu";if(E&&k.push(i),R&&k.push(o),U){let z=n.makeTensorInfo([],"float32",$.createScalarValue(g,"float32"));k.push(z),b.push(z)}let D;_?D=new EG(x,E,I,R,U):D=new kG(x,E,I,R,U);let C=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],O=n.runWebGLProgram(D,k,"float32",C);return b.forEach(z=>n.disposeIntermediateTensorInfo(z)),O}var zRe={kernelName:rd,backendName:"webgl",kernelFunc:LRe},VRe=class{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;let a=Tn(n.length),s=`
    int index;`;for(let i=0;i<this.sliceDim;i++)s+=`
          index = round(getIndices(coords[0], ${i}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[i]};
          flattenIndex += index * ${this.strides[i]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function URe(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=a.shape,i=s[s.length-1],o=$.sizeFromShape(r.shape),[l,h,c,p]=B.prepareAndValidate(r,a),m=je({inputs:{x:a},backend:n,attrs:{shape:[h,i]}}),g=je({inputs:{x:r},backend:n,attrs:{shape:[$.sizeFromShape(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,a])||r.dtype==="string"){let _=n.readSync(a.dataId),I=n.bufferSync(r),k=WEe(_,I,r.dtype,h,i,c,p,r.shape,o);return n.makeTensorInfo(l,r.dtype,k.values)}let b=new VRe(i,p,[h,c],r.shape),v=n.runWebGLProgram(b,[g,m],g.dtype),x=je({inputs:{x:v},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),x}var BRe={kernelName:lg,backendName:"webgl",kernelFunc:URe},WRe=class{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=Tn(this.rank),r=jRe(e);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}};function jRe(e,t){let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let a=0;a<e.length;a++)a===2?r.push("index"):r.push(`${n[a]}`);return r.join()}function AG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:i,batchDims:o}=r,l=$.parseAxisParam(i,a.shape)[0];if(he().get("DEBUG")){let I=n.readSync(s.dataId),k=a.shape[l];for(let E=0;E<I.length;++E){let R=I[E];$.assert(R<=k-1&&R>=0,()=>`GatherV2: the index value ${R} is not in [0, ${k-1}]`)}}let h=B.segment_util.collectGatherOpShapeInfo(a,s,l,o),c=$.sizeFromShape(s.shape),p=[],m=je({inputs:{x:a},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),g=je({inputs:{x:s},backend:n,attrs:{shape:[h.batchSize,c/h.batchSize]}});p.push(m),p.push(g);let b=[h.batchSize,h.outerSize,c/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([a,s])||a.dtype==="string"){let I=n.bufferSync(g),k=n.bufferSync(m),E=jEe(k,I,b);return p.forEach(R=>n.disposeIntermediateTensorInfo(R)),n.makeTensorInfo(h.outputShape,E.dtype,E.values)}let v=new WRe(m.shape,b),x=n.runWebGLProgram(v,[m,g],m.dtype);p.push(x);let _=je({inputs:{x},backend:n,attrs:{shape:h.outputShape}});return p.forEach(I=>n.disposeIntermediateTensorInfo(I)),_}var HRe={kernelName:og,backendName:"webgl",kernelFunc:AG},GRe="return float(a > b);",qRe=`
  return vec4(greaterThan(a, b));
`,KRe=ga({opSnippet:GRe,packedOpSnippet:qRe,cpuKernelImpl:HEe,dtype:"bool"}),XRe={kernelName:ug,backendName:"webgl",kernelFunc:KRe},YRe="return float(a >= b);",QRe=`
  return vec4(greaterThanEqual(a, b));
`,ZRe=ga({opSnippet:YRe,packedOpSnippet:QRe,dtype:"bool",cpuKernelImpl:GEe}),JRe={kernelName:ep,backendName:"webgl",kernelFunc:ZRe};function eDe(e){let{inputs:t,backend:n}=e,{input:r}=t;return CG(r,!0,n)}var tDe={kernelName:N1,backendName:"webgl",kernelFunc:eDe},nDe="return float(!isnan(x) && !isinf(x));",rDe=Zt({opSnippet:nDe,dtype:"bool"}),aDe={kernelName:np,backendName:"webgl",kernelFunc:rDe},sDe="return float(isinf(x));",iDe=Zt({opSnippet:sDe,dtype:"bool"}),oDe={kernelName:rp,backendName:"webgl",kernelFunc:iDe},lDe="return float(isnan(x));",uDe=Zt({opSnippet:lDe,dtype:"bool"}),cDe={kernelName:ap,backendName:"webgl",kernelFunc:uDe},hDe="return float(a < b);",dDe=`
  return vec4(lessThan(a, b));
`,pDe=ga({opSnippet:hDe,packedOpSnippet:dDe,cpuKernelImpl:qEe,dtype:"bool"}),fDe={kernelName:cg,backendName:"webgl",kernelFunc:pDe},mDe="return float(a <= b);",gDe=`
  return vec4(lessThanEqual(a, b));
`,yDe=ga({opSnippet:mDe,packedOpSnippet:gDe,cpuKernelImpl:KEe,dtype:"bool"}),bDe={kernelName:hg,backendName:"webgl",kernelFunc:yDe};function vDe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,i=XEe(r,a,s);return t.makeTensorInfo([i.length],"float32",i)}var xDe={kernelName:dg,backendName:"webgl",kernelFunc:vDe},wDe=ly+`
  return x < 0.0 ? 0./0. : log(x);
`,_De=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,SDe=Zt({opSnippet:wDe,packedOpSnippet:_De,cpuKernelImpl:YEe}),IDe={kernelName:ip,backendName:"webgl",kernelFunc:SDe},TDe=ly+`
  return log(1.0 + x);
`,kDe=Zt({opSnippet:TDe}),EDe={kernelName:op,backendName:"webgl",kernelFunc:kDe},NDe="return float(a >= 1.0 && b >= 1.0);",CDe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,ADe=ga({opSnippet:NDe,packedOpSnippet:CDe,dtype:"bool"}),RDe={kernelName:pg,backendName:"webgl",kernelFunc:ADe},DDe="return float(!(x >= 1.0));",MDe=Zt({opSnippet:DDe}),$De={kernelName:fg,backendName:"webgl",kernelFunc:MDe},ODe="return float(a >= 1.0 || b >= 1.0);",FDe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,PDe=ga({opSnippet:ODe,packedOpSnippet:FDe,dtype:"bool"}),LDe={kernelName:mg,backendName:"webgl",kernelFunc:PDe},zDe=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];let s=t,i=e[3]-1;this.outputShape=e;let o,l=`float(${n}) + float(${r}) * sum`;a===.5?o=`inversesqrt(${l})`:a===1?o=`1.0/(${l})`:o=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${i}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${o};
        setOutput(val);
      }
    `}},VDe=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=t,i=e[3]-1;this.outputShape=e;let o,l=`float(${n}) + float(${r}) * sum`;a===.5?o=`inversesqrt(${l})`:a===1?o=`1.0/(${l})`:o=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${o};
        setOutput(result);
      }
    `}},UDe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:o,beta:l}=r,h=he().getBool("WEBGL_PACK_NORMALIZATION")?new VDe(a.shape,s,i,o,l):new zDe(a.shape,s,i,o,l);return n.runWebGLProgram(h,[a],a.dtype)},BDe={kernelName:lp,backendName:"webgl",kernelFunc:UDe},WDe=class{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}},jDe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:o,bias:l,alpha:h,beta:c}=r,p=new WDe(a.shape,o,l,h,c);return n.runWebGLProgram(p,[a,s,i],a.dtype)},HDe={kernelName:gg,backendName:"webgl",kernelFunc:jDe};function GDe(e,t,n,r){let a=$.sizeFromShape(t),s=$.sizeFromShape(e.shape)/a,i=je({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),o=ef(i,e.dtype,"max",r),l=je({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),l}function RG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:i}=r,o=a.shape.length,l=$.parseAxisParam(s,a.shape),h=l,c=B.getAxesPermutation(h,o),p=c!=null,m=n.shouldExecuteOnCPU([a]),g=a;if(p){if(m){let I=n.texData.get(g.dataId).values,k=new Array(o);for(let U=0;U<k.length;U++)k[U]=a.shape[c[U]];let E=mD(I,a.shape,a.dtype,c,k);g=n.makeTensorInfo(k,a.dtype);let R=n.texData.get(g.dataId);R.values=E}else g=US(a,c,n);h=B.getInnerMostAxes(h.length,o)}B.assertAxesAreInnerMostDims("max",h,o);let[b,v]=B.computeOutAndReduceShapes(g.shape,h),x=b;i&&(x=B.expandShapeToKeepDim(b,l));let _;if(m){let I=n.texData.get(g.dataId).values,k=QEe(I,$.sizeFromShape(v),x,a.dtype);_=n.makeTensorInfo(x,a.dtype);let E=n.texData.get(_.dataId);E.values=k}else _=GDe(g,v,x,n);return p&&n.disposeIntermediateTensorInfo(g),_}var qDe={kernelName:up,backendName:"webgl",kernelFunc:RG},KDe=yD+`
  return max(a, b);
`,XDe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jp+`
  return result;
`,YDe=ga({opSnippet:KDe,packedOpSnippet:XDe,cpuKernelImpl:ZEe}),QDe={kernelName:cp,backendName:"webgl",kernelFunc:YDe};function ZDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;ny(a,"maxPool");let{filterSize:s,strides:i,pad:o,dimRoundingMode:l}=r,h=1;$.assert(B.eitherStridesOrDilationsAreOne(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let c=B.computePool2DInfo(a.shape,s,i,h,o,l);if(c.filterWidth===1&&c.filterHeight===1&&$.arraysEqual(c.inShape,c.outShape))return Fs({inputs:{x:a},backend:n});let p=new uv(c,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}var JDe={kernelName:hp,backendName:"webgl",kernelFunc:ZDe};function eMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dataFormat:l,dimRoundingMode:h}=r,c=[1,1,1],p=B.computePool3DInfo(a.shape,s,i,c,o,h,l),m=new vD(p,"max",!1);return n.runWebGLProgram(m,[a],a.dtype)}var tMe={kernelName:yg,backendName:"webgl",kernelFunc:eMe},nMe=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,s=e.effectiveFilterWidth,i=a-1-e.padInfo.top,o=s-1-e.padInfo.left,l=a*s-1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},rMe=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,i=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,c=o-1-e.padInfo.front,p=l-1-e.padInfo.top,m=h-1-e.padInfo.left,g=o*l*h-1;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${p}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${o};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${i}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function aMe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s,{filterSize:o,strides:l,pad:h,dimRoundingMode:c}=r,p=[1,1,1],m=B.computePool3DInfo(i.shape,o,l,p,h,c),g=new vD(m,"max",!0),b=n.runWebGLProgram(g,[i],i.dtype),v=new rMe(m),x=n.runWebGLProgram(v,[a,b],i.dtype);return n.disposeIntermediateTensorInfo(b),x}var sMe={kernelName:Lv,backendName:"webgl",kernelFunc:aMe};function iMe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:i}=t,o=s;ny([s,i],"maxPoolGrad");let{filterSize:l,strides:h,pad:c,dimRoundingMode:p}=r,m=B.computePool2DInfo(o.shape,l,h,1,c,p),g=!0,b=new uv(m,"max",g),v=n.runWebGLProgram(b,[o],o.dtype),x=new nMe(m),_=n.runWebGLProgram(x,[a,v],o.dtype);return n.disposeIntermediateTensorInfo(v),_}var oMe={kernelName:Pv,backendName:"webgl",kernelFunc:iMe};function lMe(e,t,n,r){let a=new uv(n,"max",!1),s=r.runWebGLProgram(a,[e],"float32");a=new uv(n,"max",!0,!0,t);let i=r.runWebGLProgram(a,[e],"float32");return[s,i]}var uMe={kernelName:zv,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:i,includeBatchInIndex:o}=t,l=n;$.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let h=[1,1];$.assert(B.eitherStridesOrDilationsAreOne(s,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${h}'`);let c=B.computePool2DInfo(r.shape,a,s,h,i),[p,m]=lMe(r,o,c,l);return[p,m]}};function cMe(e,t,n,r){let a=$.sizeFromShape(t),s=$.sizeFromShape(e.shape)/a,i=je({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),o=ef(i,"float32","mean",r),l=je({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),l}var hMe={kernelName:dp,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{keepDims:a,axis:s}=t,i=n,o=r.shape.length,l=$.parseAxisParam(s,r.shape),h=l,c=B.getAxesPermutation(h,o),p=c!=null,m=i.shouldExecuteOnCPU([r]),g=[],b=r;if(p){if(m){let k=i.texData.get(b.dataId).values,E=new Array(o);for(let D=0;D<E.length;D++)E[D]=r.shape[c[D]];let R=mD(k,r.shape,r.dtype,c,E);b=i.makeTensorInfo(E,r.dtype);let U=i.texData.get(b.dataId);U.values=R}else b=US(r,c,i);g.push(b),h=B.getInnerMostAxes(h.length,o)}B.assertAxesAreInnerMostDims("sum",h,o);let[v,x]=B.computeOutAndReduceShapes(b.shape,h),_=v;a&&(_=B.expandShapeToKeepDim(v,l));let I=cMe(b,x,_,i);for(let k of g)i.disposeIntermediateTensorInfo(k);return I}};function dMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,o=a.shape.length,l=$.parseAxisParam(s,a.shape),h=l,c=B.getAxesPermutation(h,o),p=a;c!=null&&(p=Ha({inputs:{x:a},backend:n,attrs:{perm:c}}),h=B.getInnerMostAxes(h.length,a.shape.length)),B.assertAxesAreInnerMostDims("min",h,o);let[m,g]=B.computeOutAndReduceShapes(p.shape,h),b=$.sizeFromShape(g),v=je({inputs:{x:p},backend:n,attrs:{shape:[-1,b]}}),x=ef(v,v.dtype,"min",n),_;if(i){let I=B.expandShapeToKeepDim(m,l);_=je({inputs:{x},backend:n,attrs:{shape:I}})}else _=je({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(p),_}var pMe={kernelName:pp,backendName:"webgl",kernelFunc:dMe},fMe=yD+`
  return min(a, b);
`,mMe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jp+`
  return result;
`,gMe=ga({opSnippet:fMe,packedOpSnippet:mMe,cpuKernelImpl:JEe}),yMe={kernelName:fp,backendName:"webgl",kernelFunc:gMe},bMe=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((h,c)=>h[0]+e[c]+h[1]);let r=e.length,a=Tn(r),s=t.map(h=>h[0]).join(","),i=t.map((h,c)=>h[0]+e[c]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=n==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${s};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${o}));
      }
    `}},vMe=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((g,b)=>g[0]+e[b]+g[1]);let r=e.length,a=Tn(r),s=t.map(g=>g[0]).join(","),i=t.map((g,b)=>g[0]+e[b]).join(","),o=Ua("rc",r),l=Ua("source",r),h=`${o[r-1]} < ${this.outputShape[r-1]}`,c=r===1?"source":`vec2(${l.slice(-2).join()})`,p=n==="reflect"?0:1,m="";if(r===1){let g=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${o[r-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
      `}else{let g=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${o[r-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
        rc = outputLoc;
        ${o[r-2]} += 1;
        if(${o[r-2]} < ${this.outputShape[r-2]}) {
          ${g}
          result[2] = getChannel(getX(${l.join()}), ${c});
          ${o[r-1]} += 1;
          if(${h}) {
            ${g}
            result[3] = getChannel(getX(${l.join()}), ${c});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}},xMe=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{paddings:a,mode:s}=n,i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vMe(r.shape,a,s):new bMe(r.shape,a,s);return t.runWebGLProgram(i,[r],r.dtype)},wMe={kernelName:mp,backendName:"webgl",kernelFunc:xMe},_Me=`if (b == 0.0) return NAN;
  return mod(a, b);`,SMe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Jp+`
  return result;
`,IMe=ga({opSnippet:_Me,packedOpSnippet:SMe}),TMe={kernelName:gp,backendName:"webgl",kernelFunc:IMe},kMe=class{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}},EMe=`
if (a == b) {
  return 1.0;
};
return a / b;`,NMe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,DG=ga({opSnippet:EMe,packedOpSnippet:NMe,checkOutOfBounds:!0}),CMe={kernelName:Gd,backendName:"webgl",kernelFunc:DG},WL="return a - b;",MG=ga({opSnippet:WL,packedOpSnippet:WL,supportsComplex:!0,cpuKernelImpl:xNe}),AMe={kernelName:Up,backendName:"webgl",kernelFunc:MG};function $G(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,i=$.parseAxisParam([s],a.shape),o=RG({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=B.expandShapeToKeepDim(o.shape,i),h=je({inputs:{x:o},backend:n,attrs:{shape:l}}),c=MG({inputs:{a,b:h},backend:n}),p=NG({inputs:{x:c},backend:n}),m=BS({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:!1}}),g=je({inputs:{x:m},backend:n,attrs:{shape:l}}),b=DG({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),b}var RMe={kernelName:zp,backendName:"webgl",kernelFunc:$G};function DMe(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:o}=r,l=o?a:$G({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),h=l.shape[0],c=l.shape[1],p=new kMe(h,c,s),m=[[i]],g=n.runWebGLProgram(p,[l],"int32",m);return o||n.disposeIntermediateTensorInfo(l),g}var MMe={kernelName:bg,backendName:"webgl",kernelFunc:DMe},$Me=Ai+`
  return -x;
`,OMe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function FMe(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){let s=n.texData.get(r.dataId),[i,o]=tNe(s.values,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,i)}let a;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Ju(r.shape,OMe):a=new $o(r.shape,$Me),n.runWebGLProgram(a,[r],r.dtype)}var PMe={kernelName:vg,backendName:"webgl",kernelFunc:FMe},LMe=el.nonMaxSuppressionV3Impl;function zMe(e){B.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l}=r,h=n.readSync(a.dataId),c=n.readSync(s.dataId),{selectedIndices:p}=LMe(h,c,i,o,l);return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}var VMe={kernelName:wg,backendName:"webgl",kernelFunc:zMe},UMe=el.nonMaxSuppressionV4Impl;function BMe(e){B.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:h}=r,c=n.readSync(a.dataId),p=n.readSync(s.dataId),{selectedIndices:m,validOutputs:g}=UMe(c,p,i,o,l,h);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([],"int32",new Int32Array([g]))]}var WMe={kernelName:_g,backendName:"webgl",kernelFunc:BMe},jMe=el.nonMaxSuppressionV5Impl;function HMe(e){B.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:o,scoreThreshold:l,softNmsSigma:h}=r,c=n.readSync(a.dataId),p=n.readSync(s.dataId),m=i,g=o,b=l,v=h,{selectedIndices:x,selectedScores:_}=jMe(c,p,m,g,b,v);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([_.length],"float32",new Float32Array(_))]}var GMe={kernelName:Sg,backendName:"webgl",kernelFunc:HMe},qMe=class{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${n}),
                      float(index == coords.y)));
      }
    `}},KMe=e=>{let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:o,offValue:l}=r,h=$.sizeFromShape(a.shape),c=new qMe(h,i,o,l),p=je({inputs:{x:a},backend:n,attrs:{shape:[h]}}),m=n.runWebGLProgram(c,[p],s);n.disposeIntermediateTensorInfo(p);let g=[...a.shape,i],b=je({inputs:{x:m},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(m),b},XMe={kernelName:bp,backendName:"webgl",kernelFunc:KMe};function O_(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){let a=Nx({inputs:{input:r},backend:n}),s=O_({inputs:{x:a},backend:n}),i=WS({inputs:{input:r},backend:n}),o=O_({inputs:{x:i},backend:n}),l=Xc({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),l}else return Cx({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}var YMe={kernelName:Bg,backendName:"webgl",kernelFunc:O_};function OG(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let a=Nx({inputs:{input:r},backend:n}),s=OG({inputs:{x:a},backend:n}),i=WS({inputs:{input:r},backend:n}),o=O_({inputs:{x:i},backend:n}),l=Xc({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),l}else return Cx({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}var QMe={kernelName:Ig,backendName:"webgl",kernelFunc:OG};function ZMe(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return sN({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{$.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),$.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let o=[],l=t.map(c=>{let p=sN({inputs:{input:c},backend:n,attrs:{dim:a}});return o.push(p),p}),h=xG({inputs:l,backend:n,attrs:{axis:a}});return o.forEach(c=>n.disposeIntermediateTensorInfo(c)),h}var JMe={kernelName:Tg,backendName:"webgl",kernelFunc:ZMe},e$e=class{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,h)=>l[0]+e[h]+l[1]);let r=e.length,a=Tn(r),s=t.map(l=>l[0]).join(","),i=t.map((l,h)=>l[0]+e[h]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${s};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${o}));
        }
      }
    `}},t$e=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((b,v)=>b[0]+e[v]+b[1]);let r=e.length,a=Tn(r),s=t.map(b=>b[0]).join(","),i=t.map((b,v)=>b[0]+e[v]).join(","),o=Ua("rc",r),l=Ua("source",r),h=`${o[r-1]} < ${this.outputShape[r-1]}`,c=r===1?"source":`vec2(${l.slice(-2).join()})`,p=[`${a} rc = outputLoc;`,`${o[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${o[r-2]} += 1;
       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${o[r-1]} += 1;
         if(${h}) {`],m=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",g="";for(let b=0,v=r===1?2:4;b<v;b++)g+=`
        ${p[b]}
        if (${m}) {
          result[${b}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${b}] = getChannel(getX(${l.join()}), ${c});
        }
      `;g+=r===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}},FG=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:i}=r;if($.sizeFromShape(a.shape)===0){let h=s.map((c,p)=>c[0]+a.shape[p]+c[1]);return Cx({backend:n,attrs:{shape:h,value:i,dtype:a.dtype}})}let o=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t$e(a.shape,s,i):new e$e(a.shape,s,i),l=[[i]];return n.runWebGLProgram(o,[a],a.dtype,l)},n$e={kernelName:vp,backendName:"webgl",kernelFunc:FG},r$e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,a$e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Jp+`
  return result;
`,s$e=ga({opSnippet:r$e,packedOpSnippet:a$e}),i$e={kernelName:xp,backendName:"webgl",kernelFunc:s$e};function o$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,o=a.shape.length,l=[],h=$.parseAxisParam(s,a.shape),c=h,p=B.getAxesPermutation(c,o),m=a;p!=null&&(m=Ha({inputs:{x:a},backend:n,attrs:{perm:p}}),c=B.getInnerMostAxes(c.length,o),l.push(m)),B.assertAxesAreInnerMostDims("prod",c,o);let g;if(n.shouldExecuteOnCPU([m])){let b=n.texData.get(m.dataId).values,{outVals:v,outShape:x,outDtype:_}=rNe(m.shape,m.dtype,b,c);g=n.makeTensorInfo(x,_,v)}else{let[b,v]=B.computeOutAndReduceShapes(m.shape,c),x=$.sizeFromShape(v),_=je({inputs:{x:m},backend:n,attrs:{shape:[-1,x]}}),I=O1(a.dtype),k=ef(_,I,"prod",n);g=je({inputs:{x:k},backend:n,attrs:{shape:b}}),l.push(_),l.push(k)}if(i){l.push(g);let b=B.expandShapeToKeepDim(g.shape,h);g=je({inputs:{x:g},backend:n,attrs:{shape:b}})}return l.forEach(b=>n.disposeIntermediateTensorInfo(b)),g}var l$e={kernelName:_p,backendName:"webgl",kernelFunc:o$e};function u$e(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:i}=t,{outputRaggedRank:o}=r,l=a.map(_=>n.readSync(_.dataId)),h=a.map(_=>_.shape),c=n.readSync(s.dataId),p=n.readSync(i.dataId),[m,g,b]=aNe(l,h,c,s.shape,s.dtype,p,i.shape,o),v=m.map(_=>n.makeTensorInfo([_.length],"int32",_)),x=n.makeTensorInfo(b,s.dtype,g);return v.concat([x])}var c$e={kernelName:A1,backendName:"webgl",kernelFunc:u$e};function h$e(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,i=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(s.dataId),[h,c]=sNe(i,r.shape,r.dtype,o,a.shape,l,s.shape),p=n.makeTensorInfo([h.length],"int32",h),m=n.makeTensorInfo([c.length],r.dtype,c);return[p,m]}var d$e={kernelName:R1,backendName:"webgl",kernelFunc:h$e};function p$e(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:i,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,h=n.readSync(a.dataId),c=n.readSync(s.dataId),p=n.readSync(i.dataId),m=o.map(x=>n.readSync(x.dataId)),g=o.map(x=>x.shape),[b,v]=iNe(h,a.shape,c,s.shape,s.dtype,p,i.shape,m,g,l);return n.makeTensorInfo(b,s.dtype,v)}var f$e={kernelName:D1,backendName:"webgl",kernelFunc:p$e},PG=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:i}=n,o=oNe(r,a,s,i);return t.makeTensorInfo([o.length],i,o)},m$e={kernelName:Vv,backendName:"webgl",kernelFunc:PG},g$e="return 1.0 / x;",y$e=Zt({opSnippet:g$e}),b$e={kernelName:Sp,backendName:"webgl",kernelFunc:y$e},v$e=Ai+`
  return (x < 0.0) ? 0.0 : x;
`,x$e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,w$e=Zt({opSnippet:v$e,packedOpSnippet:x$e}),_$e={kernelName:Ip,backendName:"webgl",kernelFunc:w$e},S$e=Ai+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,I$e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,T$e=Zt({opSnippet:S$e,packedOpSnippet:I$e}),k$e={kernelName:Ep,backendName:"webgl",kernelFunc:T$e},E$e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,i,o,l]=e;this.outputShape=[s,t,n,l];let h=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],p;a?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/c[0]},
          ${h[1]/c[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${o}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}},N$e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,i,o,l]=e;this.outputShape=[s,t,n,l];let h=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],p;a?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/c[0]},
          ${h[1]/c[1]},
          ${h[1]/c[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${o}.0,
                                     ${o}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function C$e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:o}=r,[l,h]=o,c=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new N$e(a.shape,l,h,s,i):new E$e(a.shape,l,h,s,i);return n.runWebGLProgram(c,[a],"float32")}var A$e={kernelName:kp,backendName:"webgl",kernelFunc:C$e},R$e=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,i]=e,o=[n&&s>1?r-1:r,n&&i>1?a-1:a],l=[n&&s>1?s-1:s,n&&i>1?i-1:i],h=o[0]/l[0],c=o[1]/l[1],p=1/h,m=1/c,g=Math.ceil(p)*2+2,b=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${c});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function D$e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,o=new R$e(s.shape,a.shape,i);return n.runWebGLProgram(o,[s],s.dtype)}var M$e={kernelName:Ng,backendName:"webgl",kernelFunc:D$e},$$e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,i,o,l]=e;this.outputShape=[s,t,n,l];let h=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=r?"0.5":"0.0",m;a?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/c[0]},
          ${h[1]/c[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${o}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}},O$e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,i,o,l]=e;this.outputShape=[s,t,n,l];let h=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=r?"0.5":"0.0",m;a?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/c[0]},
          ${h[1]/c[1]},
          ${h[1]/c[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${o}.0,
                                     ${o}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function F$e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:o}=r,[l,h]=o,c=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new O$e(a.shape,l,h,s,i):new $$e(a.shape,l,h,s,i);return n.runWebGLProgram(c,[a],a.dtype)}var P$e={kernelName:Tp,backendName:"webgl",kernelFunc:F$e},L$e=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,i]=e,o=[n&&s>1?r-1:r,n&&i>1?a-1:a],l=[n&&s>1?s-1:s,n&&i>1?i-1:i],h=o[0]/l[0],c=o[1]/l[1],p=1/h,m=1/c,g=Math.ceil(p)*2+2,b=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${c});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float sourceFracRow =
              float(${o[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${o[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function z$e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,o=new L$e(s.shape,a.shape,i);return n.runWebGLProgram(o,[s],s.dtype)}var V$e={kernelName:Eg,backendName:"webgl",kernelFunc:z$e},U$e=class{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let r=i=>t.indexOf(i)!==-1&&e[i]!==1?`${e[i]} - coords[${i}] - 1`:`coords[${i}]`,a=e.map((i,o)=>r(o)).join(","),s=Tn(n);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}},B$e=class{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let r=Ua("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,i=Tn(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${o(r.slice())};
          if(${a}){
            result.g = ${l(r.slice())};
          }
          if(${s}) {
            result.b = ${h(r.slice())};
            if(${a}) {
              result.a = ${c(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function o(g){return p(g)}function l(g){return g[n-1]="("+g[n-1]+" + 1)",p(g)}function h(g){return g[n-2]="("+g[n-2]+" + 1)",p(g)}function c(g){return g[n-1]="("+g[n-1]+" + 1)",g[n-2]="("+g[n-2]+" + 1)",p(g)}function p(g){let b=e.map((_,I)=>m(I,g)),v=b.join(","),x=b.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${x}))`}function m(g,b){return t.indexOf(g)!==-1&&e[g]!==1?`${e[g]} - ${b[g]} - 1`:`${b[g]}`}}};function W$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,i=a.shape.length,o=$.parseAxisParam(s,a.shape);if(i===0)return Fs({inputs:{x:a},backend:n});let l=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B$e(a.shape,o):new U$e(a.shape,o);return n.runWebGLProgram(l,[a],a.dtype)}var j$e={kernelName:Np,backendName:"webgl",kernelFunc:W$e},H$e=class{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],r=e[2];this.outputShape=e;let a="";typeof t=="number"?a=`float outputValue = ${t.toFixed(2)};`:a=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}},G$e={kernelName:Wg,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:i}=t,o=n,l=new H$e(r.shape,s),[h,c]=B.getImageCenter(i,r.shape[1],r.shape[2]),p=[[h,c,Math.sin(a),Math.cos(a)]];return o.runWebGLProgram(l,[r],r.dtype,p)}},q$e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,K$e=Zt({opSnippet:q$e}),X$e={kernelName:Cp,backendName:"webgl",kernelFunc:K$e},Y$e="return inversesqrt(x);",Q$e=Zt({opSnippet:Y$e,cpuKernelImpl:lNe}),Z$e={kernelName:Ap,backendName:"webgl",kernelFunc:Q$e},xD=class{constructor(e,t,n,r,a,s,i=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=Tn(a.length),h=Tn(s.length),c="";n===1?c="i":n===2&&(c="i, j");let p=`getIndices(${c})`,m="";r===1?m="i":r===2&&(m="i, coords[1]");let g=`getUpdates(${m})`,b="";o&&(b="coords[0], coords[1]");let v=`getDefaultValue(${b})`,x=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}},J$e=class{constructor(e,t,n,r,a,s,i=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let l=Tn(a.length),h=Tn(s.length),c="";n===1?c="i":n===2&&(c="i, j");let p=`getIndices(${c})`,m="";r===1?m="i":r===2&&(m="i, coords[1]");let g=`getUpdates(${m})`,b="";o&&(b="coords[0], coords[1]");let v=`getDefaultValue(${b})`,x=t>1?"strides[j]":"strides",_=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${_};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}};function eOe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:i}=r,{sliceRank:o,numUpdates:l,sliceSize:h,strides:c,outputSize:p}=B.calculateShapes(s,a,i),m=[p/h,h];if(p===0)return n.makeTensorInfo(i,a.dtype);let g=je({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),b=je({inputs:{x:s},backend:n,attrs:{shape:[l,h]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),x;he().getBool("WEBGL_PACK")?x=new J$e(l,o,g.shape.length,b.shape.length,c,m):x=new xD(l,o,g.shape.length,b.shape.length,c,m);let _=n.runWebGLProgram(x,[b,g,v],b.dtype),I=je({inputs:{x:_},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(v),I}var tOe={kernelName:Cg,backendName:"webgl",kernelFunc:eOe},nOe=class{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let a="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=he().getNumber("WEBGL_VERSION")===2?a:s,o=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${i}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${o} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function rOe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r,o=new nOe(a.shape[0],a.shape[1],s.shape[1],i),l=[[a.shape[1]]];return n.runWebGLProgram(o,[a,s],"int32",l)}var aOe={kernelName:Rg,backendName:"webgl",kernelFunc:rOe},sOe=class{constructor(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;let r,a;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)a="resRC",r="resRC";else{let i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],l=[];for(let h=0;h<t.length;h++)l.push(`${i[h]}`),h<e&&o.push(`${i[h]}`);r=o.join(),a=l.join()}let s=Tn(n);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}};function iOe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,i=new sOe(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(i,[r,a,s],ti(a.dtype,s.dtype))}var oOe={kernelName:Dg,backendName:"webgl",kernelFunc:iOe},lOe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${B.SELU_SCALEALPHA};
  float scale = ${B.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,uOe=Zt({opSnippet:lOe}),cOe={kernelName:Rp,backendName:"webgl",kernelFunc:uOe},hOe=ly+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,dOe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pOe=Zt({opSnippet:hOe,packedOpSnippet:dOe,cpuKernelImpl:cNe}),fOe={kernelName:Op,backendName:"webgl",kernelFunc:pOe},mOe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,gOe=Zt({opSnippet:mOe}),yOe={kernelName:$p,backendName:"webgl",kernelFunc:gOe},bOe=ly+`
  return sin(x);
`,vOe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Jp}
  return result;
`,xOe=Zt({opSnippet:bOe,packedOpSnippet:vOe}),wOe={kernelName:Dp,backendName:"webgl",kernelFunc:xOe},_Oe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,SOe=Zt({opSnippet:_Oe}),IOe={kernelName:Mp,backendName:"webgl",kernelFunc:SOe},TOe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,kOe=Zt({opSnippet:TOe}),EOe={kernelName:Fp,backendName:"webgl",kernelFunc:kOe},NOe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r;$.assert(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let o=s.reduce((_,I)=>_*I),l=[[0,0]];l.push(...i);for(let _=1+s.length;_<a.shape.length;++_)l.push([0,0]);let h=[],c=FG({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),p=B.getReshaped(c.shape,s,o,!1),m=B.getPermuted(p.length,s.length,!1),g=B.getReshapedPermuted(c.shape,s,o,!1),b=je({inputs:{x:c},backend:n,attrs:{shape:p}}),v=Ha({inputs:{x:b},backend:n,attrs:{perm:m}}),x=je({inputs:{x:v},backend:n,attrs:{shape:g}});return h.push(c),h.push(b),h.push(v),h.forEach(_=>n.disposeIntermediateTensorInfo(_)),x},COe={kernelName:$g,backendName:"webgl",kernelFunc:NOe};function AOe(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${a.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let o=n.readSync(r.dataId),l=n.readSync(a.dataId),h=n.readSync(s.dataId),c=n.readSync(i.dataId)[0],[p,m,g,b,v]=dNe(o,r.shape,r.dtype,l,a.dtype,h,c);return[n.makeTensorInfo(m,r.dtype,p),n.makeTensorInfo([m[0]],a.dtype,g),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(x=>Number(x)))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}var ROe={kernelName:Uv,backendName:"webgl",kernelFunc:AOe};function DOe(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(n.readSync(a.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[h,c,p]=pNe(o,r.shape,r.dtype,i,l);return[n.makeTensorInfo(c,r.dtype,h),n.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var MOe={kernelName:Fg,backendName:"webgl",kernelFunc:DOe};function $Oe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(s.dataId),[h,c]=sG(i,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,h)}var OOe={kernelName:Bv,backendName:"webgl",kernelFunc:$Oe};function FOe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(s.dataId),[h,c]=sG(i,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,h)}var POe={kernelName:Wv,backendName:"webgl",kernelFunc:FOe};function LOe(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:h,sliceSize:c,strides:p,outputSize:m}=B.calculateShapes(s,a,o),g=!1;if(s.dtype==="string"){let _=n.bufferSync(a),I=n.bufferSync(s),k=$.decodeString(n.readSync(i.dataId)[0]),E=uNe(_,I,o,m,c,h,l,p,k,g);return n.makeTensorInfo(o,E.dtype,E.values)}let b=new xD(h,l,a.shape.length,s.shape.length,p,[m,1],g),v=n.runWebGLProgram(b,[s,a,i],s.dtype),x=je({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(v),x}var zOe={kernelName:Pg,backendName:"webgl",kernelFunc:LOe};function VOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=r,o=$.parseAxisParam(i,a.shape)[0],l=B.prepareSplitSize(a,s,o),h=a.shape.length,c=new Array(h).fill(0),p=a.shape.slice();return l.map(m=>{let g=[...p];g[o]=m;let b=uy({inputs:{x:a},backend:n,attrs:{begin:c,size:g}});return c[o]+=m,b})}var UOe={kernelName:Og,backendName:"webgl",kernelFunc:VOe},jL="return sqrt(x);",BOe=Zt({opSnippet:jL,packedOpSnippet:jL,cpuKernelImpl:fNe}),WOe={kernelName:Pp,backendName:"webgl",kernelFunc:BOe},jOe="return x * x;",HOe=Zt({opSnippet:jOe}),GOe={kernelName:jv,backendName:"webgl",kernelFunc:HOe},HL="return (a - b) * (a - b);",qOe=ga({opSnippet:HL,packedOpSnippet:HL}),KOe={kernelName:Vp,backendName:"webgl",kernelFunc:qOe};function XOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");let s=n.readSync(a.dataId),i=B.fromUint8ToStringArray(s),o=mNe(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}var YOe={kernelName:Hv,backendName:"webgl",kernelFunc:XOe};function QOe({inputs:e,attrs:t,backend:n}){let{x:r}=e,a=Ai+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new $o(r.shape,a);return n.runWebGLProgram(s,[r],r.dtype)}var ZOe={kernelName:Bc,backendName:"webgl",kernelFunc:QOe},JOe=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let r=n.length,a=Tn(n.length),s=Tn(n.length),i="";if(r===1)i="coords * strides + begin";else{let o=0;i=n.map((l,h)=>(o++,n.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${o-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${e});
      ${a} strides = ${a}(${t});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};function eFe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:i,strides:o,beginMask:l,endMask:h,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:m}=r,{finalShapeSparse:g,finalShape:b,isIdentity:v,sliceDim0:x,isSimpleSlice:_,begin:I,end:k,strides:E}=jr.sliceInfo(a.shape,s,i,o,l,h,c,p,m),R;if(v)R=je({inputs:{x:a},backend:n,attrs:{shape:b}});else if(x||_){$.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let D=jr.computeOutShape(I,k,E),C=uy({inputs:{x:a},backend:n,attrs:{begin:I,size:D}});R=je({inputs:{x:C},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(C)}else if(n.shouldExecuteOnCPU([a])){let D=n.readSync(a.dataId),C=At(a.shape,a.dtype,D),O=gNe(g,C,E,I);R=n.makeTensorInfo(b,a.dtype,O.values)}else{let D=new JOe(I,E,g);R=n.runWebGLProgram(D,[a],a.dtype)}let U=je({inputs:{x:R},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(R),U}var tFe={kernelName:Lg,backendName:"webgl",kernelFunc:eFe};function nFe(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:i,rightPad:o,padWidth:l,preserveShortSequences:h}=r,{data:c,dataSplits:p}=t,m=n.readSync(c.dataId),g=n.readSync(p.dataId),[b,v]=yNe(m,g,a,s,i,o,l,h);return[n.makeTensorInfo([b.length],"string",b),n.makeTensorInfo(p.shape,"int32",v)]}var rFe={kernelName:Gv,backendName:"webgl",kernelFunc:nFe};function aFe(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:i}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let o=n.readSync(s.dataId),l=n.readSync(i.dataId)[0],[h,c,p]=bNe(o,l,a),m=c.length;return[n.makeTensorInfo([m,2],"int32",h),n.makeTensorInfo([m],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(p))]}var sFe={kernelName:qv,backendName:"webgl",kernelFunc:aFe};function iFe(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let i=n.readSync(s.dataId),o=vNe(i,a);return n.makeTensorInfo(s.shape,"int32",o)}var oFe={kernelName:Kv,backendName:"webgl",kernelFunc:iFe},lFe="return tan(x);",uFe=Zt({opSnippet:lFe}),cFe={kernelName:Bp,backendName:"webgl",kernelFunc:uFe},hFe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,dFe=Zt({opSnippet:hFe}),pFe={kernelName:Wp,backendName:"webgl",kernelFunc:dFe};function fFe(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:s,updates:i}=t,{sliceRank:o,numUpdates:l,sliceSize:h,strides:c,outputSize:p}=B.calculateShapes(i,s,a.shape),m=[p/h,h];if(p===0)return n.makeTensorInfo(a.shape,s.dtype);let g=je({inputs:{x:s},backend:n,attrs:{shape:[l,o]}}),b=je({inputs:{x:i},backend:n,attrs:{shape:[l,h]}}),v=je({inputs:{x:a},backend:n,attrs:{shape:m}}),x=new xD(l,o,g.shape.length,b.shape.length,c,m,!1,!0),_=n.runWebGLProgram(x,[b,g,v],v.dtype),I=je({inputs:{x:_},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(_),I}var mFe={kernelName:Ag,backendName:"webgl",kernelFunc:fFe},gFe=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s]*t[s];this.outputShape=n,this.rank=n.length;let r=Tn(this.rank),a=yFe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}};function yFe(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push(`imod(${n[a]}, ${e[a]})`);return r.join()}function LG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;if(a.dtype==="string"||a.shape.length>5){let o=n.readSync(a.dataId),l=a.dtype==="string"?o.map(p=>$.decodeString(p)):o,h=At(a.shape,a.dtype,l),c=wNe(h,s);return n.makeTensorInfo(c.shape,c.dtype,c.values)}let i=new gFe(a.shape,s);return n.runWebGLProgram(i,[a],a.dtype)}var bFe={kernelName:Uc,backendName:"webgl",kernelFunc:LG},vFe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},xFe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function kh(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function GL(e){let t=1;for(;t<e;)t*=2;return t}function wFe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:i}=r,o=he().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=he().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=a.shape,c=h[h.length-1];if(n.shouldExecuteOnCPU([a])||c<o||s>l){let O=n.readSync(a.dataId),[z,M]=_Ne(O,h,a.dtype,s,i);return[n.makeTensorInfo(z.shape,z.dtype,z.values),n.makeTensorInfo(M.shape,M.dtype,M.values)]}if(s===0)return h[h.length-1]=0,[n.makeTensorInfo(h,a.dtype,[]),n.makeTensorInfo(h,"int32",[])];if(c===1)return[a,Cx({attrs:{shape:h,dtype:"int32",value:0},backend:n})];let p=n.texData.get(a.dataId),m=p!==null&&p.isPacked,g=m?n.unpackTensor(a):a,b=$.sizeFromShape(h)/c,v=je({inputs:{x:g},attrs:{shape:[b,c]},backend:n});m&&kh(n,g);let x=GL(s),_=GL(c),I=null,k=()=>I===null?[v,v]:[v,I],E=(O,z,M)=>{let N=k(),P=new vFe(M),Q=[[c],[I===null?1:0],[Number.NEGATIVE_INFINITY],[O],[z]],ee=I;I=n.runWebGLProgram(P,N,"int32",Q),kh(n,ee)};for(let O=1;O<x;O*=2){let z=O*2;for(let M=O;M>=1;M/=2)E(z,M,[b,_])}for(let O=_;O>x;O/=2){let z=k(),M=new xFe([b,O/2]),N=[[c],[I===null?1:0],[x]],P=I;I=n.runWebGLProgram(M,z,"int32",N),kh(n,P);let Q=x/2,ee=Q*2;for(let q=Q;q>=1;q/=2)E(ee,q,I.shape)}let R=I;I=uy({inputs:{x:I},backend:n,attrs:{begin:0,size:[b,s]}}),kh(n,R);let U=AG({inputs:{x:v,indices:I},backend:n,attrs:{axis:1,batchDims:1}});kh(n,v);let D=h.slice(0,-1);D.push(s),R=I,I=je({inputs:{x:I},attrs:{shape:D},backend:n}),kh(n,R);let C=U;return U=je({inputs:{x:U},attrs:{shape:D},backend:n}),kh(n,C),[U,I]}var _Fe={kernelName:zg,backendName:"webgl",kernelFunc:wFe},SFe=class{constructor(e,t,n,r,a,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let i=n==="nearest"?1:2,o;switch(r){case"constant":o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4;break;default:o=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${o} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${o} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${o} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${i} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function IFe(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:s}=t,{interpolation:i,fillMode:o,fillValue:l,outputShape:h}=r,[c,p,m,g]=a.shape,[b,v]=h??[p,m],x=[c,b,v,g],_=new SFe(p,m,i,o,l,x);return n.runWebGLProgram(_,[a,s],"float32")}var TFe={kernelName:Vg,backendName:"webgl",kernelFunc:IFe};function kFe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;ny(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=r.readSync(s.dataId),{outputValues:o,outputShape:l,indices:h}=SNe(i,a,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,o),r.makeTensorInfo([h.length],"int32",h)]}var EFe={kernelName:Xv,backendName:"webgl",kernelFunc:kFe};function NFe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a,o=i.shape.length,l=a.shape[s],h=new Array(o-1),c=0;for(let v=0;v<o;v++)v!==s&&(h[c++]=i.shape[v]);let p=[],m=new Array(o).fill(0),g=i.shape.slice();g[s]=1;let b=new Array(l);for(let v=0;v<b.length;v++){m[s]=v;let x=uy({inputs:{x:i},backend:n,attrs:{begin:m,size:g}}),_=je({inputs:{x},backend:n,attrs:{shape:h}});b[v]=_,p.push(x)}return p.forEach(v=>n.disposeIntermediateTensorInfo(v)),b}var CFe={kernelName:Ug,backendName:"webgl",kernelFunc:NFe},AFe=class{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,r=e.batchSize,a=e.inSize,s=e.numSegments,i=s*Math.ceil(a/n);this.outputShape=[r,i];let o="0.0",l="sumValue",h=Math.floor(n/4)*4,c=n%4,p=`
        sumValue += dot(values, segFilter);
    `,m="";a%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let g="";a%n>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${o};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${c===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${l});
      }
    `}};function RFe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:i}=r,o=a.shape.length,l=[],h=0,c=B.getAxesPermutation([h],o),p=a;c!=null&&(p=Ha({inputs:{x:a},backend:n,attrs:{perm:c}}),l.push(p),h=B.getInnerMostAxes(1,o)[0]);let m=B.segment_util.computeOutShape(p.shape,h,i),g=$.sizeFromShape([p.shape[h]]),b=je({inputs:{x:p},backend:n,attrs:{shape:[-1,g]}});l.push(b);let v=O1(a.dtype),x=(E,R,U,D,C)=>{let O=E.shape[0],z=E.shape[1],M=B.segment_util.segOpComputeOptimalWindowSize(z,C),N={windowSize:M,inSize:z,batchSize:O,numSegments:C},P=new AFe(N,R),Q=n.compileAndRun(P,[E,U],D);if(l.push(Q),Q.shape[1]===C)return Q;let ee=PG({backend:n,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),q=LG({inputs:{x:ee},backend:n,attrs:{reps:[z/M]}});return l.push(ee),l.push(q),x(Q,R,q,D,C)},_=x(b,"unsortedSegmentSum",s,v,i),I=je({inputs:{x:_},backend:n,attrs:{shape:m}}),k=I;if(c!=null){l.push(I);let E=B.getUndoAxesPermutation(c);k=Ha({inputs:{x:k},backend:n,attrs:{perm:E}})}return l.forEach(E=>n.disposeIntermediateTensorInfo(E)),k}var DFe={kernelName:Yv,backendName:"webgl",kernelFunc:RFe},MFe=[g2e,b2e,w2e,I2e,k2e,C2e,R2e,M2e,P2e,z2e,B2e,H2e,K2e,Z2e,tCe,rCe,sCe,uCe,hCe,pCe,yCe,ICe,kCe,ACe,DCe,LCe,VCe,jCe,JNe,qCe,ZCe,nAe,lAe,hAe,pAe,mAe,yAe,wAe,IAe,EAe,CAe,RAe,MAe,FAe,LAe,BAe,jAe,qAe,YAe,ZAe,nRe,iRe,cRe,pRe,gRe,yRe,vRe,wRe,SRe,TRe,ERe,RRe,$Re,PRe,zRe,BRe,HRe,XRe,JRe,ZNe,tDe,YCe,aDe,oDe,cDe,t2e,fDe,bDe,xDe,IDe,EDe,RDe,$De,LDe,BDe,HDe,qDe,QDe,JDe,tMe,sMe,oMe,uMe,hMe,pMe,yMe,wMe,TMe,MMe,a2e,PMe,VMe,WMe,GMe,$Ce,XMe,QMe,JMe,n$e,i$e,r2e,l$e,c$e,d$e,f$e,m$e,OCe,CMe,b$e,_$e,k$e,i2e,A$e,M$e,P$e,V$e,j$e,G$e,X$e,Z$e,tOe,aOe,oOe,cOe,fOe,yOe,wOe,IOe,_Ce,RMe,EOe,COe,ROe,MOe,OOe,POe,zOe,UOe,WOe,GOe,KOe,YOe,ZOe,tFe,rFe,sFe,oFe,AMe,p2e,cFe,pFe,mFe,bFe,_Fe,TFe,f2e,EFe,CFe,DFe,YMe];for(let e of MFe)Qv(e);var tn;(function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"})(tn||(tn={}));var hv;(function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"})(hv||(hv={}));var zG;function $Fe(e){zG=e.wasm.cwrap(td,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])}function OFe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:o}=t;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");let{transposeA:l,transposeB:h,activation:c,leakyreluAlpha:p}=r,m=n.dataIdMap.get(a.dataId).id,g=n.dataIdMap.get(s.dataId).id,b=0;if(i!=null){let C=n.dataIdMap.get(i.dataId);if(C.shape.length!==1)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${C.shape.length}.`);b=C.id}let v=o==null?0:n.dataIdMap.get(o.dataId).id,x=hv[c];if(x==null)throw new Error(`${c} activation not yet supported for FusedConv2D in the wasm backend.`);let _=l?a.shape[2]:a.shape[1],I=h?s.shape[1]:s.shape[2],k=jg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)),E=n.makeOutput([...k,_,I],a.dtype),R=n.dataIdMap.get(E.dataId).id,U=new Uint8Array(new Int32Array(a.shape).buffer),D=new Uint8Array(new Int32Array(s.shape).buffer);return zG(m,U,a.shape.length,g,D,s.shape.length,l,h,x,b,v,p||0,R),E}var FFe={kernelName:td,backendName:"wasm",setupFunc:$Fe,kernelFunc:OFe};function Kt(e,t){let n;function r(s){n=s.wasm.cwrap(e,null,["number","number","number"])}function a(s){let{backend:i,inputs:{x:o}}=s,l=i.dataIdMap.get(o.dataId).id,h=i.makeOutput(o.shape,t||o.dtype),c=i.dataIdMap.get(h.dataId).id;return $.sizeFromShape(h.shape)===0||n(l,tn[o.dtype],c),h}return{kernelName:e,backendName:"wasm",setupFunc:r,kernelFunc:a}}var PFe=Kt(Bm),LFe=Kt(kd),zFe=Kt(Ed);function Rr(e,t,n){let r;function a(i){r=i.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])}function s(i){let{backend:o,inputs:l}=i,{a:h,b:c}=l,p=o.dataIdMap.get(h.dataId).id,m=o.dataIdMap.get(c.dataId).id,g=n??h.dtype,b=B.assertAndGetBroadcastShape(h.shape,c.shape),v=o.makeOutput(b,g);if($.sizeFromShape(b)===0)return v;let x=new Uint8Array(new Int32Array(h.shape).buffer),_=new Uint8Array(new Int32Array(c.shape).buffer),I=o.dataIdMap.get(v.dataId).id;return r(p,x,h.shape.length,m,_,c.shape.length,tn[h.dtype],I),v}return{kernelName:e,backendName:"wasm",setupFunc:a,kernelFunc:s}}var VFe=Rr(zc),VG;function UFe(e){VG=e.wasm.cwrap(Nd,null,["array","number","number","number"])}function BFe(e){let{inputs:t,backend:n}=e,r=n.makeOutput(t[0].shape,t[0].dtype);if($.sizeFromShape(r.shape)===0)return r;let a=t.map(o=>n.dataIdMap.get(o.dataId).id),s=new Uint8Array(new Int32Array(a).buffer),i=n.dataIdMap.get(r.dataId).id;return VG(s,a.length,tn[r.dtype],i),r}var WFe={kernelName:Nd,backendName:"wasm",setupFunc:UFe,kernelFunc:BFe};function jS(e){let{inputs:{x:t},backend:n}=e;if(t.dtype==="string")return Ba(n.readSync(t.dataId),t.shape,t.dtype);let r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var jFe={kernelName:tp,backendName:"wasm",kernelFunc:jS},UG;function HFe(e){UG=e.wasm.cwrap(Vl,null,["number","array","number","number","number","array","number"])}function Cc(e){let{inputs:t,backend:n,attrs:r}=e,[a,s]=qFe(t.x.shape,r.perm),i=!0;for(let b=0;b<s.length;b++)s[b]!==b&&(i=!1);let o=GFe(t.x.shape,r.perm),l={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(i){let b=jS({inputs:t,backend:n});return b.shape=o,b}let h=n.makeOutput(o,l.dtype),c=n.dataIdMap.get(l.dataId).id,p=n.dataIdMap.get(h.dataId).id,m=new Uint8Array(new Int32Array(s).buffer),g=new Uint8Array(new Int32Array(l.shape).buffer);return UG(c,g,l.shape.length,tn[l.dtype],p,m,s.length),h}function GFe(e,t){let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}function qFe(e,t){let n=[],r=[];for(let a=0;a<e.length;++a)e[a]!==1&&n.push(e[a]),e[t[a]]!==1&&r.push(t[a]);for(let a=0;a<r.length;++a){let s=-1;for(let i=0;i<r.length;++i)r[i]>=a&&(s===-1||r[s]>r[i])&&(s=i);r[s]=a}return[n,r]}var KFe={kernelName:Vl,backendName:"wasm",kernelFunc:Cc,setupFunc:HFe};function Yc(e,t,n){let r=e.shape,a=e.shape.length,s=$.parseAxisParam(t,r),i=s,o=B.getAxesPermutation(i,a),l=null,h=!1;if(o!=null){let c=new Array(a);for(let m=0;m<c.length;m++)c[m]=r[o[m]];i=B.getInnerMostAxes(i.length,a),l=Cc({inputs:{x:e},attrs:{perm:o},backend:n});let p=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(l.dataId).id!==p&&(h=!0)}return{transposed:l,originalAxes:s,axes:i,inputWasTransposed:h}}var BG;function XFe(e){BG=e.wasm.cwrap(Wm,null,["number, number, number"])}function YFe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=i,{transposed:h,axes:c,originalAxes:p,inputWasTransposed:m}=Yc(i,a,t);if(m){let I=t.dataIdMap.get(h.dataId).id;l=h,o=I}let g=l.shape.length;B.assertAxesAreInnerMostDims("all",c,g);let[b,v]=B.computeOutAndReduceShapes(l.shape,c),x=$.sizeFromShape(v),_=t.makeOutput(b,i.dtype);if($.sizeFromShape(l.shape)!==0){let I=t.dataIdMap.get(_.dataId).id;BG(o,x,I)}if(m&&t.disposeData(h.dataId),s){let I=B.expandShapeToKeepDim(_.shape,p);_.shape=I}return _}var QFe={kernelName:Wm,backendName:"wasm",setupFunc:XFe,kernelFunc:YFe},WG;function ZFe(e){WG=e.wasm.cwrap(jm,null,["number, number, number"])}function JFe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=i,{transposed:h,axes:c,originalAxes:p,inputWasTransposed:m}=Yc(i,a,t);if(m){let I=t.dataIdMap.get(h.dataId).id;l=h,o=I}let g=l.shape.length;B.assertAxesAreInnerMostDims("any",c,g);let[b,v]=B.computeOutAndReduceShapes(l.shape,c),x=$.sizeFromShape(v),_=t.makeOutput(b,i.dtype);if($.sizeFromShape(l.shape)!==0){let I=t.dataIdMap.get(_.dataId).id;WG(o,x,I)}if(m&&t.disposeData(h.dataId),s){let I=B.expandShapeToKeepDim(_.shape,p);_.shape=I}return _}var e3e={kernelName:jm,backendName:"wasm",setupFunc:ZFe,kernelFunc:JFe};function jG(e){let t;function n(a){t=a.wasm.cwrap(e,null,["number","number","number","number","number"])}function r(a){let{backend:s,inputs:i,attrs:o}=a,{axis:l}=o,{x:h}=i,c=s.dataIdMap.get(h.dataId).id,p=c,m=h,{transposed:g,axes:b,inputWasTransposed:v}=Yc(h,l,s);if(v){let R=s.dataIdMap.get(g.dataId).id;R!==c&&(m=g,p=R)}let x=m.shape.slice(0,-1),_=s.makeOutput(x,"int32"),I=s.dataIdMap.get(_.dataId).id,k=$.sizeFromShape(_.shape),E=m.shape[b[0]];return t(p,tn[m.dtype],k,E,I),v&&s.disposeData(g.dataId),_}return{kernelName:e,backendName:"wasm",setupFunc:n,kernelFunc:r}}var t3e=jG(Hm),n3e=jG(Gm),r3e=Kt(Cd),a3e=Kt(Ad),s3e=Kt(Rd),i3e=Rr(Md),o3e=Kt(Dd),HG;function l3e(e){HG=e.wasm.cwrap($d,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function u3e(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=n,c=B.computePool2DInfo(a.shape,i,o,1,l,h),p=c.filterHeight,m=c.filterWidth,g=c.padInfo.top,b=c.padInfo.right,v=c.padInfo.bottom,x=c.padInfo.left,_=c.strideHeight,I=c.strideWidth,k=c.inChannels;if(c.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${c.dataFormat}'. Please use 'channelsLast'.`);if(c.dilationWidth!==1||c.dilationHeight!==1)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${c.dilationHeight}, ${c.dilationWidth}].`);let E=r.makeOutput(c.outShape,"float32"),R=r.dataIdMap.get(E.dataId).id;return HG(s,a.shape[0],a.shape[1],a.shape[2],p,m,g,b,v,x,_,I,k,R),E}var c3e={kernelName:$d,backendName:"wasm",setupFunc:l3e,kernelFunc:u3e},GG;function h3e(e){GG=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function d3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l,dataFormat:h}=r,c=B.computePool3DInfo(a.shape,s,i,1,o,l,h),p=n.makeOutput(c.outShape,a.dtype);return GG(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),p}var p3e={kernelName:qm,backendName:"wasm",setupFunc:h3e,kernelFunc:d3e},qG;function f3e(e){qG=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function m3e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=r,c=B.computePool3DInfo(s.shape,i,o,1,l,h),p=n.makeOutput(s.shape,s.dtype);return qG(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left,c.filterDepth,c.filterHeight,c.filterWidth),p}var g3e={kernelName:Rv,backendName:"wasm",setupFunc:f3e,kernelFunc:m3e},KG;function y3e(e){KG=e.wasm.cwrap("AvgPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function b3e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l}=r,h=B.computePool2DInfo(s.shape,i,o,1,l),c=n.makeOutput(s.shape,s.dtype);return KG(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,h.batchSize,h.inChannels,h.inHeight,h.inWidth,h.outHeight,h.outWidth,h.strideHeight,h.strideWidth,h.dilationHeight,h.dilationWidth,h.effectiveFilterHeight,h.effectiveFilterWidth,h.padInfo.top,h.padInfo.left,h.filterHeight,h.filterWidth),c}var v3e={kernelName:Av,backendName:"wasm",setupFunc:y3e,kernelFunc:b3e};function os(e){let{inputs:t,attrs:n}=e,{x:r}=t,{shape:a}=n,s=$.sizeFromShape(r.shape),i=$.inferFromImplicitShape(a,s);return $.assert(s===$.sizeFromShape(i),()=>`new shape: ${i}, old shape: ${r.shape}. New shape and old shape must have the same number of elements.`),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:i,dtype:r.dtype}}var x3e={kernelName:kg,backendName:"wasm",kernelFunc:os},XG;function w3e(e){XG=e.wasm.cwrap(Od,null,["number","array","number","number","array","number","number","number","number"])}function _3e(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:o}=r;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");let l=a.shape.length,h=s.shape.length,c=i?a.shape[l-2]:a.shape[l-1],p=o?s.shape[h-1]:s.shape[h-2],m=i?a.shape[l-1]:a.shape[l-2],g=o?s.shape[h-2]:s.shape[h-1],b=a.shape.slice(0,-2),v=s.shape.slice(0,-2),x=$.sizeFromShape(b),_=$.sizeFromShape(v),I=jg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([m,g]);$.assert(c===p,()=>`Error in matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${i} and transposeB=${o} must match.`);let k=i?[x,c,m]:[x,m,c],E=o?[_,g,p]:[_,p,g],R=os({inputs:{x:a},backend:n,attrs:{shape:k}}),U=os({inputs:{x:s},backend:n,attrs:{shape:E}}),D=n.dataIdMap.get(R.dataId).id,C=n.dataIdMap.get(U.dataId).id,O=i?R.shape[2]:R.shape[1],z=o?U.shape[1]:U.shape[2],M=Math.max(x,_),N=n.makeOutput([M,O,z],R.dtype),P=n.dataIdMap.get(N.dataId).id,Q=new Uint8Array(new Int32Array(R.shape).buffer),ee=new Uint8Array(new Int32Array(U.shape).buffer);return XG(D,Q,R.shape.length,C,ee,U.shape.length,i,o,P),n.disposeData(R.dataId),n.disposeData(U.dataId),N.shape=I,N}var S3e={kernelName:Od,backendName:"wasm",setupFunc:w3e,kernelFunc:_3e};function vd(e){let{inputs:{x:t},attrs:{begin:n,size:r},backend:a}=e,[s,i]=jr.parseSliceParams(t,n,r),o=jr.isSliceContinous(t.shape,s,i),l=a.readSync(t.dataId),h=a.makeOutput(i,t.dtype),c=$.computeStrides(t.shape),p=a.dataIdMap.get(h.dataId);if(o){let b=jr.computeFlatOffset(s,c);return t.dtype==="string"?p.stringBytes=l.slice(b,b+$.sizeFromShape(i)):a.typedArrayFromHeap(h).set(l.subarray(b,b+$.sizeFromShape(i))),h}if(t.dtype==="string"){let b=C_(l,s,i,t.shape,t.dtype);return p.stringBytes=b,h}let m=a.typedArrayFromHeap(h),g=t.shape.length;if(g===2)I3e(l,c[0],m,s,i);else if(g===3)T3e(l,c[0],c[1],m,s,i);else if(g===4)k3e(l,c[0],c[1],c[2],m,s,i);else{let b=C_(l,s,i,t.shape,t.dtype);m.set(b)}return h}function I3e(e,t,n,r,a){let s=0,i=r[0],o=r[1],l=i+a[0];for(let h=i;h<l;h++){let c=h*t+o;n.set(e.subarray(c,c+a[1]),s),s+=a[1]}}function T3e(e,t,n,r,a,s){let i=0,o=a[0],l=a[1],h=a[2],c=o+s[0],p=l+s[1];for(let m=o;m<c;m++)for(let g=l;g<p;g++){let b=m*t+g*n+h;r.set(e.subarray(b,b+s[2]),i),i+=s[2]}}function k3e(e,t,n,r,a,s,i){let o=0,l=s[0],h=s[1],c=s[2],p=l+i[0],m=h+i[1],g=c+i[2],b=s[3];for(let v=l;v<p;v++)for(let x=h;x<m;x++)for(let _=c;_<g;_++){let I=v*t+x*n+_*r+b;a.set(e.subarray(I,I+i[3]),o),o+=i[3]}}var E3e={kernelName:Mg,backendName:"wasm",kernelFunc:vd};function N3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r,o=s.reduce((_,I)=>_*I),l=B.getReshaped(a.shape,s,o),h=B.getPermuted(l.length,s.length),c=B.getReshapedPermuted(a.shape,s,o),p=B.getSliceBeginCoords(i,s.length),m=B.getSliceSize(c,i,s.length),g=os({inputs:{x:a},backend:n,attrs:{shape:l}}),b=Cc({inputs:{x:g},backend:n,attrs:{perm:h}}),v=os({inputs:{x:b},backend:n,attrs:{shape:c}}),x=vd({inputs:{x:v},backend:n,attrs:{begin:p,size:m}});return n.disposeData(g.dataId),n.disposeData(b.dataId),n.disposeData(v.dataId),x}var C3e={kernelName:Km,backendName:"wasm",kernelFunc:N3e},YG;function A3e(e){YG=e.wasm.cwrap(Xm,null,["number","number","boolean","number","number","number"])}function R3e(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:i}=r,o=s.shape.reduce((p,m)=>p*m,1)!==0,l=a.shape.length===1?[i]:[a.shape[0],i],h=t.makeOutput(l,s.dtype);function c(p){return t.dataIdMap.get(p.dataId).id}return YG(c(a),i,o,c(s),tn[s.dtype],c(h)),h}var D3e={kernelName:Xm,backendName:"wasm",setupFunc:A3e,kernelFunc:R3e},M3e=Rr(Ym);function $3e(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.typedArrayFromHeap(r),i=n.typedArrayFromHeap(a),o=B.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeOutput([o.length],"int32",void 0,new Int32Array(o))}var O3e={kernelName:Dv,backendName:"wasm",kernelFunc:$3e};function Qc(e){let{inputs:{x:t},attrs:{dtype:n},backend:r}=e,a=r.makeOutput(t.shape,n),s=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(s),a}var F3e={kernelName:Fd,backendName:"wasm",kernelFunc:Qc},P3e=Kt(Pd),QG;function L3e(e){QG=e.wasm.cwrap(Vc,null,["number","number","number","number"])}function z3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:i}=r,o=n.dataIdMap.get(a.dataId).id,l=n.makeOutput(a.shape,a.dtype),h=n.dataIdMap.get(l.dataId).id;return QG(o,s,i,h),l}var V3e={kernelName:Vc,backendName:"wasm",setupFunc:L3e,kernelFunc:z3e};function ZG(e){let{inputs:t,backend:n}=e,r=$.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map(g=>g.shape);B.assertParamsConsistent(a,r);let s=B.computeOutShape(t.map(g=>g.shape),r),i=t.filter(g=>$.sizeFromShape(g.shape)>0);if(i.length===1)return jS({inputs:{x:i[0]},backend:n});let o=n.makeOutput(s,t[0].dtype);if($.sizeFromShape(s)===0)return o;if(i[0].dtype==="string"){let g=i.map(k=>{let E=[-1,$.sizeFromShape(k.shape.slice(r))];return os({inputs:{x:k},backend:n,attrs:{shape:E}})}),b=g.map(k=>({vals:n.readSync(k.dataId),shape:k.shape}));s=B.computeOutShape(g.map(k=>k.shape),1);let v=g[0].shape[0]===1,x=GR(b,s,t[0].dtype,v),_=B.computeOutShape(i.map(k=>k.shape),r);o.shape=_;let I=n.dataIdMap.get(o.dataId);return I.stringBytes=B.fromStringArrayToUint8(x),g.forEach(k=>n.disposeData(k.dataId)),o}let l=$.sizeFromShape(i[0].shape.slice(0,r)),h=0,c=i.map(g=>{let b=$.sizeFromShape(g.shape.slice(r));return h+=b,b}),p=i.map(g=>n.typedArrayFromHeap(g)),m=n.typedArrayFromHeap(o);for(let g=0;g<l;g++){let b=g*h;for(let v=0;v<p.length;v++){let x=c[v],_=g*x,I=p[v].subarray(_,_+x);m.set(I,b),b+=x}}return o}var U3e={kernelName:Qm,backendName:"wasm",kernelFunc:ZG},JG;function B3e(e){JG=e.wasm.cwrap(Ld,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function W3e(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,i=r.dataIdMap.get(a.dataId).id,o=r.dataIdMap.get(s.dataId).id,{strides:l,dilations:h,pad:c,dimRoundingMode:p,dataFormat:m}=n,g=B.convertConv2DDataFormat(m),b=B.computeConv2DInfo(a.shape,s.shape,l,h,c,p,!1,g),v=b.filterHeight,x=b.filterWidth,_=b.padInfo.top,I=b.padInfo.right,k=b.padInfo.bottom,E=b.padInfo.left,R=b.dilationHeight,U=b.dilationWidth,D=b.strideHeight,C=b.strideWidth,O=b.inChannels,z=b.outChannels,M=b.padInfo.type==="SAME"?1:0;if(b.dataFormat!=="channelsLast")throw new Error(`wasm backend Conv2D does not support dataFormat:'${b.dataFormat}'. Please use 'channelsLast'.`);let N=r.makeOutput(b.outShape,"float32"),P=r.dataIdMap.get(N.dataId).id;return JG(i,a.shape[0],a.shape[1],a.shape[2],o,v,x,_,I,k,E,M,R,U,D,C,O,z,P),N}var j3e={kernelName:Ld,backendName:"wasm",setupFunc:B3e,kernelFunc:W3e},eq;function H3e(e){eq=e.wasm.cwrap(zd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function G3e(e){let{backend:t,inputs:n,attrs:r}=e,{dy:a,filter:s}=n,{strides:i,pad:o,dataFormat:l,dimRoundingMode:h,inputShape:c}=r,p=1,m=B.convertConv2DDataFormat(l),g=B.computeConv2DInfo(c,s.shape,i,p,o,h,!1,m),{batchSize:b,filterHeight:v,filterWidth:x,inChannels:_,inHeight:I,inWidth:k,outChannels:E,outHeight:R,outWidth:U,strideHeight:D,strideWidth:C}=g,O=v-1-g.padInfo.top,z=x-1-g.padInfo.left,M=g.dataFormat==="channelsLast",N=$.computeStrides(g.inShape),P=$.computeStrides(a.shape),[Q,ee,q]=$.computeStrides(s.shape),Z=N[0],ne=M?N[1]:N[2],me=M?N[2]:1,xe=M?1:N[1],H=P[0],se=M?P[1]:P[2],ue=M?P[2]:1,ge=M?1:P[1],Ee=t.makeOutput(g.inShape,"float32"),$e=t.dataIdMap.get(Ee.dataId).id,Oe=t.dataIdMap.get(a.dataId).id,Fe=t.dataIdMap.get(s.dataId).id;return eq(Oe,Fe,b,v,x,I,k,_,R,U,E,D,C,O,z,Q,ee,q,Z,ne,me,xe,H,se,ue,ge,$e),Ee}var q3e={kernelName:zd,backendName:"wasm",setupFunc:H3e,kernelFunc:G3e},tq;function K3e(e){tq=e.wasm.cwrap(Vd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function X3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l}=r;if(a.dtype!=="float32")throw new Error(`Tensor x must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let h=B.computeConv3DInfo(a.shape,s.shape,i,l,o),c=n.makeOutput(h.outShape,a.dtype);return tq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,h.batchSize,h.inDepth,h.inHeight,h.inWidth,h.inChannels,h.outDepth,h.outHeight,h.outWidth,h.outChannels,h.strideDepth,h.strideHeight,h.strideWidth,h.dilationDepth,h.dilationHeight,h.dilationWidth,h.filterDepth,h.filterHeight,h.filterWidth,h.padInfo.front,h.padInfo.top,h.padInfo.left),c}var Y3e={kernelName:Vd,backendName:"wasm",setupFunc:K3e,kernelFunc:X3e},nq;function Q3e(e){nq=e.wasm.cwrap(Zm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function Z3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:o,filterShape:l}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let h=B.computeConv3DInfo(a.shape,l,i,1,o),c=n.makeOutput(h.filterShape,s.dtype);return nq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,h.batchSize,h.inDepth,h.inHeight,h.inWidth,h.inChannels,h.outDepth,h.outHeight,h.outWidth,h.outChannels,h.strideDepth,h.strideHeight,h.strideWidth,h.dilationDepth,h.dilationHeight,h.dilationWidth,h.filterDepth,h.filterHeight,h.filterWidth,h.padInfo.front,h.padInfo.top,h.padInfo.left),c}var J3e={kernelName:Zm,backendName:"wasm",setupFunc:Q3e,kernelFunc:Z3e},rq;function ePe(e){rq=e.wasm.cwrap(Jm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function tPe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:o,inputShape:l}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let h=B.computeConv3DInfo(l,s.shape,o,1,i),c=n.makeOutput(h.inShape,a.dtype);return rq(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,h.batchSize,h.inDepth,h.inHeight,h.inWidth,h.inChannels,h.outDepth,h.outHeight,h.outWidth,h.outChannels,h.strideDepth,h.strideHeight,h.strideWidth,h.dilationDepth,h.dilationHeight,h.dilationWidth,h.filterDepth,h.filterHeight,h.filterWidth,h.padInfo.front,h.padInfo.top,h.padInfo.left),c}var nPe={kernelName:Jm,backendName:"wasm",setupFunc:ePe,kernelFunc:tPe},rPe=Kt(Ud),aPe=Kt(Bd),iN;(function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"})(iN||(iN={}));var aq;function sPe(e){aq=e.wasm.cwrap(tg,null,["number","number","number","number","array","number","number","number","number","number"])}function iPe(e){let{backend:t,inputs:n,attrs:r}=e,{method:a,extrapolationValue:s,cropSize:i}=r,{image:o,boxes:l,boxInd:h}=n,c=l.shape[0],[p,m]=i,g=[c,p,m,o.shape[3]],b=t.dataIdMap.get(o.dataId),v;o.dtype!=="float32"&&(v=Qc({backend:t,inputs:{x:o},attrs:{dtype:"float32"}}),b=t.dataIdMap.get(v.dataId));let x=b.id,_=t.dataIdMap.get(l.dataId).id,I=t.dataIdMap.get(h.dataId).id,k=t.makeOutput(g,"float32"),E=t.dataIdMap.get(k.dataId).id,R=new Uint8Array(new Int32Array(o.shape).buffer);return aq(x,_,I,c,R,p,m,iN[a],s,E),v!=null&&t.disposeData(v.dataId),k}var oPe={kernelName:tg,backendName:"wasm",setupFunc:sPe,kernelFunc:iPe},sq;function lPe(e){sq=e.wasm.cwrap(eg,null,["number","number","number","number","number","number"])}function uPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r,l=a.shape.length;$.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumprod does not support ${a.dtype} tensors in the WASM backend`);let h=B.getAxesPermutation([s],l),c=a;h!==null&&(c=Cc({inputs:{x:a},attrs:{perm:h},backend:n}));let p=B.getInnerMostAxes(1,l)[0];B.assertAxesAreInnerMostDims("cumprod",[p],l);let m=n.makeOutput(c.shape,c.dtype),g=c.shape[p],b=n.dataIdMap.get(c.dataId).id,v=n.dataIdMap.get(m.dataId).id;sq(b,i?1:0,o?1:0,g,v,tn[a.dtype]);let x=m;if(h!==null){let _=B.getUndoAxesPermutation(h);x=Cc({inputs:{x:m},attrs:{perm:_},backend:n}),n.disposeData(c.dataId),n.disposeData(m.dataId)}return x}var cPe={kernelName:eg,backendName:"wasm",setupFunc:lPe,kernelFunc:uPe},iq;function hPe(e){iq=e.wasm.cwrap(Wd,null,["number","number","number","number","number","number"])}function dPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:o}=r,l=a.shape.length;$.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumsum does not support ${a.dtype} tensors in the WASM backend`);let h=B.getAxesPermutation([s],l),c=a;h!==null&&(c=Cc({inputs:{x:a},attrs:{perm:h},backend:n}));let p=B.getInnerMostAxes(1,l)[0];B.assertAxesAreInnerMostDims("cumsum",[p],l);let m=n.makeOutput(c.shape,c.dtype),g=c.shape[p],b=n.dataIdMap.get(c.dataId).id,v=n.dataIdMap.get(m.dataId).id;iq(b,i?1:0,o?1:0,g,v,tn[a.dtype]);let x=m;if(h!==null){let _=B.getUndoAxesPermutation(h);x=Cc({inputs:{x:m},attrs:{perm:_},backend:n}),n.disposeData(c.dataId),n.disposeData(m.dataId)}return x}var pPe={kernelName:Wd,backendName:"wasm",setupFunc:hPe,kernelFunc:dPe},oq;function fPe(e){oq=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])}function mPe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:i,binaryOutput:o}=r,l=s.shape.reduce((m,g)=>m*g,1)!==0,h=a.shape.length===1?[i]:[a.shape[0],i],c=t.makeOutput(h,s.dtype);function p(m){return t.dataIdMap.get(m.dataId).id}return oq(p(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,i,l,p(s),tn[s.dtype],o,p(c)),c}var gPe={kernelName:$v,backendName:"wasm",setupFunc:fPe,kernelFunc:mPe},lq;function yPe(e){lq=e.wasm.cwrap(ng,null,["number","number","number","array","number","array","array","number","number"])}function bPe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{blockSize:s,dataFormat:i}=r,o=a.shape[0],l=i==="NHWC"?a.shape[1]:a.shape[2],h=i==="NHWC"?a.shape[2]:a.shape[3],c=i==="NHWC"?a.shape[3]:a.shape[1],p=l*s,m=h*s,g=c/(s*s),b=i==="NHWC"?[o,p,m,g]:[o,g,p,m],v=t.makeOutput(b,"float32"),x=t.dataIdMap.get(a.dataId).id,_=new Uint8Array(new Int32Array($.computeStrides(a.shape)).buffer),I=new Uint8Array(new Int32Array(b).buffer),k=new Uint8Array(new Int32Array($.computeStrides(b)).buffer),E=t.dataIdMap.get(v.dataId).id;return lq(x,s,i==="NHWC"?1:0,_,a.shape.length-1,I,k,b.length,E),v}var vPe={kernelName:ng,backendName:"wasm",setupFunc:yPe,kernelFunc:bPe},uq;function xPe(e){uq=e.wasm.cwrap(jd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function wPe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,i=r.dataIdMap.get(a.dataId).id,o=r.dataIdMap.get(s.dataId).id,{strides:l,dilations:h,pad:c,dimRoundingMode:p}=n,m=h??[1,1],g=B.computeConv2DInfo(a.shape,s.shape,l,m,c,p,!0),b=g.filterHeight,v=g.filterWidth,x=g.padInfo.top,_=g.padInfo.right,I=g.padInfo.bottom,k=g.padInfo.left,E=g.dilationHeight,R=g.dilationWidth,U=g.strideHeight,D=g.strideWidth,C=g.inChannels,O=g.outChannels,z=g.padInfo.type==="SAME"?1:0;if(g.dataFormat!=="channelsLast")throw new Error(`wasm backend DepthwiseConv2dNative does not support dataFormat:'${g.dataFormat}'. Please use 'channelsLast'.`);let M=r.makeOutput(g.outShape,"float32"),N=r.dataIdMap.get(M.dataId).id;return uq(i,a.shape[0],a.shape[1],a.shape[2],o,b,v,x,_,I,k,z,E,R,U,D,C,O,N),M}var _Pe={kernelName:jd,backendName:"wasm",setupFunc:xPe,kernelFunc:wPe},cq;function SPe(e){cq=e.wasm.cwrap("Diag",null,["number","number","number","number"])}function IPe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=$.sizeFromShape(r.shape),s=n.makeOutput([...r.shape,...r.shape],r.dtype);return cq(n.dataIdMap.get(r.dataId).id,tn[r.dtype],a,n.dataIdMap.get(s.dataId).id),s}var TPe={kernelName:Ov,backendName:"wasm",setupFunc:SPe,kernelFunc:IPe},hq;function kPe(e){hq=e.wasm.cwrap(Hd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function EPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:o,dilations:l}=r;if(a.dtype!==s.dtype)throw new Error(`Dilation2D error: x must have the same dtype as filter. Got ${a.dtype} and ${s.dtype}`);let h=B.computeDilation2DInfo(a.shape,s.shape,i,o,"NHWC",l),c=n.makeOutput(h.outShape,a.dtype);return hq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,tn[a.dtype],h.batchSize,h.inChannels,h.inHeight,h.inWidth,h.outHeight,h.outWidth,h.strideHeight,h.strideWidth,h.dilationHeight,h.dilationWidth,h.filterHeight,h.filterWidth,h.padInfo.top,h.padInfo.left),c}var NPe={kernelName:Hd,backendName:"wasm",setupFunc:kPe,kernelFunc:EPe},dq;function CPe(e){dq=e.wasm.cwrap(mm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function APe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:i}=t,{strides:o,pad:l,dilations:h}=r;if(a.dtype!==s.dtype||a.dtype!==i.dtype)throw new Error(`Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${i.dtype}`);let c=B.computeDilation2DInfo(a.shape,s.shape,o,l,"NHWC",h),p=n.makeOutput(s.shape,s.dtype);return dq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(p.dataId).id,tn[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),p}var RPe={kernelName:mm,backendName:"wasm",setupFunc:CPe,kernelFunc:APe},pq;function DPe(e){pq=e.wasm.cwrap(fm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function MPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:i}=t,{strides:o,pad:l,dilations:h}=r;if(a.dtype!==s.dtype||a.dtype!==i.dtype)throw new Error(`Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${i.dtype}`);let c=B.computeDilation2DInfo(a.shape,s.shape,o,l,"NHWC",h),p=n.makeOutput(a.shape,a.dtype);return pq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(p.dataId).id,tn[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),p}var $Pe={kernelName:fm,backendName:"wasm",setupFunc:DPe,kernelFunc:MPe},OPe=Kt(qd),fq;function FPe(e){fq=e.wasm.cwrap(rg,null,["number","number","number"])}function PPe(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=n.makeOutput(a.shape,"float32"),i=o=>n.dataIdMap.get(o.dataId).id;return fq(i(a),i(r),i(s)),s}var LPe={kernelName:rg,backendName:"wasm",setupFunc:FPe,kernelFunc:PPe},zPe=!1,VPe=Rr(ag,zPe,"bool"),UPe=Kt(Kd),BPe=Kt(Xd,"float32");function oN(e){let{inputs:t,attrs:n,backend:r}=e,{input:a}=t,{dim:s}=n,i=a.shape.length,o=a.shape.slice(),l=s;return s<0&&($.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),o.splice(l,0,1),os({inputs:{x:a},backend:r,attrs:{shape:o}})}var WPe={kernelName:sg,backendName:"wasm",kernelFunc:oN},jPe=Kt(Yd,"float32");function mq(e){let{attrs:{shape:t,value:n},backend:r}=e,{attrs:{dtype:a}}=e;a=a||$.inferDtype(n);let s=r.makeOutput(t,a);return r.typedArrayFromHeap(s).fill(n),s}var HPe={kernelName:Fv,backendName:"wasm",kernelFunc:mq},gq;function GPe(e){gq=e.wasm.cwrap(ig,null,["number","number","number","number","number","number"])}function qPe(e){let{inputs:t,backend:n}=e,{image:r}=t,a=n.makeOutput(r.shape,r.dtype),s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,[o,l,h,c]=r.shape;return gq(s,o,l,h,c,i),a}var KPe={kernelName:ig,backendName:"wasm",kernelFunc:qPe,setupFunc:GPe},XPe=Kt(Qd),YPe=Rr(Zd),yq;function QPe(e){yq=e.wasm.cwrap(Jd,null,["number","number","number","number","number","number","number"])}function ZPe(e){let{backend:t,inputs:n,attrs:r}=e,{varianceEpsilon:a}=r,{x:s,mean:i,variance:o,offset:l,scale:h}=n,c=t.dataIdMap.get(s.dataId).id,p=t.dataIdMap.get(i.dataId).id,m=t.dataIdMap.get(o.dataId).id,g=l!=null?t.dataIdMap.get(l.dataId).id:0,b=h!=null?t.dataIdMap.get(h.dataId).id:0,v=t.makeOutput(s.shape,s.dtype);if($.sizeFromShape(s.shape)===0)return v;let x=t.dataIdMap.get(v.dataId).id;return yq(c,p,m,g,b,a,x),v}var JPe={kernelName:Jd,backendName:"wasm",setupFunc:QPe,kernelFunc:ZPe},bq;function eLe(e){bq=e.wasm.cwrap(nd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function tLe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dilations:c,dataFormat:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=n,v=B.computeConv2DInfo(a.shape,s.shape,l,c,h,m),x=hv[g];if(x==null)throw new Error(`${g} activation not yet supported for FusedConv2D in the wasm backend.`);let _=r.dataIdMap.get(a.dataId).id,I=r.dataIdMap.get(s.dataId).id,k=v.outChannels,E=0;if(i!=null){let ue=r.dataIdMap.get(i.dataId);if(ue.shape.length!==1)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${ue.shape.length}.`);if(ue.shape[0]!==k)throw new Error(`FusedConv2D bias shape (${ue.shape}) does not match the number of output channels (${k})`);E=ue.id}let R=v.filterHeight,U=v.filterWidth,D=v.padInfo.top,C=v.padInfo.right,O=v.padInfo.bottom,z=v.padInfo.left,M=v.dilationHeight,N=v.dilationWidth,P=v.strideHeight,Q=v.strideWidth,ee=v.inChannels,q=v.padInfo.type==="SAME"?1:0,Z=v.batchSize,ne=v.inHeight,me=v.inWidth;if(p!=="NHWC")throw new Error(`wasm backend FusedConv2D does not support dataFormat:'${p}'. Please use 'NHWC'.`);let xe=r.makeOutput(v.outShape,"float32"),H=r.dataIdMap.get(xe.dataId).id,se=o==null?0:r.dataIdMap.get(o.dataId).id;return bq(_,Z,ne,me,I,R,U,E,D,C,O,z,q,M,N,P,Q,ee,k,x,se,b||0,H),xe}var nLe={kernelName:nd,backendName:"wasm",setupFunc:eLe,kernelFunc:tLe},vq;function rLe(e){vq=e.wasm.cwrap(rd,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function aLe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:o}=t,{strides:l,pad:h,dilations:c,dataFormat:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=n,v=B.computeConv2DInfo(a.shape,s.shape,l,c,h,m,!0),x=hv[g];if(x==null)throw new Error(`${g} activation not yet supported for FusedDepthwiseConv2D in the wasm backend.`);let _=r.dataIdMap.get(a.dataId).id,I=r.dataIdMap.get(s.dataId).id,k=v.outChannels,E=0;if(i!=null){let ue=r.dataIdMap.get(i.dataId);if(ue.shape.length!==1)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${ue.shape.length}.`);if(ue.shape[0]!==k)throw new Error(`FusedDepthwiseConv2D bias shape (${ue.shape}) does not match the number of output channels (${k})`);E=ue.id}let R=v.filterHeight,U=v.filterWidth,D=v.padInfo.top,C=v.padInfo.right,O=v.padInfo.bottom,z=v.padInfo.left,M=v.dilationHeight,N=v.dilationWidth,P=v.strideHeight,Q=v.strideWidth,ee=v.inChannels,q=v.padInfo.type==="SAME"?1:0,Z=v.batchSize,ne=v.inHeight,me=v.inWidth;if(p!=="NHWC")throw new Error(`wasm backend FusedDepthwiseConv2D does not support dataFormat:'${p}'. Please use 'NHWC'.`);let xe=r.makeOutput(v.outShape,"float32"),H=r.dataIdMap.get(xe.dataId).id,se=o==null?0:r.dataIdMap.get(o.dataId).id;return vq(_,Z,ne,me,I,R,U,E,D,C,O,z,q,M,N,P,Q,ee,k,x,se,b||0,H),xe}var sLe={kernelName:rd,backendName:"wasm",setupFunc:rLe,kernelFunc:aLe},xq;function iLe(e){xq=e.wasm.cwrap(lg,null,["number","number","number","number","number","number","array","number"])}function oLe(e){let{backend:t,inputs:n}=e,{params:r,indices:a}=n,[s,i,o,l]=aA.prepareAndValidate(r,a),h=t.makeOutput(s,r.dtype);if(i===0)return h;let c=a.shape,p=c[c.length-1],m=t.dataIdMap.get(r.dataId).id,g=t.dataIdMap.get(a.dataId).id,b=new Uint8Array(new Int32Array(l).buffer),v=t.dataIdMap.get(h.dataId).id;return xq(m,tn[r.dtype],g,i,p,o,b,v),h}var lLe={kernelName:lg,backendName:"wasm",setupFunc:iLe,kernelFunc:oLe},wq;function uLe(e){wq=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])}function cLe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,indices:s}=n,{axis:i,batchDims:o}=r,l=$.parseAxisParam(i,a.shape)[0],h=t.readSync(s.dataId),c=a.shape[l];for(let D=0;D<h.length;++D){let C=h[D];$.assert(C<=c-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${c-1}]`)}let p=B.segment_util.collectGatherOpShapeInfo(a,s,l,o),m=os({inputs:{x:a},attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]},backend:t}),g=$.sizeFromShape(s.shape),b=os({inputs:{x:s},attrs:{shape:[p.batchSize,g/p.batchSize]},backend:t}),v=[p.batchSize,p.outerSize,g/p.batchSize,p.sliceSize],x=t.makeOutput(v,a.dtype);if($.sizeFromShape(a.shape)===0)return x;let _=m.shape.length-1,I=t.dataIdMap.get(m.dataId).id,k=t.dataIdMap.get(b.dataId).id,E=t.dataIdMap.get(x.dataId).id,R=new Uint8Array(new Int32Array($.computeStrides(m.shape)).buffer),U=new Uint8Array(new Int32Array($.computeStrides(v)).buffer);return wq(I,tn[a.dtype],R,_,k,p.batchSize,U,E),t.disposeData(m.dataId),t.disposeData(b.dataId),x.shape=p.outputShape,x}var hLe={kernelName:og,backendName:"wasm",setupFunc:uLe,kernelFunc:cLe},dLe=!1,pLe=Rr(ug,dLe,"bool"),fLe=!1,mLe=Rr(ep,fLe,"bool"),gLe=Kt(np,"bool"),yLe=Kt(rp,"bool"),bLe=Kt(ap,"bool"),_q;function vLe(e){_q=e.wasm.cwrap(sp,null,["number","number","number","number"])}function xLe(e){let{inputs:{x:t},attrs:{alpha:n},backend:r}=e,a=r.dataIdMap.get(t.dataId).id,s=r.makeOutput(t.shape,"float32");if($.sizeFromShape(t.shape)!==0){let i=r.dataIdMap.get(s.dataId).id;_q(a,tn[t.dtype],n,i)}return s}var wLe={kernelName:sp,backendName:"wasm",setupFunc:vLe,kernelFunc:xLe},_Le=!1,SLe=Rr(cg,_Le,"bool"),ILe=!1,TLe=Rr(hg,ILe,"bool"),Sq;function kLe(e){Sq=e.wasm.cwrap(dg,null,["number","number","number","number"])}function ELe(e){let{attrs:t,backend:n}=e,{start:r,stop:a,num:s}=t,i=Math.floor(s),o=n.makeOutput([i],"float32");return Sq(n.dataIdMap.get(o.dataId).id,r,a,i),o}var NLe={kernelName:dg,backendName:"wasm",setupFunc:kLe,kernelFunc:ELe},CLe=Kt(ip),ALe=Kt(op),RLe=!1,DLe=Rr(pg,RLe,"bool"),MLe=Kt(fg),$Le=!1,OLe=Rr(mg,$Le,"bool"),FLe=!1,PLe=Rr(_U,FLe,"bool"),Iq;function LLe(e){Iq=e.wasm.cwrap(lp,null,["number","number","number","number","number","number","number"])}function zLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:o,beta:l}=r;if(a.dtype!=="float32")throw new Error("LRN error: x must have dtype float32");let h=n.makeOutput(a.shape,a.dtype);return Iq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,a.shape[3],s,i,o,l),h}var VLe={kernelName:lp,backendName:"wasm",setupFunc:LLe,kernelFunc:zLe},Tq;function ULe(e){Tq=e.wasm.cwrap(gg,null,["number","number","number","number","number","number","number","number","number"])}function BLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:o,bias:l,alpha:h,beta:c}=r;if(a.dtype!=="float32"||s.dtype!=="float32"||i.dtype!=="float32")throw new Error("LRNGrad error: x, y, and dy must have dtype float32");let p=n.makeOutput(a.shape,a.dtype);return Tq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(p.dataId).id,i.shape[3],o,l,h,c),p}var WLe={kernelName:gg,backendName:"wasm",setupFunc:ULe,kernelFunc:BLe},kq;function jLe(e){kq=e.wasm.cwrap(up,null,["number","number","number","number"])}function HLe(e){let{backend:t,inputs:n,attrs:r}=e,{reductionIndices:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=i,{transposed:h,axes:c,originalAxes:p,inputWasTransposed:m}=Yc(i,a,t);if(m){let I=t.dataIdMap.get(h.dataId).id;l=h,o=I}let g=l.shape.length;B.assertAxesAreInnerMostDims("max",c,g);let[b,v]=B.computeOutAndReduceShapes(l.shape,c),x=$.sizeFromShape(v),_=t.makeOutput(b,i.dtype);if($.sizeFromShape(l.shape)!==0){let I=t.dataIdMap.get(_.dataId).id;kq(o,tn[i.dtype],x,I)}if(m&&t.disposeData(h.dataId),s){let I=B.expandShapeToKeepDim(_.shape,p);_.shape=I}return _}var GLe={kernelName:up,backendName:"wasm",setupFunc:jLe,kernelFunc:HLe},qLe=Rr(cp),Eq;function KLe(e){Eq=e.wasm.cwrap(hp,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function XLe(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id;$.assert(a.dtype==="float32",()=>`Error in MaxPool: only float32 input is supported. Got ${a.dtype}.`);let{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=n,c=B.computePool2DInfo(a.shape,i,o,1,l,h),p=c.filterHeight,m=c.filterWidth,g=c.padInfo.top,b=c.padInfo.right,v=c.padInfo.bottom,x=c.padInfo.left,_=c.dilationHeight,I=c.dilationWidth,k=c.strideHeight,E=c.strideWidth,R=c.inChannels,U=c.outChannels;if(c.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${c.dataFormat}'. Please use 'channelsLast'.`);let D=r.makeOutput(c.outShape,"float32"),C=r.dataIdMap.get(D.dataId).id;return Eq(s,a.shape[0],a.shape[1],a.shape[2],p,m,g,b,v,x,_,I,k,E,R,U,C),D}var YLe={kernelName:hp,backendName:"wasm",setupFunc:KLe,kernelFunc:XLe},Nq;function QLe(e){Nq=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function ZLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,dimRoundingMode:l,dataFormat:h}=r,c=B.computePool3DInfo(a.shape,s,i,1,o,l,h),p=n.makeOutput(c.outShape,a.dtype);return Nq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),p}var JLe={kernelName:yg,backendName:"wasm",setupFunc:QLe,kernelFunc:ZLe},Cq;function eze(e){Cq=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function tze(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=r,c=B.computePool3DInfo(s.shape,i,o,1,l,h),p=n.makeOutput(s.shape,s.dtype);return Cq(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),p}var nze={kernelName:Lv,backendName:"wasm",setupFunc:eze,kernelFunc:tze},Aq;function rze(e){Aq=e.wasm.cwrap("MaxPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function aze(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:h}=r,c=B.computePool2DInfo(s.shape,i,o,1,l,h),p=n.makeOutput(s.shape,s.dtype);return Aq(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.top,c.padInfo.left),p}var sze={kernelName:Pv,backendName:"wasm",setupFunc:rze,kernelFunc:aze},Rq;function ize(e){Rq=e.wasm.cwrap("MaxPoolWithArgmax",null,["number","number","number","number","boolean","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function oze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:o,includeBatchInIndex:l}=r;$.assert(a.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.shape.length}.`);let h=[1,1];$.assert(B.eitherStridesOrDilationsAreOne(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let c=B.computePool2DInfo(a.shape,s,i,[1,1],o),p=n.makeOutput(c.outShape,a.dtype),m=n.makeOutput(c.outShape,"int32");return Rq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,n.dataIdMap.get(m.dataId).id,tn[a.dtype],l,c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.top,c.padInfo.left),[p,m]}var lze={kernelName:zv,backendName:"wasm",setupFunc:ize,kernelFunc:oze},Dq;function uze(e){Dq=e.wasm.cwrap(dp,null,["number, number, number"])}function cze(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=o,h=i,{transposed:c,axes:p,originalAxes:m,inputWasTransposed:g}=Yc(i,a,t),b=p;if(g){let E=t.dataIdMap.get(c.dataId).id;E!==o&&(h=c,l=E,b=B.getInnerMostAxes(b.length,h.shape.length))}B.assertAxesAreInnerMostDims("mean",b,h.shape.length);let[v,x]=B.computeOutAndReduceShapes(h.shape,b),_=$.sizeFromShape(x),I=h;h.dtype!=="float32"&&(I=Qc({backend:t,inputs:{x:h},attrs:{dtype:"float32"}}),l=t.dataIdMap.get(I.dataId).id);let k=t.makeOutput(v,"float32");if($.sizeFromShape(h.shape)!==0){let E=t.dataIdMap.get(k.dataId).id;Dq(l,_,E)}if(g&&t.disposeData(c.dataId),s){let E=B.expandShapeToKeepDim(k.shape,m);k.shape=E}return h.dtype!=="float32"&&t.disposeData(I.dataId),k}var hze={kernelName:dp,backendName:"wasm",setupFunc:uze,kernelFunc:cze},Mq;function dze(e){Mq=e.wasm.cwrap(pp,null,["number","number","number","number"])}function pze(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=o,h=i,{transposed:c,axes:p,originalAxes:m,inputWasTransposed:g}=Yc(i,a,t);if(g){let k=t.dataIdMap.get(c.dataId).id;k!==o&&(h=c,l=k)}let b=h.shape.length;B.assertAxesAreInnerMostDims("min",p,b);let[v,x]=B.computeOutAndReduceShapes(h.shape,p),_=$.sizeFromShape(x),I=t.makeOutput(v,h.dtype);if($.sizeFromShape(h.shape)!==0){let k=t.dataIdMap.get(I.dataId).id;Mq(l,tn[i.dtype],_,k)}if(g&&t.disposeData(c.dataId),s){let k=B.expandShapeToKeepDim(I.shape,m);I.shape=k}return I}var fze={kernelName:pp,backendName:"wasm",setupFunc:dze,kernelFunc:pze},mze=Rr(fp),lN;(function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"})(lN||(lN={}));var $q;function gze(e){$q=e.wasm.cwrap(mp,null,["number","array","number","number","array","array","number","number"])}function yze(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,mode:a}}=e,s=r.map((b,v)=>b[0]+t.shape[v]+b[1]),i=n.dataIdMap.get(t.dataId).id,o=n.makeOutput(s,t.dtype),l=n.dataIdMap.get(o.dataId).id,h=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(b=>b[0]),p=r.map(b=>b[1]),m=new Uint8Array(new Int32Array(c).buffer),g=new Uint8Array(new Int32Array(p).buffer);return $q(i,h,t.shape.length,tn[t.dtype],m,g,lN[a],l),o}var bze={kernelName:mp,backendName:"wasm",kernelFunc:yze,setupFunc:gze},Oq;function vze(e){Oq=e.wasm.cwrap(zp,null,["number","number","number","number"])}function Fq(e){let{backend:t,inputs:{logits:n},attrs:{dim:r}}=e,a=t.dataIdMap.get(n.dataId).id,s=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(s.dataId).id,o=n.shape[r],l=$.sizeFromShape(n.shape)/o;return $.sizeFromShape(s.shape)===0||Oq(a,i,o,l),s}var xze={kernelName:zp,backendName:"wasm",setupFunc:vze,kernelFunc:Fq},Pq;function wze(e){Pq=e.wasm.cwrap(bg,null,["number","number","number","number","number","number"])}function _ze(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:o}=r;if(a.dtype!=="float32")throw new Error(`Tensor logits must have dtype float32, got ${a.dtype}`);let l=o?a:Fq({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),[h,c]=l.shape,p=n.makeOutput([h,s],"int32");return Pq(n.dataIdMap.get(l.dataId).id,h,c,s,i,n.dataIdMap.get(p.dataId).id),o||n.disposeData(l.dataId),p}var Sze={kernelName:bg,backendName:"wasm",setupFunc:wze,kernelFunc:_ze},Ize=Rr(gp),Tze=Rr(yp),kze=Kt(vg);function wD(e,t){let n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],s=n[2],i=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:s,pValidOutputs:i}}var Lq;function Eze(e){Lq=e.wasm.cwrap(wg,"number",["number","number","number","number","number"])}function Nze(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i}=r,{boxes:o,scores:l}=n,h=t.dataIdMap.get(o.dataId).id,c=t.dataIdMap.get(l.dataId).id,p=Lq(h,c,s,a,i),{pSelectedIndices:m,selectedSize:g,pSelectedScores:b,pValidOutputs:v}=wD(t,p);return t.wasm._free(b),t.wasm._free(v),t.makeOutput([g],"int32",m)}var Cze={kernelName:wg,backendName:"wasm",setupFunc:Eze,kernelFunc:Nze},zq;function Aze(e){zq=e.wasm.cwrap(_g,"number",["number","number","number","number","number","bool"])}function Rze(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i,padToMaxOutputSize:o}=r,{boxes:l,scores:h}=n,c=t.dataIdMap.get(l.dataId).id,p=t.dataIdMap.get(h.dataId).id,m=zq(c,p,s,a,i,o),{pSelectedIndices:g,selectedSize:b,pSelectedScores:v,pValidOutputs:x}=wD(t,m);t.wasm._free(v);let _=t.makeOutput([b],"int32",g),I=t.makeOutput([],"int32",x);return[_,I]}var Dze={kernelName:_g,backendName:"wasm",setupFunc:Aze,kernelFunc:Rze},Vq;function Mze(e){Vq=e.wasm.cwrap(Sg,"number",["number","number","number","number","number","number"])}function $ze(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i,softNmsSigma:o}=r,{boxes:l,scores:h}=n,c=t.dataIdMap.get(l.dataId).id,p=t.dataIdMap.get(h.dataId).id,m=Vq(c,p,s,a,i,o),{pSelectedIndices:g,selectedSize:b,pSelectedScores:v,pValidOutputs:x}=wD(t,m);t.wasm._free(x);let _=t.makeOutput([b],"int32",g),I=t.makeOutput([b],"float32",v);return[_,I]}var Oze={kernelName:Sg,backendName:"wasm",setupFunc:Mze,kernelFunc:$ze},Fze=!1,Pze=Rr(xg,Fze,"bool"),Uq;function Lze(e){Uq=e.wasm.cwrap(bp,null,["number","number","number","number","number"])}function zze(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:o,offValue:l}=r,h=n.makeOutput([...a.shape,i],s),c=n.dataIdMap.get(h.dataId).id,p=n.dataIdMap.get(a.dataId).id;return Uq(p,i,o,l,c),h}var Vze={kernelName:bp,backendName:"wasm",setupFunc:Lze,kernelFunc:zze};function Uze(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}var Bze={kernelName:Ig,backendName:"wasm",kernelFunc:Uze};function Wze(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return oN({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{$.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),$.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let o=[],l=t.map(c=>{let p=oN({inputs:{input:c},backend:n,attrs:{dim:a}});return o.push(p),p}),h=ZG({inputs:l,backend:n,attrs:{axis:a}});return o.forEach(c=>n.disposeData(c.dataId)),h}var jze={kernelName:Tg,backendName:"wasm",kernelFunc:Wze},Bq;function Hze(e){Bq=e.wasm.cwrap(vp,null,["number","array","number","number","array","array","number","number"])}function Gze(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:a}}=e,s=r.map((b,v)=>b[0]+t.shape[v]+b[1]);if($.sizeFromShape(t.shape)===0)return mq({backend:n,attrs:{shape:s,value:a,dtype:t.dtype}});let i=n.dataIdMap.get(t.dataId).id,o=n.makeOutput(s,t.dtype),l=n.dataIdMap.get(o.dataId).id,h=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(b=>b[0]),p=r.map(b=>b[1]),m=new Uint8Array(new Int32Array(c).buffer),g=new Uint8Array(new Int32Array(p).buffer);return Bq(i,h,t.shape.length,tn[t.dtype],m,g,a,l),o}var Wq={kernelName:vp,backendName:"wasm",kernelFunc:Gze,setupFunc:Hze},qze=Rr(xp),jq;function Kze(e){jq=e.wasm.cwrap(wp,null,["number","number","number"])}function Xze(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,o=s,l=r,h=l;l.dtype!=="float32"&&(h=Qc({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),o=n.dataIdMap.get(h.dataId).id);let c=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(c.dataId).id;return jq(o,i,p),l.dtype!=="float32"&&n.disposeData(h.dataId),c}var Yze={kernelName:wp,backendName:"wasm",setupFunc:Kze,kernelFunc:Xze},Hq;function Qze(e){Hq=e.wasm.cwrap(_p,null,["number","number","number","number"])}function Zze(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=o,h=i,{transposed:c,axes:p,originalAxes:m,inputWasTransposed:g}=Yc(i,a,t),b=p;if(g){let k=t.dataIdMap.get(c.dataId).id;k!==o&&(h=c,l=k,b=B.getInnerMostAxes(b.length,h.shape.length))}B.assertAxesAreInnerMostDims("prod",b,h.shape.length);let[v,x]=B.computeOutAndReduceShapes(h.shape,b),_=$.sizeFromShape(x),I=t.makeOutput(v,h.dtype);if($.sizeFromShape(h.shape)!==0){let k=t.dataIdMap.get(I.dataId).id;Hq(l,_,tn[I.dtype],k)}if(g&&t.disposeData(c.dataId),s){let k=B.expandShapeToKeepDim(I.shape,m);I.shape=k}return I}var Jze={kernelName:_p,backendName:"wasm",setupFunc:Qze,kernelFunc:Zze},e4e=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:i}=n,o=XR(r,a,s,i),l=t.makeOutput([o.length],i);return t.typedArrayFromHeap(l).set(o),l},t4e={kernelName:Vv,backendName:"wasm",kernelFunc:e4e},n4e=Rr(Gd),r4e=Kt(Sp),a4e=Kt(Ip),s4e=Kt(Ep),Gq;function i4e(e){Gq=e.wasm.cwrap(kp,null,["number","number","number","number","number","number","number","number","number","number"])}function o4e(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:i,size:o}=r,[l,h]=o,[c,p,m,g]=a.shape,b=[c,l,h,g],v=t.dataIdMap.get(a.dataId),x;v.dtype!=="float32"&&(x=Qc({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),v=t.dataIdMap.get(x.dataId));let _=v.id,I=t.makeOutput(b,"float32");if($.sizeFromShape(a.shape)===0)return I;let k=t.dataIdMap.get(I.dataId).id;return Gq(_,c,p,m,g,l,h,s?1:0,i?1:0,k),x!=null&&t.disposeData(x.dataId),I}var l4e={kernelName:kp,backendName:"wasm",setupFunc:i4e,kernelFunc:o4e},qq;function u4e(e){qq=e.wasm.cwrap(Ng,null,["number","number","number","array","array","boolean"])}function c4e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,o=n.makeOutput(a.shape,"float32"),l=n.dataIdMap.get(a.dataId),h;return l.dtype!=="float32"&&(h=Qc({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),l=n.dataIdMap.get(h.dataId)),qq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(o.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),i),h!=null&&n.disposeData(h.dataId),o}var h4e={kernelName:Ng,backendName:"wasm",setupFunc:u4e,kernelFunc:c4e},Kq;function d4e(e){Kq=e.wasm.cwrap(Tp,null,["number","number","number","number","number","number","number","number","number","number"])}function p4e(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:i,size:o}=r,[l,h]=o,[c,p,m,g]=a.shape,b=[c,l,h,g],v=t.makeOutput(b,"float32");if($.sizeFromShape(a.shape)===0)return v;let x=t.dataIdMap.get(a.dataId),_;x.dtype!=="float32"&&(_=Qc({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(_.dataId));let I=x.id,k=t.dataIdMap.get(v.dataId).id;return Kq(I,c,p,m,g,l,h,s?1:0,i?1:0,k),_!=null&&t.disposeData(_.dataId),v}var f4e={kernelName:Tp,backendName:"wasm",setupFunc:d4e,kernelFunc:p4e},Xq;function m4e(e){Xq=e.wasm.cwrap(Eg,null,["number","number","number","array","array","boolean"])}function g4e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,o=n.makeOutput(a.shape,"float32"),l=n.dataIdMap.get(a.dataId),h;return l.dtype!=="float32"&&(h=Qc({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),l=n.dataIdMap.get(h.dataId)),Xq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(o.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),i),h!=null&&n.disposeData(h.dataId),o}var y4e={kernelName:Eg,backendName:"wasm",setupFunc:m4e,kernelFunc:g4e},Yq;function b4e(e){Yq=e.wasm.cwrap(Np,null,["number","array","number","array","number","number"])}function v4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,i=$.parseAxisParam(s,a.shape);if(a.shape.length===0)return jS({inputs:{x:a},backend:n});let o=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(o.dataId).id,c=new Uint8Array(new Int32Array(i).buffer),p=new Uint8Array(new Int32Array(a.shape).buffer);Yq(l,c,i.length,p,a.shape.length,h);let m=os({inputs:{x:o},attrs:{shape:a.shape},backend:n});return n.disposeData(o.dataId),m}var x4e={kernelName:Np,backendName:"wasm",kernelFunc:v4e,setupFunc:b4e},Qq;function w4e(e){Qq=e.wasm.cwrap(Wg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function _4e(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{radians:s,fillValue:i,center:o}=r,l=n.makeOutput(a.shape,a.dtype),h=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(l.dataId).id,[p,m,g,b]=a.shape,[v,x]=B.getImageCenter(o,m,g),_=i===0,I=255,k=typeof i=="number"?[i,i,i,_?0:I]:[...i,I],E=new Uint8Array(new Int32Array(k).buffer);return Qq(h,p,m,g,b,s,v,x,E,k.length,c),l}var S4e={kernelName:Wg,backendName:"wasm",kernelFunc:_4e,setupFunc:w4e},I4e=Kt(Cp),T4e=Kt(Ap),Zq;function k4e(e){Zq=e.wasm.cwrap(Cg,null,["number","number","number","number","number","number","array","number","number"])}function E4e(e){let{backend:t,inputs:n,attrs:r}=e,{indices:a,updates:s}=n,{shape:i}=r,o=t.makeOutput(i,s.dtype);if($.sizeFromShape(i)===0)return o;let{sliceRank:l,numUpdates:h,sliceSize:c,strides:p,outputSize:m}=iS.calculateShapes(s,a,i),g=t.dataIdMap.get(a.dataId).id,b=t.dataIdMap.get(s.dataId).id,v=new Uint8Array(new Int32Array(p).buffer),x=t.dataIdMap.get(o.dataId).id;return Zq(g,b,tn[s.dtype],l,h,c,v,m,x),o}var N4e={kernelName:Cg,backendName:"wasm",setupFunc:k4e,kernelFunc:E4e},Jq;function C4e(e){Jq=e.wasm.cwrap(Rg,null,["number","number","number","number","number","number","bool","number"])}function A4e(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r;if(a.dtype!==s.dtype)throw new Error(`SearchSorted error: sorted_sequence must have the same dtype as values. Got ${a.dtype} and ${s.dtype}`);let o=n.makeOutput(s.shape,"int32");function l(h){return n.dataIdMap.get(h.dataId).id}return Jq(l(a),l(s),a.shape[0],a.shape[1],s.shape[1],tn[a.dtype],i==="left",l(o)),o}var R4e={kernelName:Rg,backendName:"wasm",setupFunc:C4e,kernelFunc:A4e},e8;function D4e(e){e8=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}function M4e(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(s.dataId).id,h=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(h.dataId).id,p=r.shape.length,m=a.shape.length,g=p===0||p>1||m===1?1:$.sizeFromShape(a.shape.slice(1));return e8(i,o,l,g,c),h}var $4e={kernelName:Dg,backendName:"wasm",kernelFunc:M4e,setupFunc:D4e},O4e=Kt(Rp),t8;function F4e(e){t8=e.wasm.cwrap(Op,null,["number","number"])}function P4e(e){let{backend:t,inputs:{x:n}}=e,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(a.dataId).id;return $.sizeFromShape(a.shape)===0||t8(r,s),a}var L4e={kernelName:"Sigmoid",backendName:"wasm",setupFunc:F4e,kernelFunc:P4e},z4e=Kt($p),V4e=Kt(Dp),U4e=Kt(Mp),B4e=Kt(Fp);function W4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r,o=$.sizeFromShape(s),l=[[0,0]];l.push(...i);for(let x=1+s.length;x<a.shape.length;++x)l.push([0,0]);let h=Wq.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),c=B.getReshaped(h.shape,s,o,!1),p=B.getPermuted(c.length,s.length,!1),m=B.getReshapedPermuted(h.shape,s,o,!1),g=os({inputs:{x:h},backend:n,attrs:{shape:c}}),b=Cc({inputs:{x:g},backend:n,attrs:{perm:p}}),v=os({inputs:{x:b},backend:n,attrs:{shape:m}});return n.disposeData(h.dataId),n.disposeData(g.dataId),n.disposeData(b.dataId),v}var j4e={kernelName:$g,backendName:"wasm",kernelFunc:W4e},n8;function H4e(e){n8=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])}function G4e(e){let{backend:t,inputs:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=n,o=r.shape[0],l=r.shape[1],h=t.readSync(s.dataId)[0],c=[o+h,l],p=t.dataIdMap.get(r.dataId).id,m=t.dataIdMap.get(a.dataId).id,g=t.dataIdMap.get(i.dataId).id,b=t.makeOutput(c,r.dtype),v=t.dataIdMap.get(b.dataId).id,x=t.makeOutput(c.slice(0,1),a.dtype),_=t.dataIdMap.get(x.dataId).id,I=t.makeOutput([h],"bool"),k=t.dataIdMap.get(I.dataId).id,E=t.makeOutput([o],r.dtype),R=t.dataIdMap.get(E.dataId).id,U=t.makeOutput([4],"int32"),D=t.dataIdMap.get(U.dataId).id,C=n8(p,m,tn[a.dtype],o,h,l,g,v,_,k,R,D),O=t.readSync(U.dataId),z;switch(O[0]){case 1:{z=B.getSparseFillEmptyRowsIndicesDenseShapeMismatch(O[1]);break}case 2:{z=B.getSparseFillEmptyRowsNegativeIndexErrorMessage(O[1],O[2]);break}case 3:z=B.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(O[1],O[2],O[3]);break;default:z=""}if(t.disposeData(U.dataId),z)throw t.disposeData(b.dataId),t.disposeData(x.dataId),t.disposeData(I.dataId),t.disposeData(E.dataId),new Error(z);let M=b,N=x;return C!==c[0]&&(M=vd({inputs:{x:b},attrs:{begin:0,size:[C,l]},backend:t}),N=vd({inputs:{x},attrs:{begin:0,size:C},backend:t}),t.disposeData(b.dataId),t.disposeData(x.dataId)),[M,N,I,E]}var q4e={kernelName:Uv,backendName:"wasm",setupFunc:H4e,kernelFunc:G4e},r8;function K4e(e){r8=e.wasm.cwrap(Fg,null,["number","number","number","number","number","number","number"])}function X4e(e){let{backend:t,inputs:n}=e,{inputIndices:r,inputShape:a,newShape:s}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=t.dataIdMap.get(r.dataId).id,o=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(s.dataId).id,h=r.shape[0],c=$.sizeFromShape(s.shape),p=t.makeOutput([h,c],r.dtype),m=t.dataIdMap.get(p.dataId).id,g=t.makeOutput([c],s.dtype),b=t.dataIdMap.get(g.dataId).id,v=t.makeOutput([3],"int32"),x=t.dataIdMap.get(v.dataId).id;r8(i,o,l,h,m,b,x);let _=t.readSync(v.dataId),I;switch(_[0]){case 0:{I=B.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(_[1],_[2]);break}case 1:{I=B.getSparseReshapeNegativeOutputDimErrorMessage(_[1],_[2]);break}case 2:I=B.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:{let k=Array.from(t.readSync(a.dataId)),E=Array.from(t.readSync(g.dataId));I=B.getSparseReshapeInputOutputMultipleErrorMessage(k,E);break}case 4:{let k=Array.from(t.readSync(a.dataId)),E=Array.from(t.readSync(g.dataId));I=B.getSparseReshapeInputOutputMismatchErrorMessage(k,E);break}default:I=""}if(t.disposeData(v.dataId),I)throw t.disposeData(p.dataId),t.disposeData(g.dataId),new Error(I);return[p,g]}var Y4e={kernelName:Fg,backendName:"wasm",setupFunc:K4e,kernelFunc:X4e},a8;function s8(e){a8=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function i8(e,t){let{backend:n,inputs:r}=e,{data:a,indices:s,segmentIds:i}=r,o=s.shape[0],l=n.readSync(i.dataId,o-1,o)[0],h=o>0?l+1:0;if(h<0)throw new Error(B.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let c=a.shape.slice();c[0]=h;let p=n.dataIdMap.get(a.dataId).id,m=n.dataIdMap.get(s.dataId).id,g=n.dataIdMap.get(i.dataId).id,b=n.makeOutput(c,a.dtype),v=n.dataIdMap.get(b.dataId).id,x=n.makeOutput([4],"int32"),_=n.dataIdMap.get(x.dataId).id;a8(p,tn[a.dtype],a.shape[0],m,g,v,_,t,0);let I=n.readSync(x.dataId),k;switch(I[0]){case 0:{k=B.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break}case 1:{k=B.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break}case 2:k=B.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(I[1],I[2]);break;case 3:k=B.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(I[1],I[2],I[3]);break;default:k=""}if(n.disposeData(x.dataId),k)throw n.disposeData(b.dataId),new Error(k);return b}function Q4e(e){return i8(e,!0)}var Z4e={kernelName:Bv,backendName:"wasm",setupFunc:s8,kernelFunc:Q4e};function J4e(e){return i8(e,!1)}var eVe={kernelName:Wv,backendName:"wasm",setupFunc:s8,kernelFunc:J4e},o8;function tVe(e){o8=e.wasm.cwrap(Pg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function nVe(e){let{backend:t,inputs:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=n,{outputShape:o}=r,l=t.makeOutput(o,i.dtype);if($.sizeFromShape(o)===0)return l;let{sliceRank:h,numUpdates:c,sliceSize:p,strides:m,outputSize:g}=B.calculateShapes(s,a,o),b=t.dataIdMap.get(a.dataId).id,v=t.dataIdMap.get(s.dataId).id,x=t.dataIdMap.get(i.dataId).id,_=new Uint8Array(new Int32Array(m).buffer),I=t.dataIdMap.get(l.dataId).id;return o8(b,v,s.shape.length,x,tn[i.dtype],h,c,p,_,g,I),l}var rVe={kernelName:Pg,backendName:"wasm",setupFunc:tVe,kernelFunc:nVe};function aVe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=n,o=$.parseAxisParam(i,a.shape)[0],l=B.prepareSplitSize(a,s,o),h=new Array(a.shape.length).fill(0),c=a.shape.slice();return l.map(p=>{let m=[...c];m[o]=p;let g=vd({inputs:{x:a},attrs:{begin:h,size:m},backend:r});return h[o]+=p,g})}var sVe={kernelName:Og,backendName:"wasm",kernelFunc:aVe},iVe=Kt(Pp),oVe=Kt(jv),lVe=Rr(Vp),l8;function uVe(e){l8=e.wasm.cwrap(Bc,null,["number","number","number","number"])}function cVe(e){let{backend:t,inputs:n,attrs:r}=e,{alpha:a}=r,{x:s}=n,i=t.dataIdMap.get(s.dataId).id,o=t.makeOutput(s.shape,s.dtype),l=t.dataIdMap.get(o.dataId).id;return l8(i,a,tn[s.dtype],l),o}var hVe={kernelName:Bc,backendName:"wasm",setupFunc:uVe,kernelFunc:cVe},u8;function dVe(e){u8=e.wasm.cwrap(Lg,null,["number","array","number","array","array","array","array","array","number","number"])}function pVe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{begin:s,end:i,strides:o,beginMask:l,endMask:h,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:m}=r,{finalShapeSparse:g,finalShape:b,isIdentity:v,sliceDim0:x,isSimpleSlice:_,begin:I,end:k,strides:E}=jr.sliceInfo(a.shape,s,i,o,l,h,c,p,m),R;if(v)R=os({inputs:{x:a},backend:t,attrs:{shape:b}});else if(x||_){$.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let U=jr.computeOutShape(I,k,E),D=vd({inputs:{x:a},backend:t,attrs:{begin:I,size:U}});R=os({inputs:{x:D},backend:t,attrs:{shape:b}}),t.disposeData(D.dataId)}else{let U=t.makeOutput(g,"float32"),D=t.dataIdMap.get(a.dataId).id,C=new Uint8Array(new Int32Array($.computeStrides(a.shape)).buffer),O=new Uint8Array(new Int32Array(I).buffer),z=new Uint8Array(new Int32Array(k).buffer),M=new Uint8Array(new Int32Array(E).buffer),N=new Uint8Array(new Int32Array(g).buffer),P=new Uint8Array(new Int32Array($.computeStrides(g)).buffer),Q=t.dataIdMap.get(U.dataId).id;u8(D,C,a.shape.length,O,z,M,N,P,g.length,Q),R=os({inputs:{x:U},backend:t,attrs:{shape:b}}),t.disposeData(U.dataId)}return R}var fVe={kernelName:Lg,backendName:"wasm",setupFunc:dVe,kernelFunc:pVe};function mVe(e){let{backend:t,inputs:n,attrs:r}=e,{data:a,dataSplits:s}=n,{separator:i,nGramWidths:o,leftPad:l,rightPad:h,padWidth:c,preserveShortSequences:p}=r,m=t.readSync(a.dataId),g=t.readSync(s.dataId),[b,v]=QR(m,g,i,o,l,h,c,p),x=t.makeOutput([b.length],"string"),_=t.dataIdMap.get(x.dataId);_.stringBytes=b;let I=t.makeOutput(s.shape,"int32");return t.typedArrayFromHeap(I).set(v),[x,I]}var gVe={kernelName:Gv,backendName:"wasm",kernelFunc:mVe};function yVe(e){let{backend:t,inputs:n,attrs:r}=e,{input:a,delimiter:s}=n,{skipEmpty:i}=r,o=t.readSync(a.dataId),l=t.readSync(s.dataId),[h,c,p]=ZR(o,l[0],i),m=c.length,g=t.makeOutput([m,2],"int32");t.typedArrayFromHeap(g).set(h);let b=t.makeOutput([m],"string"),v=t.dataIdMap.get(b.dataId);v.stringBytes=c;let x=t.makeOutput([2],"int32");return t.typedArrayFromHeap(x).set(p),[g,b,x]}var bVe={kernelName:qv,backendName:"wasm",kernelFunc:yVe};function vVe(e){let{backend:t,inputs:n,attrs:r}=e,{input:a}=n,{numBuckets:s}=r,i=t.readSync(a.dataId),o=JR(i,s),l=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(l).set(o),l}var xVe={kernelName:Kv,backendName:"wasm",kernelFunc:vVe},wVe=Rr(Up),c8;function _Ve(e){c8=e.wasm.cwrap(Lp,null,["number","number","number","number"])}function SVe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,o=t.dataIdMap.get(i.dataId).id,l=o,h=i,{transposed:c,axes:p,originalAxes:m,inputWasTransposed:g}=Yc(i,a,t),b=p;if(g){let k=t.dataIdMap.get(c.dataId).id;k!==o&&(h=c,l=k,b=B.getInnerMostAxes(b.length,h.shape.length))}B.assertAxesAreInnerMostDims("sum",b,h.shape.length);let[v,x]=B.computeOutAndReduceShapes(h.shape,b),_=$.sizeFromShape(x),I=t.makeOutput(v,h.dtype);if($.sizeFromShape(h.shape)!==0){let k=t.dataIdMap.get(I.dataId).id;c8(l,_,tn[I.dtype],k)}if(g&&t.disposeData(c.dataId),s){let k=B.expandShapeToKeepDim(I.shape,m);I.shape=k}return I}var IVe={kernelName:Lp,backendName:"wasm",setupFunc:_Ve,kernelFunc:SVe},TVe=Kt(Bp),kVe=Kt(Wp),h8;function EVe(e){h8=e.wasm.cwrap(Ag,null,["number","number","number","number","number","number","array","number","number","number"])}function NVe(e){let{backend:t,inputs:n,attrs:r}=e,{tensor:a,indices:s,updates:i}=n,o=t.makeOutput(a.shape,a.dtype);if($.sizeFromShape(a.shape)===0)return o;let{sliceRank:l,numUpdates:h,sliceSize:c,strides:p,outputSize:m}=iS.calculateShapes(i,s,a.shape),g=t.dataIdMap.get(s.dataId).id,b=t.dataIdMap.get(i.dataId).id,v=t.dataIdMap.get(a.dataId).id,x=new Uint8Array(new Int32Array(p).buffer),_=t.dataIdMap.get(o.dataId).id;return h8(g,b,tn[i.dtype],l,h,c,x,m,_,v),o}var CVe={kernelName:Ag,backendName:"wasm",setupFunc:EVe,kernelFunc:NVe},d8;function AVe(e){d8=e.wasm.cwrap(Uc,null,["number","array","number","array","number","number"])}function RVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,s=n.dataIdMap.get(a.dataId).id,{reps:i}=r,o=new Array(a.shape.length);for(let m=0;m<o.length;m++)o[m]=a.shape[m]*i[m];let l=new Uint8Array(new Int32Array(a.shape).buffer),h=new Uint8Array(new Int32Array(o).buffer),c=n.makeOutput(o,a.dtype),p=n.dataIdMap.get(c.dataId).id;return d8(s,l,a.shape.length,h,o.length,tn[c.dtype],p),c}var DVe={kernelName:Uc,backendName:"wasm",setupFunc:AVe,kernelFunc:RVe},p8;function MVe(e){p8=e.wasm.cwrap(zg,null,["number","array","number","number","number","bool","number","number"])}var $Ve=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{k:a,sorted:s}=n,i=t.dataIdMap.get(r.dataId).id,o=new Uint8Array(new Int32Array(r.shape).buffer),l=r.shape.slice();l[l.length-1]=a;let h=t.makeOutput(l,r.dtype),c=t.dataIdMap.get(h.dataId).id,p=t.makeOutput(l,"int32"),m=t.dataIdMap.get(p.dataId).id;return p8(i,o,r.shape.length,tn[r.dtype],a,s,c,m),[h,p]},OVe={kernelName:zg,backendName:"wasm",setupFunc:MVe,kernelFunc:$Ve},f8;function FVe(e){f8=e.wasm.cwrap(Vg,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])}function PVe(e){let{backend:t,inputs:n,attrs:r}=e,{image:a,transforms:s}=n,{interpolation:i,fillMode:o,fillValue:l,outputShape:h}=r,[c,p,m,g]=a.shape,[b,v]=h??[p,m],x=[c,b,v,g],_=new Uint8Array(new Int32Array($.computeStrides(a.shape)).buffer),I=new Uint8Array(new Int32Array($.computeStrides(x)).buffer),k=t.makeOutput(x,a.dtype),E=t.dataIdMap.get(k.dataId).id,R=t.dataIdMap.get(a.dataId).id,U=t.dataIdMap.get(s.dataId).id,D=i==="nearest"?1:2,C;switch(o){case"constant":C=1;break;case"reflect":C=2;break;case"wrap":C=3;break;case"nearest":C=4;break;default:C=1;break}return f8(R,U,s.shape[0]>1,c,b,v,g,m,p,_,a.shape.length-1,I,x.length-1,D,C,l,E),k}var LVe={kernelName:Vg,backendName:"wasm",setupFunc:FVe,kernelFunc:PVe};function zVe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t,{outputValues:i,outputShape:o,indices:l}=tD(r.readSync(s.dataId),a,s.shape,s.dtype);return[r.makeOutput(o,s.dtype,void 0,i),r.makeOutput([l.length],"int32",void 0,l)]}var VVe={kernelName:Xv,backendName:"wasm",kernelFunc:zVe};function UVe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a.shape[s],o=a.shape.length,l=new Array(o-1),h=0;for(let g=0;g<o;g++)g!==s&&(l[h++]=a.shape[g]);let c=new Array(i),p=new Array(o).fill(0),m=a.shape.slice();m[s]=1;for(let g=0;g<c.length;g++)p[s]=g,c[g]=vd({inputs:{x:a},attrs:{begin:p,size:m},backend:n});return c.map(({dataId:g,dtype:b})=>({dataId:g,dtype:b,shape:l}))}var BVe={kernelName:Ug,backendName:"wasm",kernelFunc:UVe};function WVe(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}var jVe={kernelName:Bg,backendName:"wasm",kernelFunc:WVe},HVe=[FFe,PFe,LFe,zFe,VFe,WFe,QFe,e3e,t3e,n3e,r3e,a3e,s3e,i3e,o3e,c3e,v3e,p3e,g3e,S3e,C3e,D3e,M3e,O3e,F3e,P3e,V3e,U3e,j3e,q3e,Y3e,J3e,nPe,rPe,aPe,oPe,cPe,pPe,gPe,vPe,_Pe,TPe,NPe,RPe,$Pe,OPe,LPe,VPe,UPe,BPe,WPe,jPe,HPe,KPe,XPe,YPe,JPe,nLe,sLe,lLe,hLe,pLe,mLe,jFe,gLe,yLe,bLe,wLe,SLe,TLe,NLe,ALe,CLe,DLe,MLe,OLe,PLe,VLe,WLe,GLe,qLe,YLe,JLe,nze,sze,lze,hze,fze,mze,bze,Sze,Ize,Tze,kze,Cze,Dze,Oze,Pze,Vze,Bze,jze,Wq,qze,Yze,Jze,t4e,n4e,r4e,a4e,s4e,x3e,l4e,h4e,f4e,y4e,x4e,S4e,I4e,T4e,N4e,R4e,$4e,O4e,L4e,z4e,V4e,U4e,E3e,xze,B4e,j4e,q4e,Y4e,Z4e,eVe,rVe,sVe,iVe,oVe,lVe,hVe,fVe,gVe,bVe,xVe,wVe,IVe,TVe,kVe,CVe,DVe,OVe,LVe,KFe,VVe,BVe,jVe];for(let e of HVe)Qv(e);var uN=he();uN.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))}catch{return!1}});uN.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{if(uN.get("IS_NODE"))return!1;try{return new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}});var qL=Lc(kae()),GVe=Lc(Eae()),KL=Lc(Nae()),XL=qL.default||qL,qVe=KL.default||KL,m8=class extends Nv{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.initWithThreadsCount(g8),cN=this.wasm.tfjs.getThreadsCount(),this.dataIdMap=new b1(this,_i())}write(e,t,n){let r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){let t=$.now();return e(),{kernelMs:$.now()-t}}move(e,t,n,r,a){let s=this.dataIdNextNumber++;if(r==="string"){let h=t;this.dataIdMap.set(e,{id:s,stringBytes:h,shape:n,dtype:r,memoryOffset:null,refCount:a});return}let i=$.sizeFromShape(n),o=i*$.bytesPerElement(r),l=this.wasm._malloc(o)>>>0;this.dataIdMap.set(e,{id:s,memoryOffset:l,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(s,i,l),t!=null&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,o),l)}async read(e){return this.readSync(e)}readSync(e,t,n){let{memoryOffset:r,dtype:a,shape:s,stringBytes:i}=this.dataIdMap.get(e);if(a==="string")return(t==null||t===0)&&(n==null||n>=i.length)?i:i.slice(t,n);t=t||0,n=n||$.sizeFromShape(s);let o=$.bytesPerElement(a),l=this.wasm.HEAPU8.slice(r+t*o,r+n*o);return YVe(l.buffer,a)}disposeData(e,t=!1){if(this.dataIdMap.has(e)){let n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}incRef(e){let t=this.dataIdMap.get(e);t!=null&&t.refCount++}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n,r){let a;if(n==null)a=this.write(r??null,e,t);else{let s=this.dataIdNextNumber++;a={id:s},this.dataIdMap.set(a,{id:s,memoryOffset:n,shape:e,dtype:t,refCount:1});let i=$.sizeFromShape(e);this.wasm.tfjs.registerTensor(s,i,n)}return{dataId:a,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){let r=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),s=$.sizeFromShape(e);switch(t){case"float32":return new Float32Array(r,a,s);case"int32":return new Int32Array(r,a,s);case"bool":return new Uint8Array(r,a,s);default:throw new Error(`Unknown dtype ${t}`)}}};function KVe(e){return(t,n)=>($.fetch(e,{credentials:"same-origin"}).then(r=>{r.ok||t.env.a(`failed to load wasm binary file at '${e}'`),r.arrayBuffer().then(a=>{WebAssembly.instantiate(a,t).then(s=>{n(s.instance,s.module)})})}),{})}function YL(e,t,n){if(F_!=null)return F_;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),Db!=null&&Db[r]!=null?Db[r]:n+r}async function XVe(){let[e,t]=await Promise.all([he().getAsync("WASM_HAS_SIMD_SUPPORT"),he().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,r)=>{let a={};a.locateFile=(o,l)=>{if(o.endsWith(".worker.js")){let h=GVe.wasmWorkerContents.replace(/\n/g,"\\n"),c=new Blob([h],{type:"application/javascript"});return URL.createObjectURL(c)}return o.endsWith(".wasm")?YL(e,t,_b??l):l+o},_D&&(a.instantiateWasm=KVe(YL(e,t,_b??"")));let s=!1;a.onAbort=()=>{s||Mb||(Mb=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))};let i;t&&e&&F_==null?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+XL.toString()],{type:"text/javascript"}),i=XL(a)):i=qVe(a),i.then(o=>{s=!0,Mb=!1;let l=null;o.tfjs={init:o.cwrap("init",null,[]),initWithThreadsCount:o.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:o.cwrap("get_threads_count","number",[]),registerTensor:o.cwrap("register_tensor",null,["number","number","number"]),disposeData:o.cwrap("dispose_data",l,["number"]),dispose:o.cwrap("dispose",l,[])},n({wasm:o})}).catch(r)})}function YVe(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error(`Unknown dtype ${t}`)}}var QVe=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],F_=null,_b=null,Db={},Mb=!1,_D=!1;function ZVe(e,t=!1){if(PU("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),Mb)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");F_=e,_D=t}function JVe(e,t=!1){if(Mb)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if(typeof e=="string")_b=e;else{Db=e;let n=QVe.filter(r=>Db[r]==null);if(n.length>0)throw new Error(`There were no entries found for the following binaries: ${n.join(",")}. Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.`)}_D=t}var g8=-1,cN=-1;function eUe(e){g8=e}function tUe(){if(cN===-1)throw new Error("WASM backend not initialized.");return cN}var nUe="4.22.0",rUe=2;F1("wasm",async()=>{let{wasm:e}=await XVe();return new m8(e)},rUe);var QL="4.22.0",aUe="4.22.0",sUe="4.22.0",iUe="4.22.0",oUe="4.22.0",lUe={tfjs:QL,"tfjs-core":QL,"tfjs-converter":aUe,"tfjs-backend-cpu":sUe,"tfjs-backend-webgl":iUe,"tfjs-backend-wasm":oUe},uUe={};A2(uUe,{AnchorPosition:()=>D8,DrawBox:()=>O8,DrawBoxOptions:()=>$8,DrawFaceLandmarks:()=>Z8,DrawFaceLandmarksOptions:()=>Q8,DrawTextField:()=>CD,DrawTextFieldOptions:()=>ND,drawContour:()=>Uu,drawDetections:()=>_Ue,drawFaceExpressions:()=>OUe,drawFaceLandmarks:()=>PUe});function Uu(e,t,n=!1){if(e.beginPath(),t.slice(1).forEach(({x:r,y:a},s)=>{let i=t[s];e.moveTo(i.x,i.y),e.lineTo(r,a)}),n){let r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}var cUe={};A2(cUe,{computeReshapedDimensions:()=>x8,getCenterPoint:()=>ID,isDimensions:()=>dN,isEven:()=>hN,isFloat:()=>v8,isTensor:()=>cy,isTensor1D:()=>hUe,isTensor2D:()=>b8,isTensor3D:()=>Ax,isTensor4D:()=>Bl,isValidNumber:()=>Gh,isValidProbablitiy:()=>dUe,range:()=>Am,round:()=>SD});var im=class y8{constructor(t,n){if(!Gh(t)||!Gh(n))throw new Error(`Dimensions.constructor - expected width and height to be valid numbers, instead have ${JSON.stringify({width:t,height:n})}`);this._width=t,this._height=n}get width(){return this._width}get height(){return this._height}reverse(){return new y8(1/this.width,1/this.height)}};function cy(e,t){return e instanceof Tt&&e.shape.length===t}function hUe(e){return cy(e,1)}function b8(e){return cy(e,2)}function Ax(e){return cy(e,3)}function Bl(e){return cy(e,4)}function v8(e){return e%1!==0}function hN(e){return e%2===0}function SD(e,t=2){let n=10**t;return Math.floor(e*n)/n}function dN(e){return e&&e.width&&e.height}function x8({width:e,height:t},n){let r=n/Math.max(t,e);return new im(Math.round(e*r),Math.round(t*r))}function ID(e){return e.reduce((t,n)=>t.add(n),new wn(0,0)).div(new wn(e.length,e.length))}function Am(e,t,n){return Array(e).fill(0).map((r,a)=>t+a*n)}function Gh(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||e===0}function dUe(e){return Gh(e)&&e>=0&&e<=1}var wn=class Ah{constructor(t,n){this._x=t,this._y=n}get x(){return this._x}get y(){return this._y}add(t){return new Ah(this.x+t.x,this.y+t.y)}sub(t){return new Ah(this.x-t.x,this.y-t.y)}mul(t){return new Ah(this.x*t.x,this.y*t.y)}div(t){return new Ah(this.x/t.x,this.y/t.y)}abs(){return new Ah(Math.abs(this.x),Math.abs(this.y))}magnitude(){return Math.sqrt(this.x**2+this.y**2)}floor(){return new Ah(Math.floor(this.x),Math.floor(this.y))}},xd=class Wi{static isRect(t){return!!t&&[t.x,t.y,t.width,t.height].every(Gh)}static assertIsValidBox(t,n,r=!1){if(!Wi.isRect(t))throw new Error(`${n} - invalid box: ${JSON.stringify(t)}, expected object with properties x, y, width, height`);if(!r&&(t.width<0||t.height<0))throw new Error(`${n} - width (${t.width}) and height (${t.height}) must be positive numbers`)}constructor(t,n=!0){let r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Gh),s=[r.x,r.y,r.width,r.height].every(Gh);if(!s&&!a)throw new Error(`Box.constructor - expected box to be IBoundingBox | IRect, instead have ${JSON.stringify(r)}`);let[i,o,l,h]=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top];Wi.assertIsValidBox({x:i,y:o,width:l,height:h},"Box.constructor",n),this._x=i,this._y=o,this._width=l,this._height=h}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get area(){return this.width*this.height}get topLeft(){return new wn(this.left,this.top)}get topRight(){return new wn(this.right,this.top)}get bottomLeft(){return new wn(this.left,this.bottom)}get bottomRight(){return new wn(this.right,this.bottom)}round(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.round(s));return new Wi({x:t,y:n,width:r,height:a})}floor(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.floor(s));return new Wi({x:t,y:n,width:r,height:a})}toSquare(){let{x:t,y:n,width:r,height:a}=this,s=Math.abs(r-a);return r<a&&(t-=s/2,r+=s),a<r&&(n-=s/2,a+=s),new Wi({x:t,y:n,width:r,height:a})}rescale(t){let n=dN(t)?t.width:t,r=dN(t)?t.height:t;return new Wi({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}pad(t,n){let[r,a,s,i]=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new Wi({x:r,y:a,width:s,height:i})}clipAtImageBorders(t,n){let{x:r,y:a,right:s,bottom:i}=this,o=Math.max(r,0),l=Math.max(a,0),h=s-o,c=i-l,p=Math.min(h,t-o),m=Math.min(c,n-l);return new Wi({x:o,y:l,width:p,height:m}).floor()}shift(t,n){let{width:r,height:a}=this,s=this.x+t,i=this.y+n;return new Wi({x:s,y:i,width:r,height:a})}padAtBorders(t,n){let r=this.width+1,a=this.height+1,s=1,i=1,o=r,l=a,h=this.left,c=this.top,p=this.right,m=this.bottom;return p>n&&(o=-p+n+r,p=n),m>t&&(l=-m+t+a,m=t),h<1&&(l=2-h,h=1),c<1&&(l=2-c,c=1),{dy:i,edy:l,dx:s,edx:o,y:c,ey:m,x:h,ex:p,w:r,h:a}}calibrate(t){return new Wi({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}},w8=class extends xd{constructor(e,t,n,r,a=!1){super({left:e,top:t,right:n,bottom:r},a)}},_8=class S8{constructor(t,n,r,a,s){this._imageDims=new im(s.width,s.height),this._score=t,this._classScore=n,this._className=r,this._box=new xd(a).rescale(this._imageDims)}get score(){return this._score}get classScore(){return this._classScore}get className(){return this._className}get box(){return this._box}get imageDims(){return this._imageDims}get imageWidth(){return this.imageDims.width}get imageHeight(){return this.imageDims.height}get relativeBox(){return new xd(this._box).rescale(this.imageDims.reverse())}forSize(t,n){return new S8(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}},ao=class I8 extends _8{constructor(t,n,r){super(t,t,"",n,r)}forSize(t,n){let{score:r,relativeBox:a,imageDims:s}=super.forSize(t,n);return new I8(r,a,s)}};function pUe(e,t,n=!0){let r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),s=r*a;return n?s/(e.area+t.area-s):s/Math.min(e.area,t.area)}function fUe(e){let t=e.map(o=>o.x),n=e.map(o=>o.y),r=t.reduce((o,l)=>l<o?l:o,1/0),a=n.reduce((o,l)=>l<o?l:o,1/0),s=t.reduce((o,l)=>o<l?l:o,0),i=n.reduce((o,l)=>o<l?l:o,0);return new w8(r,a,s,i)}function mUe(e,t,n,r=!0){let a=t.map((i,o)=>({score:i,boxIndex:o})).sort((i,o)=>i.score-o.score).map(i=>i.boxIndex),s=[];for(;a.length>0;){let i=a.pop();s.push(i);let o=a,l=[];for(let h=0;h<o.length;h++){let c=o[h],p=e[i],m=e[c];l.push(pUe(p,m,r))}a=a.filter((h,c)=>l[c]<=n)}return s}function Rx(e,t){return oe(()=>{let[n,r,a]=t,s=Ds([...e.shape.slice(0,3),1],n,"float32"),i=Ds([...e.shape.slice(0,3),1],r,"float32"),o=Ds([...e.shape.slice(0,3),1],a,"float32"),l=Sn([s,i,o],3);return Ge(e,l)})}function gUe(e,t=!1){return oe(()=>{let[n,r]=e.shape.slice(1);if(n===r)return e;let a=Math.abs(n-r),s=Math.round(a*(t?.5:1)),i=n>r?2:1,o=p=>{let m=e.shape.slice();return m[i]=p,Ds(m,0,"float32")},l=o(s),h=a-l.shape[i],c=[t&&h?o(h):null,e,l].filter(p=>!!p).map(p=>ze(p,"float32"));return Sn(c,i)})}function Tk(e){return 1/(1+Math.exp(-e))}var T8=class extends xd{constructor(e,t,n,r,a=!1){super({x:e,y:t,width:n,height:r},a)}},yUe=.5,bUe=.43,vUe=.45,P_=class{constructor(e,t,n=new wn(0,0)){let{width:r,height:a}=t;this._imgDims=new im(r,a),this._shift=n,this._positions=e.map(s=>s.mul(new wn(r,a)).add(n))}get shift(){return new wn(this._shift.x,this._shift.y)}get imageWidth(){return this._imgDims.width}get imageHeight(){return this._imgDims.height}get positions(){return this._positions}get relativePositions(){return this._positions.map(e=>e.sub(this._shift).div(new wn(this.imageWidth,this.imageHeight)))}forSize(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}shiftBy(e,t){return new this.constructor(this.relativePositions,this._imgDims,new wn(e,t))}shiftByPoint(e){return this.shiftBy(e.x,e.y)}align(e,t={}){if(e){let a=e instanceof ao?e.box.floor():new xd(e);return this.shiftBy(a.x,a.y).align(null,t)}let{useDlibAlignment:n,minBoxPadding:r}={useDlibAlignment:!1,minBoxPadding:.2,...t};return n?this.alignDlib():this.alignMinBbox(r)}alignDlib(){let e=this.getRefPointsForAlignment(),[t,n,r]=e,a=c=>r.sub(c).magnitude(),s=(a(t)+a(n))/2,i=Math.floor(s/vUe),o=ID(e),l=Math.floor(Math.max(0,o.x-yUe*i)),h=Math.floor(Math.max(0,o.y-bUe*i));return new T8(l,h,Math.min(i,this.imageWidth+l),Math.min(i,this.imageHeight+h))}alignMinBbox(e){let t=fUe(this.positions);return t.pad(t.width*e,t.height*e)}getRefPointsForAlignment(){throw new Error("getRefPointsForAlignment not implemented by base class")}},k8=class extends P_{getJawOutline(){return this.positions.slice(0,17)}getLeftEyeBrow(){return this.positions.slice(17,22)}getRightEyeBrow(){return this.positions.slice(22,27)}getNose(){return this.positions.slice(27,36)}getLeftEye(){return this.positions.slice(36,42)}getRightEye(){return this.positions.slice(42,48)}getMouth(){return this.positions.slice(48,68)}getRefPointsForAlignment(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(ID)}};function L_(e){return e.detection instanceof ao}function E8(e,t){return{...e,detection:t}}function N8(){let e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:()=>document.createElement("canvas"),createImageElement:()=>document.createElement("img"),createVideoElement:()=>document.createElement("video"),fetch:e,readFile:()=>{throw new Error("readFile - filesystem not available for browser environment")}}}function TD(){return typeof global=="object"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null}function C8(e){let t="";if(!e&&TD())try{e=aae("fs")}catch(n){t=n.toString()}return{readFile:e?n=>new Promise((r,a)=>{e.readFile(n,(s,i)=>s?a(s):r(i))}):()=>{throw new Error(`readFile - failed to require fs in nodejs environment with error: ${t}`)}}}function A8(){let e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.Video||global.HTMLVideoElement,r=()=>{if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},a=()=>{if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=()=>{if(n)return new n;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},i=global.fetch,o=C8();return{Canvas:e||class{},CanvasRenderingContext2D:global.CanvasRenderingContext2D||class{},Image:t||class{},ImageData:global.ImageData||class{},Video:global.HTMLVideoElement||class{},createCanvasElement:r,createImageElement:a,createVideoElement:s,fetch:i,...o}}function R8(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var Yr;function xUe(){if(!Yr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Yr}function pN(e){Yr=e}function kD(){return R8()?pN(N8()):TD()?pN(A8()):null}function wUe(e){if(Yr||kD(),!Yr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");let{Canvas:t=Yr.Canvas,Image:n=Yr.Image}=e;Yr.Canvas=t,Yr.Image=n,Yr.createCanvasElement=e.createCanvasElement||(()=>new t),Yr.createImageElement=e.createImageElement||(()=>new n),Yr.ImageData=e.ImageData||Yr.ImageData,Yr.Video=e.Video||Yr.Video,Yr.fetch=e.fetch||Yr.fetch,Yr.readFile=e.readFile||Yr.readFile}var hs={getEnv:xUe,setEnv:pN,initialize:kD,createBrowserEnv:N8,createFileSystem:C8,createNodejsEnv:A8,monkeyPatch:wUe,isBrowser:R8,isNodejs:TD};kD();function ED(e){return!hs.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Ac(e){let{Canvas:t,CanvasRenderingContext2D:n}=hs.getEnv();if(e instanceof n)return e;let r=ED(e);if(!(r instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");let a=r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var D8=(e=>(e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e))(D8||{}),ND=class{constructor(e={}){let{anchorPosition:t,backgroundColor:n,fontColor:r,fontSize:a,fontStyle:s,padding:i}=e;this.anchorPosition=t||"TOP_LEFT",this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=s||"Georgia",this.padding=i||4}},CD=class M8{constructor(t,n,r={}){this.text=typeof t=="string"?[t]:t instanceof M8?t.text:t,this.anchor=n,this.options=new ND(r)}measureWidth(t){let{padding:n}=this.options;return this.text.map(r=>t.measureText(r).width).reduce((r,a)=>r<a?a:r,0)+2*n}measureHeight(){let{fontSize:t,padding:n}=this.options;return this.text.length*t+2*n}getUpperLeft(t,n){let{anchorPosition:r}=this.options,a=r==="BOTTOM_RIGHT"||r==="TOP_RIGHT",s=r==="BOTTOM_LEFT"||r==="BOTTOM_RIGHT",i=this.measureWidth(t),o=this.measureHeight(),l=a?this.anchor.x-i:this.anchor.x,h=s?this.anchor.y-o:this.anchor.y;if(n){let{width:c,height:p}=n,m=Math.max(Math.min(l,c-i),0),g=Math.max(Math.min(h,p-o),0);return{x:m,y:g}}return{x:l,y:h}}draw(t){let n=ED(t),r=Ac(n),{backgroundColor:a,fontColor:s,fontSize:i,fontStyle:o,padding:l}=this.options;r.font=`${i}px ${o}`;let h=this.measureWidth(r),c=this.measureHeight();r.fillStyle=a;let p=this.getUpperLeft(r,n);r.fillRect(p.x,p.y,h,c),r.fillStyle=s,this.text.forEach((m,g)=>{let b=l+p.x,v=l+p.y+(g+1)*i;r.fillText(m,b,v)})}},$8=class{constructor(e={}){let{boxColor:t,lineWidth:n,label:r,drawLabelOptions:a}=e;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;let s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new ND({...s,...a})}},O8=class{constructor(e,t={}){this.box=new xd(e),this.options=new $8(t)}draw(e){let t=Ac(e),{boxColor:n,lineWidth:r}=this.options,{x:a,y:s,width:i,height:o}=this.box;t.strokeStyle=n,t.lineWidth=r,t.strokeRect(a,s,i,o);let{label:l}=this.options;l&&new CD([l],{x:a-r/2,y:s},this.options.drawLabelOptions).draw(e)}};function _Ue(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof ao?n.score:L_(n)?n.detection.score:void 0,a=n instanceof ao?n.box:L_(n)?n.detection.box:new xd(n),s=r?`${SD(r)}`:void 0;new O8(a,{label:s}).draw(e)})}function F8(e){let{Image:t,Video:n}=hs.getEnv();return e instanceof t&&e.complete||e instanceof n&&e.readyState>=3}function SUe(e){return new Promise((t,n)=>{if(e instanceof hs.getEnv().Canvas||F8(e)){t(null);return}function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),n(s))}function a(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),t(s))}e.addEventListener("load",a),e.addEventListener("error",r)})}function P8(e){let{Image:t,Video:n}=hs.getEnv();return e instanceof t?new im(e.naturalWidth,e.naturalHeight):e instanceof n?new im(e.videoWidth,e.videoHeight):new im(e.width,e.height)}function z_({width:e,height:t}){let{createCanvasElement:n}=hs.getEnv(),r=n();return r.width=e,r.height=t,r}function L8(e,t){let{ImageData:n}=hs.getEnv();if(!(e instanceof n)&&!F8(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");let{width:r,height:a}=P8(e),s=z_({width:r,height:a});return e instanceof n?Ac(s).putImageData(e,0,0):Ac(s).drawImage(e,0,0,r,a),s}async function IUe(e,t){let n=t||hs.getEnv().createCanvasElement(),[r,a,s]=e.shape.slice(Bl(e)?1:0),i=oe(()=>e.as3D(r,a,s).toInt());return await gx.toPixels(i,n),i.dispose(),n}function ZL(e){let{Image:t,Canvas:n,Video:r}=hs.getEnv();return e instanceof t||e instanceof n||e instanceof r}function TUe(e,t,n=!1){let{Image:r,Canvas:a}=hs.getEnv();if(!(e instanceof r||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return z_({width:1,height:1});let s=P8(e),i=t/Math.max(s.height,s.width),o=i*s.width,l=i*s.height,h=z_({width:t,height:t}),c=e instanceof a?e:L8(e),p=Math.abs(o-l)/2,m=n&&o<l?p:0,g=n&&l<o?p:0;return c.width>0&&c.height>0&&Ac(h).drawImage(c,m,g,o,l),h}var V_=class{constructor(e,t=!1){if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(e))throw new Error(`NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ${e}`);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((n,r)=>{if(Ax(n)){this._imageTensors[r]=n,this._inputDimensions[r]=n.shape;return}if(Bl(n)){let s=n.shape[0];if(s!==1)throw new Error(`NetInput - tf.Tensor4D with batchSize ${s} passed, but not supported in input array`);this._imageTensors[r]=n,this._inputDimensions[r]=n.shape.slice(1);return}let a=n instanceof hs.getEnv().Canvas?n:L8(n);this._canvases[r]=a,this._inputDimensions[r]=[a.height,a.width,3]})}get imageTensors(){return this._imageTensors}get canvases(){return this._canvases}get isBatchInput(){return this.batchSize>1||this._treatAsBatchInput}get batchSize(){return this._batchSize}get inputDimensions(){return this._inputDimensions}get inputSize(){return this._inputSize}get reshapedInputDimensions(){return Am(this.batchSize,0,1).map((e,t)=>this.getReshapedInputDimensions(t))}getInput(e){return this.canvases[e]||this.imageTensors[e]}getInputDimensions(e){return this._inputDimensions[e]}getInputHeight(e){return this._inputDimensions[e][0]}getInputWidth(e){return this._inputDimensions[e][1]}getReshapedInputDimensions(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");let t=this.getInputWidth(e),n=this.getInputHeight(e);return x8({width:t,height:n},this.inputSize)}toBatchTensor(e,t=!0){return this._inputSize=e,oe(()=>{let n=Am(this.batchSize,0,1).map(r=>{let a=this.getInput(r);if(a instanceof Tt){let s=Bl(a)?a:ea(a);return s=gUe(s,t),(s.shape[1]!==e||s.shape[2]!==e)&&(s=Xs.resizeBilinear(s,[e,e],!1,!1)),s.as3D(e,e,3)}if(a instanceof hs.getEnv().Canvas)return gx.fromPixels(TUe(a,e,t));throw new Error(`toBatchTensor - at batchIdx ${r}, expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ${a}`)});return Nr(n.map(r=>ze(r,"float32"))).as4D(this.batchSize,e,e,3)})}};async function Ga(e){if(e instanceof V_)return e;let t=Array.isArray(e)?e:[e];if(!t.length)throw new Error("toNetInput - empty array passed as input");let n=a=>Array.isArray(e)?` at input index ${a}:`:"",r=t.map(ED);return r.forEach((a,s)=>{if(!ZL(a)&&!Ax(a)&&!Bl(a))throw typeof t[s]=="string"?new Error(`toNetInput -${n(s)} string passed, but could not resolve HTMLElement for element id ${t[s]}`):new Error(`toNetInput -${n(s)} expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id`);if(Bl(a)){let i=a.shape[0];if(i!==1)throw new Error(`toNetInput -${n(s)} tf.Tensor4D with batchSize ${i} passed, but not supported in input array`)}}),await Promise.all(r.map(a=>ZL(a)&&SUe(a))),new V_(r,Array.isArray(e))}async function AD(e,t){let{Canvas:n}=hs.getEnv(),r=e;if(!(e instanceof n)){let s=await Ga(e);if(s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");let i=s.getInput(0);r=i instanceof n?i:await IUe(i)}let a=Ac(r);return t.map(s=>s instanceof ao?s.forSize(r.width,r.height).box.floor():s).map(s=>s.clipAtImageBorders(r.width,r.height)).map(({x:s,y:i,width:o,height:l})=>{let h=z_({width:o,height:l});return o>0&&l>0&&Ac(h).putImageData(a.getImageData(s,i,o,l),0,0),h})}async function RD(e,t){if(!Ax(e)&&!Bl(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Bl(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return oe(()=>{let[n,r,a]=e.shape.slice(Bl(e)?1:0);return t.map(s=>s instanceof ao?s.forSize(r,n).box:s).map(s=>s.clipAtImageBorders(r,n)).filter(s=>s.width>0&&s.height>0).map(({x:s,y:i,width:o,height:l})=>Yg(e.as3D(n,r,a),[i,s,0],[l,o,a]))})}async function kUe(e,t){let{fetch:n}=hs.getEnv(),r=await n(e,t);if(!(r.status<400))throw new Error(`failed to fetch: (${r.status}) ${r.statusText}, from url: ${r.url}`);return r}async function EUe(e){return(await kUe(e)).json()}function z8(e,t){let n=`${t}-weights_manifest.json`;if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:`/${n}`};let r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");let a=e.split("/").filter(o=>o),s=e.endsWith(".json")?a[a.length-1]:n,i=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return i=e.startsWith("/")?`/${i}`:i,{modelBaseUri:i,manifestUri:i==="/"?`/${s}`:`${i}/${s}`}}async function NUe(e,t){let{manifestUri:n,modelBaseUri:r}=z8(e,t),a=await EUe(n);return ma.loadWeights(a,r)}var Zc=class{constructor(e){this._params=void 0,this._paramMappings=[],this._name=e}get params(){return this._params}get paramMappings(){return this._paramMappings}get isLoaded(){return!!this.params}getParamFromPath(e){let{obj:t,objProp:n}=this.traversePropertyPath(e);return t[n]}reassignParamFromPath(e,t){let{obj:n,objProp:r}=this.traversePropertyPath(e);n[r].dispose(),n[r]=t}getParamList(){return this._paramMappings.map(({paramPath:e})=>({path:e,tensor:this.getParamFromPath(e)}))}getTrainableParams(){return this.getParamList().filter(e=>e.tensor instanceof ad)}getFrozenParams(){return this.getParamList().filter(e=>!(e.tensor instanceof ad))}variable(){this.getFrozenParams().forEach(({path:e,tensor:t})=>{this.reassignParamFromPath(e,t.variable())})}freeze(){this.getTrainableParams().forEach(({path:e,tensor:t})=>{let n=Ba(t.dataSync());t.dispose(),this.reassignParamFromPath(e,n)})}dispose(e=!0){this.getParamList().forEach(t=>{if(e&&t.tensor.isDisposed)throw new Error(`param tensor has already been disposed for path ${t.path}`);t.tensor.dispose()}),this._params=void 0}serializeParams(){return new Float32Array(this.getParamList().map(({tensor:e})=>Array.from(e.dataSync())).reduce((e,t)=>e.concat(t)))}async load(e){if(e instanceof Float32Array){this.extractWeights(e);return}await this.loadFromUri(e)}async loadFromUri(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromUri - expected model uri`);let t=await NUe(e,this.getDefaultModelName());this.loadFromWeightMap(t)}async loadFromDisk(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromDisk - expected model file path`);let{readFile:t}=hs.getEnv(),{manifestUri:n,modelBaseUri:r}=z8(e,this.getDefaultModelName()),a=l=>Promise.all(l.map(h=>t(h).then(c=>typeof c=="string"?Buffer.from(c):c.buffer))),s=ma.weightsLoaderFactory(a),i=JSON.parse((await t(n)).toString()),o=await s(i,r);this.loadFromWeightMap(o)}loadFromWeightMap(e){let{paramMappings:t,params:n}=this.extractParamsFromWeightMap(e);this._paramMappings=t,this._params=n}extractWeights(e){let{paramMappings:t,params:n}=this.extractParams(e);this._paramMappings=t,this._params=n}traversePropertyPath(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");let t=e.split("/").reduce((a,s)=>{if(!a.nextObj.hasOwnProperty(s))throw new Error(`traversePropertyPath - object does not have property ${s}, for path ${e}`);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),{obj:n,objProp:r}=t;if(!n||!r||!(n[r]instanceof Tt))throw new Error(`traversePropertyPath - parameter is not a tensor, for path ${e}`);return{obj:n,objProp:r}}};function Zs(e,t,n){return oe(()=>{let r=Xg(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Se(r,t.bias),r})}function kk(e,t,n=!1){return oe(()=>{let r=fn(n?Se(ja(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Zs(e,t.conv0,[2,2])),a=Zs(r,t.conv1,[1,1]),s=fn(Se(r,a)),i=Zs(s,t.conv2,[1,1]);return fn(Se(r,Se(a,i)))})}function g0(e,t,n=!1,r=!0){return oe(()=>{let a=fn(n?Se(ja(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Zs(e,t.conv0,r?[2,2]:[1,1])),s=Zs(a,t.conv1,[1,1]),i=fn(Se(a,s)),o=Zs(i,t.conv2,[1,1]),l=fn(Se(a,Se(s,o))),h=Zs(l,t.conv3,[1,1]);return fn(Se(a,Se(s,Se(o,h))))})}function $b(e,t,n="same",r=!1){return oe(()=>{let a=Se(ja(e,t.filters,[1,1],n),t.bias);return r?fn(a):a})}function Jc(e,t){Object.keys(e).forEach(n=>{t.some(r=>r.originalPath===n)||e[n].dispose()})}function DD(e,t){return(n,r,a,s)=>{let i=Sc(e(n*r*a*a),[a,a,n,r]),o=dn(e(r));return t.push({paramPath:`${s}/filters`},{paramPath:`${s}/bias`}),{filters:i,bias:o}}}function V8(e,t){return(n,r,a)=>{let s=Bo(e(n*r),[n,r]),i=dn(e(r));return t.push({paramPath:`${a}/weights`},{paramPath:`${a}/bias`}),{weights:s,bias:i}}}var U8=class{constructor(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}};function MD(e,t){return(n,r,a)=>{let s=Sc(e(9*n),[3,3,n,1]),i=Sc(e(n*r),[1,1,n,r]),o=dn(e(r));return t.push({paramPath:`${a}/depthwise_filter`},{paramPath:`${a}/pointwise_filter`},{paramPath:`${a}/bias`}),new U8(s,i,o)}}function $D(e){return t=>{let n=e(`${t}/depthwise_filter`,4),r=e(`${t}/pointwise_filter`,4),a=e(`${t}/bias`,1);return new U8(n,r,a)}}function tf(e,t){return(n,r,a)=>{let s=e[n];if(!cy(s,r))throw new Error(`expected weightMap[${n}] to be a Tensor${r}D, instead have ${s}`);return t.push({originalPath:n,paramPath:a||n}),s}}function eh(e){let t=e;function n(a){let s=t.slice(0,a);return t=t.slice(a),s}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function B8(e,t){let n=DD(e,t),r=MD(e,t);function a(i,o,l,h=!1){let c=h?n(i,o,3,`${l}/conv0`):r(i,o,`${l}/conv0`),p=r(o,o,`${l}/conv1`),m=r(o,o,`${l}/conv2`);return{conv0:c,conv1:p,conv2:m}}function s(i,o,l,h=!1){let{conv0:c,conv1:p,conv2:m}=a(i,o,l,h),g=r(o,o,`${l}/conv3`);return{conv0:c,conv1:p,conv2:m,conv3:g}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function CUe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=eh(e),{extractDenseBlock4Params:a}=B8(n,t),s=a(3,32,"dense0",!0),i=a(32,64,"dense1"),o=a(64,128,"dense2"),l=a(128,256,"dense3");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:o,dense3:l}}}function W8(e){return t=>{let n=e(`${t}/filters`,4),r=e(`${t}/bias`,1);return{filters:n,bias:r}}}function j8(e,t){let n=tf(e,t),r=W8(n),a=$D(n);function s(o,l=!1){let h=l?r(`${o}/conv0`):a(`${o}/conv0`),c=a(`${o}/conv1`),p=a(`${o}/conv2`);return{conv0:h,conv1:c,conv2:p}}function i(o,l=!1){let h=l?r(`${o}/conv0`):a(`${o}/conv0`),c=a(`${o}/conv1`),p=a(`${o}/conv2`),m=a(`${o}/conv3`);return{conv0:h,conv1:c,conv2:p,conv3:m}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:i}}function AUe(e){let t=[],{extractDenseBlock4Params:n}=j8(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Jc(e,t),{params:r,paramMappings:t}}var H8=class extends Zc{constructor(){super("FaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return oe(()=>{let n=ze(e.toBatchTensor(112,!0),"float32"),r=Rx(n,[122.782,117.001,104.298]).div(255),a=g0(r,t.dense0,!0);return a=g0(a,t.dense1),a=g0(a,t.dense2),a=g0(a,t.dense3),a=eu(a,[7,7],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await Ga(e))}getDefaultModelName(){return"face_feature_extractor_model"}extractParamsFromWeightMap(e){return AUe(e)}extractParams(e){return CUe(e)}};function fN(e,t){return oe(()=>Se(Nt(e,t.weights),t.bias))}function RUe(e,t,n){let r=[],{extractWeights:a,getRemainingWeights:s}=eh(e),i=V8(a,r)(t,n,"fc");if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{paramMappings:r,params:{fc:i}}}function DUe(e){let t=[],n=tf(e,t);function r(s){let i=n(`${s}/weights`,2),o=n(`${s}/bias`,1);return{weights:i,bias:o}}let a={fc:r("fc")};return Jc(e,t),{params:a,paramMappings:t}}function G8(e){let t={},n={};return Object.keys(e).forEach(r=>{let a=r.startsWith("fc")?n:t;a[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var q8=class extends Zc{constructor(e,t){super(e),this._faceFeatureExtractor=t}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return oe(()=>{let n=e instanceof V_?this.faceFeatureExtractor.forwardInput(e):e;return fN(n.as2D(n.shape[0],-1),t.fc)})}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return RUe(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=G8(e);return this.faceFeatureExtractor.loadFromWeightMap(t),DUe(n)}extractParams(e){let t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),s=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)}},JL=["neutral","happy","sad","angry","fearful","disgusted","surprised"],OD=class{constructor(e){if(this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,e.length!==7)throw new Error(`FaceExpressions.constructor - expected probabilities.length to be 7, have: ${e.length}`);JL.forEach((t,n)=>{this[t]=e[n]})}asSortedArray(){return JL.map(e=>({expression:e,probability:this[e]})).sort((e,t)=>t.probability-e.probability)}},MUe=class extends q8{constructor(e=new H8){super("FaceExpressionNet",e)}forwardInput(e){return oe(()=>Gc(this.runNet(e)))}async forward(e){return this.forwardInput(await Ga(e))}async predictExpressions(e){let t=await Ga(e),n=await this.forwardInput(t),r=await Promise.all(or(n).map(async s=>{let i=s.dataSync();return s.dispose(),i}));n.dispose();let a=r.map(s=>new OD(s));return t.isBatchInput?a:a[0]}getDefaultModelName(){return"face_expression_model"}getClassifierChannelsIn(){return 256}getClassifierChannelsOut(){return 7}};function $Ue(e){return e.expressions instanceof OD}function K8(e,t){return{...e,expressions:t}}function OUe(e,t,n=.1,r){(Array.isArray(t)?t:[t]).forEach(a=>{let s=a instanceof OD?a:$Ue(a)?a.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");let i=s.asSortedArray().filter(l=>l.probability>n),o=L_(a)?a.detection.box.bottomLeft:r||new wn(0,0);new CD(i.map(l=>`${l.expression} (${SD(l.probability)})`),o).draw(e)})}function X8(e){return L_(e)&&e.landmarks instanceof P_&&e.unshiftedLandmarks instanceof P_&&e.alignedRect instanceof ao}function FUe(e){let t=l=>l*180/Math.PI,n=(l,h)=>Math.sqrt((l.x-h.x)**2+(l.y-h.y)**2),r={roll:void 0,pitch:void 0,yaw:void 0},a=(l,h,c)=>{let p=Math.floor(l.x-h.x),m=Math.floor(h.x-c.x);return p-m},s=(l,h)=>{let c=Math.hypot(h.x-l.x,h.y-l.y),p=h.y-l.y,m=Math.asin(p/c),g=t(m),b=Math.floor(90-g),v=h.x-l.x<0?-1:1;return b*v},i=(l,h,c)=>{let p=n(l,c),m=new wn((l.x+c.x)/2,(l.y+c.y)/2),g=n(h,m),b=Math.atan(g/p),v=Math.floor(t(b)),x=m.y-h.y<0?-1:1;return v*x};if(!e||!e.positions||e.positions.length!==68)return r;let o=e.positions;return r.roll=s(o[27],o[66]),r.pitch=i(o[14],o[30],o[2]),r.yaw=a(o[14],o[33],o[2]),r}function Y8(e,t){let{box:n}=e.detection,r=t.shiftBy(n.x,n.y),a=r.align(),{imageDims:s}=e.detection,i=new ao(e.detection.score,a.rescale(s.reverse()),s),o=FUe(t);return{...e,landmarks:r,unshiftedLandmarks:t,alignedRect:i,angle:o}}var Q8=class{constructor(e={}){let{drawLines:t=!0,drawPoints:n=!0,lineWidth:r,lineColor:a,pointSize:s,pointColor:i}=e;this.drawLines=t,this.drawPoints=n,this.lineWidth=r||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=i||"rgba(255, 0, 255, 1)"}},Z8=class{constructor(e,t={}){this.faceLandmarks=e,this.options=new Q8(t)}draw(e){let t=Ac(e),{drawLines:n,drawPoints:r,lineWidth:a,lineColor:s,pointSize:i,pointColor:o}=this.options;if(n&&this.faceLandmarks instanceof k8&&(t.strokeStyle=s,t.lineWidth=a,Uu(t,this.faceLandmarks.getJawOutline()),Uu(t,this.faceLandmarks.getLeftEyeBrow()),Uu(t,this.faceLandmarks.getRightEyeBrow()),Uu(t,this.faceLandmarks.getNose()),Uu(t,this.faceLandmarks.getLeftEye(),!0),Uu(t,this.faceLandmarks.getRightEye(),!0),Uu(t,this.faceLandmarks.getMouth(),!0)),r){t.strokeStyle=o,t.fillStyle=o;let l=h=>{t.beginPath(),t.arc(h.x,h.y,i,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(l)}}};function PUe(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof P_?n:X8(n)?n.landmarks:void 0;if(!r)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Z8(r).draw(e)})}function LUe(e,t){let n=DD(e,t),r=MD(e,t);function a(i,o,l){let h=r(i,o,`${l}/separable_conv0`),c=r(o,o,`${l}/separable_conv1`),p=n(i,o,1,`${l}/expansion_conv`);return{separable_conv0:h,separable_conv1:c,expansion_conv:p}}function s(i,o){let l=r(i,i,`${o}/separable_conv0`),h=r(i,i,`${o}/separable_conv1`),c=r(i,i,`${o}/separable_conv2`);return{separable_conv0:l,separable_conv1:h,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:s}}function zUe(e,t){let n=[],{extractWeights:r,getRemainingWeights:a}=eh(e),{extractConvParams:s,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:l}=LUe(r,n),h=s(3,32,3,"entry_flow/conv_in"),c=o(32,64,"entry_flow/reduction_block_0"),p=o(64,128,"entry_flow/reduction_block_1"),m={conv_in:h,reduction_block_0:c,reduction_block_1:p},g={};Am(t,0,1).forEach(_=>{g[`main_block_${_}`]=l(128,`middle_flow/main_block_${_}`)});let b=o(128,256,"exit_flow/reduction_block"),v=i(256,512,"exit_flow/separable_conv"),x={reduction_block:b,separable_conv:v};if(a().length!==0)throw new Error(`weights remaing after extract: ${a().length}`);return{paramMappings:n,params:{entry_flow:m,middle_flow:g,exit_flow:x}}}function VUe(e,t){let n=tf(e,t),r=W8(n),a=$D(n);function s(o){let l=a(`${o}/separable_conv0`),h=a(`${o}/separable_conv1`),c=r(`${o}/expansion_conv`);return{separable_conv0:l,separable_conv1:h,expansion_conv:c}}function i(o){let l=a(`${o}/separable_conv0`),h=a(`${o}/separable_conv1`),c=a(`${o}/separable_conv2`);return{separable_conv0:l,separable_conv1:h,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:i}}function UUe(e,t){let n=[],{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:i}=VUe(e,n),o=r("entry_flow/conv_in"),l=s("entry_flow/reduction_block_0"),h=s("entry_flow/reduction_block_1"),c={conv_in:o,reduction_block_0:l,reduction_block_1:h},p={};Am(t,0,1).forEach(v=>{p[`main_block_${v}`]=i(`middle_flow/main_block_${v}`)});let m=s("exit_flow/reduction_block"),g=a("exit_flow/separable_conv"),b={reduction_block:m,separable_conv:g};return Jc(e,n),{params:{entry_flow:c,middle_flow:p,exit_flow:b},paramMappings:n}}function J8(e,t,n){return Se(ja(e,t.filters,n,"same"),t.bias)}function Ek(e,t,n=!0){let r=n?fn(e):e;return r=Zs(r,t.separable_conv0,[1,1]),r=Zs(fn(r),t.separable_conv1,[1,1]),r=Qr(r,[3,3],[2,2],"same"),r=Se(r,J8(e,t.expansion_conv,[2,2])),r}function BUe(e,t){let n=Zs(fn(e),t.separable_conv0,[1,1]);return n=Zs(fn(n),t.separable_conv1,[1,1]),n=Zs(fn(n),t.separable_conv2,[1,1]),n=Se(n,e),n}var WUe=class extends Zc{constructor(e){super("TinyXception"),this._numMainBlocks=e}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyXception - load model before inference");return oe(()=>{let n=ze(e.toBatchTensor(112,!0),"float32"),r=Rx(n,[122.782,117.001,104.298]).div(255),a=fn(J8(r,t.entry_flow.conv_in,[2,2]));return a=Ek(a,t.entry_flow.reduction_block_0,!1),a=Ek(a,t.entry_flow.reduction_block_1),Am(this._numMainBlocks,0,1).forEach(s=>{a=BUe(a,t.middle_flow[`main_block_${s}`])}),a=Ek(a,t.exit_flow.reduction_block),a=fn(Zs(a,t.exit_flow.separable_conv,[1,1])),a})}async forward(e){return this.forwardInput(await Ga(e))}getDefaultModelName(){return"tiny_xception_model"}extractParamsFromWeightMap(e){return UUe(e,this._numMainBlocks)}extractParams(e){return zUe(e,this._numMainBlocks)}};function jUe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=eh(e),a=V8(n,t),s=a(512,1,"fc/age"),i=a(512,2,"fc/gender");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{fc:{age:s,gender:i}}}}function HUe(e){let t=[],n=tf(e,t);function r(s){let i=n(`${s}/weights`,2),o=n(`${s}/bias`,1);return{weights:i,bias:o}}let a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Jc(e,t),{params:a,paramMappings:t}}var GUe=(e=>(e.FEMALE="female",e.MALE="male",e))(GUe||{}),qUe=class extends Zc{constructor(e=new WUe(2)){super("AgeGenderNet"),this._faceFeatureExtractor=e}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return oe(()=>{let n=e instanceof V_?this.faceFeatureExtractor.forwardInput(e):e,r=eu(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1),a=fN(r,t.fc.age).as1D(),s=fN(r,t.fc.gender);return{age:a,gender:s}})}forwardInput(e){return oe(()=>{let{age:t,gender:n}=this.runNet(e);return{age:t,gender:Gc(n)}})}async forward(e){return this.forwardInput(await Ga(e))}async predictAgeAndGender(e){let t=await Ga(e),n=await this.forwardInput(t),r=or(n.age),a=or(n.gender),s=r.map((o,l)=>({ageTensor:o,genderTensor:a[l]})),i=await Promise.all(s.map(async({ageTensor:o,genderTensor:l})=>{let h=o.dataSync()[0],c=l.dataSync()[0],p=c>.5,m=p?"male":"female",g=p?c:1-c;return o.dispose(),l.dispose(),{age:h,gender:m,genderProbability:g}}));return n.age.dispose(),n.gender.dispose(),t.isBatchInput?i:i[0]}getDefaultModelName(){return"age_gender_model"}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return jUe(e)}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=G8(e);return this.faceFeatureExtractor.loadFromWeightMap(t),HUe(n)}extractParams(e){let t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}},e9=class extends q8{postProcess(e,t,n){let r=n.map(({width:s,height:i})=>{let o=t/Math.max(i,s);return{width:s*o,height:i*o}}),a=r.length;return oe(()=>{let s=(h,c)=>Nr([Ds([68],h,"float32"),Ds([68],c,"float32")],1).as2D(1,136).as1D(),i=(h,c)=>{let{width:p,height:m}=r[h];return c(p,m)?Math.abs(p-m)/2:0},o=h=>i(h,(c,p)=>c<p),l=h=>i(h,(c,p)=>p<c);return e.mul(Ds([a,136],t,"float32")).sub(Nr(Array.from(Array(a),(h,c)=>s(o(c),l(c))))).div(Nr(Array.from(Array(a),(h,c)=>s(r[c].width,r[c].height))))})}forwardInput(e){return oe(()=>{let t=this.runNet(e);return this.postProcess(t,e.inputSize,e.inputDimensions.map(([n,r])=>({height:n,width:r})))})}async forward(e){return this.forwardInput(await Ga(e))}async detectLandmarks(e){let t=await Ga(e),n=oe(()=>or(this.forwardInput(t))),r=await Promise.all(n.map(async(a,s)=>{let i=Array.from(a.dataSync()),o=i.filter((h,c)=>hN(c)),l=i.filter((h,c)=>!hN(c));return new k8(Array(68).fill(0).map((h,c)=>new wn(o[c],l[c])),{height:t.getInputHeight(s),width:t.getInputWidth(s)})}));return n.forEach(a=>a.dispose()),t.isBatchInput?r:r[0]}getClassifierChannelsOut(){return 136}},KUe=class extends e9{constructor(e=new H8){super("FaceLandmark68Net",e)}getDefaultModelName(){return"face_landmark_68_model"}getClassifierChannelsIn(){return 256}};function XUe(e){let t=[],{extractDenseBlock3Params:n}=j8(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Jc(e,t),{params:r,paramMappings:t}}function YUe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=eh(e),{extractDenseBlock3Params:a}=B8(n,t),s=a(3,32,"dense0",!0),i=a(32,64,"dense1"),o=a(64,128,"dense2");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:o}}}var QUe=class extends Zc{constructor(){super("TinyFaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return oe(()=>{let n=ze(e.toBatchTensor(112,!0),"float32"),r=Rx(n,[122.782,117.001,104.298]).div(255),a=kk(r,t.dense0,!0);return a=kk(a,t.dense1),a=kk(a,t.dense2),a=eu(a,[14,14],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await Ga(e))}getDefaultModelName(){return"face_feature_extractor_tiny_model"}extractParamsFromWeightMap(e){return XUe(e)}extractParams(e){return YUe(e)}},ZUe=class extends e9{constructor(e=new QUe){super("FaceLandmark68TinyNet",e)}getDefaultModelName(){return"face_landmark_68_tiny_model"}getClassifierChannelsIn(){return 128}};function JUe(e,t){return Se(re(e,t.weights),t.biases)}function FD(e,t,n,r,a="same"){let{filters:s,bias:i}=t.conv,o=ja(e,s,n,a);return o=Se(o,i),o=JUe(o,t.scale),r?fn(o):o}function eBe(e,t){return FD(e,t,[1,1],!0)}function t9(e,t){return FD(e,t,[1,1],!1)}function n9(e,t){return FD(e,t,[2,2],!0,"valid")}function tBe(e,t){function n(o,l,h){let c=e(o),p=c.length/(l*h*h);if(v8(p))throw new Error(`depth has to be an integer: ${p}, weights.length: ${c.length}, numFilters: ${l}, filterSize: ${h}`);return oe(()=>Ct(Sc(c,[l,p,h,h]),[2,3,1,0]))}function r(o,l,h,c){let p=n(o,l,h),m=dn(e(l));return t.push({paramPath:`${c}/filters`},{paramPath:`${c}/bias`}),{filters:p,bias:m}}function a(o,l){let h=dn(e(o)),c=dn(e(o));return t.push({paramPath:`${l}/weights`},{paramPath:`${l}/biases`}),{weights:h,biases:c}}function s(o,l,h,c){let p=r(o,l,h,`${c}/conv`),m=a(l,`${c}/scale`);return{conv:p,scale:m}}function i(o,l,h,c,p=!1){let m=s((p?.5:1)*o,l,h,`${c}/conv1`),g=s(o,l,h,`${c}/conv2`);return{conv1:m,conv2:g}}return{extractConvLayerParams:s,extractResidualLayerParams:i}}function nBe(e){let{extractWeights:t,getRemainingWeights:n}=eh(e),r=[],{extractConvLayerParams:a,extractResidualLayerParams:s}=tBe(t,r),i=a(4704,32,7,"conv32_down"),o=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),c=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),m=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),b=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),I=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),R=oe(()=>Ct(Bo(t(256*128),[128,256]),[1,0]));if(r.push({paramPath:"fc"}),n().length!==0)throw new Error(`weights remaing after extract: ${n().length}`);return{params:{conv32_down:i,conv32_1:o,conv32_2:l,conv32_3:h,conv64_down:c,conv64_1:p,conv64_2:m,conv64_3:g,conv128_down:b,conv128_1:v,conv128_2:x,conv256_down:_,conv256_1:I,conv256_2:k,conv256_down_out:E,fc:R},paramMappings:r}}function rBe(e,t){let n=tf(e,t);function r(i){let o=n(`${i}/scale/weights`,1),l=n(`${i}/scale/biases`,1);return{weights:o,biases:l}}function a(i){let o=n(`${i}/conv/filters`,4),l=n(`${i}/conv/bias`,1),h=r(i);return{conv:{filters:o,bias:l},scale:h}}function s(i){return{conv1:a(`${i}/conv1`),conv2:a(`${i}/conv2`)}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function aBe(e){let t=[],{extractConvLayerParams:n,extractResidualLayerParams:r}=rBe(e,t),a=n("conv32_down"),s=r("conv32_1"),i=r("conv32_2"),o=r("conv32_3"),l=r("conv64_down"),h=r("conv64_1"),c=r("conv64_2"),p=r("conv64_3"),m=r("conv128_down"),g=r("conv128_1"),b=r("conv128_2"),v=r("conv256_down"),x=r("conv256_1"),_=r("conv256_2"),I=r("conv256_down_out"),{fc:k}=e;if(t.push({originalPath:"fc",paramPath:"fc"}),!b8(k))throw new Error(`expected weightMap[fc] to be a Tensor2D, instead have ${k}`);let E={conv32_down:a,conv32_1:s,conv32_2:i,conv32_3:o,conv64_down:l,conv64_1:h,conv64_2:c,conv64_3:p,conv128_down:m,conv128_1:g,conv128_2:b,conv256_down:v,conv256_1:x,conv256_2:_,conv256_down_out:I,fc:k};return Jc(e,t),{params:E,paramMappings:t}}function Io(e,t){let n=eBe(e,t.conv1);return n=t9(n,t.conv2),n=Se(n,e),n=fn(n),n}function y0(e,t){let n=n9(e,t.conv1);n=t9(n,t.conv2);let r=eu(e,2,2,"valid"),a=Zn(r.shape),s=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){let i=[...n.shape];i[1]=1;let o=Zn(i);n=Sn([n,o],1);let l=[...n.shape];l[2]=1;let h=Zn(l);n=Sn([n,h],2)}return r=s?Sn([r,a],3):r,n=Se(r,n),n=fn(n),n}var sBe=class extends Zc{constructor(){super("FaceRecognitionNet")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return oe(()=>{let n=ze(e.toBatchTensor(150,!0),"float32"),r=Rx(n,[122.782,117.001,104.298]).div(255),a=n9(r,t.conv32_down);a=Qr(a,3,2,"valid"),a=Io(a,t.conv32_1),a=Io(a,t.conv32_2),a=Io(a,t.conv32_3),a=y0(a,t.conv64_down),a=Io(a,t.conv64_1),a=Io(a,t.conv64_2),a=Io(a,t.conv64_3),a=y0(a,t.conv128_down),a=Io(a,t.conv128_1),a=Io(a,t.conv128_2),a=y0(a,t.conv256_down),a=Io(a,t.conv256_1),a=Io(a,t.conv256_2),a=y0(a,t.conv256_down_out);let s=a.mean([1,2]);return Nt(s,t.fc)})}async forward(e){return this.forwardInput(await Ga(e))}async computeFaceDescriptor(e){var t;if((t=e?.shape)!=null&&t.some(s=>s<=0))return new Float32Array(128);let n=await Ga(e),r=oe(()=>or(this.forwardInput(n))),a=await Promise.all(r.map(s=>s.data()));return r.forEach(s=>s.dispose()),n.isBatchInput?a:a[0]}getDefaultModelName(){return"face_recognition_model"}extractParamsFromWeightMap(e){return aBe(e)}extractParams(e){return nBe(e)}};function r9(e,t){return{...e,descriptor:t}}function a9(e,t){return{...e,age:t}}function s9(e,t,n){return{...e,gender:t,genderProbability:n}}function iBe(e,t){function n(l,h){let c=Sc(e(9*l),[3,3,l,1]),p=dn(e(l)),m=dn(e(l)),g=dn(e(l)),b=dn(e(l));return t.push({paramPath:`${h}/filters`},{paramPath:`${h}/batch_norm_scale`},{paramPath:`${h}/batch_norm_offset`},{paramPath:`${h}/batch_norm_mean`},{paramPath:`${h}/batch_norm_variance`}),{filters:c,batch_norm_scale:p,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:b}}function r(l,h,c,p,m){let g=Sc(e(l*h*c*c),[c,c,l,h]),b=dn(e(h));return t.push({paramPath:`${p}/filters`},{paramPath:`${p}/${m?"batch_norm_offset":"bias"}`}),{filters:g,bias:b}}function a(l,h,c,p){let{filters:m,bias:g}=r(l,h,c,p,!0);return{filters:m,batch_norm_offset:g}}function s(l,h,c){let p=n(l,`${c}/depthwise_conv`),m=a(l,h,1,`${c}/pointwise_conv`);return{depthwise_conv:p,pointwise_conv:m}}function i(){let l=a(3,32,3,"mobilenetv1/conv_0"),h=s(32,64,"mobilenetv1/conv_1"),c=s(64,128,"mobilenetv1/conv_2"),p=s(128,128,"mobilenetv1/conv_3"),m=s(128,256,"mobilenetv1/conv_4"),g=s(256,256,"mobilenetv1/conv_5"),b=s(256,512,"mobilenetv1/conv_6"),v=s(512,512,"mobilenetv1/conv_7"),x=s(512,512,"mobilenetv1/conv_8"),_=s(512,512,"mobilenetv1/conv_9"),I=s(512,512,"mobilenetv1/conv_10"),k=s(512,512,"mobilenetv1/conv_11"),E=s(512,1024,"mobilenetv1/conv_12"),R=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:h,conv_2:c,conv_3:p,conv_4:m,conv_5:g,conv_6:b,conv_7:v,conv_8:x,conv_9:_,conv_10:I,conv_11:k,conv_12:E,conv_13:R}}function o(){let l=a(1024,256,1,"prediction_layer/conv_0"),h=a(256,512,3,"prediction_layer/conv_1"),c=a(512,128,1,"prediction_layer/conv_2"),p=a(128,256,3,"prediction_layer/conv_3"),m=a(256,128,1,"prediction_layer/conv_4"),g=a(128,256,3,"prediction_layer/conv_5"),b=a(256,64,1,"prediction_layer/conv_6"),v=a(64,128,3,"prediction_layer/conv_7"),x=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),_=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),I=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),k=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),E=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),R=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),U=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),D=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),O=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),z=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),M=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor");return{conv_0:l,conv_1:h,conv_2:c,conv_3:p,conv_4:m,conv_5:g,conv_6:b,conv_7:v,box_predictor_0:{box_encoding_predictor:x,class_predictor:_},box_predictor_1:{box_encoding_predictor:I,class_predictor:k},box_predictor_2:{box_encoding_predictor:E,class_predictor:R},box_predictor_3:{box_encoding_predictor:U,class_predictor:D},box_predictor_4:{box_encoding_predictor:C,class_predictor:O},box_predictor_5:{box_encoding_predictor:z,class_predictor:M}}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:o}}function oBe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=eh(e),{extractMobilenetV1Params:a,extractPredictionLayerParams:s}=iBe(n,t),i=a(),o=s(),l={extra_dim:sS(n(5118*4),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{params:{mobilenetv1:i,prediction_layer:o,output_layer:l},paramMappings:t}}function lBe(e,t){let n=tf(e,t);function r(h,c,p){let m=n(`${h}/Conv2d_${c}_pointwise/weights`,4,`${p}/filters`),g=n(`${h}/Conv2d_${c}_pointwise/convolution_bn_offset`,1,`${p}/batch_norm_offset`);return{filters:m,batch_norm_offset:g}}function a(h){let c=`mobilenetv1/conv_${h}`,p=`MobilenetV1/Conv2d_${h}_depthwise`,m=`${c}/depthwise_conv`,g=`${c}/pointwise_conv`,b=n(`${p}/depthwise_weights`,4,`${m}/filters`),v=n(`${p}/BatchNorm/gamma`,1,`${m}/batch_norm_scale`),x=n(`${p}/BatchNorm/beta`,1,`${m}/batch_norm_offset`),_=n(`${p}/BatchNorm/moving_mean`,1,`${m}/batch_norm_mean`),I=n(`${p}/BatchNorm/moving_variance`,1,`${m}/batch_norm_variance`);return{depthwise_conv:{filters:b,batch_norm_scale:v,batch_norm_offset:x,batch_norm_mean:_,batch_norm_variance:I},pointwise_conv:r("MobilenetV1",h,g)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function i(h,c){let p=n(`${h}/weights`,4,`${c}/filters`),m=n(`${h}/biases`,1,`${c}/bias`);return{filters:p,bias:m}}function o(h){let c=i(`Prediction/BoxPredictor_${h}/BoxEncodingPredictor`,`prediction_layer/box_predictor_${h}/box_encoding_predictor`),p=i(`Prediction/BoxPredictor_${h}/ClassPredictor`,`prediction_layer/box_predictor_${h}/class_predictor`);return{box_encoding_predictor:c,class_predictor:p}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:l}}function uBe(e){let t=[],{extractMobilenetV1Params:n,extractPredictionLayerParams:r}=lBe(e,t),a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ax(a))throw new Error(`expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ${a}`);let s={mobilenetv1:n(),prediction_layer:r(),output_layer:{extra_dim:a}};return Jc(e,t),{params:s,paramMappings:t}}function Eo(e,t,n){return oe(()=>{let r=ja(e,t.filters,n,"same");return r=Se(r,t.batch_norm_offset),ka(r,0,6)})}var cBe=.0010000000474974513;function hBe(e,t,n){return oe(()=>{let r=Hp(e,t.filters,n,"same");return r=jp(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,cBe),ka(r,0,6)})}function dBe(e){return[2,4,6,12].some(t=>t===e)?[2,2]:[1,1]}function pBe(e,t){return oe(()=>{let n,r=Eo(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((a,s)=>{let i=s+1,o=dBe(i);r=hBe(r,a.depthwise_conv,o),r=Eo(r,a.pointwise_conv,[1,1]),i===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function fBe(e,t,n){let r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),s=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),o=Math.max(r[t][1],r[t][3]),l=Math.min(r[n][0],r[n][2]),h=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),m=(i-a)*(o-s),g=(c-l)*(p-h);if(m<=0||g<=0)return 0;let b=Math.max(a,l),v=Math.max(s,h),x=Math.min(i,c),_=Math.min(o,p),I=Math.max(x-b,0)*Math.max(_-v,0);return I/(m+g-I)}function mBe(e,t,n,r,a){let s=e.shape[0],i=Math.min(n,s),o=t.map((c,p)=>({score:c,boxIndex:p})).filter(c=>c.score>a).sort((c,p)=>p.score-c.score),l=c=>c<=r?1:0,h=[];return o.forEach(c=>{if(h.length>=i)return;let p=c.score;for(let m=h.length-1;m>=0;--m){let g=fBe(e,c.boxIndex,h[m]);if(g!==0&&(c.score*=l(g),c.score<=a))break}p===c.score&&h.push(c.boxIndex)}),h}function gBe(e){let t=or(Ct(e,[1,0])),n=[Ge(t[2],t[0]),Ge(t[3],t[1])],r=[Se(t[0],Ke(n[0],2)),Se(t[1],Ke(n[1],2))];return{sizes:n,centers:r}}function yBe(e,t){let{sizes:n,centers:r}=gBe(e),a=or(Ct(t,[1,0])),s=Ke(re(Ea(Ke(a[2],5)),n[0]),2),i=Se(re(Ke(a[0],10),n[0]),r[0]),o=Ke(re(Ea(Ke(a[3],5)),n[1]),2),l=Se(re(Ke(a[1],10),n[1]),r[1]);return Ct(Nr([Ge(i,s),Ge(l,o),Se(i,s),Se(l,o)]),[1,0])}function bBe(e,t,n){return oe(()=>{let r=e.shape[0],a=yBe(ie(Rs(n.extra_dim,[r,1,1]),[-1,4]),ie(e,[-1,4]));a=ie(a,[r,a.shape[0]/r,4]);let s=Ti(Pt(t,[0,0,1],[-1,-1,-1])),i=Pt(s,[0,0,0],[-1,-1,1]);i=ie(i,[r,i.shape[1]]);let o=or(a),l=or(i);return{boxes:o,scores:l}})}function Uf(e,t){return oe(()=>{let n=e.shape[0],r=ie($b(e,t.box_encoding_predictor),[n,-1,1,4]),a=ie($b(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function vBe(e,t,n){return oe(()=>{let r=Eo(e,n.conv_0,[1,1]),a=Eo(r,n.conv_1,[2,2]),s=Eo(a,n.conv_2,[1,1]),i=Eo(s,n.conv_3,[2,2]),o=Eo(i,n.conv_4,[1,1]),l=Eo(o,n.conv_5,[2,2]),h=Eo(l,n.conv_6,[1,1]),c=Eo(h,n.conv_7,[2,2]),p=Uf(t,n.box_predictor_0),m=Uf(e,n.box_predictor_1),g=Uf(a,n.box_predictor_2),b=Uf(i,n.box_predictor_3),v=Uf(l,n.box_predictor_4),x=Uf(c,n.box_predictor_5),_=Sn([p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,b.boxPredictionEncoding,v.boxPredictionEncoding,x.boxPredictionEncoding],1),I=Sn([p.classPrediction,m.classPrediction,g.classPrediction,b.classPrediction,v.classPrediction,x.classPrediction],1);return{boxPredictions:_,classPredictions:I}})}var HS=class{constructor({minConfidence:e,maxResults:t}={}){if(this._name="SsdMobilenetv1Options",this._minConfidence=e||.5,this._maxResults=t||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(`${this._name} - expected minConfidence to be a number between 0 and 1`);if(typeof this._maxResults!="number")throw new Error(`${this._name} - expected maxResults to be a number`)}get minConfidence(){return this._minConfidence}get maxResults(){return this._maxResults}},xBe=class extends Zc{constructor(){super("SsdMobilenetv1")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return oe(()=>{let n=ze(e.toBatchTensor(512,!1),"float32"),r=Ge(Ke(n,127.5),1),a=pBe(r,t.mobilenetv1),{boxPredictions:s,classPredictions:i}=vBe(a.out,a.conv11,t.prediction_layer);return bBe(s,i,t.output_layer)})}async forward(e){return this.forwardInput(await Ga(e))}async locateFaces(e,t={}){let{maxResults:n,minConfidence:r}=new HS(t),a=await Ga(e),{boxes:s,scores:i}=this.forwardInput(a),o=s[0],l=i[0];for(let _=1;_<s.length;_++)s[_].dispose(),i[_].dispose();let h=Array.from(l.dataSync()),c=mBe(o,h,n,.5,r),p=a.getReshapedInputDimensions(0),m=a.inputSize,g=m/p.width,b=m/p.height,v=o.arraySync(),x=c.map(_=>{let[I,k]=[Math.max(0,v[_][0]),Math.min(1,v[_][2])].map(U=>U*b),[E,R]=[Math.max(0,v[_][1]),Math.min(1,v[_][3])].map(U=>U*g);return new ao(h[_],new T8(E,I,R-E,k-I),{height:a.getInputHeight(0),width:a.getInputWidth(0)})});return o.dispose(),l.dispose(),x}getDefaultModelName(){return"ssd_mobilenetv1_model"}extractParamsFromWeightMap(e){return uBe(e)}extractParams(e){return oBe(e)}},wBe=.4,_Be=[new wn(.738768,.874946),new wn(2.42204,2.65704),new wn(4.30971,7.04493),new wn(10.246,4.59428),new wn(12.6868,11.8741)],SBe=[new wn(1.603231,2.094468),new wn(6.041143,7.080126),new wn(2.882459,3.518061),new wn(4.266906,5.178857),new wn(9.041765,10.66308)],IBe=[117.001,114.697,97.404],TBe="tiny_yolov2_model",kBe="tiny_yolov2_separable_conv_model",b0=e=>typeof e=="number";function EBe(e){if(!e)throw new Error(`invalid config: ${e}`);if(typeof e.withSeparableConvs!="boolean")throw new Error(`config.withSeparableConvs has to be a boolean, have: ${e.withSeparableConvs}`);if(!b0(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error(`config.iouThreshold has to be a number between [0, 1], have: ${e.iouThreshold}`);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(t=>typeof t=="string"))throw new Error(`config.classes has to be an array class names: string[], have: ${JSON.stringify(e.classes)}`);if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(t=>t||{}).every(t=>b0(t.x)&&b0(t.y)))throw new Error(`config.anchors has to be an array of { x: number, y: number }, have: ${JSON.stringify(e.anchors)}`);if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(b0)))throw new Error(`config.meanRgb has to be an array of shape [number, number, number], have: ${JSON.stringify(e.meanRgb)}`)}function PD(e){return oe(()=>{let t=re(e,rt(.10000000149011612));return Se(fn(Ge(e,t)),t)})}function Pu(e,t){return oe(()=>{let n=io(e,[[0,0],[1,1],[1,1],[0,0]]);return n=ja(n,t.conv.filters,[1,1],"valid"),n=Ge(n,t.bn.sub),n=re(n,t.bn.truediv),n=Se(n,t.conv.bias),PD(n)})}function Lu(e,t){return oe(()=>{let n=io(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Xg(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Se(n,t.bias),PD(n)})}function NBe(e,t){let n=DD(e,t);function r(i,o){let l=dn(e(i)),h=dn(e(i));return t.push({paramPath:`${o}/sub`},{paramPath:`${o}/truediv`}),{sub:l,truediv:h}}function a(i,o,l){let h=n(i,o,3,`${l}/conv`),c=r(o,`${l}/bn`);return{conv:h,bn:c}}let s=MD(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function CBe(e,t,n,r){let{extractWeights:a,getRemainingWeights:s}=eh(e),i=[],{extractConvParams:o,extractConvWithBatchNormParams:l,extractSeparableConvParams:h}=NBe(a,i),c;if(t.withSeparableConvs){let[p,m,g,b,v,x,_,I,k]=r,E=t.isFirstLayerConv2d?o(p,m,3,"conv0"):h(p,m,"conv0"),R=h(m,g,"conv1"),U=h(g,b,"conv2"),D=h(b,v,"conv3"),C=h(v,x,"conv4"),O=h(x,_,"conv5"),z=I?h(_,I,"conv6"):void 0,M=k?h(I,k,"conv7"):void 0,N=o(k||I||_,5*n,1,"conv8");c={conv0:E,conv1:R,conv2:U,conv3:D,conv4:C,conv5:O,conv6:z,conv7:M,conv8:N}}else{let[p,m,g,b,v,x,_,I,k]=r,E=l(p,m,"conv0"),R=l(m,g,"conv1"),U=l(g,b,"conv2"),D=l(b,v,"conv3"),C=l(v,x,"conv4"),O=l(x,_,"conv5"),z=l(_,I,"conv6"),M=l(I,k,"conv7"),N=o(k,5*n,1,"conv8");c={conv0:E,conv1:R,conv2:U,conv3:D,conv4:C,conv5:O,conv6:z,conv7:M,conv8:N}}if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{params:c,paramMappings:i}}function ABe(e,t){let n=tf(e,t);function r(o){let l=n(`${o}/sub`,1),h=n(`${o}/truediv`,1);return{sub:l,truediv:h}}function a(o){let l=n(`${o}/filters`,4),h=n(`${o}/bias`,1);return{filters:l,bias:h}}function s(o){let l=a(`${o}/conv`),h=r(`${o}/bn`);return{conv:l,bn:h}}let i=$D(n);return{extractConvParams:a,extractConvWithBatchNormParams:s,extractSeparableConvParams:i}}function RBe(e,t){let n=[],{extractConvParams:r,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}=ABe(e,n),i;if(t.withSeparableConvs){let o=t.filterSizes&&t.filterSizes.length||9;i={conv0:t.isFirstLayerConv2d?r("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:o>7?s("conv6"):void 0,conv7:o>8?s("conv7"):void 0,conv8:r("conv8")}}else i={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:r("conv8")};return Jc(e,n),{params:i,paramMappings:n}}var LD=class{constructor({inputSize:e,scoreThreshold:t}={}){if(this._name="TinyYolov2Options",this._inputSize=e||416,this._scoreThreshold=t||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(`${this._name} - expected inputSize to be a number divisible by 32`);if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(`${this._name} - expected scoreThreshold to be a number between 0 and 1`)}get inputSize(){return this._inputSize}get scoreThreshold(){return this._scoreThreshold}},i9=class o9 extends Zc{constructor(t){super("TinyYolov2"),EBe(t),this._config=t}get config(){return this._config}get withClassScores(){return this.config.withClassScores||this.config.classes.length>1}get boxEncodingSize(){return 5+(this.withClassScores?this.config.classes.length:0)}runTinyYolov2(t,n){let r=Pu(t,n.conv0);return r=Qr(r,[2,2],[2,2],"same"),r=Pu(r,n.conv1),r=Qr(r,[2,2],[2,2],"same"),r=Pu(r,n.conv2),r=Qr(r,[2,2],[2,2],"same"),r=Pu(r,n.conv3),r=Qr(r,[2,2],[2,2],"same"),r=Pu(r,n.conv4),r=Qr(r,[2,2],[2,2],"same"),r=Pu(r,n.conv5),r=Qr(r,[2,2],[1,1],"same"),r=Pu(r,n.conv6),r=Pu(r,n.conv7),$b(r,n.conv8,"valid",!1)}runMobilenet(t,n){let r=this.config.isFirstLayerConv2d?PD($b(t,n.conv0,"valid",!1)):Lu(t,n.conv0);return r=Qr(r,[2,2],[2,2],"same"),r=Lu(r,n.conv1),r=Qr(r,[2,2],[2,2],"same"),r=Lu(r,n.conv2),r=Qr(r,[2,2],[2,2],"same"),r=Lu(r,n.conv3),r=Qr(r,[2,2],[2,2],"same"),r=Lu(r,n.conv4),r=Qr(r,[2,2],[2,2],"same"),r=Lu(r,n.conv5),r=Qr(r,[2,2],[1,1],"same"),r=n.conv6?Lu(r,n.conv6):r,r=n.conv7?Lu(r,n.conv7):r,$b(r,n.conv8,"valid",!1)}forwardInput(t,n){let{params:r}=this;if(!r)throw new Error("TinyYolov2 - load model before inference");return oe(()=>{let a=ze(t.toBatchTensor(n,!1),"float32");return a=this.config.meanRgb?Rx(a,this.config.meanRgb):a,a=a.div(255),this.config.withSeparableConvs?this.runMobilenet(a,r):this.runTinyYolov2(a,r)})}async forward(t,n){return this.forwardInput(await Ga(t),n)}async detect(t,n={}){let{inputSize:r,scoreThreshold:a}=new LD(n),s=await Ga(t),i=await this.forwardInput(s,r),o=oe(()=>or(i)[0].expandDims()),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},h=await this.extractBoxes(o,s.getReshapedInputDimensions(0),a);i.dispose(),o.dispose();let c=h.map(b=>b.box),p=h.map(b=>b.score),m=h.map(b=>b.classScore),g=h.map(b=>this.config.classes[b.label]);return mUe(c.map(b=>b.rescale(r)),p,this.config.iouThreshold,!0).map(b=>new _8(p[b],m[b],g[b],c[b],l))}getDefaultModelName(){return""}extractParamsFromWeightMap(t){return RBe(t,this.config)}extractParams(t){let n=this.config.filterSizes||o9.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(r!==7&&r!==8&&r!==9)throw new Error(`TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ${r} filterSizes in config`);return CBe(t,this.config,this.boxEncodingSize,n)}async extractBoxes(t,n,r){let{width:a,height:s}=n,i=Math.max(a,s),o=i/a,l=i/s,h=t.shape[1],c=this.config.anchors.length,[p,m,g]=oe(()=>{let _=t.reshape([h,h,c,this.boxEncodingSize]),I=_.slice([0,0,0,0],[h,h,c,4]),k=_.slice([0,0,0,4],[h,h,c,1]),E=this.withClassScores?Gc(_.slice([0,0,0,5],[h,h,c,this.config.classes.length]),3):rt(0);return[I,k,E]}),b=[],v=await m.array(),x=await p.array();for(let _=0;_<h;_++)for(let I=0;I<h;I++)for(let k=0;k<c;k++){let E=Tk(v[_][I][k][0]);if(!r||E>r){let R=(I+Tk(x[_][I][k][0]))/h*o,U=(_+Tk(x[_][I][k][1]))/h*l,D=Math.exp(x[_][I][k][2])*this.config.anchors[k].x/h*o,C=Math.exp(x[_][I][k][3])*this.config.anchors[k].y/h*l,O=R-D/2,z=U-C/2,M={row:_,col:I,anchor:k},{classScore:N,label:P}=this.withClassScores?await this.extractPredictedClass(g,M):{classScore:1,label:0};b.push({box:new w8(O,z,O+D,z+C),score:E,classScore:E*N,label:P,...M})}}return p.dispose(),m.dispose(),g.dispose(),b}async extractPredictedClass(t,n){let{row:r,col:a,anchor:s}=n,i=await t.array();return Array(this.config.classes.length).fill(0).map((o,l)=>i[r][a][s][l]).map((o,l)=>({classScore:o,label:l})).reduce((o,l)=>o.classScore>l.classScore?o:l)}};i9.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var l9=i9,DBe=class extends l9{constructor(e=!0){let t={withSeparableConvs:e,iouThreshold:wBe,classes:["face"],...e?{anchors:SBe,meanRgb:IBe}:{anchors:_Be,withClassScores:!0}};super(t)}get withSeparableConvs(){return this.config.withSeparableConvs}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new ao(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return this.withSeparableConvs?kBe:TBe}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},u9=class extends LD{constructor(){super(...arguments),this._name="TinyFaceDetectorOptions"}},Dx=class{async then(e){return e(await this.run())}async run(){throw new Error("ComposableTask - run is not implemented")}};async function GS(e,t,n,r,a=({alignedRect:s})=>s){let s=e.map(l=>X8(l)?a(l):l.detection),i=r||(t instanceof Tt?await RD(t,s):await AD(t,s)),o=await n(i);return i.forEach(l=>l instanceof Tt&&l.dispose()),o}async function zD(e,t,n,r,a){return GS([e],t,async s=>n(s[0]),r,a)}var MBe=.4,$Be=[new wn(1.603231,2.094468),new wn(6.041143,7.080126),new wn(2.882459,3.518061),new wn(4.266906,5.178857),new wn(9.041765,10.66308)],OBe=[117.001,114.697,97.404],FBe=class extends l9{constructor(){let e={withSeparableConvs:!0,iouThreshold:MBe,classes:["face"],anchors:$Be,meanRgb:OBe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};super(e)}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new ao(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return"tiny_face_detector_model"}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},ss={ssdMobilenetv1:new xBe,tinyFaceDetector:new FBe,tinyYolov2:new DBe,faceLandmark68Net:new KUe,faceLandmark68TinyNet:new ZUe,faceRecognitionNet:new sBe,faceExpressionNet:new MUe,ageGenderNet:new qUe},c9=class extends Dx{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},VD=class extends c9{async run(){let e=await this.parentTask,t=await GS(e,this.input,async n=>Promise.all(n.map(r=>ss.faceExpressionNet.predictExpressions(r))),this.extractedFaces);return e.map((n,r)=>K8(n,t[r]))}withAgeAndGender(){return new jD(this,this.input)}},UD=class extends c9{async run(){let e=await this.parentTask;if(!e)return;let t=await zD(e,this.input,n=>ss.faceExpressionNet.predictExpressions(n),this.extractedFaces);return K8(e,t)}withAgeAndGender(){return new HD(this,this.input)}},BD=class extends VD{withAgeAndGender(){return new GD(this,this.input)}withFaceDescriptors(){return new KD(this,this.input)}},WD=class extends UD{withAgeAndGender(){return new qD(this,this.input)}withFaceDescriptor(){return new XD(this,this.input)}},h9=class extends Dx{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},jD=class extends h9{async run(){let e=await this.parentTask,t=await GS(e,this.input,async n=>Promise.all(n.map(r=>ss.ageGenderNet.predictAgeAndGender(r))),this.extractedFaces);return e.map((n,r)=>{let{age:a,gender:s,genderProbability:i}=t[r];return a9(s9(n,s,i),a)})}withFaceExpressions(){return new VD(this,this.input)}},HD=class extends h9{async run(){let e=await this.parentTask;if(!e)return;let{age:t,gender:n,genderProbability:r}=await zD(e,this.input,a=>ss.ageGenderNet.predictAgeAndGender(a),this.extractedFaces);return a9(s9(e,n,r),t)}withFaceExpressions(){return new UD(this,this.input)}},GD=class extends jD{withFaceExpressions(){return new BD(this,this.input)}withFaceDescriptors(){return new KD(this,this.input)}},qD=class extends HD{withFaceExpressions(){return new WD(this,this.input)}withFaceDescriptor(){return new XD(this,this.input)}},d9=class extends Dx{constructor(e,t){super(),this.parentTask=e,this.input=t}},KD=class extends d9{async run(){let e=await this.parentTask;return(await GS(e,this.input,t=>Promise.all(t.map(n=>ss.faceRecognitionNet.computeFaceDescriptor(n))),null,t=>t.landmarks.align(null,{useDlibAlignment:!0}))).map((t,n)=>r9(e[n],t))}withFaceExpressions(){return new BD(this,this.input)}withAgeAndGender(){return new GD(this,this.input)}},XD=class extends d9{async run(){let e=await this.parentTask;if(!e)return;let t=await zD(e,this.input,n=>ss.faceRecognitionNet.computeFaceDescriptor(n),null,n=>n.landmarks.align(null,{useDlibAlignment:!0}));return r9(e,t)}withFaceExpressions(){return new WD(this,this.input)}withAgeAndGender(){return new qD(this,this.input)}},p9=class extends Dx{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.useTinyLandmarkNet=n}get landmarkNet(){return this.useTinyLandmarkNet?ss.faceLandmark68TinyNet:ss.faceLandmark68Net}},PBe=class extends p9{async run(){let e=await this.parentTask,t=e.map(a=>a.detection),n=this.input instanceof Tt?await RD(this.input,t):await AD(this.input,t),r=await Promise.all(n.map(a=>this.landmarkNet.detectLandmarks(a)));return n.forEach(a=>a instanceof Tt&&a.dispose()),e.filter((a,s)=>r[s]).map((a,s)=>Y8(a,r[s]))}withFaceExpressions(){return new BD(this,this.input)}withAgeAndGender(){return new GD(this,this.input)}withFaceDescriptors(){return new KD(this,this.input)}},LBe=class extends p9{async run(){let e=await this.parentTask;if(!e)return;let{detection:t}=e,n=this.input instanceof Tt?await RD(this.input,[t]):await AD(this.input,[t]),r=await this.landmarkNet.detectLandmarks(n[0]);return n.forEach(a=>a instanceof Tt&&a.dispose()),Y8(e,r)}withFaceExpressions(){return new WD(this,this.input)}withAgeAndGender(){return new qD(this,this.input)}withFaceDescriptor(){return new XD(this,this.input)}},f9=class extends Dx{constructor(e,t=new HS){super(),this.input=e,this.options=t}},zBe=class extends f9{async run(){let{input:e,options:t}=this,n;if(t instanceof u9)n=ss.tinyFaceDetector.locateFaces(e,t);else if(t instanceof HS)n=ss.ssdMobilenetv1.locateFaces(e,t);else if(t instanceof LD)n=ss.tinyYolov2.locateFaces(e,t);else throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");return n}runAndExtendWithFaceDetections(){return new Promise((e,t)=>{this.run().then(n=>e(n.map(r=>E8({},r)))).catch(n=>t(n))})}withFaceLandmarks(e=!1){return new PBe(this.runAndExtendWithFaceDetections(),this.input,e)}withFaceExpressions(){return new VD(this.runAndExtendWithFaceDetections(),this.input)}withAgeAndGender(){return new jD(this.runAndExtendWithFaceDetections(),this.input)}},VBe=class extends f9{async run(){let e=await new zBe(this.input,this.options),t=e[0];return e.forEach(n=>{n.score>t.score&&(t=n)}),t}runAndExtendWithFaceDetection(){return new Promise(async e=>{let t=await this.run();e(t?E8({},t):void 0)})}withFaceLandmarks(e=!1){return new LBe(this.runAndExtendWithFaceDetection(),this.input,e)}withFaceExpressions(){return new UD(this.runAndExtendWithFaceDetection(),this.input)}withAgeAndGender(){return new HD(this.runAndExtendWithFaceDetection(),this.input)}};function UBe(e,t=new HS){return new VBe(e,t)}const BBe={happy:["happy","upbeat","pop"],sad:["sad","acoustic","mellow"],neutral:["neutral","chill","lofi","ambient"],surprised:["surprised","energetic","electronic","dance"],angry:["angry","intense","rock","metal"],fearful:["fearful","ambient","calm","chill"],disgusted:["disgusted","intense","experimental"]};async function WBe(e,t=10){try{const n=BBe[e]||[e],r=Ho(Ta,"tracks"),a=Jh(r,aE("tags","array-contains-any",n),iE(t)),s=await qb(a),i=[];return s.forEach(o=>{i.push({id:o.id,...o.data(),source:"firestore"})}),i.length>=t?i.slice(0,t):i}catch(n){return console.error("getTracksForMood error:",n),[]}}const jBe=()=>{const e=fe.useRef(null);fe.useRef(null);const{user:t}=Pc(),[n,r]=fe.useState(null),[a,s]=fe.useState(!1),[i,o]=fe.useState(null),[l,h]=fe.useState([]),[c,p]=fe.useState(!1),[m,g]=fe.useState({tinyFaceDetector:"idle",faceLandmark68Net:"idle",faceRecognitionNet:"idle",faceExpressionNet:"idle"}),[b,v]=fe.useState(null);fe.useEffect(()=>{let k=!0;return(async()=>{s(!0);const R="https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights",U=[["tinyFaceDetector",()=>ss.tinyFaceDetector.loadFromUri(R)],["faceLandmark68Net",()=>ss.faceLandmark68Net.loadFromUri(R)],["faceRecognitionNet",()=>ss.faceRecognitionNet.loadFromUri(R)],["faceExpressionNet",()=>ss.faceExpressionNet.loadFromUri(R)]];for(const[D,C]of U)try{g(O=>({...O,[D]:"loading"})),await C(),g(O=>({...O,[D]:"loaded"}))}catch(O){console.error(`failed to load ${D}:`,O),g(z=>({...z,[D]:"error"})),k&&o("Some models failed to load. See diagnostics below.")}k&&s(!1)})(),()=>{k=!1}},[]);const x=()=>{const k=e.current&&e.current.srcObject;k&&k.getTracks&&k.getTracks().forEach(E=>E.stop()),e.current&&(e.current.srcObject=null)},_=async k=>{r(k),v(`Mood changed: ${k} @ ${new Date().toLocaleTimeString()}`);try{t&&t.uid&&await o_(fc(Ta,"users",t.uid),{currentMood:k,moodUpdatedAt:Id()},{merge:!0})}catch(E){console.error("Failed to write mood to firestore:",E)}try{const E=await WBe(k,5);h(E)}catch(E){console.error("Failed to fetch recommendations:",E)}},I=async()=>{if(!e.current)return null;try{const k=new u9({inputSize:160,scoreThreshold:.3}),E=await UBe(e.current,k).withFaceExpressions();if(E&&E.expressions){const R=E.expressions,U=Object.keys(R).reduce((C,O)=>R[C]>R[O]?C:O),D=R[U]||0;return v(`Detected: ${U} (confidence: ${D.toFixed(2)})`),{dominant:U,confidence:D}}return v("No face detected"),null}catch(k){return console.error("face detection error:",k),v(`Detection error: ${k.message}`),null}};return fe.useEffect(()=>()=>x(),[]),G.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm p-8 rounded-2xl max-w-md mx-auto border border-gray-700/50 shadow-2xl",children:[G.jsxs("div",{className:"text-center mb-6",children:[G.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:"Mood Detector"}),G.jsx("p",{className:"text-gray-300 text-sm",children:"Discover music that matches your current mood using AI facial recognition"})]}),i&&G.jsx("p",{className:"text-red-400 mb-4 text-center",children:i}),G.jsxs("div",{className:"mb-6",children:[c?G.jsx("div",{className:"mt-2 text-center",children:G.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-600/20 text-green-400 border border-green-500/30",children:[G.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"}),"Camera Active"]})}):G.jsx("div",{className:"mt-2 text-center",children:G.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-600/20 text-red-400 border border-red-500/30",children:[G.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full mr-2 animate-pulse"}),"Camera Active"]})}),G.jsx("video",{ref:e,className:`w-full h-48 bg-gray-700/50 rounded-xl border border-gray-900 transition-all duration-300 ${c?"ring-2 ring-green-400 shadow-lg":""}`,style:{display:"block"}})]}),G.jsx("div",{className:"mb-6",children:G.jsx("button",{onClick:async()=>{o(null),v(null),p(!0);try{const k=await navigator.mediaDevices.getUserMedia({video:!0});e.current&&(e.current.srcObject=k,await e.current.play().catch(()=>{})),await new Promise(R=>setTimeout(R,500));const E=await I();E&&E.dominant&&await _(E.dominant)}catch(k){console.error("getUserMedia/detect error:",k),o("Could not access webcam or detection failed.")}finally{x(),p(!1)}},disabled:a,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 px-6 py-3 rounded-xl text-white font-semibold hover:scale-105 transition-all duration-300 disabled:bg-gray-600 disabled:scale-100 disabled:cursor-not-allowed shadow-lg",children:a?G.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[G.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),G.jsx("span",{children:"Loading AI Models..."})]}):G.jsx("span",{children:" Detect My Mood"})})}),G.jsx("div",{className:"mb-6",children:G.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 border border-gray-600/50",children:[G.jsx("p",{className:"text-sm text-gray-300 mb-3 text-center font-medium",children:"AI Model Status"}),G.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(m).map(([k,E])=>G.jsxs("div",{className:`p-2 rounded-lg text-xs font-medium text-center transition-all duration-300 ${E==="loaded"?"bg-green-600/20 text-green-400 border border-green-500/30":E==="loading"?"bg-yellow-600/20 text-yellow-400 border border-yellow-500/30 animate-pulse":"bg-red-600/20 text-red-400 border border-red-500/30"}`,children:[k.replace(/([A-Z])/g," $1").toLowerCase(),": ",E]},k))})]})}),n&&G.jsx("div",{className:"mood-result mb-6 text-center",children:G.jsxs("p",{className:"text-xl text-white",children:["Detected Mood: ",G.jsx("span",{className:"font-bold text-yellow-400",children:n})]})}),G.jsxs("div",{className:"diagnostics bg-gray-700/50 rounded-xl p-4 border border-gray-600/50",children:[G.jsx("h4",{className:"text-white font-semibold mb-3 text-center text-lg",children:"AI Diagnostics"}),G.jsxs("div",{className:"models mb-3",children:[G.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"Model Status:"}),G.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(m).map(([k,E])=>G.jsxs("div",{className:`p-2 rounded-lg text-xs font-medium text-center transition-all duration-300 ${E==="loaded"?"bg-green-600/20 text-green-400 border border-green-500/30":E==="loading"?"bg-yellow-600/20 text-yellow-400 border border-yellow-500/30 animate-pulse":"bg-red-600/20 text-red-400 border border-red-500/30"}`,children:[k.replace(/([A-Z])/g," $1").toLowerCase(),": ",E]},k))})]}),G.jsx("div",{className:"stream mb-3 text-sm text-gray-200",children:G.jsxs("p",{children:["Webcam Active: ",G.jsx("span",{className:`font-medium ${c?"text-green-400":"text-gray-400"}`,children:c?"Yes":"No"})]})}),G.jsxs("div",{className:"log text-sm text-gray-200",children:[G.jsx("p",{className:"text-gray-300 mb-1",children:"Last Log:"}),G.jsx("p",{className:"font-mono text-sm text-yellow-300 bg-gray-800/50 p-2 rounded",children:b||""})]}),G.jsx("div",{className:"help text-xs text-gray-400 mt-3 p-2 bg-gray-800/30 rounded",children:G.jsx("p",{children:"If models show error or loading indefinitely, download weights from GitHub and place in /public/models."})})]}),l&&l.length>0&&G.jsxs("div",{className:"recommendations mt-6 bg-gray-700/50 rounded-xl p-4 border border-gray-600/50",children:[G.jsx("h3",{className:"text-white font-semibold mb-3 text-center",children:"Recommended Tracks"}),G.jsx("div",{className:"space-y-2",children:l.map(k=>G.jsxs("div",{className:"flex items-center justify-between bg-gray-600/50 p-3 rounded-lg border border-gray-500/30",children:[G.jsxs("div",{className:"flex-1 min-w-0",children:[G.jsx("p",{className:"font-medium truncate text-white",children:k.title}),G.jsx("p",{className:"text-sm text-gray-300 truncate",children:k.artist})]}),G.jsxs("button",{onClick:()=>window.dispatchEvent(new CustomEvent("playTrack",{detail:k})),className:"ml-3 flex justify-between items-center  hover:bg-green-500 px-3 py-1 rounded-lg text-white hover:scale-105 transition-all duration-300 shadow-lg text-sm",children:[G.jsx("div",{children:k.title}),G.jsx("div",{className:"p-3 rounded-lg bg-red-500",children:" Play "})]})]},k.id))})]})]})};function HBe(){const[e,t]=fe.useState([]),[n,r]=fe.useState([]),[a,s]=fe.useState(!1),[i,o]=fe.useState(!1);fe.useEffect(()=>{(async()=>{s(!0);try{const c=Ho(Ta,"tracks"),p=Jh(c,sE("createdAt","desc"),iE(10)),m=await qb(p),g=[];m.forEach(b=>{const v=b.data();console.log("Firestore track:",v),g.push({id:b.id,...v,source:"firestore"})}),g.length>0?t(g):t([])}catch(c){console.error("Failed to load free tracks:",c),t([])}finally{s(!1)}})()},[]),fe.useEffect(()=>{(async()=>{o(!0);try{const c=Ho(Ta,"tracks"),p=Jh(c,sE("createdAt","desc"),iE(10)),m=await qb(p),g=[];m.forEach(b=>{g.push({id:b.id,...b.data(),source:"firestore"})}),g.length>0?r(g):r([])}catch(c){console.error("Failed to load recommended tracks:",c),r([])}finally{o(!1)}})()},[]);const l=h=>{window.dispatchEvent(new CustomEvent("playTrack",{detail:h}))};return G.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 text-white",children:G.jsxs("div",{className:"container mx-auto px-6 py-8",children:[G.jsx("div",{className:"mb-16",children:G.jsx(jBe,{})}),G.jsxs("section",{className:"mb-16",children:[G.jsxs("div",{className:"flex items-center justify-between mb-8",children:[G.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent",children:"Free Music"}),G.jsx("div",{className:"h-1 flex-1 bg-gradient-to-r from-green-400 to-blue-400 rounded ml-4"})]}),a?G.jsx("div",{className:"flex justify-center items-center py-12",children:G.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-400"})}):e.length===0?G.jsx("div",{className:"text-center py-12",children:G.jsx("p",{className:"text-gray-400 text-lg",children:"No free tracks available right now."})}):G.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:e.map(h=>G.jsxs("div",{className:"group bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl hover:bg-gray-700/50 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl border border-gray-700/50",children:[G.jsx("div",{className:"relative mb-4",children:G.jsx("div",{className:"w-full h-40 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300",children:G.jsx("button",{onClick:()=>l(h),className:"bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center text-white hover:bg-white/30 transition-all duration-300 group-hover:scale-110",children:G.jsx("span",{className:"text-2xl",children:""})})})}),G.jsx("h3",{className:"font-bold text-lg mb-1 truncate group-hover:text-purple-300 transition-colors",children:h.title}),G.jsx("p",{className:"text-sm text-gray-400 truncate",children:h.artist})]},h.id))})]}),G.jsxs("section",{className:"mb-16",children:[G.jsxs("div",{className:"flex items-center justify-between mb-8",children:[G.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent",children:"Recommended For You"}),G.jsx("div",{className:"h-1 flex-1 bg-gradient-to-r from-orange-400 to-red-400 rounded ml-4"})]}),i?G.jsx("div",{className:"flex justify-center items-center py-12",children:G.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-400"})}):n.length===0?G.jsx("div",{className:"text-center py-12",children:G.jsx("p",{className:"text-gray-400 text-lg",children:"No recommendations available right now."})}):G.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:n.map(h=>G.jsxs("div",{className:"group bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl hover:bg-gray-700/50 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl border border-gray-700/50",children:[G.jsx("div",{className:"relative mb-4",children:G.jsx("div",{className:"w-full h-40 bg-gradient-to-br from-orange-600 to-red-600 rounded-lg flex items-center justify-center group-hover:from-orange-500 group-hover:to-red-500 transition-all duration-300",children:G.jsx("button",{onClick:()=>l(h),className:"bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center text-white hover:bg-white/30 transition-all duration-300 group-hover:scale-110",children:G.jsx("span",{className:"text-2xl",children:""})})})}),G.jsx("h3",{className:"font-bold text-lg mb-1 truncate group-hover:text-orange-300 transition-colors",children:h.title}),G.jsx("p",{className:"text-sm text-gray-400 truncate",children:h.artist})]},h.id))})]}),G.jsxs("section",{children:[G.jsxs("div",{className:"flex items-center justify-between mb-8",children:[G.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Your Playlists"}),G.jsx("div",{className:"h-1 flex-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded ml-4"})]}),G.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:[...Array(3)].map((h,c)=>G.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl hover:bg-gray-700/50 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl border border-gray-700/50",children:[G.jsx("div",{className:"w-full h-40 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg mb-4 flex items-center justify-center",children:G.jsx("span",{className:"text-4xl",children:""})}),G.jsxs("h3",{className:"font-bold text-lg mb-1",children:["My Playlist #",c+1]}),G.jsxs("p",{className:"text-sm text-gray-400",children:[Math.floor(Math.random()*20)+5," songs"]})]},c))})]})]})})}function GBe({file:e,user:t,title:n,artist:r,tags:a=[],onProgress:s}){if(!t)return Promise.reject(new Error("Not authenticated"));const i=`tracks/${t.uid}/${Date.now()}_${e.name}`,o=qre(Jre,i);return new Promise((l,h)=>{const c=Hre(o,e);c.on("state_changed",p=>{const m=Math.round(p.bytesTransferred/p.totalBytes*100);s&&s(m)},p=>h(p),async()=>{try{const p=await Gre(c.snapshot.ref),m=await _2(Ho(Ta,"tracks"),{title:n,artist:r,url:p,ownerId:t.uid,tags:a,createdAt:Id(),storagePath:i});l({url:p,storagePath:i,docId:m.id})}catch(p){h(p)}})})}function qBe({url:e,user:t,title:n,artist:r,tags:a=[]}){return t?!e||!e.startsWith("http")?Promise.reject(new Error("Invalid URL")):_2(Ho(Ta,"tracks"),{title:n,artist:r,url:e,ownerId:t.uid,tags:a,createdAt:Id()}).then(s=>({url:e,docId:s.id})):Promise.reject(new Error("Not authenticated"))}function KBe({onUploaded:e}={}){const{user:t}=Pc(),[n,r]=fe.useState("file"),[a,s]=fe.useState(null),[i,o]=fe.useState(""),[l,h]=fe.useState(""),[c,p]=fe.useState(""),[m,g]=fe.useState(""),[b,v]=fe.useState(0),[x,_]=fe.useState(""),[I,k]=fe.useState("");if(!t)return null;const E=50*1024*1024,R=["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/x-m4a","audio/mp4","audio/aac"],U=C=>{_(""),k("");const O=C.target.files?.[0];if(!O)return s(null);if(O.size>E)return _("File is too large (max 50MB)");if(!R.includes(O.type))return _("Unsupported audio format");s(O),l||h(O.name.replace(/\.[^.]+$/,""))},D=async()=>{if(_(""),k(""),n==="file"){if(!a)return _("Please choose a file first")}else if(!i)return _("Please enter a URL");try{const C=m.split(",").map(z=>z.trim()).filter(Boolean);let O;n==="file"?O=await GBe({file:a,user:t,title:l||a.name,artist:c,tags:C,onProgress:z=>v(z)}):O=await qBe({url:i,user:t,title:l||"Untitled",artist:c,tags:C}),k("Track added successfully"),s(null),o(""),h(""),p(""),g(""),v(0),e&&e(O)}catch(C){console.error(C),_(C.message||"Failed to add track")}};return G.jsxs("div",{className:"mb-6 bg-gray-900 p-4 rounded",children:[G.jsx("h3",{className:"font-semibold mb-2",children:"Add Track"}),G.jsxs("div",{className:"mb-4 flex gap-2",children:[G.jsx("button",{onClick:()=>r("file"),className:`px-3 py-1 rounded ${n==="file"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,children:"Upload File"}),G.jsx("button",{onClick:()=>r("url"),className:`px-3 py-1 rounded ${n==="url"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,children:"Add via URL"})]}),n==="file"?G.jsxs("div",{className:"mb-2",children:[G.jsx("label",{className:"block text-sm text-gray-300",children:"File"}),G.jsx("input",{type:"file",accept:"audio/*",onChange:U}),a&&G.jsxs("div",{className:"text-sm mt-1 text-gray-400",children:["Selected: ",a.name," (",Math.round(a.size/1024)," KB)"]})]}):G.jsxs("div",{className:"mb-2",children:[G.jsx("label",{className:"block text-sm text-gray-300",children:"URL"}),G.jsx("input",{type:"url",className:"w-full p-2 bg-gray-800 rounded",placeholder:"https://example.com/song.mp3",value:i,onChange:C=>o(C.target.value)})]}),G.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[G.jsx("input",{className:"p-2 bg-gray-800 rounded",placeholder:"Title",value:l,onChange:C=>h(C.target.value)}),G.jsx("input",{className:"p-2 bg-gray-800 rounded",placeholder:"Artist",value:c,onChange:C=>p(C.target.value)})]}),G.jsx("div",{className:"mb-2",children:G.jsx("input",{className:"w-full p-2 bg-gray-800 rounded",placeholder:"Tags (comma separated) eg. happy,neutral",value:m,onChange:C=>g(C.target.value)})}),G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx("button",{onClick:D,className:"bg-green-600 px-3 py-1 rounded text-white",children:n==="file"?"Upload":"Add Track"}),G.jsx("div",{className:"text-sm text-gray-400",children:b>0?`Progress: ${b}%`:""})]}),b>0&&G.jsx("div",{className:"w-full bg-gray-800 h-2 rounded mt-2",children:G.jsx("div",{className:"bg-green-500 h-2 rounded",style:{width:`${b}%`}})}),x&&G.jsx("div",{className:"text-red-400 mt-2",children:x}),I&&G.jsx("div",{className:"text-green-400 mt-2",children:I})]})}function XBe(){const{user:e,userProfile:t,logout:n}=Pc(),[r,a]=fe.useState([]),[s,i]=fe.useState([]),[o,l]=fe.useState(!1),h=async()=>{if(e){l(!0);try{const c=Ho(Ta,"tracks"),p=Jh(c,aE("ownerId","==",e.uid)),m=await qb(p),g=[];m.forEach(I=>g.push({id:I.id,...I.data()}));const b=Ho(Ta,"playlists"),v=Jh(b,aE("ownerId","==",e.uid)),x=await qb(v),_=[];x.forEach(I=>_.push({id:I.id,...I.data()})),a(g),i(_)}catch(c){console.error("Failed to load user assets:",c)}finally{l(!1)}}};return fe.useEffect(()=>{if(e)return h(),()=>{}},[e]),e?G.jsxs("div",{className:"p-4 md:p-6 text-white",children:[G.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[G.jsx("h1",{className:"text-xl md:text-2xl",children:"Profile"}),G.jsx("button",{onClick:n,className:"w-full sm:w-20 bg-red-600 text-white px-3 py-1 border rounded text-sm md:text-base",children:"Logout"})]}),G.jsxs("div",{className:"mb-6",children:[G.jsx("h2",{className:"font-semibold mb-3",children:"Account Information"}),G.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm p-4 md:p-6 rounded-xl border border-gray-700/50 shadow-lg",children:G.jsxs("div",{className:"space-y-3",children:[G.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[G.jsx("span",{className:"text-gray-400 font-medium min-w-[60px]",children:"Email:"}),G.jsx("span",{className:"text-white break-all",children:e?.email})]}),G.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[G.jsx("span",{className:"text-gray-400 font-medium min-w-[60px]",children:"User ID:"}),G.jsx("span",{className:"text-gray-300 text-sm font-mono break-all",children:e?.uid})]}),t?.username&&G.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[G.jsx("span",{className:"text-gray-400 font-medium min-w-[60px]",children:"Username:"}),G.jsx("span",{className:"text-white",children:t.username})]})]})})]}),G.jsx("div",{className:"mb-6",children:G.jsx(KBe,{onUploaded:h})}),G.jsxs("div",{className:"mb-6",children:[G.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Your Tracks"}),o?G.jsx("p",{children:"Loading..."}):r.length===0?G.jsx("p",{className:"text-gray-400",children:"No uploaded tracks found."}):G.jsx("ul",{className:"divide-y divide-gray-700",children:r.map(c=>G.jsx("li",{className:"py-2",children:G.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[G.jsxs("div",{className:"flex-1 min-w-0",children:[G.jsx("div",{className:"font-medium truncate",children:c.title||c.name||"Untitled"}),G.jsx("div",{className:"text-sm text-gray-400 truncate",children:c.artist||c.uploader||""})]}),c.url&&G.jsx("audio",{controls:!0,src:c.url,className:"w-full sm:w-48"})]})},c.id))})]}),G.jsxs("div",{children:[G.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Your Playlists"}),o?G.jsx("p",{children:"Loading..."}):s.length===0?G.jsx("p",{className:"text-gray-400",children:"No playlists found."}):G.jsx("ul",{className:"divide-y divide-gray-700",children:s.map(c=>G.jsx("li",{className:"py-2",children:G.jsx("div",{className:"flex items-center justify-between",children:G.jsxs("div",{children:[G.jsx("div",{className:"font-medium",children:c.title||c.name||"Untitled Playlist"}),G.jsx("div",{className:"text-sm text-gray-400",children:c.description||""})]})})},c.id))})]})]}):G.jsxs("div",{className:"p-6 text-white",children:[G.jsx("h1",{className:"text-2xl mb-4",children:"Profile"}),G.jsxs("p",{className:"mb-4",children:["You are not logged in. Please ",G.jsx(ji,{to:"/login",className:"underline",children:"login"})," or ",G.jsx(ji,{to:"/signup",className:"underline",children:"signup"})," to view your profile."]})]})}async function m9(e,{uid:t,displayName:n,text:r,photoURL:a=null,type:s="message",meta:i=null}){const o=Ho(Ta,"chats",e,"messages");return await _2(o,{uid:t,displayName:n||null,text:r||null,photoURL:a,type:s,meta:i,createdAt:Id()})}async function Nk(e,{uid:t,displayName:n,control:r}){return m9(e,{uid:t,displayName:n,text:null,type:"control",meta:r})}function YBe(e,t){const n=Jh(Ho(Ta,"chats",e,"messages"),sE("createdAt"));return LV(n,a=>{const s=[];a.forEach(i=>s.push({id:i.id,...i.data()})),t(s)})}async function QBe(e,t,n){const r=`${e}_${t}`,a=fc(Ta,"chat_requests",r);return await o_(a,{fromUid:e,toUid:t,fromDisplayName:n,status:"pending",createdAt:Id()}),r}async function ZBe(e){const t=fc(Ta,"chat_requests",e);await PV(t,{status:"accepted",acceptedAt:Id()})}async function JBe(e){const t=fc(Ta,"chat_requests",e);await PV(t,{status:"rejected",rejectedAt:Id()})}function e6e(e,t){const n=Jh(Ho(Ta,"chat_requests"));return LV(n,a=>{const s=[];a.forEach(i=>{const o=i.data();(o.toUid===e||o.fromUid===e)&&s.push({id:i.id,...o})}),t(s)})}function t6e(){const{user:e,userProfile:t}=Pc(),[n,r]=fe.useState(()=>{const M=localStorage.getItem(`user_chats_${e?.uid}`);return M?JSON.parse(M):[]}),[a,s]=fe.useState(null),[i,o]=fe.useState(""),[l,h]=fe.useState(""),[c,p]=fe.useState(!1),[m,g]=fe.useState([]),[b,v]=fe.useState(!1),x=fe.useRef(null);fe.useEffect(()=>{e&&n.length>0&&localStorage.setItem(`user_chats_${e.uid}`,JSON.stringify(n))},[n,e]),fe.useEffect(()=>{n.length>0&&!a&&s(n[0].id)},[n,a]),fe.useEffect(()=>{if(!a||!e)return;const M=n.find(P=>P.id===a);if(!M)return;const N=YBe(M.roomId,P=>{r(ee=>ee.map(q=>q.id===a?{...q,messages:P,lastMessage:P[P.length-1]||null}:q));const Q=P[P.length-1];Q&&Q.uid!==e.uid&&r(ee=>ee.map(q=>q.id===a&&!q.partnerDisplayName?{...q,partnerDisplayName:Q.displayName||Q.uid}:q)),P.forEach(ee=>{ee.type==="control"&&ee.meta&&window.dispatchEvent(new CustomEvent("remote-music-control",{detail:{roomId:M.roomId,from:ee.uid,control:ee.meta}}))})});return()=>N&&N()},[a,e]),fe.useEffect(()=>{if(!e)return;const M=e6e(e.uid,N=>{g(N),N.forEach(P=>{if(P.fromUid===e.uid&&P.status==="accepted"&&!n.find(ee=>ee.partnerId===P.toUid)){const ee=[e.uid,P.toUid].sort(),q=`private_${ee[0]}_${ee[1]}`,Z={id:Date.now().toString()+"_accepted",partnerId:P.toUid,partnerDisplayName:P.toDisplayName||P.toUid,roomId:q,messages:[],lastMessage:null,unreadCount:0};r(ne=>[...ne,Z])}})});return()=>M&&M()},[e,n]),fe.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[n,a]);const _=async()=>{if(!i.trim())return alert("Enter partner user ID");if(i===e.uid)return alert("Cannot chat with yourself");const M=n.find(N=>N.partnerId===i);if(M){s(M.id),o("");return}try{await QBe(e.uid,i,t?.username||e.email||e.uid),alert("Chat request sent! Wait for the other user to accept."),o("")}catch(N){console.error("Failed to send chat request",N),alert("Failed to send chat request")}},I=async M=>{try{await ZBe(M);const N=m.find(q=>q.id===M);if(!N)return;g(q=>q.filter(Z=>Z.id!==M));const P=[e.uid,N.fromUid].sort(),Q=`private_${P[0]}_${P[1]}`,ee={id:Date.now().toString(),partnerId:N.fromUid,partnerDisplayName:N.fromDisplayName,roomId:Q,messages:[],lastMessage:null,unreadCount:0};r(q=>[...q,ee]),s(ee.id)}catch(N){console.error("Failed to accept request",N),alert("Failed to accept chat request")}},k=async M=>{try{await JBe(M),g(N=>N.filter(P=>P.id!==M))}catch(N){console.error("Failed to reject request",N),alert("Failed to reject chat request")}},E=M=>{s(M),p(!1),r(N=>N.map(P=>P.id===M?{...P,unreadCount:0}:P))},R=M=>{if(r(N=>{const P=N.filter(Q=>Q.id!==M);return e&&P.length>0?localStorage.setItem(`user_chats_${e.uid}`,JSON.stringify(P)):e&&localStorage.removeItem(`user_chats_${e.uid}`),P}),a===M){const N=n.filter(P=>P.id!==M);s(N.length>0?N[0].id:null)}},U=async M=>{if(M?.preventDefault(),!l.trim()||!a)return;const N=n.find(P=>P.id===a);if(N)try{await m9(N.roomId,{uid:e.uid,displayName:t?.username||e.email||e.uid,text:l.trim(),photoURL:e.photoURL||null}),h("")}catch(P){console.error("Send failed",P),alert("Message send failed")}},D=async()=>{if(!a)return;const M=n.find(N=>N.id===a);try{await Nk(M.roomId,{uid:e.uid,displayName:t?.username||e.email||e.uid,control:{action:"play"}})}catch(N){console.error("sendPlay failed",N)}},C=async()=>{if(!a)return;const M=n.find(N=>N.id===a);try{await Nk(M.roomId,{uid:e.uid,displayName:t?.username||e.email||e.uid,control:{action:"pause"}})}catch(N){console.error("sendPause failed",N)}},O=async M=>{if(!a)return;const N=n.find(P=>P.id===a);try{await Nk(N.roomId,{uid:e.uid,displayName:t?.username||e.email||e.uid,control:{action:"seek",position:M}})}catch(P){console.error("sendSeek failed",P)}};if(!e)return G.jsx("div",{className:"p-6 text-white",children:"Please login to join the chat."});const z=n.find(M=>M.id===a);return G.jsxs("div",{className:"flex h-[calc(100vh-5rem)] bg-gray-900 text-white",children:[G.jsx("button",{onClick:()=>p(!c),className:"w-[12%] md:hidden fixed top-[9%] right-1 z-50 bg-gray-800 p-2 rounded-full border border-gray-700",children:G.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),G.jsxs("div",{className:` w-80 bg-gray-800 border-r border-gray-700 flex flex-col fixed md:relative inset-y-0 left-0 z-50 transform ${c?"translate-x-0":"-translate-x-full"} md:translate-x-0 transition-transform duration-300 ease-in-out`,children:[G.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-700",children:[G.jsxs("div",{className:"flex items-center justify-between ",children:[G.jsx("h2",{className:"text-base md:text-lg font-semibold",children:"Private Chats"}),G.jsxs("button",{onClick:()=>v(!b),className:"px-3 py-1 mt-3 rounded text-sm relative w-[30%]",children:["Requests",m.filter(M=>M.status==="pending"&&M.toUid===e.uid).length>0&&G.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-xs rounded-full px-1",children:m.filter(M=>M.status==="pending"&&M.toUid===e.uid).length})]})]}),b&&G.jsxs("div",{className:"mb-3 p-2 bg-gray-700 rounded",children:[G.jsx("h3",{className:"text-sm font-medium mb-2",children:"Chat Requests"}),m.filter(M=>M.toUid===e.uid&&M.status==="pending").length===0?G.jsx("div",{className:"text-xs text-gray-400",children:"No pending requests"}):m.filter(M=>M.toUid===e.uid&&M.status==="pending").map(M=>G.jsxs("div",{className:"flex items-center justify-between mb-2 p-2 bg-gray-600 rounded",children:[G.jsxs("div",{className:"text-xs",children:[G.jsx("div",{className:"font-medium",children:M.fromDisplayName}),G.jsx("div",{className:"text-gray-400",children:"Wants to chat"})]}),G.jsxs("div",{className:"flex gap-1",children:[G.jsx("button",{onClick:()=>I(M.id),className:"bg-green-600 px-2 py-1 rounded text-xs",children:"Accept"}),G.jsx("button",{onClick:()=>k(M.id),className:"bg-red-600 px-2 py-1 rounded text-xs",children:"Reject"})]})]},M.id))]}),G.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[G.jsx("input",{value:i,onChange:M=>o(M.target.value),className:"flex-1 p-2 bg-gray-700 rounded text-sm",placeholder:"Enter user ID",onKeyPress:M=>M.key==="Enter"&&_()}),G.jsx("button",{onClick:_,className:"bg-indigo-600 px-3 py-2 rounded text-sm w-full sm:w-[20%]",children:"Start"})]})]}),G.jsx("div",{className:"flex-1 overflow-y-auto",children:n.length===0?G.jsx("div",{className:"p-4 text-gray-400 text-center",children:"No chats yet. Start a conversation!"}):n.map(M=>G.jsx("div",{onClick:()=>E(M.id),className:`p-3 border-b border-gray-700 cursor-pointer hover:bg-gray-700 transition-colors ${a===M.id?"bg-gray-700 border-l-4 border-indigo-500":""}`,children:G.jsxs("div",{className:"flex items-center justify-between",children:[G.jsxs("div",{className:"flex-1 min-w-0",children:[G.jsx("div",{className:"font-medium text-sm truncate",children:M.partnerDisplayName||M.partnerId}),M.lastMessage&&G.jsx("div",{className:"text-xs text-gray-400 truncate mt-1",children:M.lastMessage.text||"[Control message]"})]}),M.unreadCount>0&&G.jsx("div",{className:"bg-indigo-600 text-xs rounded-full px-2 py-1 ml-2",children:M.unreadCount}),G.jsxs("button",{onClick:N=>{N.stopPropagation(),R(M.id)},className:"ml-2 text-gray-400 hover:text-red-700 hover:bg-red-400 rounded-full relative group",children:[G.jsx("span",{className:"group-hover:hidden ",children:M.partnerDisplayName||M.partnerId}),G.jsx("span",{className:"hidden group-hover:inline text-red-700",children:"delete this chat"})]})]})},M.id))})]}),G.jsx("div",{className:"flex-1 flex flex-col md:ml-0",children:z?G.jsxs(G.Fragment,{children:[G.jsx("div",{className:"p-3 md:p-4 border-b border-gray-700 bg-gray-800",children:G.jsxs("h3",{className:"text-base md:text-lg font-semibold truncate",children:["Chat with ",G.jsx("i",{children:G.jsx("u",{children:z.partnerDisplayName||z.partnerId})})]})}),G.jsxs("div",{className:"flex-1 overflow-y-auto p-3 md:p-4 bg-gray-900",children:[z.messages.length===0?G.jsx("div",{className:"text-gray-400 text-center py-8",children:"No messages yet. Say hi! "}):z.messages.map((M,N)=>G.jsxs("div",{className:`mb-3 ${M.uid===e.uid?"text-right":"text-left"}`,children:[G.jsx("div",{className:"text-xs text-gray-400 mb-1 truncate",children:M.displayName||M.uid}),M.type==="control"?G.jsxs("div",{className:"text-sm italic text-yellow-300 inline-block px-3 py-2 bg-gray-800 rounded max-w-xs break-words",children:["[Control] ",JSON.stringify(M.meta)]}):G.jsx("div",{className:`inline-block px-3 py-2 rounded max-w-xs md:max-w-sm break-words ${M.uid===e.uid?"bg-indigo-600 text-white":"bg-gray-700 text-gray-100"}`,children:M.text})]},N)),G.jsx("div",{ref:x})]}),G.jsx("div",{className:"p-3 md:p-4 border-t border-gray-700 bg-gray-800 z-10 mb-5 rounded-[20px]",children:G.jsxs("div",{className:"flex flex-col gap-2",children:[G.jsxs("form",{onSubmit:U,className:"flex gap-2",children:[G.jsx("input",{className:"flex-1 p-2 bg-gray-700 rounded text-sm",placeholder:"Type a message...",value:l,onChange:M=>h(M.target.value)}),G.jsx("button",{className:"w-[20%] md:w-[10%] bg-blue-600 px-3 py-2 rounded text-white text-sm whitespace-nowrap",children:"Send"})]}),G.jsxs("div",{className:"flex gap-2 justify-center",children:[G.jsx("button",{onClick:D,className:"w-[20%] md:w-[10%] bg-green-500 px-3 py-2 rounded text-sm",children:"Play"}),G.jsx("button",{onClick:C,className:"w-[20%] md:w-[10%] bg-yellow-500 px-3 py-2 rounded text-sm",children:"Pause"}),G.jsx("button",{onClick:()=>{const M=Number(prompt("Seek to seconds:"));Number.isNaN(M)||O(M)},className:"bg-indigo-500 px-3 py-2 rounded text-sm w-[20%] md:w-[10%]",children:"Seek"})]})]})})]}):G.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-900",children:G.jsxs("div",{className:"text-gray-400 text-center p-4",children:[G.jsx("div",{className:"text-3xl md:text-4xl mb-4",children:""}),G.jsx("div",{className:"text-sm md:text-base",children:"Select a chat or start a new conversation"})]})})})]})}function ez({children:e}){const{user:t,loading:n}=Pc();return n?G.jsx("p",{className:"text-center text-white",children:"Loading..."}):t?e:G.jsx(GK,{to:"/login",replace:!0})}function n6e(){const{user:e,logout:t}=Pc(),n=Yl();return G.jsx("nav",{className:"bg-gray-900/95 backdrop-blur-sm border-b border-gray-700/50 px-6 py-4 sticky top-0 z-50",children:G.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[G.jsx("div",{className:"text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent",children:G.jsx(ji,{to:"/",className:"",children:"MusicApp"})}),G.jsx("div",{className:"flex items-center space-x-4",children:e?G.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[n.pathname==="/"?G.jsxs(G.Fragment,{children:[G.jsx(ji,{to:"/chat",className:"-mt-3 px-2 md:px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 hover:text-blue-300 rounded-lg border border-blue-500/30 hover:border-blue-400/50 transition-all duration-300 text-sm md:text-base",children:"Chat"}),G.jsx(ji,{to:"/profile",className:"-mt-3 px-2 md:px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg text-gray-300 hover:text-white transition-all duration-300 border border-gray-600/50 hover:border-gray-500/50 text-sm md:text-base",children:"Profile"})]}):n.pathname==="/chat"?G.jsx(ji,{to:"/profile",className:"-mt-3 px-2 md:px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg text-gray-300 hover:text-white transition-all duration-300 border border-gray-600/50 hover:border-gray-500/50 text-sm md:text-base",children:"Profile"}):G.jsx(ji,{to:"/chat",className:"-mt-3 px-2 md:px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 hover:text-blue-300 rounded-lg border border-blue-500/30 hover:border-blue-400/50 transition-all duration-300 text-sm md:text-base",children:"Chat"}),G.jsx("button",{onClick:()=>t(),className:" px-2 md:px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 hover:text-red-300 rounded-lg border border-red-500/30 hover:border-red-400/50 transition-all duration-300 text-sm md:text-base",children:"Logout"})]}):G.jsxs(G.Fragment,{children:[G.jsx(ji,{to:"/login",className:"px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg text-gray-300 hover:text-white transition-all duration-300 border border-gray-600/50 hover:border-gray-500/50",children:"Login"}),G.jsx(ji,{to:"/signup",className:"px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-lg text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl",children:"Signup"})]})})]})})}const r6e=()=>{const[e,t]=fe.useState(null),[n,r]=fe.useState(!1),[a,s]=fe.useState(0),[i,o]=fe.useState(0),l=fe.useRef(null);fe.useEffect(()=>{const m=async g=>{const b=g.detail;console.log("Playing track:",b),console.log("Track URL:",b.url),console.log("Track source:",b.source);let v=b.url;b.source==="firestore"&&b.url&&console.log("Firebase Storage URL detected"),t(b),r(!0),l.current&&(l.current.src=v,l.current.load(),l.current.play().catch(x=>{console.error("Error playing audio:",x),console.error("Track details:",b),console.error("Audio src after error:",l.current.src)}))};return window.addEventListener("playTrack",m),()=>window.removeEventListener("playTrack",m)},[]);const h=()=>{l.current&&(n?l.current.pause():l.current.play().catch(console.error),r(!n))},c=()=>{l.current&&(s(l.current.currentTime),o(l.current.duration||0))},p=m=>{const g=Math.floor(m/60),b=Math.floor(m%60);return`${g}:${b.toString().padStart(2,"0")}`};return G.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-md border-t border-gray-700 p-4",children:[G.jsx("audio",{ref:l,onTimeUpdate:c,onLoadedMetadata:()=>o(l.current.duration),onEnded:()=>r(!1)}),e?G.jsxs("div",{className:"max-w-7xl mx-auto flex items-center space-x-4",children:[G.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[G.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex-shrink-0"}),G.jsxs("div",{className:"min-w-0 flex-1",children:[G.jsx("h4",{className:"text-white font-medium truncate",children:e.title}),G.jsx("p",{className:"text-gray-400 text-sm truncate",children:e.artist})]})]}),G.jsxs("div",{className:"flex flex-col items-center space-y-2 flex-1 max-w-md",children:[G.jsxs("div",{className:"flex items-center space-x-4",children:[G.jsx("button",{className:"text-gray-400 hover:text-white transition-colors",children:G.jsx("span",{className:"text-xl",children:""})}),G.jsx("button",{onClick:h,className:"bg-white text-black rounded-full w-10 h-10 flex items-center justify-center hover:scale-105 transition-transform",children:G.jsx("span",{className:"text-lg",children:n?"":""})}),G.jsx("button",{className:"text-gray-400 hover:text-white transition-colors",children:G.jsx("span",{className:"text-xl",children:""})})]}),G.jsxs("div",{className:"w-full flex items-center space-x-2",children:[G.jsx("span",{className:"text-xs text-gray-400 w-10 text-right",children:p(a)}),G.jsx("div",{className:"flex-1 h-1 bg-gray-700 rounded-full cursor-pointer relative",onClick:m=>{if(l.current){const g=m.target.getBoundingClientRect(),b=(m.clientX-g.left)/g.width;l.current.currentTime=b*i}},children:G.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full relative",style:{width:`${i?a/i*100:0}%`},children:G.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg"})})}),G.jsx("span",{className:"text-xs text-gray-400 w-10",children:p(i)})]})]}),G.jsxs("div",{className:"flex items-center space-x-2 flex-1 justify-end",children:[G.jsx("button",{className:"text-gray-400 hover:text-white transition-colors",children:G.jsx("span",{className:"text-lg",children:""})}),G.jsx("div",{className:"w-20 h-1 bg-gray-700 rounded-full",children:G.jsx("div",{className:"w-3/4 h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"})}),G.jsx("button",{className:"text-gray-400 hover:text-white transition-colors",children:G.jsx("span",{className:"text-lg",children:""})})]})]}):G.jsx("div",{className:"flex items-center justify-center text-gray-400",children:G.jsx("span",{className:"text-sm",children:"No track selected"})})]})},Ck=({children:e})=>G.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[G.jsx(n6e,{}),G.jsx("main",{className:"flex-grow p-4",children:e}),G.jsx(r6e,{})]});function a6e(){return G.jsx(eae,{children:G.jsxs(KK,{children:[G.jsx(Bf,{path:"/signup",element:G.jsx(tae,{})}),G.jsx(Bf,{path:"/login",element:G.jsx(nae,{})}),G.jsx(Bf,{path:"/",element:G.jsx(Ck,{children:G.jsx(HBe,{})})}),G.jsx(Bf,{path:"/profile",element:G.jsx(ez,{children:G.jsx(Ck,{children:G.jsx(XBe,{})})})}),G.jsx(Bf,{path:"/chat",element:G.jsx(ez,{children:G.jsx(Ck,{children:G.jsx(t6e,{})})})})]})})}rK.createRoot(document.getElementById("root")).render(G.jsx(X7.StrictMode,{children:G.jsx(yX,{children:G.jsx(a6e,{})})}));
